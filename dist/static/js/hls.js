<<<<<<< .mine
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["hls"],{"2ae8":function(t,e,r){"undefined"!==typeof window&&function(e,r){t.exports=r()}(0,(function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */function(t,e,r){"use strict";var i=Object.prototype.hasOwnProperty,n="~";function s(){}function a(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function o(t,e,r,i,s){if("function"!==typeof r)throw new TypeError("The listener must be a function");var o=new a(r,i||t,s),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function l(t,e){0===--t._eventsCount?t._events=new s:delete t._events[e]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1)),u.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)i.call(t,e)&&r.push(n?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},u.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);i<s;i++)a[i]=r[i].fn;return a},u.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},u.prototype.emit=function(t,e,r,i,s,a){var o=n?n+t:t;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,s),!0;case 6:return c.fn.call(c.context,e,r,i,s,a),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,r);break;case 4:c[u].fn.call(c[u].context,e,r,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(t,e,r){return o(this,t,e,r,!1)},u.prototype.once=function(t,e,r){return o(this,t,e,r,!0)},u.prototype.removeListener=function(t,e,r,i){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return l(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||i&&!a.once||r&&a.context!==r||l(this,s);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==e||i&&!a[o].once||r&&a[o].context!==r)&&u.push(a[o]);u.length?this._events[s]=1===u.length?u[0]:u:l(this,s)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&l(this,e)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */function(t,e,r){(function(e){var r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,i=/^([^\/?#]*)([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),e=e.trim(),!e){if(!r.alwaysNormalize)return t;var n=a.parseURL(t);if(!n)throw new Error("Error trying to parse base URL.");return n.path=a.normalizePath(n.path),a.buildURLFromParts(n)}var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return r.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):e;var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(u.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+s.path;u.path=a.normalizePath(d)}else u.path=o.path,s.params||(u.params=o.params,s.query||(u.query=o.query));return null===u.path&&(u.path=r.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(u)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){t=t.split("").reverse().join("").replace(n,"");while(t.length!==(t=t.replace(s,"")).length);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=a})()},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */function(t,e,r){function i(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r.oe=function(t){throw console.error(t),t};var i=r(r.s=ENTRY_MODULE);return i.default||i}var n="[\\.|\\-|\\+|\\w|/|@]+",s="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+n+").*?\\)";function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t){return!isNaN(1*t)}function l(t,e,i){var l={};l[i]=[];var u=e.toString(),c=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return l;var d,h=c[1],f=new RegExp("(\\\\n|\\W)"+a(h)+s,"g");while(d=f.exec(u))"dll-reference"!==d[3]&&l[i].push(d[3]);f=new RegExp("\\("+a(h)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+s,"g");while(d=f.exec(u))t[d[2]]||(l[i].push(d[1]),t[d[2]]=r(d[1]).m),l[d[2]]=l[d[2]]||[],l[d[2]].push(d[4]);for(var g=Object.keys(l),v=0;v<g.length;v++)for(var p=0;p<l[g[v]].length;p++)o(l[g[v]][p])&&(l[g[v]][p]=1*l[g[v]][p]);return l}function u(t){var e=Object.keys(t);return e.reduce((function(e,r){return e||t[r].length>0}),!1)}function c(t,e){var r={main:[e]},i={main:[]},n={main:{}};while(u(r))for(var s=Object.keys(r),a=0;a<s.length;a++){var o=s[a],c=r[o],d=c.pop();if(n[o]=n[o]||{},!n[o][d]&&t[o][d]){n[o][d]=!0,i[o]=i[o]||[],i[o].push(d);for(var h=l(t,t[o][d],o),f=Object.keys(h),g=0;g<f.length;g++)r[f[g]]=r[f[g]]||[],r[f[g]]=r[f[g]].concat(h[f[g]])}}return i}t.exports=function(t,e){e=e||{};var n={main:r.m},s=e.all?{main:Object.keys(n.main)}:c(n,t),a="";Object.keys(s).filter((function(t){return"main"!==t})).forEach((function(t){var e=0;while(s[t][e])e++;s[t].push(e),n[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+t+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s[t].map((function(e){return JSON.stringify(e)+": "+n[t][e].toString()})).join(",")+"});\n"})),a=a+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s.main.map((function(t){return JSON.stringify(t)+": "+n.main[t].toString()})).join(",")+"}))(self);";var o=new window.Blob([a],{type:"text/javascript"});if(e.bare)return o;var l=window.URL||window.webkitURL||window.mozURL||window.msURL,u=l.createObjectURL(o),d=new window.Worker(u);return d.objectURL=u,d}},"./src/config.ts":
/*!***********************!*\
  !*** ./src/config.ts ***!
  \***********************/
/*! exports provided: hlsDefaultConfig, mergeConfig, enableStreamingMode */function(t,e,r){"use strict";r.r(e),r.d(e,"hlsDefaultConfig",(function(){return L})),r.d(e,"mergeConfig",(function(){return D})),r.d(e,"enableStreamingMode",(function(){return k}));var i=r(/*! ./controller/abr-controller */"./src/controller/abr-controller.ts"),n=r(/*! ./controller/audio-stream-controller */"./src/controller/audio-stream-controller.ts"),s=r(/*! ./controller/audio-track-controller */"./src/controller/audio-track-controller.ts"),a=r(/*! ./controller/subtitle-stream-controller */"./src/controller/subtitle-stream-controller.ts"),o=r(/*! ./controller/subtitle-track-controller */"./src/controller/subtitle-track-controller.ts"),l=r(/*! ./controller/buffer-controller */"./src/controller/buffer-controller.ts"),u=r(/*! ./controller/timeline-controller */"./src/controller/timeline-controller.ts"),c=r(/*! ./controller/cap-level-controller */"./src/controller/cap-level-controller.ts"),d=r(/*! ./controller/fps-controller */"./src/controller/fps-controller.ts"),h=r(/*! ./controller/eme-controller */"./src/controller/eme-controller.ts"),f=r(/*! ./controller/cmcd-controller */"./src/controller/cmcd-controller.ts"),g=r(/*! ./utils/xhr-loader */"./src/utils/xhr-loader.ts"),v=r(/*! ./utils/fetch-loader */"./src/utils/fetch-loader.ts"),p=r(/*! ./utils/cues */"./src/utils/cues.ts"),m=r(/*! ./utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts"),y=r(/*! ./utils/logger */"./src/utils/logger.ts");function E(){return E=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},E.apply(this,arguments)}function T(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function S(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?T(Object(r),!0).forEach((function(e){b(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function b(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var L=S(S({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:g["default"],fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:i["default"],bufferController:l["default"],capLevelController:c["default"],fpsController:d["default"],stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:m["requestMediaKeySystemAccess"],testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},A()),{},{subtitleStreamController:a["SubtitleStreamController"],subtitleTrackController:o["default"],timelineController:u["TimelineController"],audioStreamController:n["default"],audioTrackController:s["default"],emeController:h["default"],cmcdController:f["default"]});function A(){return{cueHandler:p["default"],enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function D(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return E({},t,e)}function k(t){var e=t.loader;if(e!==v["default"]&&e!==g["default"])y["logger"].log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1;else{var r=Object(v["fetchSupported"])();r&&(t.loader=v["default"],t.progressive=!0,t.enableSoftwareAES=!0,y["logger"].log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/abr-controller.ts ***!
  \******************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../utils/ewma-bandwidth-estimator */"./src/utils/ewma-bandwidth-estimator.ts"),s=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),o=r(/*! ../errors */"./src/errors.ts"),l=r(/*! ../types/loader */"./src/types/loader.ts"),u=r(/*! ../utils/logger */"./src/utils/logger.ts");function c(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function d(t,e,r){return e&&c(t.prototype,e),r&&c(t,r),t}var h=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var e=t.config;this.bwEstimator=new n["default"](e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(s["Events"].FRAG_LOADING,this.onFragLoading,this),t.on(s["Events"].FRAG_LOADED,this.onFragLoaded,this),t.on(s["Events"].FRAG_BUFFERED,this.onFragBuffered,this),t.on(s["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.on(s["Events"].ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(s["Events"].FRAG_LOADING,this.onFragLoading,this),t.off(s["Events"].FRAG_LOADED,this.onFragLoaded,this),t.off(s["Events"].FRAG_BUFFERED,this.onFragBuffered,this),t.off(s["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.off(s["Events"].ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},e.onFragLoading=function(t,e){var r,i=e.frag;i.type===l["PlaylistLevelType"].MAIN&&(this.timer||(this.fragCurrent=i,this.partCurrent=null!=(r=e.part)?r:null,this.timer=self.setInterval(this.onCheck,100)))},e.onLevelLoaded=function(t,e){var r=this.hls.config;e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},e._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,n=r.autoLevelEnabled,o=r.config,l=r.media;if(t&&l){var c=e?e.stats:t.stats,d=e?e.duration:t.duration;if(c.aborted)return u["logger"].warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!l.paused&&l.playbackRate&&l.readyState){var h=performance.now()-c.loading.start,f=Math.abs(l.playbackRate);if(!(h<=500*d/f)){var g=r.levels,v=r.minAutoLevel,p=g[t.level],m=c.total||Math.max(c.loaded,Math.round(d*p.maxBitrate/8)),y=Math.max(1,c.bwEstimate?c.bwEstimate/8:1e3*c.loaded/h),E=(m-c.loaded)/y,T=l.currentTime,S=(a["BufferHelper"].bufferInfo(l,T,o.maxBufferHole).end-T)/f;if(!(S>=2*d/f||E<=S)){var b,L=Number.POSITIVE_INFINITY;for(b=t.level-1;b>v;b--){var A=g[b].maxBitrate;if(L=d*A/(6.4*y),L<S)break}if(!(L>=E)){var D=this.bwEstimator.getEstimate();u["logger"].warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+b+"\n      Current BW estimate: "+(Object(i["isFiniteNumber"])(D)?(D/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+E.toFixed(3)+" s\n      Estimated load time for the next fragment: "+L.toFixed(3)+" s\n      Time to underbuffer: "+S.toFixed(3)+" s"),r.nextLoadLevel=b,this.bwEstimator.sample(h,c.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),r.trigger(s["Events"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:c})}}}}}},e.onFragLoaded=function(t,e){var r=e.frag,n=e.part;if(r.type===l["PlaylistLevelType"].MAIN&&Object(i["isFiniteNumber"])(r.sn)){var a=n?n.stats:r.stats,o=n?n.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var u=this.hls.levels[r.level],c=(u.loaded?u.loaded.bytes:0)+a.loaded,d=(u.loaded?u.loaded.duration:0)+o;u.loaded={bytes:c,duration:d},u.realBitrate=Math.round(8*c/d)}if(r.bitrateTest){var h={stats:a,frag:r,part:n,id:r.type};this.onFragBuffered(s["Events"].FRAG_BUFFERED,h),r.bitrateTest=!1}}},e.onFragBuffered=function(t,e){var r=e.frag,i=e.part,n=i?i.stats:r.stats;if(!n.aborted&&r.type===l["PlaylistLevelType"].MAIN&&"initSegment"!==r.sn){var s=n.parsing.end-n.loading.start;this.bwEstimator.sample(s,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},e.onError=function(t,e){switch(e.details){case o["ErrorDetails"].FRAG_LOAD_ERROR:case o["ErrorDetails"].FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},e.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},e.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,s=r.minAutoLevel,o=r.media,l=e?e.duration:t?t.duration:0,c=o?o.currentTime:0,d=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,f=(a["BufferHelper"].bufferInfo(o,c,n.maxBufferHole).end-c)/d,g=this.findBestLevel(h,s,i,f,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(g>=0)return g;u["logger"].trace((f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=l?Math.min(l,n.maxStarvationDelay):n.maxStarvationDelay,p=n.abrBandWidthFactor,m=n.abrBandWidthUpFactor;if(!f){var y=this.bitrateTestDelay;if(y){var E=l?Math.min(l,n.maxLoadingDelay):n.maxLoadingDelay;v=E-y,u["logger"].trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),p=m=1}}return g=this.findBestLevel(h,s,i,f+v,p,m),Math.max(g,0)},e.findBestLevel=function(t,e,r,i,n,s){for(var a,o=this.fragCurrent,l=this.partCurrent,c=this.lastLoadedFragLevel,d=this.hls.levels,h=d[c],f=!(null===h||void 0===h||null===(a=h.details)||void 0===a||!a.live),g=null===h||void 0===h?void 0:h.codecSet,v=l?l.duration:o?o.duration:0,p=r;p>=e;p--){var m=d[p];if(m&&(!g||m.codecSet===g)){var y=m.details,E=(l?null===y||void 0===y?void 0:y.partTarget:null===y||void 0===y?void 0:y.averagetargetduration)||v,T=void 0;T=p<=c?n*t:s*t;var S=d[p].maxBitrate,b=S*E/T;if(u["logger"].trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+p+"/"+Math.round(T)+"/"+S+"/"+E+"/"+i+"/"+b),T>S&&(!b||f&&!this.bitrateTestDelay||b<i))return p}}return-1},d(t,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(-1!==t&&(!e||!e.canEstimate()))return t;var r=this.getNextABRAutoLevel();return-1!==t&&(r=Math.min(t,r)),r},set:function(t){this._nextAutoLevel=t}}]),t}();e["default"]=h},"./src/controller/audio-stream-controller.ts":
/*!***************************************************!*\
  !*** ./src/controller/audio-stream-controller.ts ***!
  \***************************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),s=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),o=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),l=r(/*! ../types/level */"./src/types/level.ts"),u=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),d=r(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts"),h=r(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),f=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),g=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),v=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),p=r(/*! ../errors */"./src/errors.ts"),m=r(/*! ../utils/logger */"./src/utils/logger.ts");function y(){return y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},y.apply(this,arguments)}function E(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,T(t,e)}function T(t,e){return T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},T(t,e)}var S=100,b=function(t){function e(e,r){var i;return i=t.call(this,e,r,"[audio-stream-controller]")||this,i.videoBuffer=null,i.videoTrackCC=-1,i.waitingVideoCC=-1,i.audioSwitch=!1,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.bufferFlushed=!1,i._registerListeners(),i}E(e,t);var r=e.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var t=this.hls;t.on(s["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.on(s["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.on(s["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.on(s["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.on(s["Events"].AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(s["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(s["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(s["Events"].ERROR,this.onError,this),t.on(s["Events"].BUFFER_RESET,this.onBufferReset,this),t.on(s["Events"].BUFFER_CREATED,this.onBufferCreated,this),t.on(s["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(s["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(s["Events"].FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var t=this.hls;t.off(s["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.off(s["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.off(s["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.off(s["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.off(s["Events"].AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(s["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(s["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(s["Events"].ERROR,this.onError,this),t.off(s["Events"].BUFFER_RESET,this.onBufferReset,this),t.off(s["Events"].BUFFER_CREATED,this.onBufferCreated,this),t.off(s["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(s["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(s["Events"].FRAG_BUFFERED,this.onFragBuffered,this)},r.onInitPtsFound=function(t,e){var r=e.frag,i=e.id,s=e.initPTS;if("main"===i){var a=r.cc;this.initPTS[r.cc]=s,this.log("InitPTS for cc: "+a+" found from main: "+s),this.videoTrackCC=a,this.state===n["State"].WAITING_INIT_PTS&&this.tick()}},r.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=n["State"].STOPPED);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(S),this.fragLoadError=0,e>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=n["State"].IDLE):(this.loadedmetadata=!1,this.state=n["State"].WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},r.doTick=function(){switch(this.state){case n["State"].IDLE:this.doTickIdle();break;case n["State"].WAITING_TRACK:var e,r=this.levels,i=this.trackId,s=null===r||void 0===r||null===(e=r[i])||void 0===e?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=n["State"].WAITING_INIT_PTS}break;case n["State"].FRAG_LOADING_WAITING_RETRY:var o,l=performance.now(),u=this.retryDate;(!u||l>=u||null!==(o=this.media)&&void 0!==o&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=n["State"].IDLE);break;case n["State"].WAITING_INIT_PTS:var c=this.waitingData;if(c){var d=c.frag,h=c.part,f=c.cache,v=c.complete;if(void 0!==this.initPTS[d.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=n["State"].FRAG_LOADING;var p=f.flush(),y={frag:d,part:h,payload:p,networkDetails:null};this._handleFragmentLoadProgress(y),v&&t.prototype._handleFragmentLoadComplete.call(this,y)}else if(this.videoTrackCC!==this.waitingVideoCC)m["logger"].log("Waiting fragment cc ("+d.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var E=this.getLoadPosition(),T=a["BufferHelper"].bufferInfo(this.mediaBuffer,E,this.config.maxBufferHole),S=Object(g["fragmentWithinToleranceTest"])(T.end,this.config.maxFragLookUpTolerance,d);S<0&&(m["logger"].log("Waiting fragment cc ("+d.cc+") @ "+d.start+" cancelled because another fragment at "+T.end+" is needed"),this.clearWaitingFragment())}}else this.state=n["State"].IDLE}this.onTickEnd()},r.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=n["State"].IDLE)},r.onTickEnd=function(){var t=this.media;if(t&&t.readyState){var e=this.mediaBuffer?this.mediaBuffer:t,r=e.buffered;!this.loadedmetadata&&r.length&&(this.loadedmetadata=!0),this.lastCurrentTime=t.currentTime}},r.doTickIdle=function(){var t,e,r=this.hls,i=this.levels,a=this.media,o=this.trackId,l=r.config;if(i&&i[o]&&(a||!this.startFragRequested&&l.startFragPrefetch)){var d=i[o],h=d.details;if(!h||h.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(h))this.state=n["State"].WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,c["ElementaryStreamTypes"].AUDIO,u["PlaylistLevelType"].AUDIO));var f=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,u["PlaylistLevelType"].AUDIO);if(null!==f){var g=f.len,v=this.getMaxBufferLength(),p=this.audioSwitch;if(!(g>=v)||p){if(!p&&this._streamEnded(f,h))return r.trigger(s["Events"].BUFFER_EOS,{type:"audio"}),void(this.state=n["State"].ENDED);var m=h.fragments,y=m[0].start,E=f.end;if(p){var T=this.getLoadPosition();E=T,h.PTSKnown&&T<y&&(f.end>y||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),a.currentTime=y+.05)}var S=this.getNextFragment(E,h);S?"identity"!==(null===(t=S.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(e=S.decryptdata)&&void 0!==e&&e.key?this.loadFragment(S,h,E):this.loadKey(S,h):this.bufferFlushed=!0}}}}},r.getMaxBufferLength=function(){var e=t.prototype.getMaxBufferLength.call(this),r=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,u["PlaylistLevelType"].MAIN);return null===r?e:Math.max(e,r.len)},r.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},r.onAudioTracksUpdated=function(t,e){var r=e.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(t){return new l["Level"](t)}))},r.onAudioTrackSwitching=function(t,e){var r=!!e.url;this.trackId=e.id;var i=this.fragCurrent;null!==i&&void 0!==i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(S):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=n["State"].IDLE):this.state=n["State"].STOPPED,this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},r.onLevelLoaded=function(t,e){this.mainDetails=e.details},r.onAudioTrackLoaded=function(t,e){var r,i=this.levels,s=e.details,a=e.id;if(i){this.log("Track "+a+" loaded ["+s.startSN+","+s.endSN+"],duration:"+s.totalduration);var o=i[a],l=0;if(s.live||null!==(r=o.details)&&void 0!==r&&r.live){var u=this.mainDetails;if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed||!u)return;!o.details&&s.hasProgramDateTime&&u.hasProgramDateTime?(Object(v["alignMediaPlaylistByPDT"])(s,u),l=s.fragments[0].start):l=this.alignPlaylists(s,o.details)}o.details=s,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(o.details,l),this.state!==n["State"].WAITING_TRACK||this.waitForCdnTuneIn(s)||(this.state=n["State"].IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+a)},r._handleFragmentLoadProgress=function(t){var e,r=t.frag,i=t.part,s=t.payload,a=this.config,o=this.trackId,l=this.levels;if(l){var c=l[o];console.assert(c,"Audio track is defined on fragment load progress");var g=c.details;console.assert(g,"Audio track details are defined on fragment load progress");var v=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2",p=this.transmuxer;p||(p=this.transmuxer=new h["default"](this.hls,u["PlaylistLevelType"].AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var y=this.initPTS[r.cc],E=null===(e=r.initSegment)||void 0===e?void 0:e.data;if(void 0!==y){var T=!1,S=i?i.index:-1,b=-1!==S,L=new f["ChunkMetadata"](r.level,r.sn,r.stats.chunkCount,s.byteLength,S,b);p.push(s,E,v,"",r,i,g.totalduration,T,L,y)}else{m["logger"].log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+g.startSN+" ,"+g.endSN+"],track "+o);var A=this.waitingData=this.waitingData||{frag:r,part:i,cache:new d["default"],complete:!1},D=A.cache;D.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=n["State"].WAITING_INIT_PTS}}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},r._handleFragmentLoadComplete=function(e){this.waitingData?this.waitingData.complete=!0:t.prototype._handleFragmentLoadComplete.call(this,e)},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(t,e){var r=e.tracks.audio;r&&(this.mediaBuffer=r.buffer),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},r.onFragBuffered=function(t,e){var r=e.frag,i=e.part;r.type===u["PlaylistLevelType"].AUDIO&&(this.fragContextChanged(r)?this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==r.sn&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(s["Events"].AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,i)))},r.onError=function(e,r){switch(r.details){case p["ErrorDetails"].FRAG_LOAD_ERROR:case p["ErrorDetails"].FRAG_LOAD_TIMEOUT:case p["ErrorDetails"].KEY_LOAD_ERROR:case p["ErrorDetails"].KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(u["PlaylistLevelType"].AUDIO,r);break;case p["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR:case p["ErrorDetails"].AUDIO_TRACK_LOAD_TIMEOUT:this.state!==n["State"].ERROR&&this.state!==n["State"].STOPPED&&(this.state=r.fatal?n["State"].ERROR:n["State"].IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case p["ErrorDetails"].BUFFER_FULL_ERROR:if("audio"===r.parent&&(this.state===n["State"].PARSING||this.state===n["State"].PARSED)){var i=!0,s=this.getFwdBufferInfo(this.mediaBuffer,u["PlaylistLevelType"].AUDIO);s&&s.len>.5&&(i=!this.reduceMaxBufferLength(s.len)),i&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},r.onBufferFlushed=function(t,e){var r=e.type;r===c["ElementaryStreamTypes"].AUDIO&&(this.bufferFlushed=!0)},r._handleTransmuxComplete=function(t){var e,r="audio",i=this.hls,a=t.remuxResult,o=t.chunkMeta,l=this.getCurrentContext(o);if(!l)return this.warn("The loading context changed while buffering fragment "+o.sn+" of level "+o.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(o.level);var u=l.frag,d=l.part,h=a.audio,f=a.text,g=a.id3,v=a.initSegment;if(!this.fragContextChanged(u)){if(this.state=n["State"].PARSING,this.audioSwitch&&h&&this.completeAudioSwitch(),null!==v&&void 0!==v&&v.tracks&&(this._bufferInitSegment(v.tracks,u,o),i.trigger(s["Events"].FRAG_PARSING_INIT_SEGMENT,{frag:u,id:r,tracks:v.tracks})),h){var p=h.startPTS,m=h.endPTS,E=h.startDTS,T=h.endDTS;d&&(d.elementaryStreams[c["ElementaryStreamTypes"].AUDIO]={startPTS:p,endPTS:m,startDTS:E,endDTS:T}),u.setElementaryStreamInfo(c["ElementaryStreamTypes"].AUDIO,p,m,E,T),this.bufferFragmentData(h,u,d,o)}if(null!==g&&void 0!==g&&null!==(e=g.samples)&&void 0!==e&&e.length){var S=y({frag:u,id:r},g);i.trigger(s["Events"].FRAG_PARSING_METADATA,S)}if(f){var b=y({frag:u,id:r},f);i.trigger(s["Events"].FRAG_PARSING_USERDATA,b)}}},r._bufferInitSegment=function(t,e,r){if(this.state===n["State"].PARSING){t.video&&delete t.video;var i=t.audio;if(i){i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:"+i.container+", codecs[parsed]=["+i.codec+"]"),this.hls.trigger(s["Events"].BUFFER_CODECS,t);var a=i.initSegment;if(null!==a&&void 0!==a&&a.byteLength){var o={type:"audio",frag:e,part:null,chunkMeta:r,parent:e.type,data:a};this.hls.trigger(s["Events"].BUFFER_APPENDING,o)}this.tick()}}},r.loadFragment=function(e,r,s){var a=this.fragmentTracker.getState(e);this.fragCurrent=e,(this.audioSwitch||a===o["FragmentState"].NOT_LOADED||a===o["FragmentState"].PARTIAL)&&("initSegment"===e.sn?this._loadInitSegment(e):r.live&&!Object(i["isFiniteNumber"])(this.initPTS[e.cc])?(this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=n["State"].WAITING_INIT_PTS):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,r,s)))},r.completeAudioSwitch=function(){var e=this.hls,r=this.media,i=this.trackId;r&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,e.trigger(s["Events"].AUDIO_TRACK_SWITCHED,{id:i})},e}(n["default"]);e["default"]=b},"./src/controller/audio-track-controller.ts":
/*!**************************************************!*\
  !*** ./src/controller/audio-track-controller.ts ***!
  \**************************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../events */"./src/events.ts"),n=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),a=r(/*! ../types/loader */"./src/types/loader.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}function u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}var d=function(t){function e(e){var r;return r=t.call(this,e,"[audio-track-controller]")||this,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.trackName="",r.selectDefaultTrack=!0,r.registerListeners(),r}u(e,t);var r=e.prototype;return r.registerListeners=function(){var t=this.hls;t.on(i["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.on(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.on(i["Events"].LEVEL_LOADING,this.onLevelLoading,this),t.on(i["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(i["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(i["Events"].ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(i["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.off(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.off(i["Events"].LEVEL_LOADING,this.onLevelLoading,this),t.off(i["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(i["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(i["Events"].ERROR,this.onError,this)},r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,t.prototype.destroy.call(this)},r.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},r.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},r.onAudioTrackLoaded=function(t,e){var r=e.id,i=e.details,n=this.tracksInGroup[r];if(n){var s=n.details;n.details=e.details,this.log("audioTrack "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,s))}else this.warn("Invalid audio track id "+r)},r.onLevelLoading=function(t,e){this.switchLevel(e.level)},r.onLevelSwitching=function(t,e){this.switchLevel(e.level)},r.switchLevel=function(t){var e=this.hls.levels[t];if(null!==e&&void 0!==e&&e.audioGroupIds){var r=e.audioGroupIds[e.urlId];if(this.groupId!==r){this.groupId=r;var n=this.tracks.filter((function(t){return!r||t.groupId===r}));this.selectDefaultTrack&&!n.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=n;var s={audioTracks:n};this.log("Updating audio tracks, "+n.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(i["Events"].AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}}},r.onError=function(e,r){t.prototype.onError.call(this,e,r),!r.fatal&&r.context&&r.context.type===a["PlaylistContextType"].AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},r.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var r=e[this.trackId];this.log("Now switching to audio-track index "+t);var n=e[t],s=n.id,a=n.groupId,o=void 0===a?"":a,l=n.name,u=n.type,c=n.url;if(this.trackId=t,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(i["Events"].AUDIO_TRACK_SWITCHING,{id:s,groupId:o,name:l,type:u,url:c}),!n.details||n.details.live){var d=this.switchParams(n.url,null===r||void 0===r?void 0:r.details);this.loadPlaylist(d)}}},r.selectInitialTrack=function(){var t=this.tracksInGroup;console.assert(t.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,r=this.findTrackId(e)||this.findTrackId();-1!==r?this.setAudioTrack(r):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].MEDIA_ERROR,details:n["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},r.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var i=e[r];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},r.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,n=e.groupId,s=e.url;if(t)try{s=t.addDirectives(s)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(i["Events"].AUDIO_TRACK_LOADING,{url:s,id:r,groupId:n,deliveryDirectives:t||null})}},l(e,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),e}(s["default"]);e["default"]=d},"./src/controller/base-playlist-controller.ts":
/*!****************************************************!*\
  !*** ./src/controller/base-playlist-controller.ts ***!
  \****************************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return l}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../types/level */"./src/types/level.ts"),s=r(/*! ./level-helper */"./src/controller/level-helper.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../errors */"./src/errors.ts"),l=function(){function t(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=a["logger"].log.bind(a["logger"],e+":"),this.warn=a["logger"].warn.bind(a["logger"],e+":"),this.hls=t}var e=t.prototype;return e.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},e.onError=function(t,e){e.fatal&&e.type===o["ErrorTypes"].NETWORK_ERROR&&this.clearTimer()},e.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},e.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},e.stopLoad=function(){this.canLoad=!1,this.clearTimer()},e.switchParams=function(t,e){var r=null===e||void 0===e?void 0:e.renditionReports;if(r)for(var s=0;s<r.length;s++){var a=r[s],o=""+a.URI;if(o===t.substr(-o.length)){var l=parseInt(a["LAST-MSN"]),u=parseInt(a["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode){var c=Math.min(e.age-e.partTarget,e.targetduration);void 0!==u&&c>e.partTarget&&(u+=1)}if(Object(i["isFiniteNumber"])(l))return new n["HlsUrlParameters"](l,Object(i["isFiniteNumber"])(u)?u:void 0,n["HlsSkip"].No)}}},e.loadPlaylist=function(t){},e.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},e.playlistLoaded=function(t,e,r){var i=this,n=e.details,a=e.stats,o=a.loading.end?Math.max(0,self.performance.now()-a.loading.end):0;if(n.advancedDateTime=Date.now()-o,n.live||null!==r&&void 0!==r&&r.live){if(n.reloaded(r),r&&this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),r&&n.fragments.length>0&&Object(s["mergeDetails"])(r,n),!this.canLoad||!n.live)return;var l,u=void 0,c=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var d=this.hls.config.lowLatencyMode,h=n.lastPartSn,f=n.endSN,g=n.lastPartIndex,v=-1!==g,p=h===f,m=d?0:g;v?(u=p?f+1:h,c=p?m:g+1):u=f+1;var y=n.age,E=y+n.ageHeader,T=Math.min(E-n.partTarget,1.5*n.targetduration);if(T>0){if(r&&T>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+T+" with playlist age: "+n.age),T=0;else{var S=Math.floor(T/n.targetduration);if(u+=S,void 0!==c){var b=Math.round(T%n.targetduration/n.partTarget);c+=b}this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+y.toFixed(2)+"s goal: "+T+" skip sn "+S+" to part "+c)}n.tuneInGoal=T}if(l=this.getDeliveryDirectives(n,e.deliveryDirectives,u,c),d||!p)return void this.loadPlaylist(l)}else l=this.getDeliveryDirectives(n,e.deliveryDirectives,u,c);var L=Object(s["computeReloadInterval"])(n,a);void 0!==u&&n.canBlockReload&&(L-=n.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(L)+" ms"),this.timer=self.setTimeout((function(){return i.loadPlaylist(l)}),L)}else this.clearTimer()},e.getDeliveryDirectives=function(t,e,r,i){var s=Object(n["getSkipValue"])(t,r);return null!==e&&void 0!==e&&e.skip&&t.deltaUpdateFailed&&(r=e.msn,i=e.part,s=n["HlsSkip"].No),new n["HlsUrlParameters"](r,i,s)},e.retryLoadingOrFail=function(t){var e,r=this,i=this.hls.config,n=this.retryCount<i.levelLoadingMaxRetry;if(n)if(this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&null!==(e=t.context)&&void 0!==e&&e.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var s=Math.min(Math.pow(2,this.retryCount)*i.levelLoadingRetryDelay,i.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return r.loadPlaylist()}),s),this.warn("retry playlist loading #"+this.retryCount+" in "+s+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return n},t}()},"./src/controller/base-stream-controller.ts":
/*!**************************************************!*\
  !*** ./src/controller/base-stream-controller.ts ***!
  \**************************************************/
/*! exports provided: State, default */function(t,e,r){"use strict";r.r(e),r.d(e,"State",(function(){return A})),r.d(e,"default",(function(){return D}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../task-loop */"./src/task-loop.ts"),s=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),a=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),l=r(/*! ../events */"./src/events.ts"),u=r(/*! ../errors */"./src/errors.ts"),c=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),d=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),h=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),f=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),g=r(/*! ./level-helper */"./src/controller/level-helper.ts"),v=r(/*! ../loader/fragment-loader */"./src/loader/fragment-loader.ts"),p=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),m=r(/*! ../utils/time-ranges */"./src/utils/time-ranges.ts"),y=r(/*! ../types/loader */"./src/types/loader.ts");function E(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function T(t,e,r){return e&&E(t.prototype,e),r&&E(t,r),t}function S(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,L(t,e)}function L(t,e){return L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},L(t,e)}var A={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},D=function(t){function e(e,r,i){var n;return n=t.call(this)||this,n.hls=void 0,n.fragPrevious=null,n.fragCurrent=null,n.fragmentTracker=void 0,n.transmuxer=null,n._state=A.STOPPED,n.media=void 0,n.mediaBuffer=void 0,n.config=void 0,n.bitrateTest=!1,n.lastCurrentTime=0,n.nextLoadPosition=0,n.startPosition=0,n.loadedmetadata=!1,n.fragLoadError=0,n.retryDate=0,n.levels=null,n.fragmentLoader=void 0,n.levelLastLoaded=null,n.startFragRequested=!1,n.decrypter=void 0,n.initPTS=[],n.onvseeking=null,n.onvended=null,n.logPrefix="",n.log=void 0,n.warn=void 0,n.logPrefix=i,n.log=o["logger"].log.bind(o["logger"],i+":"),n.warn=o["logger"].warn.bind(o["logger"],i+":"),n.hls=e,n.fragmentLoader=new v["default"](e.config),n.fragmentTracker=r,n.config=e.config,n.decrypter=new p["default"](e,e.config),e.on(l["Events"].KEY_LOADED,n.onKeyLoaded,S(n)),n}b(e,t);var r=e.prototype;return r.doTick=function(){this.onTickEnd()},r.onTickEnd=function(){},r.startLoad=function(t){},r.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=A.STOPPED},r._streamEnded=function(t,e){var r=this.fragCurrent,i=this.fragmentTracker;if(!e.live&&r&&r.sn===e.endSN&&!t.nextStart){var n=i.getState(r);return n===s["FragmentState"].PARTIAL||n===s["FragmentState"].OK}return!1},r.onMediaAttached=function(t,e){var r=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.state===A.STOPPED&&this.startLoad(i.startPosition)},r.onMediaDetaching=function(){var t=this.media;null!==t&&void 0!==t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},r.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,r=this.media,n=this.mediaBuffer,s=this.state,o=r?r.currentTime:0,l=a["BufferHelper"].bufferInfo(n||r,o,t.maxBufferHole);if(this.log("media seeking to "+(Object(i["isFiniteNumber"])(o)?o.toFixed(3):o)+", state: "+s),s===A.ENDED)this.resetLoadingState();else if(e&&!l.len){var u=t.maxFragLookUpTolerance,c=e.start-u,d=e.start+e.duration+u,h=o>d;(o<c||h)&&(h&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.resetLoadingState())}r&&(this.lastCurrentTime=o),this.loadedmetadata||l.len||(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()},r.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.onKeyLoaded=function(t,e){if(this.state===A.KEY_LOADING&&e.frag===this.fragCurrent&&this.levels){this.state=A.IDLE;var r=this.levels[e.frag.level].details;r&&this.loadFragment(e.frag,r,e.frag.start)}},r.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function(){this.state=A.STOPPED,this.hls.off(l["Events"].KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},r.loadKey=function(t,e){this.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=A.KEY_LOADING,this.fragCurrent=t,this.hls.trigger(l["Events"].KEY_LOADING,{frag:t})},r.loadFragment=function(t,e,r){this._loadFragForPlayback(t,e,r)},r._loadFragForPlayback=function(t,e,r){var i=this,n=function(e){if(i.fragContextChanged(t))return i.warn("Fragment "+t.sn+(e.part?" p: "+e.part.index:"")+" of level "+t.level+" was dropped during download."),void i.fragmentTracker.removeFragment(t);t.stats.chunkCount++,i._handleFragmentLoadProgress(e)};this._doFragLoad(t,e,r,n).then((function(e){if(e){i.fragLoadError=0;var r=i.state;if(!i.fragContextChanged(t))return"payload"in e&&(i.log("Loaded fragment "+t.sn+" of level "+t.level),i.hls.trigger(l["Events"].FRAG_LOADED,e),i.state===A.BACKTRACKING)?(i.fragmentTracker.backtrack(t,e),void i.resetFragmentLoading(t)):void i._handleFragmentLoadComplete(e);(r===A.FRAG_LOADING||r===A.BACKTRACKING||!i.fragCurrent&&r===A.PARSING)&&(i.fragmentTracker.removeFragment(t),i.state=A.IDLE)}})).catch((function(e){i.warn(e),i.resetFragmentLoading(t)}))},r.flushMainBuffer=function(t,e,r){if(void 0===r&&(r=null),t-e){var i={startOffset:t,endOffset:e,type:r};this.fragLoadError=0,this.hls.trigger(l["Events"].BUFFER_FLUSHING,i)}},r._loadInitSegment=function(t){var e=this;this._doFragLoad(t).then((function(r){if(!r||e.fragContextChanged(t)||!e.levels)throw new Error("init load aborted");return r})).then((function(r){var i=e.hls,n=r.payload,s=t.decryptdata;if(n&&n.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var a=self.performance.now();return e.decrypter.webCryptoDecrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer).then((function(e){var n=self.performance.now();return i.trigger(l["Events"].FRAG_DECRYPTED,{frag:t,payload:e,stats:{tstart:a,tdecrypt:n}}),r.payload=e,r}))}return r})).then((function(r){var i=e.fragCurrent,n=e.hls,s=e.levels;if(!s)throw new Error("init load aborted, missing levels");var a=s[t.level].details;console.assert(a,"Level details are defined when init segment is loaded");var o=t.stats;e.state=A.IDLE,e.fragLoadError=0,t.data=new Uint8Array(r.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),r.frag===i&&n.trigger(l["Events"].FRAG_BUFFERED,{stats:o,frag:i,part:null,id:t.type}),e.tick()})).catch((function(r){e.warn(r),e.resetFragmentLoading(t)}))},r.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},r.fragBufferedComplete=function(t,e){var r=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+m["default"].toString(a["BufferHelper"].getBuffered(r))),this.state=A.IDLE,this.tick()},r._handleFragmentLoadComplete=function(t){var e=this.transmuxer;if(e){var r=t.frag,i=t.part,n=t.partsLoaded,s=!n||0===n.length||n.some((function(t){return!t})),a=new c["ChunkMetadata"](r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!s);e.flush(a)}},r._handleFragmentLoadProgress=function(t){},r._doFragLoad=function(t,e,r,n){var s=this;if(void 0===r&&(r=null),!this.levels)throw new Error("frag load aborted, missing levels");if(r=Math.max(t.start,r||0),this.config.lowLatencyMode&&e){var a=e.partList;if(a&&n){r>t.end&&e.fragmentHint&&(t=e.fragmentHint);var o=this.getNextPart(a,t,r);if(o>-1){var u=a[o];return this.log("Loading part sn: "+t.sn+" p: "+u.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+o+"-"+(a.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=u.start+u.duration,this.state=A.FRAG_LOADING,this.hls.trigger(l["Events"].FRAG_LOADING,{frag:t,part:a[o],targetBufferTime:r}),this.doFragPartsLoad(t,a,o,n).catch((function(t){return s.handleFragLoadError(t)}))}if(!t.url||this.loadedEndOfParts(a,r))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),Object(i["isFiniteNumber"])(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=A.FRAG_LOADING,this.hls.trigger(l["Events"].FRAG_LOADING,{frag:t,targetBufferTime:r}),this.fragmentLoader.load(t,n).catch((function(t){return s.handleFragLoadError(t)}))},r.doFragPartsLoad=function(t,e,r,i){var n=this;return new Promise((function(s,a){var o=[],u=function r(u){var c=e[u];n.fragmentLoader.loadPart(t,c,i).then((function(i){o[c.index]=i;var a=i.part;n.hls.trigger(l["Events"].FRAG_LOADED,i);var d=e[u+1];if(!d||d.fragment!==t)return s({frag:t,part:a,partsLoaded:o});r(u+1)})).catch(a)};u(r)}))},r.handleFragLoadError=function(t){var e=t.data;return e&&e.details===u["ErrorDetails"].INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(l["Events"].ERROR,e),null},r._handleTransmuxerFlush=function(t){var e=this.getCurrentContext(t);if(e&&this.state===A.PARSING){var r=e.frag,i=e.part,n=e.level,s=self.performance.now();r.stats.parsing.end=s,i&&(i.stats.parsing.end=s),this.updateLevelTiming(r,i,n,t.partial)}else this.fragCurrent||(this.state=A.IDLE)},r.getCurrentContext=function(t){var e=this.levels,r=t.level,i=t.sn,n=t.part;if(!e||!e[r])return this.warn("Levels object was unset while buffering fragment "+i+" of level "+r+". The current chunk will not be buffered."),null;var s=e[r],a=n>-1?Object(g["getPartWith"])(s,i,n):null,o=a?a.fragment:Object(g["getFragmentWithSN"])(s,i,this.fragCurrent);return o?{frag:o,part:a,level:s}:null},r.bufferFragmentData=function(t,e,r,i){if(t&&this.state===A.PARSING){var n=t.data1,s=t.data2,a=n;if(n&&s&&(a=Object(d["appendUint8Array"])(n,s)),a&&a.length){var o={type:t.type,frag:e,part:r,chunkMeta:i,parent:e.type,data:a};this.hls.trigger(l["Events"].BUFFER_APPENDING,o),t.dropped&&t.independent&&!r&&this.flushBufferGap(e)}}},r.flushBufferGap=function(t){var e=this.media;if(e)if(a["BufferHelper"].isBuffered(e,e.currentTime)){var r=e.currentTime,i=a["BufferHelper"].bufferInfo(e,r,0),n=t.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),o=Math.max(Math.min(t.start-s,i.end-s),r+s);t.start-o>s&&this.flushMainBuffer(o,t.start)}else this.flushMainBuffer(0,t.start)},r.getFwdBufferInfo=function(t,e){var r=this.config,n=this.getLoadPosition();if(!Object(i["isFiniteNumber"])(n))return null;var s=a["BufferHelper"].bufferInfo(t,n,r.maxBufferHole);if(0===s.len&&void 0!==s.nextStart){var o=this.fragmentTracker.getBufferedFrag(n,e);if(o&&s.nextStart<o.end)return a["BufferHelper"].bufferInfo(t,n,Math.max(s.nextStart,r.maxBufferHole))}return s},r.getMaxBufferLength=function(t){var e,r=this.config;return e=t?Math.max(8*r.maxBufferSize/t,r.maxBufferLength):r.maxBufferLength,Math.min(e,r.maxMaxBufferLength)},r.reduceMaxBufferLength=function(t){var e=this.config,r=t||e.maxBufferLength;return e.maxMaxBufferLength>=r&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},r.getNextFragment=function(t,e){var r,i,n=e.fragments,s=n.length;if(!s)return null;var a,o=this.config,l=n[0].start;if(e.live){var u=o.initialLiveManifestSize;if(s<u)return this.warn("Not enough fragments to start playback (have: "+s+", need: "+u+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(a=this.getInitialLiveFragment(e,n),this.startPosition=a?this.hls.liveSyncPosition||a.start:t)}else t<=l&&(a=n[0]);if(!a){var c=o.lowLatencyMode?e.partEnd:e.fragmentEnd;a=this.getFragmentAtPosition(t,c,e)}return null===(r=a)||void 0===r||!r.initSegment||null!==(i=a)&&void 0!==i&&i.initSegment.data||this.bitrateTest||(a=a.initSegment),a},r.getNextPart=function(t,e,r){for(var i=-1,n=!1,s=!0,a=0,o=t.length;a<o;a++){var l=t[a];if(s=s&&!l.independent,i>-1&&r<l.start)break;var u=l.loaded;!u&&(n||l.independent||s)&&l.fragment===e&&(i=a),n=u}return i},r.loadedEndOfParts=function(t,e){var r=t[t.length-1];return r&&e>r.start&&r.loaded},r.getInitialLiveFragment=function(t,e){var r=this.fragPrevious,i=null;if(r){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),i=Object(f["findFragmentByPDT"])(e,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){var n=r.sn+1;if(n>=t.startSN&&n<=t.endSN){var s=e[n-t.startSN];r.cc===s.cc&&(i=s,this.log("Live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=Object(f["findFragWithCC"])(e,r.cc),i&&this.log("Live playlist, switching playlist, load frag with same CC: "+i.sn))}}else{var a=this.hls.liveSyncPosition;null!==a&&(i=this.getFragmentAtPosition(a,this.bitrateTest?t.fragmentEnd:t.edge,t))}return i},r.getFragmentAtPosition=function(t,e,r){var i,n=this.config,a=this.fragPrevious,o=r.fragments,l=r.endSN,u=r.fragmentHint,c=n.maxFragLookUpTolerance,d=!!(n.lowLatencyMode&&r.partList&&u);if(d&&u&&!this.bitrateTest&&(o=o.concat(u),l=u.sn),t<e){var h=t>e-c?0:c;i=Object(f["findFragmentByPTS"])(a,o,t,h)}else i=o[o.length-1];if(i){var g=i.sn-r.startSN,v=a&&i.level===a.level,p=o[g+1],m=this.fragmentTracker.getState(i);if(m===s["FragmentState"].BACKTRACKED){i=null;var y=g;while(o[y]&&this.fragmentTracker.getState(o[y])===s["FragmentState"].BACKTRACKED)i=a?o[y--]:o[--y];i||(i=p)}else a&&i.sn===a.sn&&!d&&v&&(i.sn<l&&this.fragmentTracker.getState(p)!==s["FragmentState"].OK?(this.log("SN "+i.sn+" just loaded, load next one: "+p.sn),i=p):i=null)}return i},r.synchronizeToLiveEdge=function(t){var e=this.config,r=this.media;if(r){var i=this.hls.liveSyncPosition,n=r.currentTime,s=t.fragments[0].start,a=t.edge,o=n>=s-e.maxFragLookUpTolerance&&n<=a;if(null!==i&&r.duration>i&&(n<i||!o)){var l=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!o&&r.readyState<4||n<a-l)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn("Playback: "+n.toFixed(3)+" is located too far from the end of live sliding playlist: "+a+", reset currentTime to : "+i.toFixed(3)),r.currentTime=i))}}},r.alignPlaylists=function(t,e){var r=this.levels,n=this.levelLastLoaded,s=this.fragPrevious,a=null!==n?r[n]:null,o=t.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var l=t.fragments[0].start,u=!e,c=t.alignedSliding&&Object(i["isFiniteNumber"])(l);if(u||!c&&!l){Object(h["alignStream"])(s,a,t);var d=t.fragments[0].start;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(s?s.sn:"na")+" fragments: "+o),d}return l},r.waitForCdnTuneIn=function(t){var e=3;return t.live&&t.canBlockReload&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*e)},r.setStartPosition=function(t,e){var r=this.startPosition;if(r<e&&(r=-1),-1===r||-1===this.lastCurrentTime){var n=t.startTimeOffset;Object(i["isFiniteNumber"])(n)?(r=e+n,n<0&&(r+=t.totalduration),r=Math.min(Math.max(e,r),e+t.totalduration),this.log("Start time offset "+n+" found in playlist, adjust startPosition to "+r),this.startPosition=r):t.live?r=this.hls.liveSyncPosition||e:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r},r.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},r.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part"+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},r.resetFragmentLoading=function(t){this.fragCurrent&&this.fragContextChanged(t)||(this.state=A.IDLE)},r.onFragmentOrKeyLoadError=function(t,e){if(!e.fatal){var r=e.frag;if(r&&r.type===t){var i=this.fragCurrent;console.assert(i&&r.sn===i.sn&&r.level===i.level&&r.urlId===i.urlId,"Frag load error must match current frag to retry");var n=this.config;if(this.fragLoadError+1<=n.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(r.level))return;var s=Math.min(Math.pow(2,this.fragLoadError)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);this.warn("Fragment "+r.sn+" of "+t+" "+r.level+" failed to load, retrying in "+s+"ms"),this.retryDate=self.performance.now()+s,this.fragLoadError++,this.state=A.FRAG_LOADING_WAITING_RETRY}else e.levelRetry?(t===y["PlaylistLevelType"].AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=A.IDLE):(o["logger"].error(e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.stopLoad(),this.state=A.ERROR)}}},r.afterBufferFlushed=function(t,e,r){if(t){var i=a["BufferHelper"].getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,i,r),this.state===A.ENDED&&this.resetLoadingState()}},r.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=A.IDLE},r.resetLiveStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var e=this.levels?this.levels[t].details:null;if(null!==e&&void 0!==e&&e.live)return this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},r.updateLevelTiming=function(t,e,r,i){var n=this,s=r.details;console.assert(!!s,"level.details must be defined");var a=Object.keys(t.elementaryStreams).reduce((function(e,a){var o=t.elementaryStreams[a];if(o){var u=o.endPTS-o.startPTS;if(u<=0)return n.warn("Could not parse fragment "+t.sn+" "+a+" duration reliably ("+u+") resetting transmuxer to fallback to playlist timing"),n.resetTransmuxer(),e||!1;var c=i?0:Object(g["updateFragPTSDTS"])(s,t,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return n.hls.trigger(l["Events"].LEVEL_PTS_UPDATED,{details:s,level:r,drift:c,type:a,frag:t,start:o.startPTS,end:o.endPTS}),!0}return e}),!1);a?(this.state=A.PARSED,this.hls.trigger(l["Events"].FRAG_PARSED,{frag:t,part:e})):this.resetLoadingState()},r.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},T(e,[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}]),e}(n["default"])},"./src/controller/buffer-controller.ts":
/*!*********************************************!*\
  !*** ./src/controller/buffer-controller.ts ***!
  \*********************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return f}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=r(/*! ../errors */"./src/errors.ts"),o=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),l=r(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),u=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),c=r(/*! ./buffer-operation-queue */"./src/controller/buffer-operation-queue.ts"),d=Object(l["getMediaSource"])(),h=/([ha]vc.)(?:\.[^.,]+)+/,f=function(){function t(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=e.hls,r=e.media,i=e.mediaSource;s["logger"].log("[buffer-controller]: Media source opened"),r&&(e.updateMediaElementDuration(),t.trigger(n["Events"].MEDIA_ATTACHED,{media:r})),i&&i.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){s["logger"].log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){s["logger"].log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var e=t.prototype;return e.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},e.destroy=function(){this.unregisterListeners(),this.details=null},e.registerListeners=function(){var t=this.hls;t.on(n["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(n["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.on(n["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.on(n["Events"].BUFFER_RESET,this.onBufferReset,this),t.on(n["Events"].BUFFER_APPENDING,this.onBufferAppending,this),t.on(n["Events"].BUFFER_CODECS,this.onBufferCodecs,this),t.on(n["Events"].BUFFER_EOS,this.onBufferEos,this),t.on(n["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(n["Events"].LEVEL_UPDATED,this.onLevelUpdated,this),t.on(n["Events"].FRAG_PARSED,this.onFragParsed,this),t.on(n["Events"].FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=function(){var t=this.hls;t.off(n["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(n["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.off(n["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.off(n["Events"].BUFFER_RESET,this.onBufferReset,this),t.off(n["Events"].BUFFER_APPENDING,this.onBufferAppending,this),t.off(n["Events"].BUFFER_CODECS,this.onBufferCodecs,this),t.off(n["Events"].BUFFER_EOS,this.onBufferEos,this),t.off(n["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(n["Events"].LEVEL_UPDATED,this.onLevelUpdated,this),t.off(n["Events"].FRAG_PARSED,this.onFragParsed,this),t.off(n["Events"].FRAG_CHANGED,this.onFragChanged,this)},e._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new c["default"](this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},e.onManifestParsed=function(t,e){var r=2;(e.audio&&!e.video||!e.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,s["logger"].log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},e.onMediaAttaching=function(t,e){var r=this.media=e.media;if(r&&d){var i=this.mediaSource=new d;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src}},e.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,r=this._objectUrl;if(e){if(s["logger"].log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(i){s["logger"].warn("[buffer-controller]: onMediaDetaching: "+i.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(r&&self.URL.revokeObjectURL(r),t.src===r?(t.removeAttribute("src"),t.load()):s["logger"].warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(n["Events"].MEDIA_DETACHED,void 0)},e.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach((function(e){var r=t.sourceBuffer[e];try{r&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(r),t.sourceBuffer[e]=void 0)}catch(i){s["logger"].warn("[buffer-controller]: Failed to reset the "+e+" buffer",i)}})),this._initSourceBuffer()},e.onBufferCodecs=function(t,e){var r=this,i=this.getSourceBufferTypes().length;Object.keys(e).forEach((function(t){if(i){var n=r.tracks[t];if(n&&"function"===typeof n.buffer.changeType){var s=e[t],a=s.codec,o=s.levelCodec,l=s.container,u=(n.levelCodec||n.codec).replace(h,"$1"),c=(o||a).replace(h,"$1");if(u!==c){var d=l+";codecs="+(o||a);r.appendChangeType(t,d)}}}else r.pendingTracks[t]=e[t]})),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},e.appendChangeType=function(t,e){var r=this,i=this.operationQueue,n={execute:function(){var n=r.sourceBuffer[t];n&&(s["logger"].log("[buffer-controller]: changing "+t+" sourceBuffer type to "+e),n.changeType(e)),i.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(e){s["logger"].warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",e)}};i.append(n,t)},e.onBufferAppending=function(t,e){var r=this,i=this.hls,l=this.operationQueue,u=this.tracks,c=e.data,d=e.type,h=e.frag,f=e.part,g=e.chunkMeta,v=g.buffering[d],p=self.performance.now();v.start=p;var m=h.stats.buffering,y=f?f.stats.buffering:null;0===m.start&&(m.start=p),y&&0===y.start&&(y.start=p);var E=u.audio,T="audio"===d&&1===g.id&&"audio/mpeg"===(null===E||void 0===E?void 0:E.container),S={execute:function(){if(v.executeStart=self.performance.now(),T){var t=r.sourceBuffer[d];if(t){var e=h.start-t.timestampOffset;Math.abs(e)>=.1&&(s["logger"].log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+e+") sn: "+h.sn+")"),t.timestampOffset=h.start)}}r.appendExecutor(c,d)},onStart:function(){},onComplete:function(){var t=self.performance.now();v.executeEnd=v.end=t,0===m.first&&(m.first=t),y&&0===y.first&&(y.first=t);var e=r.sourceBuffer,i={};for(var s in e)i[s]=o["BufferHelper"].getBuffered(e[s]);r.appendError=0,r.hls.trigger(n["Events"].BUFFER_APPENDED,{type:d,frag:h,part:f,chunkMeta:g,parent:h.type,timeRanges:i})},onError:function(t){s["logger"].error("[buffer-controller]: Error encountered while trying to append to the "+d+" SourceBuffer",t);var e={type:a["ErrorTypes"].MEDIA_ERROR,parent:h.type,details:a["ErrorDetails"].BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=a["ErrorDetails"].BUFFER_FULL_ERROR:(r.appendError++,e.details=a["ErrorDetails"].BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(s["logger"].error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0)),i.trigger(n["Events"].ERROR,e)}};l.append(S,d)},e.onBufferFlushing=function(t,e){var r=this,i=this.operationQueue,a=function(t){return{execute:r.removeExecutor.bind(r,t,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(n["Events"].BUFFER_FLUSHED,{type:t})},onError:function(e){s["logger"].warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",e)}}};e.type?i.append(a(e.type),e.type):this.getSourceBufferTypes().forEach((function(t){i.append(a(t),t)}))},e.onFragParsed=function(t,e){var r=this,i=e.frag,a=e.part,o=[],l=a?a.elementaryStreams:i.elementaryStreams;l[u["ElementaryStreamTypes"].AUDIOVIDEO]?o.push("audiovideo"):(l[u["ElementaryStreamTypes"].AUDIO]&&o.push("audio"),l[u["ElementaryStreamTypes"].VIDEO]&&o.push("video"));var c=function(){var t=self.performance.now();i.stats.buffering.end=t,a&&(a.stats.buffering.end=t);var e=a?a.stats:i.stats;r.hls.trigger(n["Events"].FRAG_BUFFERED,{frag:i,part:a,stats:e,id:i.type})};0===o.length&&s["logger"].warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(c,o)},e.onFragChanged=function(t,e){this.flushBackBuffer()},e.onBufferEos=function(t,e){var r=this,i=this.getSourceBufferTypes().reduce((function(t,i){var n=r.sourceBuffer[i];return e.type&&e.type!==i||n&&!n.ended&&(n.ended=!0,s["logger"].log("[buffer-controller]: "+i+" sourceBuffer now EOS")),t&&!(n&&!n.ended)}),!0);i&&this.blockBuffers((function(){var t=r.mediaSource;t&&"open"===t.readyState&&t.endOfStream()}))},e.onLevelUpdated=function(t,e){var r=e.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},e.flushBackBuffer=function(){var t=this.hls,e=this.details,r=this.media,s=this.sourceBuffer;if(r&&null!==e){var a=this.getSourceBufferTypes();if(a.length){var l=e.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(i["isFiniteNumber"])(l)&&!(l<0)){var u=r.currentTime,c=e.levelTargetDuration,d=Math.max(l,c),h=Math.floor(u/c)*c-d;a.forEach((function(r){var i=s[r];if(i){var a=o["BufferHelper"].getBuffered(i);a.length>0&&h>a.start(0)&&(t.trigger(n["Events"].BACK_BUFFER_REACHED,{bufferEnd:h}),e.live&&t.trigger(n["Events"].LIVE_BACK_BUFFER_REACHED,{bufferEnd:h}),t.trigger(n["Events"].BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:r}))}}))}}}},e.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,e=this.hls,r=this.media,n=this.mediaSource,a=t.fragments[0].start+t.totalduration,o=r.duration,l=Object(i["isFiniteNumber"])(n.duration)?n.duration:0;t.live&&e.config.liveDurationInfinity?(s["logger"].log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(t)):(a>l&&a>o||!Object(i["isFiniteNumber"])(o))&&(s["logger"].log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),n.duration=a)}},e.updateSeekableRange=function(t){var e=this.mediaSource,r=t.fragments,i=r.length;if(i&&t.live&&null!==e&&void 0!==e&&e.setLiveSeekableRange){var n=Math.max(0,r[0].start),s=Math.max(n,n+t.totalduration);e.setLiveSeekableRange(n,s)}},e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!t||2===i){this.createSourceBuffers(r),this.pendingTracks={};var s=this.getSourceBufferTypes();if(0===s.length)return void this.hls.trigger(n["Events"].ERROR,{type:a["ErrorTypes"].MEDIA_ERROR,details:a["ErrorDetails"].BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach((function(t){e.executeNext(t)}))}},e.createSourceBuffers=function(t){var e=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var i=0;for(var o in t)if(!e[o]){var l=t[o];if(!l)throw Error("source buffer exists for track "+o+", however track does not");var u=l.levelCodec||l.codec,c=l.container+";codecs="+u;s["logger"].log("[buffer-controller]: creating sourceBuffer("+c+")");try{var d=e[o]=r.addSourceBuffer(c),h=o;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[o]={buffer:d,codec:u,container:l.container,levelCodec:l.levelCodec,id:l.id},i++}catch(f){s["logger"].error("[buffer-controller]: error while trying to add sourceBuffer: "+f.message),this.hls.trigger(n["Events"].ERROR,{type:a["ErrorTypes"].MEDIA_ERROR,details:a["ErrorDetails"].BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,mimeType:c})}}i&&this.hls.trigger(n["Events"].BUFFER_CREATED,{tracks:this.tracks})},e._onSBUpdateStart=function(t){var e=this.operationQueue,r=e.current(t);r.onStart()},e._onSBUpdateEnd=function(t){var e=this.operationQueue,r=e.current(t);r.onComplete(),e.shiftAndExecuteNext(t)},e._onSBUpdateError=function(t,e){s["logger"].error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(n["Events"].ERROR,{type:a["ErrorTypes"].MEDIA_ERROR,details:a["ErrorDetails"].BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(t);r&&r.onError(e)},e.removeExecutor=function(t,e,r){var n=this.media,a=this.mediaSource,o=this.operationQueue,l=this.sourceBuffer,u=l[t];if(!n||!a||!u)return s["logger"].warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(t);var c=Object(i["isFiniteNumber"])(n.duration)?n.duration:1/0,d=Object(i["isFiniteNumber"])(a.duration)?a.duration:1/0,h=Math.max(0,e),f=Math.min(r,c,d);f>h?(s["logger"].log("[buffer-controller]: Removing ["+h+","+f+"] from the "+t+" SourceBuffer"),console.assert(!u.updating,t+" sourceBuffer must not be updating"),u.remove(h,f)):o.shiftAndExecuteNext(t)},e.appendExecutor=function(t,e){var r=this.operationQueue,i=this.sourceBuffer,n=i[e];if(!n)return s["logger"].warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);n.ended=!1,console.assert(!n.updating,e+" sourceBuffer must not be updating"),n.appendBuffer(t)},e.blockBuffers=function(t,e){var r=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return s["logger"].log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var i=this.operationQueue,n=e.map((function(t){return i.appendBlocker(t)}));Promise.all(n).then((function(){t(),e.forEach((function(t){var e=r.sourceBuffer[t];e&&e.updating||i.shiftAndExecuteNext(t)}))}))},e.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},e.addBufferListener=function(t,e,r){var i=this.sourceBuffer[t];if(i){var n=r.bind(this,t);this.listeners[t].push({event:e,listener:n}),i.addEventListener(e,n)}},e.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach((function(t){e.removeEventListener(t.event,t.listener)}))},t}()},"./src/controller/buffer-operation-queue.ts":
/*!**************************************************!*\
  !*** ./src/controller/buffer-operation-queue.ts ***!
  \**************************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return n}));var i=r(/*! ../utils/logger */"./src/utils/logger.ts"),n=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var e=t.prototype;return e.append=function(t,e){var r=this.queues[e];r.push(t),1===r.length&&this.buffers[e]&&this.executeNext(e)},e.insertAbort=function(t,e){var r=this.queues[e];r.unshift(t),this.executeNext(e)},e.appendBlocker=function(t){var e,r=new Promise((function(t){e=t})),i={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,t),r},e.executeNext=function(t){var e=this.buffers,r=this.queues,n=e[t],s=r[t];if(s.length){var a=s[0];try{a.execute()}catch(o){i["logger"].warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),a.onError(o),n&&n.updating||(s.shift(),this.executeNext(t))}}},e.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},e.current=function(t){return this.queues[t][0]},t}()},"./src/controller/cap-level-controller.ts":
/*!************************************************!*\
  !*** ./src/controller/cap-level-controller.ts ***!
  \************************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../events */"./src/events.ts");function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var a=function(){function t(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},e.registerListeners=function(){var t=this.hls;t.on(i["Events"].FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(i["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.on(i["Events"].BUFFER_CODECS,this.onBufferCodecs,this),t.on(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this)},e.unregisterListener=function(){var t=this.hls;t.off(i["Events"].FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(i["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.off(i["Events"].BUFFER_CODECS,this.onBufferCodecs,this),t.off(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this)},e.onFpsDropLevelCapping=function(e,r){t.isLevelAllowed(r.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(r.droppedLevel)},e.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null},e.onManifestParsed=function(t,e){var r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},e.onBufferCodecs=function(t,e){var r=this.hls;r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},e.onMediaDetaching=function(){this.stopCapping()},e.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var t=this.hls.levels;if(t.length){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},e.getMaxLevel=function(e){var r=this,i=this.hls.levels;if(!i.length)return-1;var n=i.filter((function(i,n){return t.isLevelAllowed(n,r.restrictedLevels)&&n<=e}));return this.clientRect=null,t.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},e.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},e.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var r=t.getBoundingClientRect();e.width=r.width,e.height=r.height,e.width||e.height||(e.width=r.right-r.left||t.width||0,e.height=r.bottom-r.top||t.height||0)}return this.clientRect=e,e},t.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},t.getMaxLevelByMediaSize=function(t,e,r){if(!t||!t.length)return-1;for(var i=function(t,e){return!e||(t.width!==e.width||t.height!==e.height)},n=t.length-1,s=0;s<t.length;s+=1){var a=t[s];if((a.width>=e||a.height>=r)&&i(a,t[s+1])){n=s;break}}return n},s(t,[{key:"mediaWidth",get:function(){return this.getDimensions().width*t.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*t.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var t=1;try{t=self.devicePixelRatio}catch(e){}return t}}]),t}();e["default"]=a},"./src/controller/cmcd-controller.ts":
/*!*******************************************!*\
  !*** ./src/controller/cmcd-controller.ts ***!
  \*******************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return f}));var i=r(/*! ../events */"./src/events.ts"),n=r(/*! ../types/cmcd */"./src/types/cmcd.ts"),s=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}function u(t,e){var r="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=c(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t,e){if(t){if("string"===typeof t)return d(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function h(){return h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},h.apply(this,arguments)}var f=function(){function t(e){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(t){try{r.apply(t,{ot:n["CMCDObjectType"].MANIFEST,su:!r.initialized})}catch(e){a["logger"].warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(t){try{var e=t.frag,i=r.hls.levels[e.level],s=r.getObjectType(e),o={d:1e3*e.duration,ot:s};s!==n["CMCDObjectType"].VIDEO&&s!==n["CMCDObjectType"].AUDIO&&s!=n["CMCDObjectType"].MUXED||(o.br=i.bitrate/1e3,o.tb=r.getTopBandwidth(s),o.bl=r.getBufferLength(s)),r.apply(t,o)}catch(l){a["logger"].warn("Could not generate segment CMCD data.",l)}},this.hls=e;var i=this.config=e.config,s=i.cmcd;null!=s&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||t.uuid(),this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.registerListeners())}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i["Events"].MEDIA_DETACHED,this.onMediaDetached,this),t.on(i["Events"].BUFFER_CREATED,this.onBufferCreated,this)},e.unregisterListeners=function(){var t=this.hls;t.off(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i["Events"].MEDIA_DETACHED,this.onMediaDetached,this),t.off(i["Events"].BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},e.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},e.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},e.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},e.onBufferCreated=function(t,e){var r,i;this.audioBuffer=null===(r=e.tracks.audio)||void 0===r?void 0:r.buffer,this.videoBuffer=null===(i=e.tracks.video)||void 0===i?void 0:i.buffer},e.createData=function(){var t;return{v:n["CMCDVersion"],sf:n["CMCDStreamingFormat"].HLS,sid:this.sid,cid:this.cid,pr:null===(t=this.media)||void 0===t?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},e.apply=function(e,r){void 0===r&&(r={}),h(r,this.createData());var i=r.ot===n["CMCDObjectType"].INIT||r.ot===n["CMCDObjectType"].VIDEO||r.ot===n["CMCDObjectType"].MUXED;if(this.starved&&i&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){var s=t.toHeaders(r);if(!Object.keys(s).length)return;e.headers||(e.headers={}),h(e.headers,s)}else{var a=t.toQuery(r);if(!a)return;e.url=t.appendQueryToUri(e.url,a)}},e.getObjectType=function(t){var e=t.type;return"subtitle"===e?n["CMCDObjectType"].TIMED_TEXT:"initSegment"===t.sn?n["CMCDObjectType"].INIT:"audio"===e?n["CMCDObjectType"].AUDIO:"main"===e?this.hls.audioTracks.length?n["CMCDObjectType"].VIDEO:n["CMCDObjectType"].MUXED:void 0},e.getTopBandwidth=function(t){for(var e,r=0,i=t===n["CMCDObjectType"].AUDIO?this.hls.audioTracks:this.hls.levels,s=u(i);!(e=s()).done;){var a=e.value;a.bitrate>r&&(r=a.bitrate)}return r>0?r:NaN},e.getBufferLength=function(t){var e=this.hls.media,r=t===n["CMCDObjectType"].AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!e)return NaN;var i=s["BufferHelper"].bufferInfo(r,e.currentTime,this.config.maxBufferHole);return 1e3*i.len},e.createPlaylistLoader=function(){var t=this.config.pLoader,e=this.applyPlaylistData,r=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new r(t)}var i=t.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(t,r,i){e(t),this.loader.load(t,r,i)},l(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},e.createFragmentLoader=function(){var t=this.config.fLoader,e=this.applyFragmentData,r=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new r(t)}var i=t.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(t,r,i){e(t),this.loader.load(t,r,i)},l(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},t.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.substr(e.lastIndexOf("/")+1)},t.serialize=function(t){for(var e,r=[],i=function(t){return!Number.isNaN(t)&&null!=t&&""!==t&&!1!==t},n=function(t){return Math.round(t)},s=function(t){return 100*n(t/100)},a=function(t){return encodeURIComponent(t)},o={br:n,d:n,bl:s,dl:s,mtp:s,nor:a,rtp:s,tb:n},l=Object.keys(t||{}).sort(),c=u(l);!(e=c()).done;){var d=e.value,h=t[d];if(i(h)&&(("v"!==d||1!==h)&&("pr"!=d||1!==h))){var f=o[d];f&&(h=f(h));var g=typeof h,v=void 0;v="ot"===d||"sf"===d||"st"===d?d+"="+h:"boolean"===g?d:"number"===g?d+"="+h:d+"="+JSON.stringify(h),r.push(v)}}return r.join(",")},t.toHeaders=function(e){for(var r=Object.keys(e),i={},n=["Object","Request","Session","Status"],s=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,l=r;o<l.length;o++){var u=l[o],c=null!=a[u]?a[u]:1;s[c][u]=e[u]}for(var d=0;d<s.length;d++){var h=t.serialize(s[d]);h&&(i["CMCD-"+n[d]]=h)}return i},t.toQuery=function(e){return"CMCD="+encodeURIComponent(t.serialize(e))},t.appendQueryToUri=function(t,e){if(!e)return t;var r=t.includes("?")?"&":"?";return""+t+r+e},t}()},"./src/controller/eme-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/eme-controller.ts ***!
  \******************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../events */"./src/events.ts"),n=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=r(/*! ../utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}var u=3,c=function(t,e,r){var i={audioCapabilities:[],videoCapabilities:[]};return t.forEach((function(t){i.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:r.audioRobustness||""})})),e.forEach((function(t){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:r.videoRobustness||""})})),[i]},d=function(t,e,r,i){switch(t){case a["KeySystems"].WIDEVINE:return c(e,r,i);default:throw new Error("Unknown key-system: "+t)}},h=function(){function t(t){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=t,this._config=t.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var e=t.prototype;return e.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},e._registerListeners=function(){this.hls.on(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i["Events"].MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this)},e._unregisterListeners=function(){this.hls.off(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(i["Events"].MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this)},e.getLicenseServerUrl=function(t){switch(t){case a["KeySystems"].WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},e._attemptKeySystemAccess=function(t,e,r){var i=this,n=d(t,e,r,this._drmSystemOptions);s["logger"].log("Requesting encrypted media key-system access");var a=this.requestMediaKeySystemAccess(t,n);this.mediaKeysPromise=a.then((function(e){return i._onMediaKeySystemAccessObtained(t,e)})),a.catch((function(e){s["logger"].error('Failed to obtain key-system "'+t+'" access:',e)}))},e._onMediaKeySystemAccessObtained=function(t,e){var r=this;s["logger"].log('Access for key-system "'+t+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(i);var n=Promise.resolve().then((function(){return e.createMediaKeys()})).then((function(e){return i.mediaKeys=e,s["logger"].log('Media-keys created for key-system "'+t+'"'),r._onMediaKeysCreated(),e}));return n.catch((function(t){s["logger"].error("Failed to create media-keys:",t)})),n},e._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))}))},e._onNewMediaKeySession=function(t){var e=this;s["logger"].log("New key-system session "+t.sessionId),t.addEventListener("message",(function(r){e._onKeySessionMessage(t,r.message)}),!1)},e._onKeySessionMessage=function(t,e){s["logger"].log("Got EME message event, creating license request"),this._requestLicense(e,(function(e){s["logger"].log("Received license data (length: "+(e?e.byteLength:e)+"), updating key-session"),t.update(e)}))},e.onMediaEncrypted=function(t){var e=this;if(s["logger"].log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise)return s["logger"].error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_NO_KEYS,fatal:!0});var r=function(r){e._media&&(e._attemptSetMediaKeys(r),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(r).catch(r)},e._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return s["logger"].error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_NO_KEYS,fatal:!0});s["logger"].log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},e._generateRequestWithPreferredKeySession=function(t,e){var r=this,a=this._mediaKeysList[0];if(!a)return s["logger"].error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_NO_ACCESS,fatal:!0});if(a.mediaKeysSessionInitialized)s["logger"].warn("Key-Session already initialized but requested again");else{var o=a.mediaKeysSession;if(!o)return s["logger"].error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_NO_SESSION,fatal:!0});if(!e)return s["logger"].warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_NO_INIT_DATA,fatal:!0});s["logger"].log('Generating key-session request for "'+t+'" init data type'),a.mediaKeysSessionInitialized=!0,o.generateRequest(t,e).then((function(){s["logger"].debug("Key-session generation succeeded")})).catch((function(t){s["logger"].error("Error generating key-session request:",t),r.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},e._createLicenseXhr=function(t,e,r){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,t,e,r);var n=this._licenseXhrSetup;if(n)try{n.call(this.hls,i,t),n=void 0}catch(a){s["logger"].error(a)}try{i.readyState||i.open("POST",t,!0),n&&n.call(this.hls,i,t)}catch(a){throw new Error("issue setting up KeySystem license XHR "+a)}return i},e._onLicenseRequestReadyStageChange=function(t,e,r,a){switch(t.readyState){case 4:if(200===t.status){this._requestLicenseFailureCount=0,s["logger"].log("License request succeeded");var o=t.response,l=this._licenseResponseCallback;if(l)try{o=l.call(this.hls,t,e)}catch(d){s["logger"].error(d)}a(o)}else{if(s["logger"].error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u)return void this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var c=u-this._requestLicenseFailureCount+1;s["logger"].warn("Retrying license request, "+c+" attempts left"),this._requestLicense(r,a)}break}},e._generateLicenseRequestChallenge=function(t,e){switch(t.mediaKeySystemDomain){case a["KeySystems"].WIDEVINE:return e}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},e._requestLicense=function(t,e){s["logger"].log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return s["logger"].error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var a=this.getLicenseServerUrl(r.mediaKeySystemDomain),o=this._createLicenseXhr(a,t,e);s["logger"].log("Sending license request to URL: "+a);var l=this._generateLicenseRequestChallenge(r,t);o.send(l)}catch(u){s["logger"].error("Failure requesting DRM license: "+u),this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].KEY_SYSTEM_ERROR,details:n["ErrorDetails"].KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},e.onMediaAttached=function(t,e){if(this._emeEnabled){var r=e.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},e.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch((function(){}))}))).then((function(){return t.setMediaKeys(null)})).catch((function(){})))},e.onManifestParsed=function(t,e){if(this._emeEnabled){var r=e.levels.map((function(t){return t.audioCodec})).filter((function(t){return!!t})),i=e.levels.map((function(t){return t.videoCodec})).filter((function(t){return!!t}));this._attemptKeySystemAccess(a["KeySystems"].WIDEVINE,r,i)}},l(t,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),t}();e["default"]=h},"./src/controller/fps-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/fps-controller.ts ***!
  \******************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../events */"./src/events.ts"),n=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.registerListeners=function(){this.hls.on(i["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this)},e.unregisterListeners=function(){this.hls.off(i["Events"].MEDIA_ATTACHING,this.onMediaAttaching)},e.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},e.onMediaAttaching=function(t,e){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=i,i&&"function"===typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},e.checkFPS=function(t,e,r){var s=performance.now();if(e){if(this.lastTime){var a=s-this.lastTime,o=r-this.lastDroppedFrames,l=e-this.lastDecodedFrames,u=1e3*o/a,c=this.hls;if(c.trigger(i["Events"].FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),u>0&&o>c.config.fpsDroppedMonitoringThreshold*l){var d=c.currentLevel;n["logger"].warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=d)&&(d-=1,c.trigger(i["Events"].FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:c.currentLevel}),c.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=e}},e.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}();e["default"]=s},"./src/controller/fragment-finders.ts":
/*!********************************************!*\
  !*** ./src/controller/fragment-finders.ts ***!
  \********************************************/
/*! exports provided: findFragmentByPDT, findFragmentByPTS, fragmentWithinToleranceTest, pdtWithinToleranceTest, findFragWithCC */function(t,e,r){"use strict";r.r(e),r.d(e,"findFragmentByPDT",(function(){return s})),r.d(e,"findFragmentByPTS",(function(){return a})),r.d(e,"fragmentWithinToleranceTest",(function(){return o})),r.d(e,"pdtWithinToleranceTest",(function(){return l})),r.d(e,"findFragWithCC",(function(){return u}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../utils/binary-search */"./src/utils/binary-search.ts");function s(t,e,r){if(null===e||!Array.isArray(t)||!t.length||!Object(i["isFiniteNumber"])(e))return null;var n=t[0].programDateTime;if(e<(n||0))return null;var s=t[t.length-1].endProgramDateTime;if(e>=(s||0))return null;r=r||0;for(var a=0;a<t.length;++a){var o=t[a];if(l(e,r,o))return o}return null}function a(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var s=null;if(t?s=e[t.sn-e[0].sn+1]||null:0===r&&0===e[0].start&&(s=e[0]),s&&0===o(r,i,s))return s;var a=n["default"].search(e,o.bind(null,r,i));return a||s}function o(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0);var i=Math.min(e,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=t?1:r.start-i>t&&r.start?-1:0}function l(t,e,r){var i=1e3*Math.min(e,r.duration+(r.deltaPTS?r.deltaPTS:0)),n=r.endProgramDateTime||0;return n-i>t}function u(t,e){return n["default"].search(t,(function(t){return t.cc<e?1:t.cc>e?-1:0}))}},"./src/controller/fragment-tracker.ts":
/*!********************************************!*\
  !*** ./src/controller/fragment-tracker.ts ***!
  \********************************************/
/*! exports provided: FragmentState, FragmentTracker */function(t,e,r){"use strict";r.r(e),r.d(e,"FragmentState",(function(){return i})),r.d(e,"FragmentTracker",(function(){return a}));var i,n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../types/loader */"./src/types/loader.ts");(function(t){t["NOT_LOADED"]="NOT_LOADED",t["BACKTRACKED"]="BACKTRACKED",t["APPENDING"]="APPENDING",t["PARTIAL"]="PARTIAL",t["OK"]="OK"})(i||(i={}));var a=function(){function t(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(n["Events"].BUFFER_APPENDED,this.onBufferAppended,this),t.on(n["Events"].FRAG_BUFFERED,this.onFragBuffered,this),t.on(n["Events"].FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=function(){var t=this.hls;t.off(n["Events"].BUFFER_APPENDED,this.onBufferAppended,this),t.off(n["Events"].FRAG_BUFFERED,this.onFragBuffered,this),t.off(n["Events"].FRAG_LOADED,this.onFragLoaded,this)},e.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},e.getAppendedFrag=function(t,e){if(e===s["PlaylistLevelType"].MAIN){var r=this.activeFragment,i=this.activeParts;if(!r)return null;if(i)for(var n=i.length;n--;){var a=i[n],o=a?a.end:r.appendedPTS;if(a.start<=t&&void 0!==o&&t<=o)return n>9&&(this.activeParts=i.slice(n-9)),a}else if(r.start<=t&&void 0!==r.appendedPTS&&t<=r.appendedPTS)return r}return this.getBufferedFrag(t,e)},e.getBufferedFrag=function(t,e){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var s=r[i[n]];if((null===s||void 0===s?void 0:s.body.type)===e&&s.buffered){var a=s.body;if(a.start<=t&&t<=a.end)return a}}return null},e.detectEvictedFragments=function(t,e,r){var i=this;Object.keys(this.fragments).forEach((function(n){var s=i.fragments[n];if(s)if(s.buffered){var a=s.range[t];a&&a.time.some((function(t){var r=!i.isTimeBuffered(t.startPTS,t.endPTS,e);return r&&i.removeFragment(s.body),r}))}else s.body.type===r&&i.removeFragment(s.body)}))},e.detectPartialFragments=function(t){var e=this,r=this.timeRanges,i=t.frag,n=t.part;if(r&&"initSegment"!==i.sn){var s=l(i),a=this.fragments[s];a&&(Object.keys(r).forEach((function(t){var s=i.elementaryStreams[t];if(s){var o=r[t],l=null!==n||!0===s.partial;a.range[t]=e.getBufferedTimes(i,n,l,o)}})),a.backtrack=a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},e.fragBuffered=function(t){var e=l(t),r=this.fragments[e];r&&(r.backtrack=r.loaded=null,r.buffered=!0)},e.getBufferedTimes=function(t,e,r,i){for(var n={time:[],partial:r},s=e?e.start:t.start,a=e?e.end:t.end,o=t.minEndPTS||a,l=t.maxStartPTS||s,u=0;u<i.length;u++){var c=i.start(u)-this.bufferPadding,d=i.end(u)+this.bufferPadding;if(l>=c&&o<=d){n.time.push({startPTS:Math.max(s,i.start(u)),endPTS:Math.min(a,i.end(u))});break}if(s<d&&a>c)n.partial=!0,n.time.push({startPTS:Math.max(s,i.start(u)),endPTS:Math.min(a,i.end(u))});else if(a<=c)break}return n},e.getPartialFragment=function(t){var e,r,i,n=null,s=0,a=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach((function(u){var c=l[u];c&&o(c)&&(r=c.body.start-a,i=c.body.end+a,t>=r&&t<=i&&(e=Math.min(t-r,i-t),s<=e&&(n=c.body,s=e)))})),n},e.getState=function(t){var e=l(t),r=this.fragments[e];return r?r.buffered?o(r)?i.PARTIAL:i.OK:r.backtrack?i.BACKTRACKED:i.APPENDING:i.NOT_LOADED},e.backtrack=function(t,e){var r=l(t),i=this.fragments[r];if(!i||i.backtrack)return null;var n=i.backtrack=e||i.loaded;return i.loaded=null,n},e.getBacktrackData=function(t){var e=l(t),r=this.fragments[e];if(r){var i,n=r.backtrack;if(null!==n&&void 0!==n&&null!==(i=n.payload)&&void 0!==i&&i.byteLength)return n;this.removeFragment(t)}return null},e.isTimeBuffered=function(t,e,r){for(var i,n,s=0;s<r.length;s++){if(i=r.start(s)-this.bufferPadding,n=r.end(s)+this.bufferPadding,t>=i&&e<=n)return!0;if(e<=i)return!1}return!1},e.onFragLoaded=function(t,e){var r=e.frag,i=e.part;if("initSegment"!==r.sn&&!r.bitrateTest&&!i){var n=l(r);this.fragments[n]={body:r,loaded:e,backtrack:null,buffered:!1,range:Object.create(null)}}},e.onBufferAppended=function(t,e){var r=this,i=e.frag,n=e.part,a=e.timeRanges;if(i.type===s["PlaylistLevelType"].MAIN)if(this.activeFragment=i,n){var o=this.activeParts;o||(this.activeParts=o=[]),o.push(n)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach((function(t){var e=a[t];if(r.detectEvictedFragments(t,e),!n)for(var s=0;s<e.length;s++)i.appendedPTS=Math.max(e.end(s),i.appendedPTS||0)}))},e.onFragBuffered=function(t,e){this.detectPartialFragments(e)},e.hasFragment=function(t){var e=l(t);return!!this.fragments[e]},e.removeFragmentsInRange=function(t,e,r){var i=this;Object.keys(this.fragments).forEach((function(n){var s=i.fragments[n];if(s&&s.buffered){var a=s.body;a.type===r&&a.start<e&&a.end>t&&i.removeFragment(a)}}))},e.removeFragment=function(t){var e=l(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},e.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},t}();function o(t){var e,r;return t.buffered&&((null===(e=t.range.video)||void 0===e?void 0:e.partial)||(null===(r=t.range.audio)||void 0===r?void 0:r.partial))}function l(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}},"./src/controller/gap-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/gap-controller.ts ***!
  \******************************************/
/*! exports provided: STALL_MINIMUM_DURATION_MS, MAX_START_GAP_JUMP, SKIP_BUFFER_HOLE_STEP_SECONDS, SKIP_BUFFER_RANGE_START, default */function(t,e,r){"use strict";r.r(e),r.d(e,"STALL_MINIMUM_DURATION_MS",(function(){return o})),r.d(e,"MAX_START_GAP_JUMP",(function(){return l})),r.d(e,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return u})),r.d(e,"SKIP_BUFFER_RANGE_START",(function(){return c})),r.d(e,"default",(function(){return d}));var i=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),n=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=250,l=2,u=.1,c=.05,d=function(){function t(t,e,r,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=r,this.hls=i}var e=t.prototype;return e.destroy=function(){this.hls=this.fragmentTracker=this.media=null},e.poll=function(t){var e=this.config,r=this.media,n=this.stalled,s=r.currentTime,u=r.seeking,c=this.seeking&&!u,d=!this.seeking&&u;if(this.seeking=u,s===t){if((d||c)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&i["BufferHelper"].getBuffered(r).length){var h=i["BufferHelper"].bufferInfo(r,s,0),f=h.len>0,g=h.nextStart||0;if(f||g){if(u){var v=h.len>l,p=!g||g-s>l&&!this.fragmentTracker.getPartialFragment(s);if(v||p)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var m,y=Math.max(g,h.start||0)-s,E=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,T=null===E||void 0===E||null===(m=E.details)||void 0===m?void 0:m.live,S=T?2*E.details.targetduration:l;if(y>0&&y<=S)return void this._trySkipBufferHole(null)}var b=self.performance.now();if(null!==n){var L=b-n;!u&&L>=o&&this._reportStall(h.len);var A=i["BufferHelper"].bufferInfo(r,s,e.maxBufferHole);this._tryFixBufferStall(A,L)}else this.stalled=b}}}else if(this.moved=!0,null!==n){if(this.stallReported){var D=self.performance.now()-n;a["logger"].warn("playback not stuck anymore @"+s+", after "+Math.round(D)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},e._tryFixBufferStall=function(t,e){var r=this.config,i=this.fragmentTracker,n=this.media,s=n.currentTime,o=i.getPartialFragment(s);if(o){var l=this._trySkipBufferHole(o);if(l)return}t.len>r.maxBufferHole&&e>1e3*r.highBufferWatchdogPeriod&&(a["logger"].warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},e._reportStall=function(t){var e=this.hls,r=this.media,i=this.stallReported;i||(this.stallReported=!0,a["logger"].warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+t+")"),e.trigger(s["Events"].ERROR,{type:n["ErrorTypes"].MEDIA_ERROR,details:n["ErrorDetails"].BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},e._trySkipBufferHole=function(t){for(var e=this.config,r=this.hls,o=this.media,l=o.currentTime,d=0,h=i["BufferHelper"].getBuffered(o),f=0;f<h.length;f++){var g=h.start(f);if(l+e.maxBufferHole>=d&&l<g){var v=Math.max(g+c,o.currentTime+u);return a["logger"].warn("skipping hole, adjusting currentTime from "+l+" to "+v),this.moved=!0,this.stalled=null,o.currentTime=v,t&&r.trigger(s["Events"].ERROR,{type:n["ErrorTypes"].MEDIA_ERROR,details:n["ErrorDetails"].BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+v,frag:t}),v}d=h.end(f)}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,r=this.media,i=r.currentTime,o=(this.nudgeRetry||0)+1;if(this.nudgeRetry=o,o<t.nudgeMaxRetry){var l=i+o*t.nudgeOffset;a["logger"].warn("Nudging 'currentTime' from "+i+" to "+l),r.currentTime=l,e.trigger(s["Events"].ERROR,{type:n["ErrorTypes"].MEDIA_ERROR,details:n["ErrorDetails"].BUFFER_NUDGE_ON_STALL,fatal:!1})}else a["logger"].error("Playhead still not moving while enough data buffered @"+i+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(s["Events"].ERROR,{type:n["ErrorTypes"].MEDIA_ERROR,details:n["ErrorDetails"].BUFFER_STALLED_ERROR,fatal:!0})},t}()},"./src/controller/id3-track-controller.ts":
/*!************************************************!*\
  !*** ./src/controller/id3-track-controller.ts ***!
  \************************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../events */"./src/events.ts"),n=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),s=r(/*! ../demux/id3 */"./src/demux/id3.ts"),a=.25,o=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=t,this._registerListeners()}var e=t.prototype;return e.destroy=function(){this._unregisterListeners()},e._registerListeners=function(){var t=this.hls;t.on(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i["Events"].FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(i["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this)},e._unregisterListeners=function(){var t=this.hls;t.off(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i["Events"].FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(i["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this)},e.onMediaAttached=function(t,e){this.media=e.media},e.onMediaDetaching=function(){this.id3Track&&(Object(n["clearCurrentCues"])(this.id3Track),this.id3Track=null,this.media=null)},e.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var r=t[e];if("metadata"===r.kind&&"id3"===r.label)return Object(n["sendAddTrackEvent"])(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},e.onFragParsingMetadata=function(t,e){if(this.media){var r=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,o=0;o<i.length;o++){var l=s["getID3Frames"](i[o].data);if(l){var u=i[o].pts,c=o<i.length-1?i[o+1].pts:r.end,d=c-u;d<=0&&(c=u+a);for(var h=0;h<l.length;h++){var f=l[h];if(!s["isTimeStampFrame"](f)){var g=new n(u,c,"");g.value=f,this.id3Track.addCue(g)}}}}}},e.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset,s=e.type;if(!s||"audio"===s){var a=this.id3Track;a&&Object(n["removeCuesInRange"])(a,r,i)}},t}();e["default"]=o},"./src/controller/latency-controller.ts":
/*!**********************************************!*\
  !*** ./src/controller/latency-controller.ts ***!
  \**********************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return l}));var i=r(/*! ../errors */"./src/errors.ts"),n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts");function a(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}var l=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var e=t.prototype;return e.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},e.registerListeners=function(){this.hls.on(n["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(n["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(n["Events"].MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(n["Events"].LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(n["Events"].ERROR,this.onError,this)},e.unregisterListeners=function(){this.hls.off(n["Events"].MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(n["Events"].MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(n["Events"].MANIFEST_LOADING,this.onManifestLoading),this.hls.off(n["Events"].LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(n["Events"].ERROR,this.onError)},e.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},e.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},e.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},e.onLevelUpdated=function(t,e){var r=e.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},e.onError=function(t,e){e.details===i["ErrorDetails"].BUFFER_STALLED_ERROR&&(this.stallCount++,s["logger"].warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},e.timeupdate=function(){var t=this.media,e=this.levelDetails;if(t&&e){this.currentTime=t.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var i=this.config,n=i.lowLatencyMode,s=i.maxLiveSyncPlaybackRate;if(n&&1!==s){var a=this.targetLatency;if(null!==a){var o=r-a,l=Math.min(this.maxLatency,a+e.targetduration),u=o<l;if(e.live&&u&&o>.05&&this.forwardBufferLength>1){var c=Math.min(2,Math.max(1,s)),d=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;t.playbackRate=Math.min(c,Math.max(1,d))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},e.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},e.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},o(t,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.holdBack,r=t.partHoldBack,i=t.targetduration,n=this.config,s=n.liveSyncDuration,a=n.liveSyncDurationCount,o=n.lowLatencyMode,l=this.hls.userConfig,u=o&&r||e;(l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==s?s:a*i);var c=i,d=1;return u+Math.min(this.stallCount*d,c)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,r=this.levelDetails;if(null===t||null===e||null===r)return null;var i=r.edge,n=t-e-this.edgeStalled,s=i-r.totalduration,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(s,n),a)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var r=t.buffered.length;return r?t.buffered.end(r-1):e.edge-this.currentTime}}]),t}()},"./src/controller/level-controller.ts":
/*!********************************************!*\
  !*** ./src/controller/level-controller.ts ***!
  \********************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return p}));var i=r(/*! ../types/level */"./src/types/level.ts"),n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../utils/codecs */"./src/utils/codecs.ts"),o=r(/*! ./level-helper */"./src/controller/level-helper.ts"),l=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),u=r(/*! ../types/loader */"./src/types/loader.ts");function c(){return c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},c.apply(this,arguments)}function d(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),t}function f(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,g(t,e)}function g(t,e){return g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},g(t,e)}var v=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),p=function(t){function e(e){var r;return r=t.call(this,e,"[level-controller]")||this,r._levels=[],r._firstLevel=-1,r._startLevel=void 0,r.currentLevelIndex=-1,r.manualLevelIndex=-1,r.onParsedComplete=void 0,r._registerListeners(),r}f(e,t);var r=e.prototype;return r._registerListeners=function(){var t=this.hls;t.on(n["Events"].MANIFEST_LOADED,this.onManifestLoaded,this),t.on(n["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.on(n["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(n["Events"].FRAG_LOADED,this.onFragLoaded,this),t.on(n["Events"].ERROR,this.onError,this)},r._unregisterListeners=function(){var t=this.hls;t.off(n["Events"].MANIFEST_LOADED,this.onManifestLoaded,this),t.off(n["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.off(n["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(n["Events"].FRAG_LOADED,this.onFragLoaded,this),t.off(n["Events"].ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},r.startLoad=function(){var e=this._levels;e.forEach((function(t){t.loadError=0})),t.prototype.startLoad.call(this)},r.onManifestLoaded=function(t,e){var r,l,u=[],c=[],d=[],h={},f=!1,g=!1,p=!1;if(e.levels.forEach((function(t){var e=t.attrs;f=f||!(!t.width||!t.height),g=g||!!t.videoCodec,p=p||!!t.audioCodec,v&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var r=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;l=h[r],l?l.url.push(t.url):(l=new i["Level"](t),h[r]=l,u.push(l)),e&&(e.AUDIO&&Object(o["addGroupId"])(l,"audio",e.AUDIO),e.SUBTITLES&&Object(o["addGroupId"])(l,"text",e.SUBTITLES))})),(f||g)&&p&&(u=u.filter((function(t){var e=t.videoCodec,r=t.width,i=t.height;return!!e||!(!r||!i)}))),u=u.filter((function(t){var e=t.audioCodec,r=t.videoCodec;return(!e||Object(a["isCodecSupportedInMp4"])(e,"audio"))&&(!r||Object(a["isCodecSupportedInMp4"])(r,"video"))})),e.audioTracks&&(c=e.audioTracks.filter((function(t){return!t.audioCodec||Object(a["isCodecSupportedInMp4"])(t.audioCodec,"audio")})),Object(o["assignTrackIdsByGroup"])(c)),e.subtitles&&(d=e.subtitles,Object(o["assignTrackIdsByGroup"])(d)),u.length>0){r=u[0].bitrate,u.sort((function(t,e){return t.bitrate-e.bitrate})),this._levels=u;for(var m=0;m<u.length;m++)if(u[m].bitrate===r){this._firstLevel=m,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+r);break}var y=p&&!g,E={levels:u,audioTracks:c,subtitleTracks:d,firstLevel:this._firstLevel,stats:e.stats,audio:p,video:g,altAudio:!y&&c.some((function(t){return!!t.url}))};this.hls.trigger(n["Events"].MANIFEST_PARSED,E),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(n["Events"].ERROR,{type:s["ErrorTypes"].MEDIA_ERROR,details:s["ErrorDetails"].MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},r.onError=function(e,r){if(t.prototype.onError.call(this,e,r),!r.fatal){var i=r.context,n=this._levels[this.currentLevelIndex];if(i&&(i.type===u["PlaylistContextType"].AUDIO_TRACK&&n.audioGroupIds&&i.groupId===n.audioGroupIds[n.urlId]||i.type===u["PlaylistContextType"].SUBTITLE_TRACK&&n.textGroupIds&&i.groupId===n.textGroupIds[n.urlId]))this.redundantFailover(this.currentLevelIndex);else{var a,o=!1,l=!0;switch(r.details){case s["ErrorDetails"].FRAG_LOAD_ERROR:case s["ErrorDetails"].FRAG_LOAD_TIMEOUT:case s["ErrorDetails"].KEY_LOAD_ERROR:case s["ErrorDetails"].KEY_LOAD_TIMEOUT:if(r.frag){var c=this._levels[r.frag.level];c?(c.fragmentError++,c.fragmentError>this.hls.config.fragLoadingMaxRetry&&(a=r.frag.level)):a=r.frag.level}break;case s["ErrorDetails"].LEVEL_LOAD_ERROR:case s["ErrorDetails"].LEVEL_LOAD_TIMEOUT:i&&(i.deliveryDirectives&&(l=!1),a=i.level),o=!0;break;case s["ErrorDetails"].REMUX_ALLOC_ERROR:a=r.level,o=!0;break}void 0!==a&&this.recoverLevel(r,a,o,l)}}},r.recoverLevel=function(t,e,r,i){var n=t.details,s=this._levels[e];if(s.loadError++,r){var a=this.retryLoadingOrFail(t);if(!a)return void(this.currentLevelIndex=-1);t.levelRetry=!0}if(i){var o=s.url.length;if(o>1&&s.loadError<o)t.levelRetry=!0,this.redundantFailover(e);else if(-1===this.manualLevelIndex){var l=0===e?this._levels.length-1:e-1;this.currentLevelIndex!==l&&0===this._levels[l].loadError&&(this.warn(n+": switch to "+l),t.levelRetry=!0,this.hls.nextAutoLevel=l)}}},r.redundantFailover=function(t){var e=this._levels[t],r=e.url.length;if(r>1){var i=(e.urlId+1)%r;this.warn("Switching to redundant URL-id "+i),this._levels.forEach((function(t){t.urlId=i})),this.level=t}},r.onFragLoaded=function(t,e){var r=e.frag;if(void 0!==r&&r.type===u["PlaylistLevelType"].MAIN){var i=this._levels[r.level];void 0!==i&&(i.fragmentError=0,i.loadError=0)}},r.onLevelLoaded=function(t,e){var r,i,n=e.level,s=e.details,a=this._levels[n];if(!a)return this.warn("Invalid level index "+n),void(null!==(i=e.deliveryDirectives)&&void 0!==i&&i.skip&&(s.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0,this.retryCount=0),this.playlistLoaded(n,e,a.details)):null!==(r=e.deliveryDirectives)&&void 0!==r&&r.skip&&(s.deltaUpdateFailed=!0)},r.onAudioTrackSwitched=function(t,e){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var i=-1,n=this.hls.audioTracks[e.id].groupId,s=0;s<r.audioGroupIds.length;s++)if(r.audioGroupIds[s]===n){i=s;break}i!==r.urlId&&(r.urlId=i,this.startLoad())}},r.loadPlaylist=function(t){var e=this.currentLevelIndex,r=this._levels[e];if(this.canLoad&&r&&r.url.length>0){var i=r.urlId,s=r.url[i];if(t)try{s=t.addDirectives(s)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Attempt loading level index "+e+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+i+" "+s),this.clearTimer(),this.hls.trigger(n["Events"].LEVEL_LOADING,{url:s,level:e,id:i,deliveryDirectives:t||null})}},r.removeLevel=function(t,e){var r=function(t,r){return r!==e},i=this._levels.filter((function(i,n){return n!==t||i.url.length>1&&void 0!==e&&(i.url=i.url.filter(r),i.audioGroupIds&&(i.audioGroupIds=i.audioGroupIds.filter(r)),i.textGroupIds&&(i.textGroupIds=i.textGroupIds.filter(r)),i.urlId=0,!0)})).map((function(t,e){var r=t.details;return null!==r&&void 0!==r&&r.fragments&&r.fragments.forEach((function(t){t.level=e})),t}));this._levels=i,this.hls.trigger(n["Events"].LEVELS_UPDATED,{levels:i})},h(e,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e,r=this._levels;if(0!==r.length&&(this.currentLevelIndex!==t||null===(e=r[t])||void 0===e||!e.details)){if(t<0||t>=r.length){var i=t<0;if(this.hls.trigger(n["Events"].ERROR,{type:s["ErrorTypes"].OTHER_ERROR,details:s["ErrorDetails"].LEVEL_SWITCH_ERROR,level:t,fatal:i,reason:"invalid level idx"}),i)return;t=Math.min(t,r.length-1)}this.clearTimer();var a=this.currentLevelIndex,o=r[a],l=r[t];this.log("switching to level "+t+" from "+a),this.currentLevelIndex=t;var u=c({},l,{level:t,maxBitrate:l.maxBitrate,uri:l.uri,urlId:l.urlId});delete u._urlId,this.hls.trigger(n["Events"].LEVEL_SWITCHING,u);var d=l.details;if(!d||d.live){var h=this.switchParams(l.uri,null===o||void 0===o?void 0:o.details);this.loadPlaylist(h)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),e}(l["default"])},"./src/controller/level-helper.ts":
/*!****************************************!*\
  !*** ./src/controller/level-helper.ts ***!
  \****************************************/
/*! exports provided: addGroupId, assignTrackIdsByGroup, updatePTS, updateFragPTSDTS, mergeDetails, mapPartIntersection, mapFragmentIntersection, adjustSliding, addSliding, computeReloadInterval, getFragmentWithSN, getPartWith */function(t,e,r){"use strict";r.r(e),r.d(e,"addGroupId",(function(){return s})),r.d(e,"assignTrackIdsByGroup",(function(){return a})),r.d(e,"updatePTS",(function(){return o})),r.d(e,"updateFragPTSDTS",(function(){return u})),r.d(e,"mergeDetails",(function(){return c})),r.d(e,"mapPartIntersection",(function(){return d})),r.d(e,"mapFragmentIntersection",(function(){return h})),r.d(e,"adjustSliding",(function(){return f})),r.d(e,"addSliding",(function(){return g})),r.d(e,"computeReloadInterval",(function(){return v})),r.d(e,"getFragmentWithSN",(function(){return p})),r.d(e,"getPartWith",(function(){return m}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../utils/logger */"./src/utils/logger.ts");function s(t,e,r){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(r);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(r);break}}function a(t){var e={};t.forEach((function(t){var r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++}))}function o(t,e,r){var i=t[e],n=t[r];l(i,n)}function l(t,e){var r=e.startPTS;if(Object(i["isFiniteNumber"])(r)){var n,s=0;e.sn>t.sn?(s=r-t.start,n=t):(s=t.start-r,n=e),n.duration!==s&&(n.duration=s)}else if(e.sn>t.sn){var a=t.cc===e.cc;a&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration}else e.start=Math.max(t.start-e.duration,0)}function u(t,e,r,s,a,o){var u=s-r;u<=0&&(n["logger"].warn("Fragment should have a positive duration",e),s=r+e.duration,o=a+e.duration);var c=r,d=s,h=e.startPTS,f=e.endPTS;if(Object(i["isFiniteNumber"])(h)){var g=Math.abs(h-r);Object(i["isFiniteNumber"])(e.deltaPTS)?e.deltaPTS=Math.max(g,e.deltaPTS):e.deltaPTS=g,c=Math.max(r,h),r=Math.min(r,h),a=Math.min(a,e.startDTS),d=Math.min(s,f),s=Math.max(s,f),o=Math.max(o,e.endDTS)}e.duration=s-r;var v=r-e.start;e.appendedPTS=s,e.start=e.startPTS=r,e.maxStartPTS=c,e.startDTS=a,e.endPTS=s,e.minEndPTS=d,e.endDTS=o;var p,m=e.sn;if(!t||m<t.startSN||m>t.endSN)return 0;var y=m-t.startSN,E=t.fragments;for(E[y]=e,p=y;p>0;p--)l(E[p],E[p-1]);for(p=y;p<E.length-1;p++)l(E[p],E[p+1]);return t.fragmentHint&&l(E[E.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,v}function c(t,e){for(var r=null,s=t.fragments,a=s.length-1;a>=0;a--){var o=s[a].initSegment;if(o){r=o;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var l,c=0;if(h(t,e,(function(t,n){t.relurl&&(c=t.cc-n.cc),Object(i["isFiniteNumber"])(t.startPTS)&&Object(i["isFiniteNumber"])(t.endPTS)&&(n.start=n.startPTS=t.startPTS,n.startDTS=t.startDTS,n.appendedPTS=t.appendedPTS,n.maxStartPTS=t.maxStartPTS,n.endPTS=t.endPTS,n.endDTS=t.endDTS,n.minEndPTS=t.minEndPTS,n.duration=t.endPTS-t.startPTS,n.duration&&(l=n),e.PTSKnown=e.alignedSliding=!0),n.elementaryStreams=t.elementaryStreams,n.loader=t.loader,n.stats=t.stats,n.urlId=t.urlId,t.initSegment&&(n.initSegment=t.initSegment,r=t.initSegment)})),r){var g=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;g.forEach((function(t){var e;t.initSegment&&t.initSegment.relurl!==(null===(e=r)||void 0===e?void 0:e.relurl)||(t.initSegment=r)}))}if(e.skippedSegments&&(e.deltaUpdateFailed=e.fragments.some((function(t){return!t})),e.deltaUpdateFailed)){n["logger"].warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var v=e.skippedSegments;v--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}var p=e.fragments;if(c){n["logger"].warn("discontinuity sliding from playlist, take drift into account");for(var m=0;m<p.length;m++)p[m].cc+=c}e.skippedSegments&&(e.startCC=e.fragments[0].cc),d(t.partList,e.partList,(function(t,e){e.elementaryStreams=t.elementaryStreams,e.stats=t.stats})),l?u(e,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):f(t,e),p.length&&(e.totalduration=e.edge-p[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;var y=e.advancedDateTime;if(e.advanced&&y){var E=e.edge;e.driftStart||(e.driftStartTime=y,e.driftStart=E),e.driftEndTime=y,e.driftEnd=E}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function d(t,e,r){if(t&&e)for(var i=0,n=0,s=t.length;n<=s;n++){var a=t[n],o=e[n+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?r(a,o):i--}}function h(t,e,r){for(var i=e.skippedSegments,n=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=n;u<=s;u++){var c=l[a+u],d=o[u];i&&!d&&u<i&&(d=e.fragments[u]=c),c&&d&&r(c,d)}}function f(t,e){var r=e.startSN+e.skippedSegments-t.startSN,i=t.fragments;r<0||r>=i.length||g(e,i[r].start)}function g(t,e){if(e){for(var r=t.fragments,i=t.skippedSegments;i<r.length;i++)r[i].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function v(t,e){var r,i=1e3*t.levelTargetDuration,n=i/2,s=t.age,a=s>0&&s<3*i,o=e.loading.end-e.loading.start,l=t.availabilityDelay;if(!1===t.updated)if(a){var u=333*t.misses;r=Math.max(Math.min(n,2*o),u),t.availabilityDelay=(t.availabilityDelay||0)+r}else r=n;else a?(l=Math.min(l||i/2,s),t.availabilityDelay=l,r=l+i-s):r=i-o;return Math.round(r)}function p(t,e,r){if(!t||!t.details)return null;var i=t.details,n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e?n:e<i.startSN&&r&&r.sn===e?r:null)}function m(t,e,r){if(!t||!t.details)return null;var i=t.details.partList;if(i)for(var n=i.length;n--;){var s=i[n];if(s.index===r&&s.fragment.sn===e)return s}return null}},"./src/controller/stream-controller.ts":
/*!*********************************************!*\
  !*** ./src/controller/stream-controller.ts ***!
  \*********************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return S}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),s=r(/*! ../is-supported */"./src/is-supported.ts"),a=r(/*! ../events */"./src/events.ts"),o=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),l=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),u=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),d=r(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),h=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),f=r(/*! ./gap-controller */"./src/controller/gap-controller.ts"),g=r(/*! ../errors */"./src/errors.ts"),v=r(/*! ../utils/logger */"./src/utils/logger.ts");function p(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function m(t,e,r){return e&&p(t.prototype,e),r&&p(t,r),t}function y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,E(t,e)}function E(t,e){return E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},E(t,e)}var T=100,S=function(t){function e(e,r){var i;return i=t.call(this,e,r,"[stream-controller]")||this,i.audioCodecSwap=!1,i.gapController=null,i.level=-1,i._forceStartLoad=!1,i.altAudio=!1,i.audioOnly=!1,i.fragPlaying=null,i.onvplaying=null,i.onvseeked=null,i.fragLastKbps=0,i.stalled=!1,i.couldBacktrack=!1,i.audioCodecSwitch=!1,i.videoBuffer=null,i._registerListeners(),i}y(e,t);var r=e.prototype;return r._registerListeners=function(){var t=this.hls;t.on(a["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.on(a["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.on(a["Events"].LEVEL_LOADING,this.onLevelLoading,this),t.on(a["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.on(a["Events"].FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(a["Events"].ERROR,this.onError,this),t.on(a["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(a["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(a["Events"].BUFFER_CREATED,this.onBufferCreated,this),t.on(a["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(a["Events"].LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(a["Events"].FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var t=this.hls;t.off(a["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.off(a["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.off(a["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.off(a["Events"].FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(a["Events"].ERROR,this.onError,this),t.off(a["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(a["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(a["Events"].BUFFER_CREATED,this.onBufferCreated,this),t.off(a["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(a["Events"].LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(a["Events"].FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},r.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(T),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(r.config.testBandwidth?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}e>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=n["State"].IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=n["State"].STOPPED},r.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case n["State"].IDLE:this.doTickIdle();break;case n["State"].WAITING_LEVEL:var t,e=this.levels,r=this.level,i=null===e||void 0===e||null===(t=e[r])||void 0===t?void 0:t.details;if(i&&(!i.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(i))break;this.state=n["State"].IDLE;break}break;case n["State"].FRAG_LOADING_WAITING_RETRY:var s,a=self.performance.now(),o=this.retryDate;(!o||a>=o||null!==(s=this.media)&&void 0!==s&&s.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=n["State"].IDLE);break;default:break}this.onTickEnd()},r.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},r.doTickIdle=function(){var t,e,r=this.hls,i=this.levelLastLoaded,s=this.levels,o=this.media,d=r.config,h=r.nextLoadLevel;if(null!==i&&(o||!this.startFragRequested&&d.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&s&&s[h]){var f=s[h];this.level=r.nextLoadLevel=h;var g=f.details;if(!g||this.state===n["State"].WAITING_LEVEL||g.live&&this.levelLastLoaded!==h)this.state=n["State"].WAITING_LEVEL;else{var v=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:o,u["PlaylistLevelType"].MAIN);if(null!==v){var p=v.len,m=this.getMaxBufferLength(f.maxBitrate);if(!(p>=m)){if(this._streamEnded(v,g)){var y={};return this.altAudio&&(y.type="video"),this.hls.trigger(a["Events"].BUFFER_EOS,y),void(this.state=n["State"].ENDED)}var E=v.end,T=this.getNextFragment(E,g);if(this.couldBacktrack&&!this.fragPrevious&&T&&"initSegment"!==T.sn){var S=T.sn-g.startSN;S>1&&(T=g.fragments[S-1],this.fragmentTracker.removeFragment(T))}if(T&&this.fragmentTracker.getState(T)===l["FragmentState"].OK&&this.nextLoadPosition>E){var b=this.audioOnly&&!this.altAudio?c["ElementaryStreamTypes"].AUDIO:c["ElementaryStreamTypes"].VIDEO;this.afterBufferFlushed(o,b,u["PlaylistLevelType"].MAIN),T=this.getNextFragment(this.nextLoadPosition,g)}T&&(!T.initSegment||T.initSegment.data||this.bitrateTest||(T=T.initSegment),"identity"!==(null===(t=T.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(e=T.decryptdata)&&void 0!==e&&e.key?this.loadFragment(T,g,E):this.loadKey(T,g))}}}}},r.loadFragment=function(e,r,i){var n,s=this.fragmentTracker.getState(e);if(this.fragCurrent=e,s===l["FragmentState"].BACKTRACKED){var a=this.fragmentTracker.getBacktrackData(e);if(a)return this._handleFragmentLoadProgress(a),void this._handleFragmentLoadComplete(a);s=l["FragmentState"].NOT_LOADED}s===l["FragmentState"].NOT_LOADED||s===l["FragmentState"].PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e):this.bitrateTest?(e.bitrateTest=!0,this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,r,i)):s===l["FragmentState"].APPENDING?this.reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e):0===(null===(n=this.media)||void 0===n?void 0:n.buffered.length)&&this.fragmentTracker.removeAllFragments()},r.getAppendedFrag=function(t){var e=this.fragmentTracker.getAppendedFrag(t,u["PlaylistLevelType"].MAIN);return e&&"fragment"in e?e.fragment:e},r.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,u["PlaylistLevelType"].MAIN)},r.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var t=this.levels,e=this.media;if(null!==e&&void 0!==e&&e.readyState){var r,i=this.getAppendedFrag(e.currentTime);if(i&&i.start>1&&this.flushMainBuffer(0,i.start-1),!e.paused&&t){var n=this.hls.nextLoadLevel,s=t[n],a=this.fragLastKbps;r=a&&this.fragCurrent?this.fragCurrent.duration*s.maxBitrate/(1e3*a)+1:0}else r=0;var o=this.getBufferedFrag(e.currentTime+r);if(o){var l=this.followingBufferedFrag(o);if(l){this.abortCurrentFrag();var u=l.maxStartPTS?l.maxStartPTS:l.start,c=l.duration,d=Math.max(o.end,u+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,.5*c),.75*c));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}},r.abortCurrentFrag=function(){var t=this.fragCurrent;this.fragCurrent=null,null!==t&&void 0!==t&&t.loader&&t.loader.abort(),this.state===n["State"].KEY_LOADING&&(this.state=n["State"].IDLE),this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(e,r){t.prototype.flushMainBuffer.call(this,e,r,this.altAudio?"video":null)},r.onMediaAttached=function(e,r){t.prototype.onMediaAttached.call(this,e,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new f["default"](this.config,i,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var e=this.media;e&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},r.onMediaPlaying=function(){this.tick()},r.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:null;Object(i["isFiniteNumber"])(e)&&this.log("Media seeked to "+e.toFixed(3)),this.tick()},r.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(a["Events"].BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},r.onManifestParsed=function(t,e){var r,i=!1,n=!1;e.levels.forEach((function(t){r=t.audioCodec,r&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5")&&(n=!0))})),this.audioCodecSwitch=i&&n&&!Object(s["changeTypeSupported"])(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},r.onLevelLoading=function(t,e){var r=this.levels;if(r&&this.state===n["State"].IDLE){var i=r[e.level];(!i.details||i.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(i.details))&&(this.state=n["State"].WAITING_LEVEL)}},r.onLevelLoaded=function(t,e){var r,i=this.levels,s=e.level,o=e.details,l=o.totalduration;if(i){this.log("Level "+s+" loaded ["+o.startSN+","+o.endSN+"], cc ["+o.startCC+", "+o.endCC+"] duration:"+l);var u=this.fragCurrent;!u||this.state!==n["State"].FRAG_LOADING&&this.state!==n["State"].FRAG_LOADING_WAITING_RETRY||u.level!==e.level&&u.loader&&(this.state=n["State"].IDLE,u.loader.abort());var c=i[s],d=0;if(o.live||null!==(r=c.details)&&void 0!==r&&r.live){if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,c.details)}if(c.details=o,this.levelLastLoaded=s,this.hls.trigger(a["Events"].LEVEL_UPDATED,{details:o,level:s}),this.state===n["State"].WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=n["State"].IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,d),this.tick()}else this.warn("Levels were reset while loading level "+s)},r._handleFragmentLoadProgress=function(t){var e,r=t.frag,i=t.part,n=t.payload,s=this.levels;if(s){var a=s[r.level],o=a.details;if(o){var l=a.videoCodec,c=o.PTSKnown||!o.live,f=null===(e=r.initSegment)||void 0===e?void 0:e.data,g=this._getAudioCodec(a),v=this.transmuxer=this.transmuxer||new d["default"](this.hls,u["PlaylistLevelType"].MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,m=-1!==p,y=new h["ChunkMetadata"](r.level,r.sn,r.stats.chunkCount,n.byteLength,p,m),E=this.initPTS[r.cc];v.push(n,f,g,l,r,i,o.totalduration,c,y,E)}else this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},r.onAudioTrackSwitching=function(t,e){var r=this.altAudio,i=!!e.url,n=e.id;if(!i){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var s=this.fragCurrent;null!==s&&void 0!==s&&s.loader&&(this.log("Switching to main audio track, cancel main fragment load"),s.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;r&&o.trigger(a["Events"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(a["Events"].AUDIO_TRACK_SWITCHED,{id:n})}},r.onAudioTrackSwitched=function(t,e){var r=e.id,i=!!this.hls.audioTracks[r].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},r.onBufferCreated=function(t,e){var r,i,n=e.tracks,s=!1;for(var a in n){var o=n[a];if("main"===o.id){if(i=a,r=o,"video"===a){var l=n[a];l&&(this.videoBuffer=l.buffer)}}else s=!0}s&&r?(this.log("Alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(t,e){var r=e.frag,i=e.part;if(!r||r.type===u["PlaylistLevelType"].MAIN){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===n["State"].PARSED&&(this.state=n["State"].IDLE));var s=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}},r.onError=function(t,e){switch(e.details){case g["ErrorDetails"].FRAG_LOAD_ERROR:case g["ErrorDetails"].FRAG_LOAD_TIMEOUT:case g["ErrorDetails"].KEY_LOAD_ERROR:case g["ErrorDetails"].KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(u["PlaylistLevelType"].MAIN,e);break;case g["ErrorDetails"].LEVEL_LOAD_ERROR:case g["ErrorDetails"].LEVEL_LOAD_TIMEOUT:this.state!==n["State"].ERROR&&(e.fatal?(this.warn(""+e.details),this.state=n["State"].ERROR):e.levelRetry||this.state!==n["State"].WAITING_LEVEL||(this.state=n["State"].IDLE));break;case g["ErrorDetails"].BUFFER_FULL_ERROR:if("main"===e.parent&&(this.state===n["State"].PARSING||this.state===n["State"].PARSED)){var r=!0,i=this.getFwdBufferInfo(this.media,u["PlaylistLevelType"].MAIN);i&&i.len>.5&&(r=!this.reduceMaxBufferLength(i.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},r.checkBuffer=function(){var t=this.media,e=this.gapController;if(t&&e&&t.readyState){var r=o["BufferHelper"].getBuffered(t);!this.loadedmetadata&&r.length?(this.loadedmetadata=!0,this.seekToStartPos()):e.poll(this.lastCurrentTime),this.lastCurrentTime=t.currentTime}},r.onFragLoadEmergencyAborted=function(){this.state=n["State"].IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},r.onBufferFlushed=function(t,e){var r=e.type;if(r!==c["ElementaryStreamTypes"].AUDIO||this.audioOnly&&!this.altAudio){var i=(r===c["ElementaryStreamTypes"].VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,r,u["PlaylistLevelType"].MAIN)}},r.onLevelsUpdated=function(t,e){this.levels=e.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var t=this.media,e=t.currentTime,r=this.startPosition;if(r>=0&&e<r){if(t.seeking)return void v["logger"].log("could not seek to "+r+", already seeking at "+e);var i=o["BufferHelper"].getBuffered(t),n=i.length?i.start(0):0,s=n-r;s>0&&(s<this.config.maxBufferHole||s<this.config.maxFragLookUpTolerance)&&(v["logger"].log("adjusting start position by "+s+" to match buffer start"),r+=s,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+e),t.currentTime=r}},r._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e},r._loadBitrateTestFrag=function(t){var e=this;this._doFragLoad(t).then((function(r){var i=e.hls;if(r&&!i.nextLoadLevel&&!e.fragContextChanged(t)){e.fragLoadError=0,e.state=n["State"].IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var s=t.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),i.trigger(a["Events"].FRAG_LOADED,r)}}))},r._handleTransmuxComplete=function(t){var e,r="main",s=this.hls,o=t.remuxResult,l=t.chunkMeta,u=this.getCurrentContext(l);if(!u)return this.warn("The loading context changed while buffering fragment "+l.sn+" of level "+l.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(l.level);var d=u.frag,h=u.part,f=u.level,g=o.video,v=o.text,p=o.id3,m=o.initSegment,y=this.altAudio?void 0:o.audio;if(!this.fragContextChanged(d)){if(this.state=n["State"].PARSING,m){m.tracks&&(this._bufferInitSegment(f,m.tracks,d,l),s.trigger(a["Events"].FRAG_PARSING_INIT_SEGMENT,{frag:d,id:r,tracks:m.tracks}));var E=m.initPTS,T=m.timescale;Object(i["isFiniteNumber"])(E)&&(this.initPTS[d.cc]=E,s.trigger(a["Events"].INIT_PTS_FOUND,{frag:d,id:r,initPTS:E,timescale:T}))}if(g&&!1!==o.independent){if(f.details){var S=g.startPTS,b=g.endPTS,L=g.startDTS,A=g.endDTS;if(h)h.elementaryStreams[g.type]={startPTS:S,endPTS:b,startDTS:L,endDTS:A};else if(g.firstKeyFrame&&g.independent&&(this.couldBacktrack=!0),g.dropped&&g.independent){var D=this.getLoadPosition()+this.config.maxBufferHole;if(D<S)return void this.backtrack(d);d.setElementaryStreamInfo(g.type,d.start,b,d.start,A,!0)}d.setElementaryStreamInfo(g.type,S,b,L,A),this.bufferFragmentData(g,d,h,l)}}else if(!1===o.independent)return void this.backtrack(d);if(y){var k=y.startPTS,R=y.endPTS,I=y.startDTS,_=y.endDTS;h&&(h.elementaryStreams[c["ElementaryStreamTypes"].AUDIO]={startPTS:k,endPTS:R,startDTS:I,endDTS:_}),d.setElementaryStreamInfo(c["ElementaryStreamTypes"].AUDIO,k,R,I,_),this.bufferFragmentData(y,d,h,l)}if(null!==p&&void 0!==p&&null!==(e=p.samples)&&void 0!==e&&e.length){var C={frag:d,id:r,samples:p.samples};s.trigger(a["Events"].FRAG_PARSING_METADATA,C)}if(v){var O={frag:d,id:r,samples:v.samples};s.trigger(a["Events"].FRAG_PARSING_USERDATA,O)}}},r._bufferInitSegment=function(t,e,r,i){var s=this;if(this.state===n["State"].PARSING){this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;var o=e.audio,l=e.video,u=e.audiovideo;if(o){var c=t.audioCodec,d=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==o.metadata.channelCount&&-1===d.indexOf("firefox")&&(c="mp4a.40.5")),-1!==d.indexOf("android")&&"audio/mpeg"!==o.container&&(c="mp4a.40.2",this.log("Android: force audio codec to "+c)),t.audioCodec&&t.audioCodec!==c&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+c+'"'),o.levelCodec=c,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(c||"")+"/"+(t.audioCodec||"")+"/"+o.codec+"]")}l&&(l.levelCodec=t.videoCodec,l.id="main",this.log("Init video buffer, container:"+l.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+l.codec+"]")),u&&this.log("Init audiovideo buffer, container:"+u.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+u.codec+"]"),this.hls.trigger(a["Events"].BUFFER_CODECS,e),Object.keys(e).forEach((function(t){var n=e[t],o=n.initSegment;null!==o&&void 0!==o&&o.byteLength&&s.hls.trigger(a["Events"].BUFFER_APPENDING,{type:t,data:o,frag:r,part:null,chunkMeta:i,parent:r.type})})),this.tick()}},r.backtrack=function(t){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(t);var e=this.fragmentTracker.backtrack(t);this.fragPrevious=null,this.nextLoadPosition=t.start,e?this.resetFragmentLoading(t):this.state=n["State"].BACKTRACKING},r.checkFragmentChanged=function(){var t=this.media,e=null;if(t&&t.readyState>1&&!1===t.seeking){var r=t.currentTime;if(o["BufferHelper"].isBuffered(t,r)?e=this.getAppendedFrag(r):o["BufferHelper"].isBuffered(t,r+.1)&&(e=this.getAppendedFrag(r+.1)),e){var i=this.fragPlaying,n=e.level;i&&e.sn===i.sn&&i.level===n&&e.urlId===i.urlId||(this.hls.trigger(a["Events"].FRAG_CHANGED,{frag:e}),i&&i.level===n||this.hls.trigger(a["Events"].LEVEL_SWITCHED,{level:n}),this.fragPlaying=e)}}},m(e,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getAppendedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;if(t){var e=this.getAppendedFrag(t.currentTime);return this.followingBufferedFrag(e)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),e}(n["default"])},"./src/controller/subtitle-stream-controller.ts":
/*!******************************************************!*\
  !*** ./src/controller/subtitle-stream-controller.ts ***!
  \******************************************************/
/*! exports provided: SubtitleStreamController */function(t,e,r){"use strict";r.r(e),r.d(e,"SubtitleStreamController",(function(){return y}));var i=r(/*! ../events */"./src/events.ts"),n=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),a=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),o=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),l=r(/*! ./level-helper */"./src/controller/level-helper.ts"),u=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),c=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),d=r(/*! ../types/loader */"./src/types/loader.ts"),h=r(/*! ../types/level */"./src/types/level.ts");function f(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t,e,r){return e&&f(t.prototype,e),r&&f(t,r),t}function v(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,p(t,e)}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}var m=500,y=function(t){function e(e,r){var i;return i=t.call(this,e,r,"[subtitle-stream-controller]")||this,i.levels=[],i.currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i._registerListeners(),i}v(e,t);var r=e.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var t=this.hls;t.on(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.on(i["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.on(i["Events"].ERROR,this.onError,this),t.on(i["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(i["Events"].SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(i["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(i["Events"].SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(i["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this)},r._unregisterListeners=function(){var t=this.hls;t.off(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.off(i["Events"].LEVEL_LOADED,this.onLevelLoaded,this),t.off(i["Events"].ERROR,this.onError,this),t.off(i["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(i["Events"].SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(i["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(i["Events"].SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(i["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this)},r.startLoad=function(){this.stopLoad(),this.state=c["State"].IDLE,this.setInterval(m),this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},r.onLevelLoaded=function(t,e){this.mainDetails=e.details},r.onSubtitleFragProcessed=function(t,e){var r=e.frag,i=e.success;if(this.fragPrevious=r,this.state=c["State"].IDLE,i){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var s,a=r.start,o=0;o<n.length;o++)if(a>=n[o].start&&a<=n[o].end){s=n[o];break}var l=r.start+r.duration;s?s.end=l:(s={start:a,end:l},n.push(s)),this.fragmentTracker.fragBuffered(r)}}},r.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset;if(0===r&&i!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,s=this.levels;if(!s.length||!s[n]||!s[n].details)return;var a=s[n].details,o=a.targetduration,l=i-o;if(l<=0)return;e.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach((function(t){for(var e=0;e<t.length;)if(t[e].end<=l)t.shift();else{if(!(t[e].start<l))break;t[e].start=l,e++}})),this.fragmentTracker.removeFragmentsInRange(r,l,d["PlaylistLevelType"].SUBTITLE)}},r.onError=function(t,e){var r,i=e.frag;i&&i.type===d["PlaylistLevelType"].SUBTITLE&&(null!==(r=this.fragCurrent)&&void 0!==r&&r.loader&&this.fragCurrent.loader.abort(),this.state=c["State"].IDLE)},r.onSubtitleTracksUpdated=function(t,e){var r=this,i=e.subtitleTracks;this.tracksBuffered=[],this.levels=i.map((function(t){return new h["Level"](t)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(t){r.tracksBuffered[t.id]=[]})),this.mediaBuffer=null},r.onSubtitleTrackSwitch=function(t,e){if(this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId){var r=this.levels[this.currentTrackId];null!==r&&void 0!==r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(m)}else this.clearInterval()},r.onSubtitleTrackLoaded=function(t,e){var r,i=e.details,n=e.id,s=this.currentTrackId,u=this.levels;if(u.length){var d=u[s];if(!(n>=u.length||n!==s)&&d){if(this.mediaBuffer=this.mediaBufferTimeRanges,i.live||null!==(r=d.details)&&void 0!==r&&r.live){var h=this.mainDetails;if(i.deltaUpdateFailed||!h)return;var f=h.fragments[0];if(d.details){var g=this.alignPlaylists(i,d.details);0===g&&f&&Object(l["addSliding"])(i,f.start)}else i.hasProgramDateTime&&h.hasProgramDateTime?Object(o["alignMediaPlaylistByPDT"])(i,h):f&&Object(l["addSliding"])(i,f.start)}if(d.details=i,this.levelLastLoaded=n,this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===c["State"].IDLE){var v=Object(a["findFragmentByPTS"])(null,i.fragments,this.media.currentTime,0);v||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)}}}},r._handleFragmentLoadComplete=function(t){var e=t.frag,r=t.payload,n=e.decryptdata,s=this.hls;if(!this.fragContextChanged(e)&&r&&r.byteLength>0&&n&&n.key&&n.iv&&"AES-128"===n.method){var a=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer).then((function(t){var r=performance.now();s.trigger(i["Events"].FRAG_DECRYPTED,{frag:e,payload:t,stats:{tstart:a,tdecrypt:r}})}))}},r.doTick=function(){if(this.media){if(this.state===c["State"].IDLE){var t,e=this.currentTrackId,r=this.levels;if(!r.length||!r[e]||!r[e].details)return;var o=r[e].details,l=o.targetduration,d=this.config,h=this.media,f=s["BufferHelper"].bufferedInfo(this.mediaBufferTimeRanges,h.currentTime-l,d.maxBufferHole),g=f.end,v=f.len,p=this.getMaxBufferLength()+l;if(v>p)return;console.assert(o,"Subtitle track details are defined on idle subtitle stream controller tick");var m,y=o.fragments,E=y.length,T=o.edge,S=this.fragPrevious;if(g<T){var b=d.maxFragLookUpTolerance;S&&o.hasProgramDateTime&&(m=Object(a["findFragmentByPDT"])(y,S.endProgramDateTime,b)),m||(m=Object(a["findFragmentByPTS"])(S,y,g,b),!m&&S&&S.start<y[0].start&&(m=y[0]))}else m=y[E-1];null!==(t=m)&&void 0!==t&&t.encrypted?(n["logger"].log("Loading key for "+m.sn),this.state=c["State"].KEY_LOADING,this.hls.trigger(i["Events"].KEY_LOADING,{frag:m})):m&&this.fragmentTracker.getState(m)===u["FragmentState"].NOT_LOADED&&this.loadFragment(m,o,g)}}else this.state=c["State"].IDLE},r.loadFragment=function(e,r,i){this.fragCurrent=e,t.prototype.loadFragment.call(this,e,r,i)},g(e,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),e}(c["default"])},"./src/controller/subtitle-track-controller.ts":
/*!*****************************************************!*\
  !*** ./src/controller/subtitle-track-controller.ts ***!
  \*****************************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../events */"./src/events.ts"),n=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),s=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),a=r(/*! ../types/loader */"./src/types/loader.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}function u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}var d=function(t){function e(e){var r;return r=t.call(this,e,"[subtitle-track-controller]")||this,r.media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r.subtitleDisplay=!0,r.registerListeners(),r}u(e,t);var r=e.prototype;return r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,t.prototype.destroy.call(this)},r.registerListeners=function(){var t=this.hls;t.on(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.on(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.on(i["Events"].LEVEL_LOADING,this.onLevelLoading,this),t.on(i["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(i["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(i["Events"].ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.off(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this),t.off(i["Events"].LEVEL_LOADING,this.onLevelLoading,this),t.off(i["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(i["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(i["Events"].ERROR,this.onError,this)},r.onMediaAttached=function(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},r.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},r.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var t=h(this.media.textTracks);t.forEach((function(t){Object(n["clearCurrentCues"])(t)})),this.subtitleTrack=-1,this.media=null}},r.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},r.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},r.onSubtitleTrackLoaded=function(t,e){var r=e.id,i=e.details,n=this.trackId,s=this.tracksInGroup[n];if(s){var a=s.details;s.details=e.details,this.log("subtitle track "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,a))}else this.warn("Invalid subtitle track id "+r)},r.onLevelLoading=function(t,e){this.switchLevel(e.level)},r.onLevelSwitching=function(t,e){this.switchLevel(e.level)},r.switchLevel=function(t){var e=this.hls.levels[t];if(null!==e&&void 0!==e&&e.textGroupIds){var r=e.textGroupIds[e.urlId];if(this.groupId!==r){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter((function(t){return!r||t.groupId===r}));this.tracksInGroup=s;var a=this.findTrackId(null===n||void 0===n?void 0:n.name)||this.findTrackId();this.groupId=r;var o={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(i["Events"].SUBTITLE_TRACKS_UPDATED,o),-1!==a&&this.setSubtitleTrack(a,n)}}},r.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var i=e[r];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},r.onError=function(e,r){t.prototype.onError.call(this,e,r),!r.fatal&&r.context&&r.context.type===a["PlaylistContextType"].SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},r.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,n=e.groupId,s=e.url;if(t)try{s=t.addDirectives(s)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(i["Events"].SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:n,deliveryDirectives:t||null})}},r.toggleTrackModes=function(t){var e=this,r=this.media,i=this.subtitleDisplay,n=this.trackId;if(r){var s=h(r.textTracks),a=s.filter((function(t){return t.groupId===e.groupId}));if(-1===t)[].slice.call(s).forEach((function(t){t.mode="disabled"}));else{var o=a[n];o&&(o.mode="disabled")}var l=a[t];l&&(l.mode=i?"showing":"hidden")}},r.setSubtitleTrack=function(t,e){var r,n=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(-1===t||null!==(r=n[t])&&void 0!==r&&r.details)||t<-1||t>=n.length)){this.clearTimer();var s=n[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,s){var a=s.id,o=s.groupId,l=void 0===o?"":o,u=s.name,c=s.type,d=s.url;this.hls.trigger(i["Events"].SUBTITLE_TRACK_SWITCH,{id:a,groupId:l,name:u,type:c,url:d});var h=this.switchParams(s.url,null===e||void 0===e?void 0:e.details);this.loadPlaylist(h)}else this.hls.trigger(i["Events"].SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},r.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=h(this.media.textTracks),r=0;r<e.length;r++)if("hidden"===e[r].mode)t=r;else if("showing"===e[r].mode){t=r;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},l(e,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}}]),e}(s["default"]);function h(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];"subtitles"===i.kind&&i.label&&e.push(t[r])}return e}e["default"]=d},"./src/controller/timeline-controller.ts":
/*!***********************************************!*\
  !*** ./src/controller/timeline-controller.ts ***!
  \***********************************************/
/*! exports provided: TimelineController */function(t,e,r){"use strict";r.r(e),r.d(e,"TimelineController",(function(){return h}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/cea-608-parser */"./src/utils/cea-608-parser.ts"),a=r(/*! ../utils/output-filter */"./src/utils/output-filter.ts"),o=r(/*! ../utils/webvtt-parser */"./src/utils/webvtt-parser.ts"),l=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),u=r(/*! ../utils/imsc1-ttml-parser */"./src/utils/imsc1-ttml-parser.ts"),c=r(/*! ../types/loader */"./src/types/loader.ts"),d=r(/*! ../utils/logger */"./src/utils/logger.ts"),h=function(){function t(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new a["default"](this,"textTrack1"),r=new a["default"](this,"textTrack2"),i=new a["default"](this,"textTrack3"),o=new a["default"](this,"textTrack4");this.cea608Parser1=new s["default"](1,e,r),this.cea608Parser2=new s["default"](3,i,o)}t.on(n["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(n["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.on(n["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.on(n["Events"].MANIFEST_LOADED,this.onManifestLoaded,this),t.on(n["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(n["Events"].FRAG_LOADING,this.onFragLoading,this),t.on(n["Events"].FRAG_LOADED,this.onFragLoaded,this),t.on(n["Events"].FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(n["Events"].FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(n["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(n["Events"].SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(n["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=function(){var t=this.hls;t.off(n["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(n["Events"].MEDIA_DETACHING,this.onMediaDetaching,this),t.off(n["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.off(n["Events"].MANIFEST_LOADED,this.onManifestLoaded,this),t.off(n["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(n["Events"].FRAG_LOADING,this.onFragLoading,this),t.off(n["Events"].FRAG_LOADED,this.onFragLoaded,this),t.off(n["Events"].FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(n["Events"].FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(n["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(n["Events"].SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(n["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,e,r,i,s){for(var a=!1,o=s.length;o--;){var l=s[o],u=g(l[0],l[1],e,r);if(u>=0&&(l[0]=Math.min(l[0],e),l[1]=Math.max(l[1],r),a=!0,u/(r-e)>.5))return}if(a||s.push([e,r]),this.config.renderTextTracksNatively){var c=this.captionsTracks[t];this.Cues.newCue(c,e,r,i)}else{var d=this.Cues.newCue(null,e,r,i);this.hls.trigger(n["Events"].CUES_PARSED,{type:"captions",cues:d,track:t})}},e.onInitPtsFound=function(t,e){var r=this,i=e.frag,s=e.id,a=e.initPTS,o=e.timescale,l=this.unparsedVttFrags;"main"===s&&(this.initPTS[i.cc]=a,this.timescale[i.cc]=o),l.length&&(this.unparsedVttFrags=[],l.forEach((function(t){r.onFragLoaded(n["Events"].FRAG_LOADED,t)})))},e.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var i=e.textTracks[r];if(i[t])return i}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,r=this.captionsTracks,i=this.media,n=e[t],s=n.label,a=n.languageCode,o=this.getExistingTrack(t);if(o)r[t]=o,Object(l["clearCurrentCues"])(r[t]),Object(l["sendAddTrackEvent"])(r[t],i);else{var u=this.createTextTrack("captions",s,a);u&&(u[t]=!0,r[t]=u)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var r=e.label,i={_id:t,label:r,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=i,this.hls.trigger(n["Events"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},e.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},e.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(e){Object(l["clearCurrentCues"])(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)Object(l["clearCurrentCues"])(e[r])}},e.onSubtitleTracksUpdated=function(t,e){var r=this;this.textTracks=[];var i=e.subtitleTracks||[],s=i.some((function(t){return t.textCodec===u["IMSC1_CODEC"]}));if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var a=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,e){var i;if(e<o.length){for(var n=null,s=0;s<o.length;s++)if(f(o[s],t)){n=o[s];break}n&&(i=n)}i?Object(l["clearCurrentCues"])(i):(i=r.createTextTrack("subtitles",t.name,t.lang),i&&(i.mode="disabled")),i&&(i.groupId=t.groupId,r.textTracks.push(i))}))}else if(!a&&this.tracks&&this.tracks.length){var c=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(n["Events"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}},e.onManifestLoaded=function(t,e){var r=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(e){var i="textTrack"+e[1],n=r.captionsProperties[i];n&&(n.label=t.name,t.lang&&(n.languageCode=t.lang),n.media=t)}}))},e.onFragLoading=function(t,e){var r=this.cea608Parser1,i=this.cea608Parser2,n=this.lastSn,s=this.lastPartIndex;if(this.enabled&&r&&i&&e.frag.type===c["PlaylistLevelType"].MAIN){var a,o,l=e.frag.sn,u=null!=(a=null===e||void 0===e||null===(o=e.part)||void 0===o?void 0:o.index)?a:-1;l===n+1||l===n&&u===s+1||(r.reset(),i.reset()),this.lastSn=l,this.lastPartIndex=u}},e.onFragLoaded=function(t,e){var r=e.frag,s=e.payload,a=this.initPTS,o=this.unparsedVttFrags;if(r.type===c["PlaylistLevelType"].SUBTITLE)if(s.byteLength){if(!Object(i["isFiniteNumber"])(a[r.cc]))return o.push(e),void(a.length&&this.hls.trigger(n["Events"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var l=r.decryptdata;if(null==l||null==l.key||"AES-128"!==l.method){var d=this.tracks[r.level],h=this.vttCCs;h[r.cc]||(h[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),d&&d.textCodec===u["IMSC1_CODEC"]?this._parseIMSC1(r,s):this._parseVTTs(r,s,h)}}else this.hls.trigger(n["Events"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,e){var r=this,i=this.hls;Object(u["parseIMSC1"])(e,this.initPTS[t.cc],this.timescale[t.cc],(function(e){r._appendCues(e,t.level),i.trigger(n["Events"].SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(e){d["logger"].log("Failed to parse IMSC1: "+e),i.trigger(n["Events"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})}))},e._parseVTTs=function(t,e,r){var i=this,s=this.hls;Object(o["parseWebVTT"])(e,this.initPTS[t.cc],this.timescale[t.cc],r,t.cc,t.start,(function(e){i._appendCues(e,t.level),s.trigger(n["Events"].SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(r){i._fallbackToIMSC1(t,e),d["logger"].log("Failed to parse VTT cue: "+r),s.trigger(n["Events"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:r})}))},e._fallbackToIMSC1=function(t,e){var r=this,i=this.tracks[t.level];i.textCodec||Object(u["parseIMSC1"])(e,this.initPTS[t.cc],this.timescale[t.cc],(function(){i.textCodec=u["IMSC1_CODEC"],r._parseIMSC1(t,e)}),(function(){i.textCodec="wvtt"}))},e._appendCues=function(t,e){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if("disabled"===i.mode)return;t.forEach((function(t){return Object(l["addCueToTrack"])(i,t)}))}else{var s=this.tracks[e],a=s.default?"default":"subtitles"+e;r.trigger(n["Events"].CUES_PARSED,{type:"subtitles",cues:t,track:a})}},e.onFragDecrypted=function(t,e){var r=e.frag;if(r.type===c["PlaylistLevelType"].SUBTITLE){if(!Object(i["isFiniteNumber"])(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(e);this.onFragLoaded(n["Events"].FRAG_LOADED,e)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,e){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i)for(var n=0;n<e.samples.length;n++){var s=e.samples[n].bytes;if(s){var a=this.extractCea608Data(s);r.addData(e.samples[n].pts,a[0]),i.addData(e.samples[n].pts,a[1])}}},e.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset,n=e.endOffsetSubtitles,s=e.type,a=this.media;if(a&&!(a.currentTime<i)){if(!s||"video"===s){var o=this.captionsTracks;Object.keys(o).forEach((function(t){return Object(l["removeCuesInRange"])(o[t],r,i)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==n){var u=this.textTracks;Object.keys(u).forEach((function(t){return Object(l["removeCuesInRange"])(u[t],r,n)}))}}},e.extractCea608Data=function(t){for(var e=31&t[0],r=2,i=[[],[]],n=0;n<e;n++){var s=t[r++],a=127&t[r++],o=127&t[r++],l=0!==(4&s),u=3&s;0===a&&0===o||l&&(0!==u&&1!==u||(i[u].push(a),i[u].push(o)))}return i},t}();function f(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function g(t,e,r,i){return Math.min(e,i)-Math.max(t,r)}function v(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":
/*!*********************************!*\
  !*** ./src/crypt/aes-crypto.ts ***!
  \*********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return i}));var i=function(){function t(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}var e=t.prototype;return e.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}()},"./src/crypt/aes-decryptor.ts":
/*!************************************!*\
  !*** ./src/crypt/aes-decryptor.ts ***!
  \************************************/
/*! exports provided: removePadding, default */function(t,e,r){"use strict";r.r(e),r.d(e,"removePadding",(function(){return n})),r.d(e,"default",(function(){return s}));var i=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts");function n(t){var e=t.byteLength,r=e&&new DataView(t.buffer).getUint8(e-1);return r?Object(i["sliceUint8"])(t,0,e-r):t}var s=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},e.initTable=function(){var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],n=r[1],s=r[2],a=r[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=new Uint32Array(256),f=0,g=0,v=0;for(v=0;v<256;v++)h[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var p=g^g<<1^g<<2^g<<3^g<<4;p=p>>>8^255&p^99,t[f]=p,e[p]=f;var m=h[f],y=h[m],E=h[y],T=257*h[p]^16843008*p;i[f]=T<<24|T>>>8,n[f]=T<<16|T>>>16,s[f]=T<<8|T>>>24,a[f]=T,T=16843009*E^65537*y^257*m^16843008*f,l[p]=T<<24|T>>>8,u[p]=T<<16|T>>>16,c[p]=T<<8|T>>>24,d[p]=T,f?(f=m^h[h[h[E^m]]],g^=h[h[g]]):f=g=1}},e.expandKey=function(t){var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;while(i<e.length&&r)r=e[i]===this.key[i],i++;if(!r){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var s,a,o,l,u=this.ksRows=4*(n+6+1),c=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),h=this.sBox,f=this.rcon,g=this.invSubMix,v=g[0],p=g[1],m=g[2],y=g[3];for(s=0;s<u;s++)s<n?o=c[s]=e[s]:(l=o,s%n===0?(l=l<<8|l>>>24,l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=f[s/n|0]<<24):n>6&&s%n===4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),c[s]=o=(c[s-n]^l)>>>0);for(a=0;a<u;a++)s=u-a,l=3&a?c[s]:c[s-4],d[a]=a<4||s<=4?l:v[h[l>>>24]]^p[h[l>>>16&255]]^m[h[l>>>8&255]]^y[h[255&l]],d[a]=d[a]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,r){var i,n,s,a,o,l,u,c,d,h,f,g,v,p,m=this.keySize+6,y=this.invKeySchedule,E=this.invSBox,T=this.invSubMix,S=T[0],b=T[1],L=T[2],A=T[3],D=this.uint8ArrayToUint32Array_(r),k=D[0],R=D[1],I=D[2],_=D[3],C=new Int32Array(t),O=new Int32Array(C.length),w=this.networkToHostOrderSwap;while(e<C.length){for(d=w(C[e]),h=w(C[e+1]),f=w(C[e+2]),g=w(C[e+3]),o=d^y[0],l=g^y[1],u=f^y[2],c=h^y[3],v=4,p=1;p<m;p++)i=S[o>>>24]^b[l>>16&255]^L[u>>8&255]^A[255&c]^y[v],n=S[l>>>24]^b[u>>16&255]^L[c>>8&255]^A[255&o]^y[v+1],s=S[u>>>24]^b[c>>16&255]^L[o>>8&255]^A[255&l]^y[v+2],a=S[c>>>24]^b[o>>16&255]^L[l>>8&255]^A[255&u]^y[v+3],o=i,l=n,u=s,c=a,v+=4;i=E[o>>>24]<<24^E[l>>16&255]<<16^E[u>>8&255]<<8^E[255&c]^y[v],n=E[l>>>24]<<24^E[u>>16&255]<<16^E[c>>8&255]<<8^E[255&o]^y[v+1],s=E[u>>>24]<<24^E[c>>16&255]<<16^E[o>>8&255]<<8^E[255&l]^y[v+2],a=E[c>>>24]<<24^E[o>>16&255]<<16^E[l>>8&255]<<8^E[255&u]^y[v+3],O[e]=w(i^k),O[e+1]=w(a^R),O[e+2]=w(s^I),O[e+3]=w(n^_),k=d,R=h,I=f,_=g,e+=4}return O.buffer},t}()},"./src/crypt/decrypter.ts":
/*!********************************!*\
  !*** ./src/crypt/decrypter.ts ***!
  \********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return c}));var i=r(/*! ./aes-crypto */"./src/crypt/aes-crypto.ts"),n=r(/*! ./fast-aes-key */"./src/crypt/fast-aes-key.ts"),s=r(/*! ./aes-decryptor */"./src/crypt/aes-decryptor.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),l=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),u=16,c=function(){function t(t,e,r){var i=void 0===r?{}:r,n=i.removePKCS7Padding,s=void 0===n||n;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=e,this.removePKCS7Padding=s,s)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(o){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var e=t.prototype;return e.destroy=function(){this.observer=null},e.isSync=function(){return this.config.enableSoftwareAES},e.flush=function(){var t=this.currentResult;if(t){var e=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Object(s["removePadding"])(e):e}this.reset()},e.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},e.decrypt=function(t,e,r,i){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(t),e,r);var n=this.flush();n&&i(n.buffer)}else this.webCryptoDecrypt(new Uint8Array(t),e,r).then(i)},e.softwareDecrypt=function(t,e,r){var i=this.currentIV,n=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(t=Object(o["appendUint8Array"])(a,t),this.remainderData=null);var u=this.getValidChunk(t);if(!u.length)return null;i&&(r=i);var c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new s["default"]),c.expandKey(e);var d=n;return this.currentResult=c.decrypt(u.buffer,0,r),this.currentIV=Object(l["sliceUint8"])(u,-16).buffer,d||null},e.webCryptoDecrypt=function(t,e,r){var s=this,a=this.subtle;return this.key===e&&this.fastAesKey||(this.key=e,this.fastAesKey=new n["default"](a,e)),this.fastAesKey.expandKey().then((function(e){if(!a)return Promise.reject(new Error("web crypto not initialized"));var n=new i["default"](a,r);return n.decrypt(t.buffer,e)})).catch((function(i){return s.onWebCryptoError(i,t,e,r)}))},e.onWebCryptoError=function(t,e,r,i){return a["logger"].warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(e,r,i)},e.getValidChunk=function(t){var e=t,r=t.length-t.length%u;return r!==t.length&&(e=Object(l["sliceUint8"])(t,0,r),this.remainderData=Object(l["sliceUint8"])(t,r)),e},e.logOnce=function(t){this.logEnabled&&(a["logger"].log("[decrypter.ts]: "+t),this.logEnabled=!1)},t}()},"./src/crypt/fast-aes-key.ts":
/*!***********************************!*\
  !*** ./src/crypt/fast-aes-key.ts ***!
  \***********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return i}));var i=function(){function t(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}var e=t.prototype;return e.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}()},"./src/demux/aacdemuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/aacdemuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),n=r(/*! ./adts */"./src/demux/adts.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=r(/*! ../demux/id3 */"./src/demux/id3.ts");function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,l(t,e)}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}var u=function(t){function e(e,r){var i;return i=t.call(this)||this,i.observer=void 0,i.config=void 0,i.observer=e,i.config=r,i}o(e,t);var r=e.prototype;return r.resetInitSegment=function(e,r,i){t.prototype.resetInitSegment.call(this,e,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:e,duration:i,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(!t)return!1;for(var e=a["getID3Data"](t,0)||[],r=e.length,i=t.length;r<i;r++)if(n["probe"](t,r))return s["logger"].log("ADTS sync word found !"),!0;return!1},r.canParse=function(t,e){return n["canParse"](t,e)},r.appendFrame=function(t,e,r){n["initTrackConfig"](t,this.observer,e,r,t.manifestCodec);var i=n["appendFrame"](t,e,r,this.initPTS,this.frameIndex);if(i&&0===i.missing)return i},e}(i["default"]);u.minProbeByteLength=9,e["default"]=u},"./src/demux/adts.ts":
/*!***************************!*\
  !*** ./src/demux/adts.ts ***!
  \***************************/
/*! exports provided: getAudioConfig, isHeaderPattern, getHeaderLength, getFullFrameLength, canGetFrameLength, isHeader, canParse, probe, initTrackConfig, getFrameDuration, parseFrameHeader, appendFrame */function(t,e,r){"use strict";r.r(e),r.d(e,"getAudioConfig",(function(){return a})),r.d(e,"isHeaderPattern",(function(){return o})),r.d(e,"getHeaderLength",(function(){return l})),r.d(e,"getFullFrameLength",(function(){return u})),r.d(e,"canGetFrameLength",(function(){return c})),r.d(e,"isHeader",(function(){return d})),r.d(e,"canParse",(function(){return h})),r.d(e,"probe",(function(){return f})),r.d(e,"initTrackConfig",(function(){return g})),r.d(e,"getFrameDuration",(function(){return v})),r.d(e,"parseFrameHeader",(function(){return p})),r.d(e,"appendFrame",(function(){return m}));var i=r(/*! ../utils/logger */"./src/utils/logger.ts"),n=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ../events */"./src/events.ts");function a(t,e,r,a){var o,l,u,c,d=navigator.userAgent.toLowerCase(),h=a,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=1+((192&e[r+2])>>>6);var g=(60&e[r+2])>>>2;if(!(g>f.length-1))return u=(1&e[r+2])<<2,u|=(192&e[r+3])>>>6,i["logger"].log("manifest codec:"+a+", ADTS type:"+o+", samplingIndex:"+g),/firefox/i.test(d)?g>=6?(o=5,c=new Array(4),l=g-3):(o=2,c=new Array(2),l=g):-1!==d.indexOf("android")?(o=2,c=new Array(2),l=g):(o=5,c=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&g>=6?l=g-3:((a&&-1!==a.indexOf("mp4a.40.2")&&(g>=6&&1===u||/vivaldi/i.test(d))||!a&&1===u)&&(o=2,c=new Array(2)),l=g)),c[0]=o<<3,c[0]|=(14&g)>>1,c[1]|=(1&g)<<7,c[1]|=u<<3,5===o&&(c[1]|=(14&l)>>1,c[2]=(1&l)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:f[g],channelCount:u,codec:"mp4a.40."+o,manifestCodec:h};t.trigger(s["Events"].ERROR,{type:n["ErrorTypes"].MEDIA_ERROR,details:n["ErrorDetails"].FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+g})}function o(t,e){return 255===t[e]&&240===(246&t[e+1])}function l(t,e){return 1&t[e+1]?7:9}function u(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function c(t,e){return e+5<t.length}function d(t,e){return e+1<t.length&&o(t,e)}function h(t,e){return c(t,e)&&o(t,e)&&u(t,e)<=t.length-e}function f(t,e){if(d(t,e)){var r=l(t,e);if(e+r>=t.length)return!1;var i=u(t,e);if(i<=r)return!1;var n=e+i;return n===t.length||d(t,n)}return!1}function g(t,e,r,n,s){if(!t.samplerate){var o=a(e,r,n,s);if(!o)return;t.config=o.config,t.samplerate=o.samplerate,t.channelCount=o.channelCount,t.codec=o.codec,t.manifestCodec=o.manifestCodec,i["logger"].log("parsed codec:"+t.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function v(t){return 9216e4/t}function p(t,e,r,i,n){var s=l(t,e),a=u(t,e);if(a-=s,a>0){var o=r+i*n;return{headerLength:s,frameLength:a,stamp:o}}}function m(t,e,r,i,n){var s=v(t.samplerate),a=p(e,r,i,n,s);if(a){var o,l=a.frameLength,u=a.headerLength,c=a.stamp,d=u+l,h=Math.max(0,r+d-e.length);h?(o=new Uint8Array(d-u),o.set(e.subarray(r+u,e.length),0)):o=e.subarray(r+u,r+d);var f={unit:o,pts:c};return h||t.samples.push(f),{sample:f,length:d,missing:h}}}},"./src/demux/base-audio-demuxer.ts":
/*!*****************************************!*\
  !*** ./src/demux/base-audio-demuxer.ts ***!
  \*****************************************/
/*! exports provided: initPTSFn, default */function(t,e,r){"use strict";r.r(e),r.d(e,"initPTSFn",(function(){return u}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../demux/id3 */"./src/demux/id3.ts"),s=r(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),a=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),o=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),l=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var e=t.prototype;return e.resetInitSegment=function(t,e,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},e.resetTimeStamp=function(){},e.resetContiguity=function(){},e.canParse=function(t,e){return!1},e.appendFrame=function(t,e,r){},e.demux=function(t,e){this.cachedData&&(t=Object(a["appendUint8Array"])(this.cachedData,t),this.cachedData=null);var r,i,l=n["getID3Data"](t,0),c=l?l.length:0,d=this._audioTrack,h=this._id3Track,f=l?n["getTimeStamp"](l):void 0,g=t.length;0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=u(f,e)),l&&l.length>0&&h.samples.push({pts:this.initPTS,dts:this.initPTS,data:l}),i=this.initPTS;while(c<g){if(this.canParse(t,c)){var v=this.appendFrame(d,t,c);v?(this.frameIndex++,i=v.sample.pts,c+=v.length,r=c):c=g}else n["canParse"](t,c)?(l=n["getID3Data"](t,c),h.samples.push({pts:i,dts:i,data:l}),c+=l.length,r=c):c++;if(c===g&&r!==g){var p=Object(o["sliceUint8"])(t,r);this.cachedData?this.cachedData=Object(a["appendUint8Array"])(this.cachedData,p):this.cachedData=p}}return{audioTrack:d,avcTrack:Object(s["dummyTrack"])(),id3Track:h,textTrack:Object(s["dummyTrack"])()}},e.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},e.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(s["dummyTrack"])(),id3Track:this._id3Track,textTrack:Object(s["dummyTrack"])()}},e.destroy=function(){},t}(),u=function(t,e){return Object(i["isFiniteNumber"])(t)?90*t:9e4*e};e["default"]=l},"./src/demux/chunk-cache.ts":
/*!**********************************!*\
  !*** ./src/demux/chunk-cache.ts ***!
  \**********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return i}));var i=function(){function t(){this.chunks=[],this.dataLength=0}var e=t.prototype;return e.push=function(t){this.chunks.push(t),this.dataLength+=t.length},e.flush=function(){var t,e=this.chunks,r=this.dataLength;return e.length?(t=1===e.length?e[0]:n(e,r),this.reset(),t):new Uint8Array(0)},e.reset=function(){this.chunks.length=0,this.dataLength=0},t}();function n(t,e){for(var r=new Uint8Array(e),i=0,n=0;n<t.length;n++){var s=t[n];r.set(s,i),i+=s.length}return r}},"./src/demux/dummy-demuxed-track.ts":
/*!******************************************!*\
  !*** ./src/demux/dummy-demuxed-track.ts ***!
  \******************************************/
/*! exports provided: dummyTrack */function(t,e,r){"use strict";function i(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}r.r(e),r.d(e,"dummyTrack",(function(){return i}))},"./src/demux/exp-golomb.ts":
/*!*********************************!*\
  !*** ./src/demux/exp-golomb.ts ***!
  \*********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../utils/logger */"./src/utils/logger.ts"),n=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),n=Math.min(4,e);if(0===n)throw new Error("no bytes available");i.set(t.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},e.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return t>32&&i["logger"].error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0&&this.bitsAvailable?r<<e|this.readBits(e):r},e.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!==(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){for(var e,r=8,i=8,n=0;n<t;n++)0!==i&&(e=this.readEG(),i=(r+e+256)%256),r=0===i?r:i},e.readSPS=function(){var t,e,r,i=0,n=0,s=0,a=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);o();var v=o();if(l(5),d(3),o(),f(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var p=u();if(3===p&&d(1),f(),f(),d(1),c())for(e=3!==p?8:12,r=0;r<e;r++)c()&&g(r<6?16:64)}f();var m=u();if(0===m)u();else if(1===m)for(d(1),h(),h(),t=u(),r=0;r<t;r++)h();f(),d(1);var y=u(),E=u(),T=l(1);0===T&&d(1),d(1),c()&&(i=u(),n=u(),s=u(),a=u());var S=[1,1];if(c()&&c()){var b=o();switch(b){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[o()<<8|o(),o()<<8|o()];break}}return{width:Math.ceil(16*(y+1)-2*i-2*n),height:(2-T)*(E+1)*16-(T?2:4)*(s+a),pixelRatio:S}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}();e["default"]=n},"./src/demux/id3.ts":
/*!**************************!*\
  !*** ./src/demux/id3.ts ***!
  \**************************/
/*! exports provided: isHeader, isFooter, getID3Data, canParse, getTimeStamp, isTimeStampFrame, getID3Frames, decodeFrame, utf8ArrayToStr, testables */function(t,e,r){"use strict";r.r(e),r.d(e,"isHeader",(function(){return n})),r.d(e,"isFooter",(function(){return s})),r.d(e,"getID3Data",(function(){return a})),r.d(e,"canParse",(function(){return l})),r.d(e,"getTimeStamp",(function(){return u})),r.d(e,"isTimeStampFrame",(function(){return c})),r.d(e,"getID3Frames",(function(){return h})),r.d(e,"decodeFrame",(function(){return f})),r.d(e,"utf8ArrayToStr",(function(){return y})),r.d(e,"testables",(function(){return E}));var i,n=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},s=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},a=function(t,e){var r=e,i=0;while(n(t,e)){i+=10;var a=o(t,e+6);i+=a,s(t,e+10)&&(i+=10),e+=i}if(i>0)return t.subarray(r,r+i)},o=function(t,e){var r=0;return r=(127&t[e])<<21,r|=(127&t[e+1])<<14,r|=(127&t[e+2])<<7,r|=127&t[e+3],r},l=function(t,e){return n(t,e)&&o(t,e+6)+10<=t.length-e},u=function(t){for(var e=h(t),r=0;r<e.length;r++){var i=e[r];if(c(i))return m(i)}},c=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},d=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),r=o(t,4),i=10;return{type:e,size:r,data:t.subarray(i,i+r)}},h=function(t){var e=0,r=[];while(n(t,e)){var i=o(t,e+6);e+=10;var a=e+i;while(e+8<a){var l=d(t.subarray(e)),u=f(l);u&&r.push(u),e+=l.size+10}s(t,e)&&(e+=10)}return r},f=function(t){return"PRIV"===t.type?g(t):"W"===t.type[0]?p(t):v(t)},g=function(t){if(!(t.size<2)){var e=y(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}},v=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,r=y(t.data.subarray(e),!0);e+=r.length+1;var i=y(t.data.subarray(e));return{key:t.type,info:r,data:i}}var n=y(t.data.subarray(1));return{key:t.type,data:n}}},p=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,r=y(t.data.subarray(e),!0);e+=r.length+1;var i=y(t.data.subarray(e));return{key:t.type,info:r,data:i}}var n=y(t.data);return{key:t.type,data:n}},m=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),r=1&e[3],i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},y=function(t,e){void 0===e&&(e=!1);var r=T();if(r){var i=r.decode(t);if(e){var n=i.indexOf("\0");return-1!==n?i.substring(0,n):i}return i.replace(/\0/g,"")}var s,a,o,l=t.length,u="",c=0;while(c<l){if(s=t[c++],0===s&&e)return u;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(s);break;case 12:case 13:a=t[c++],u+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=t[c++],o=t[c++],u+=String.fromCharCode((15&s)<<12|(63&a)<<6|(63&o)<<0);break;default:}}return u},E={decodeTextFrame:v};function T(){return i||"undefined"===typeof self.TextDecoder||(i=new self.TextDecoder("utf-8")),i}},"./src/demux/mp3demuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/mp3demuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),n=r(/*! ../demux/id3 */"./src/demux/id3.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=r(/*! ./mpegaudio */"./src/demux/mpegaudio.ts");function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,l(t,e)}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}var u=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var r=e.prototype;return r.resetInitSegment=function(e,r,i){t.prototype.resetInitSegment.call(this,e,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:e,duration:i,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(!t)return!1;for(var e=n["getID3Data"](t,0)||[],r=e.length,i=t.length;r<i;r++)if(a["probe"](t,r))return s["logger"].log("MPEG Audio sync word found !"),!0;return!1},r.canParse=function(t,e){return a["canParse"](t,e)},r.appendFrame=function(t,e,r){if(null!==this.initPTS)return a["appendFrame"](t,e,r,this.initPTS,this.frameIndex)},e}(i["default"]);u.minProbeByteLength=4,e["default"]=u},"./src/demux/mp4demuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),n=r(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),s=function(){function t(t,e){this.remainderData=null,this.config=void 0,this.config=e}var e=t.prototype;return e.resetTimeStamp=function(){},e.resetInitSegment=function(){},e.resetContiguity=function(){},t.probe=function(t){return Object(i["findBox"])({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.demux=function(t){var e=t,r=Object(n["dummyTrack"])();if(this.config.progressive){this.remainderData&&(e=Object(i["appendUint8Array"])(this.remainderData,t));var s=Object(i["segmentValidRange"])(e);this.remainderData=s.remainder,r.samples=s.valid||new Uint8Array}else r.samples=e;return{audioTrack:Object(n["dummyTrack"])(),avcTrack:r,id3Track:Object(n["dummyTrack"])(),textTrack:Object(n["dummyTrack"])()}},e.flush=function(){var t=Object(n["dummyTrack"])();return t.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(n["dummyTrack"])(),avcTrack:t,id3Track:Object(n["dummyTrack"])(),textTrack:Object(n["dummyTrack"])()}},e.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},e.destroy=function(){},t}();s.minProbeByteLength=1024,e["default"]=s},"./src/demux/mpegaudio.ts":
/*!********************************!*\
  !*** ./src/demux/mpegaudio.ts ***!
  \********************************/
/*! exports provided: appendFrame, parseHeader, isHeaderPattern, isHeader, canParse, probe */function(t,e,r){"use strict";r.r(e),r.d(e,"appendFrame",(function(){return l})),r.d(e,"parseHeader",(function(){return u})),r.d(e,"isHeaderPattern",(function(){return c})),r.d(e,"isHeader",(function(){return d})),r.d(e,"canParse",(function(){return h})),r.d(e,"probe",(function(){return f}));var i=null,n=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],s=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],a=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],o=[0,1,1,4];function l(t,e,r,i,n){if(!(r+24>e.length)){var s=u(e,r);if(s&&r+s.frameLength<=e.length){var a=9e4*s.samplesPerFrame/s.sampleRate,o=i+n*a,l={unit:e.subarray(r,r+s.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}}function u(t,e){var r=t[e+1]>>3&3,l=t[e+1]>>1&3,u=t[e+2]>>4&15,c=t[e+2]>>2&3;if(1!==r&&0!==u&&15!==u&&3!==c){var d=t[e+2]>>1&1,h=t[e+3]>>6,f=3===r?3-l:3===l?3:4,g=1e3*n[14*f+u-1],v=3===r?0:2===r?1:2,p=s[3*v+c],m=3===h?1:2,y=a[r][l],E=o[l],T=8*y*E,S=Math.floor(y*g/p+d)*E;if(null===i){var b=navigator.userAgent||"",L=b.match(/Chrome\/(\d+)/i);i=L?parseInt(L[1]):0}var A=!!i&&i<=87;return A&&2===l&&g>=224e3&&0===h&&(t[e+3]=128|t[e+3]),{sampleRate:p,channelCount:m,frameLength:S,samplesPerFrame:T}}}function c(t,e){return 255===t[e]&&224===(224&t[e+1])&&0!==(6&t[e+1])}function d(t,e){return e+1<t.length&&c(t,e)}function h(t,e){var r=4;return c(t,e)&&r<=t.length-e}function f(t,e){if(e+1<t.length&&c(t,e)){var r=4,i=u(t,e),n=r;null!==i&&void 0!==i&&i.frameLength&&(n=i.frameLength);var s=e+n;return s===t.length||d(t,s)}return!1}},"./src/demux/sample-aes.ts":
/*!*********************************!*\
  !*** ./src/demux/sample-aes.ts ***!
  \*********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),n=r(/*! ./tsdemuxer */"./src/demux/tsdemuxer.ts"),s=function(){function t(t,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new i["default"](t,e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,e)},e.decryptAacSample=function(t,e,r,i){var n=t[e].unit,s=n.subarray(16,n.length-n.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),o=this;this.decryptBuffer(a,(function(s){var a=new Uint8Array(s);n.set(a,16),i||o.decryptAacSamples(t,e+1,r)}))},e.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,i),!i)return}}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,n=32;n<=t.length-16;n+=160,i+=16)r.set(t.subarray(n,n+16),i);return r},e.getAvcDecryptedUnit=function(t,e){for(var r=new Uint8Array(e),i=0,n=32;n<=t.length-16;n+=160,i+=16)t.set(r.subarray(i,i+16),n);return t},e.decryptAvcSample=function(t,e,r,i,s,a){var o=Object(n["discardEPB"])(s.data),l=this.getAvcEncryptedData(o),u=this;this.decryptBuffer(l.buffer,(function(n){s.data=u.getAvcDecryptedUnit(o,n),a||u.decryptAvcSamples(t,e,r+1,i)}))},e.decryptAvcSamples=function(t,e,r,i){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length)return void i();for(var n=t[e].units;;r++){if(r>=n.length)break;var s=n[r];if(!(s.data.length<=48||1!==s.type&&5!==s.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,i,s,a),!a)return}}}},t}();e["default"]=s},"./src/demux/transmuxer-interface.ts":
/*!*******************************************!*\
  !*** ./src/demux/transmuxer-interface.ts ***!
  \*******************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return d}));var i=r(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../errors */"./src/errors.ts"),l=r(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),u=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),c=Object(l["getMediaSource"])()||{isTypeSupported:function(){return!1}},d=function(){function t(t,e,r,l){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=e,this.onTransmuxComplete=r,this.onFlush=l;var h=t.config,f=function(e,r){r=r||{},r.frag=d.frag,r.id=d.id,t.trigger(e,r)};this.observer=new u["EventEmitter"],this.observer.on(n["Events"].FRAG_DECRYPTED,f),this.observer.on(n["Events"].ERROR,f);var g={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(h.enableWorker&&"undefined"!==typeof Worker){var p;a["logger"].log("demuxing in webworker");try{p=this.worker=i(/*! ../demux/transmuxer-worker.ts */"./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(e){t.trigger(n["Events"].ERROR,{type:o["ErrorTypes"].OTHER_ERROR,details:o["ErrorDetails"].INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(e.message+"  ("+e.filename+":"+e.lineno+")")})},p.postMessage({cmd:"init",typeSupported:g,vendor:v,id:e,config:JSON.stringify(h)})}catch(m){a["logger"].warn("Error in worker:",m),a["logger"].error("Error while initializing DemuxerWorker, fallback to inline"),p&&self.URL.revokeObjectURL(p.objectURL),this.transmuxer=new s["default"](this.observer,g,h,v,e),this.worker=null}}else this.transmuxer=new s["default"](this.observer,g,h,v,e)}var e=t.prototype;return e.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.observer=null},e.push=function(t,e,r,i,n,o,l,u,c,d){var h=this;c.transmuxing.start=self.performance.now();var f=this.transmuxer,g=this.worker,v=o?o.start:n.start,p=n.decryptdata,m=this.frag,y=!(m&&n.cc===m.cc),E=!(m&&c.level===m.level),T=m?c.sn-m.sn:-1,S=this.part?c.part-this.part.index:1,b=!E&&(1===T||0===T&&1===S),L=self.performance.now();(E||T||0===n.stats.parsing.start)&&(n.stats.parsing.start=L),!o||!S&&b||(o.stats.parsing.start=L);var A=new s["TransmuxState"](y,b,u,E,v);if(!b||y){a["logger"].log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+"\n        discontinuity: "+y+"\n        trackSwitch: "+E+"\n        contiguous: "+b+"\n        accurateTimeOffset: "+u+"\n        timeOffset: "+v);var D=new s["TransmuxConfig"](r,i,e,l,d);this.configureTransmuxer(D)}if(this.frag=n,this.part=o,g)g.postMessage({cmd:"demux",data:t,decryptdata:p,chunkMeta:c,state:A},t instanceof ArrayBuffer?[t]:[]);else if(f){var k=f.push(t,p,c,A);Object(s["isPromise"])(k)?k.then((function(t){h.handleTransmuxComplete(t)})):this.handleTransmuxComplete(k)}},e.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var r=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:t});else if(r){var n=r.flush(t);Object(s["isPromise"])(n)?n.then((function(r){e.handleFlushResult(r,t)})):this.handleFlushResult(n,t)}},e.handleFlushResult=function(t,e){var r=this;t.forEach((function(t){r.handleTransmuxComplete(t)})),this.onFlush(e)},e.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data);break}},e.configureTransmuxer=function(t){var e=this.worker,r=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):r&&r.configure(t)},e.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}()},"./src/demux/transmuxer-worker.ts":
/*!****************************************!*\
  !*** ./src/demux/transmuxer-worker.ts ***!
  \****************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var i=r(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");function o(t){var e=new a["EventEmitter"],r=function(e,r){t.postMessage({event:e,data:r})};e.on(n["Events"].FRAG_DECRYPTED,r),e.on(n["Events"].ERROR,r),t.addEventListener("message",(function(n){var a=n.data;switch(a.cmd){case"init":var o=JSON.parse(a.config);t.transmuxer=new i["default"](e,a.typeSupported,o,a.vendor,a.id),Object(s["enableLogs"])(o.debug),r("init",null);break;case"configure":t.transmuxer.configure(a.config);break;case"demux":var u=t.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);Object(i["isPromise"])(u)?u.then((function(e){l(t,e)})):l(t,u);break;case"flush":var d=a.chunkMeta,h=t.transmuxer.flush(d);Object(i["isPromise"])(h)?h.then((function(e){c(t,e,d)})):c(t,h,d);break;default:break}}))}function l(t,e){if(!d(e.remuxResult)){var r=[],i=e.remuxResult,n=i.audio,s=i.video;n&&u(r,n),s&&u(r,s),t.postMessage({event:"transmuxComplete",data:e},r)}}function u(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function c(t,e,r){e.forEach((function(e){l(t,e)})),t.postMessage({event:"flush",data:r})}function d(t){return!t.audio&&!t.video&&!t.text&&!t.id3&&!t.initSegment}},"./src/demux/transmuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/transmuxer.ts ***!
  \*********************************/
/*! exports provided: default, isPromise, TransmuxConfig, TransmuxState */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return y})),r.d(e,"isPromise",(function(){return S})),r.d(e,"TransmuxConfig",(function(){return b})),r.d(e,"TransmuxState",(function(){return L}));var i,n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),o=r(/*! ../demux/aacdemuxer */"./src/demux/aacdemuxer.ts"),l=r(/*! ../demux/mp4demuxer */"./src/demux/mp4demuxer.ts"),u=r(/*! ../demux/tsdemuxer */"./src/demux/tsdemuxer.ts"),c=r(/*! ../demux/mp3demuxer */"./src/demux/mp3demuxer.ts"),d=r(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),h=r(/*! ../remux/passthrough-remuxer */"./src/remux/passthrough-remuxer.ts"),f=r(/*! ./chunk-cache */"./src/demux/chunk-cache.ts"),g=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),v=r(/*! ../utils/logger */"./src/utils/logger.ts");try{i=self.performance.now.bind(self.performance)}catch(A){v["logger"].debug("Unable to use Performance API on this environment"),i=self.Date.now}var p=[{demux:u["default"],remux:d["default"]},{demux:l["default"],remux:h["default"]},{demux:o["default"],remux:d["default"]},{demux:c["default"],remux:d["default"]}],m=1024;p.forEach((function(t){var e=t.demux;m=Math.max(m,e.minProbeByteLength)}));var y=function(){function t(t,e,r,i,n){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new f["default"],this.observer=t,this.typeSupported=e,this.config=r,this.vendor=i,this.id=n}var e=t.prototype;return e.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,r,n){var s=this,a=r.transmuxing;a.executeStart=i();var o=new Uint8Array(t),l=this.cache,u=this.config,c=this.currentTransmuxState,d=this.transmuxConfig;n&&(this.currentTransmuxState=n);var h=E(o,e);if(h&&"AES-128"===h.method){var f=this.getDecrypter();if(!u.enableSoftwareAES)return this.decryptionPromise=f.webCryptoDecrypt(o,h.key.buffer,h.iv.buffer).then((function(t){var e=s.push(t,null,r);return s.decryptionPromise=null,e})),this.decryptionPromise;var v=f.softwareDecrypt(o,h.key.buffer,h.iv.buffer);if(!v)return a.executeEnd=i(),T(r);o=new Uint8Array(v)}var p=n||c,m=p.contiguous,y=p.discontinuity,S=p.trackSwitch,b=p.accurateTimeOffset,L=p.timeOffset,A=d.audioCodec,D=d.videoCodec,k=d.defaultInitPts,R=d.duration,I=d.initSegmentData;if((y||S)&&this.resetInitSegment(I,A,D,R),y&&this.resetInitialTimestamp(k),m||this.resetContiguity(),this.needsProbing(o,y,S)){if(l.dataLength){var _=l.flush();o=Object(g["appendUint8Array"])(_,o)}this.configureTransmuxer(o,d)}var C=this.transmux(o,h,L,b,r),O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,a.executeEnd=i(),C},e.flush=function(t){var e=this,r=t.transmuxing;r.executeStart=i();var a=this.decrypter,o=this.cache,l=this.currentTransmuxState,u=this.decryptionPromise;if(u)return u.then((function(){return e.flush(t)}));var c=[],d=l.timeOffset;if(a){var h=a.flush();h&&c.push(this.push(h,null,t))}var f=o.dataLength;o.reset();var g=this.demuxer,v=this.remuxer;if(!g||!v)return f>=m&&this.observer.emit(n["Events"].ERROR,n["Events"].ERROR,{type:s["ErrorTypes"].MEDIA_ERROR,details:s["ErrorDetails"].FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),r.executeEnd=i(),[T(t)];var p=g.flush(d);return S(p)?p.then((function(r){return e.flushRemux(c,r,t),c})):(this.flushRemux(c,p,t),c)},e.flushRemux=function(t,e,r){var n=e.audioTrack,s=e.avcTrack,a=e.id3Track,o=e.textTrack,l=this.currentTransmuxState,u=l.accurateTimeOffset,c=l.timeOffset;v["logger"].log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var d=this.remuxer.remux(n,s,a,o,c,u,!0,this.id);t.push({remuxResult:d,chunkMeta:r}),r.transmuxing.executeEnd=i()},e.resetInitialTimestamp=function(t){var e=this.demuxer,r=this.remuxer;e&&r&&(e.resetTimeStamp(t),r.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,r,i){var n=this.demuxer,s=this.remuxer;n&&s&&(n.resetInitSegment(e,r,i),s.resetInitSegment(t,e,r))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,r,i,n){var s;return s=e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,r,i,n):this.transmuxUnencrypted(t,r,i,n),s},e.transmuxUnencrypted=function(t,e,r,i){var n=this.demuxer.demux(t,e,!1,!this.config.progressive),s=n.audioTrack,a=n.avcTrack,o=n.id3Track,l=n.textTrack,u=this.remuxer.remux(s,a,o,l,e,r,!1,this.id);return{remuxResult:u,chunkMeta:i}},e.transmuxSampleAes=function(t,e,r,i,n){var s=this;return this.demuxer.demuxSampleAes(t,e,r).then((function(t){var e=s.remuxer.remux(t.audioTrack,t.avcTrack,t.id3Track,t.textTrack,r,i,!1,s.id);return{remuxResult:e,chunkMeta:n}}))},e.configureTransmuxer=function(t,e){for(var r,i=this.config,n=this.observer,s=this.typeSupported,a=this.vendor,o=e.audioCodec,u=e.defaultInitPts,c=e.duration,d=e.initSegmentData,f=e.videoCodec,g=0,m=p.length;g<m;g++)if(p[g].demux.probe(t)){r=p[g];break}r||(v["logger"].warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),r={demux:l["default"],remux:h["default"]});var y=this.demuxer,E=this.remuxer,T=r.remux,S=r.demux;E&&E instanceof T||(this.remuxer=new T(n,i,s,a)),y&&y instanceof S||(this.demuxer=new S(n,i,s),this.probe=S.probe),this.resetInitSegment(d,o,f,c),this.resetInitialTimestamp(u)},e.needsProbing=function(t,e,r){return!this.demuxer||!this.remuxer||e||r},e.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new a["default"](this.observer,this.config)),t},t}();function E(t,e){var r=null;return t.byteLength>0&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(r=e),r}var T=function(t){return{remuxResult:{},chunkMeta:t}};function S(t){return"then"in t&&t.then instanceof Function}var b=function(t,e,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n},L=function(t,e,r,i,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n}},"./src/demux/tsdemuxer.ts":
/*!********************************!*\
  !*** ./src/demux/tsdemuxer.ts ***!
  \********************************/
/*! exports provided: discardEPB, default */function(t,e,r){"use strict";r.r(e),r.d(e,"discardEPB",(function(){return T}));var i=r(/*! ./adts */"./src/demux/adts.ts"),n=r(/*! ./mpegaudio */"./src/demux/mpegaudio.ts"),s=r(/*! ./exp-golomb */"./src/demux/exp-golomb.ts"),a=r(/*! ./id3 */"./src/demux/id3.ts"),o=r(/*! ./sample-aes */"./src/demux/sample-aes.ts"),l=r(/*! ../events */"./src/events.ts"),u=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),c=r(/*! ../utils/logger */"./src/utils/logger.ts"),d=r(/*! ../errors */"./src/errors.ts"),h={video:1,audio:2,id3:3,text:4},f=function(){function t(t,e,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=r}t.probe=function(e){var r=t.syncOffset(e);return!(r<0)&&(r&&c["logger"].warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),!0)},t.syncOffset=function(t){var e=Math.min(1e3,t.length-564),r=0;while(r<e){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:h[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var e=t.prototype;return e.resetInitSegment=function(e,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",i),this._audioTrack=t.createTrack("audio",i),this._id3Track=t.createTrack("id3",i),this._txtTrack=t.createTrack("text",i),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=r,this._duration=i},e.resetTimeStamp=function(){},e.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,r=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},e.demux=function(e,r,i,n){var s;void 0===i&&(i=!1),void 0===n&&(n=!1),i||(this.sampleAes=null);var a=this._avcTrack,o=this._audioTrack,h=this._id3Track,f=a.pid,g=a.pesData,y=o.pid,E=h.pid,T=o.pesData,S=h.pesData,b=!1,L=this.pmtParsed,A=this._pmtId,D=e.length;if(this.remainderData&&(e=Object(u["appendUint8Array"])(this.remainderData,e),D=e.length,this.remainderData=null),D<188&&!n)return this.remainderData=e,{audioTrack:o,avcTrack:a,id3Track:h,textTrack:this._txtTrack};var k=Math.max(0,t.syncOffset(e));D-=(D+k)%188,D<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,D,e.buffer.byteLength-D));for(var R=k;R<D;R+=188)if(71===e[R]){var I=!!(64&e[R+1]),_=((31&e[R+1])<<8)+e[R+2],C=(48&e[R+3])>>4,O=void 0;if(C>1){if(O=R+5+e[R+4],O===R+188)continue}else O=R+4;switch(_){case f:I&&(g&&(s=m(g))&&this.parseAVCPES(s,!1),g={data:[],size:0}),g&&(g.data.push(e.subarray(O,R+188)),g.size+=R+188-O);break;case y:I&&(T&&(s=m(T))&&(o.isAAC?this.parseAACPES(s):this.parseMPEGPES(s)),T={data:[],size:0}),T&&(T.data.push(e.subarray(O,R+188)),T.size+=R+188-O);break;case E:I&&(S&&(s=m(S))&&this.parseID3PES(s),S={data:[],size:0}),S&&(S.data.push(e.subarray(O,R+188)),S.size+=R+188-O);break;case 0:I&&(O+=e[O]+1),A=this._pmtId=v(e,O);break;case A:I&&(O+=e[O]+1);var w=p(e,O,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,i);f=w.avc,f>0&&(a.pid=f),y=w.audio,y>0&&(o.pid=y,o.isAAC=w.isAAC),E=w.id3,E>0&&(h.pid=E),b&&!L&&(c["logger"].log("reparse from beginning"),b=!1,R=k-188),L=this.pmtParsed=!0;break;case 17:case 8191:break;default:b=!0;break}}else this.observer.emit(l["Events"].ERROR,l["Events"].ERROR,{type:d["ErrorTypes"].MEDIA_ERROR,details:d["ErrorDetails"].FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});a.pesData=g,o.pesData=T,h.pesData=S;var x={audioTrack:o,avcTrack:a,id3Track:h,textTrack:this._txtTrack};return n&&this.extractRemainingSamples(x),x},e.flush=function(){var t,e=this.remainderData;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},e.extractRemainingSamples=function(t){var e,r=t.audioTrack,i=t.avcTrack,n=t.id3Track,s=i.pesData,a=r.pesData,o=n.pesData;s&&(e=m(s))?(this.parseAVCPES(e,!0),i.pesData=null):i.pesData=s,a&&(e=m(a))?(r.isAAC?this.parseAACPES(e):this.parseMPEGPES(e),r.pesData=null):(null!==a&&void 0!==a&&a.size&&c["logger"].log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=a),o&&(e=m(o))?(this.parseID3PES(e),n.pesData=null):n.pesData=o},e.demuxSampleAes=function(t,e,r){var i=this.demux(t,r,!0,!this.config.progressive),n=this.sampleAes=new o["default"](this.observer,this.config,e);return this.decrypt(i,n)},e.decrypt=function(t,e){return new Promise((function(r){var i=t.audioTrack,n=t.avcTrack;i.samples&&i.isAAC?e.decryptAacSamples(i.samples,0,(function(){n.samples?e.decryptAvcSamples(n.samples,0,0,(function(){r(t)})):r(t)})):n.samples&&e.decryptAvcSamples(n.samples,0,0,(function(){r(t)}))}))},e.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},e.parseAVCPES=function(t,e){var r,i=this,n=this._avcTrack,o=this.parseAVCNALu(t.data),l=!1,u=this.avcSample,c=!1;t.data=null,u&&o.length&&!n.audFound&&(y(u,n),u=this.avcSample=g(!1,t.pts,t.dts,"")),o.forEach((function(e){switch(e.type){case 1:r=!0,u||(u=i.avcSample=g(!0,t.pts,t.dts,"")),l&&(u.debug+="NDR "),u.frame=!0;var o=e.data;if(c&&o.length>4){var d=new s["default"](o).readSliceType();2!==d&&4!==d&&7!==d&&9!==d||(u.key=!0)}break;case 5:r=!0,u||(u=i.avcSample=g(!0,t.pts,t.dts,"")),l&&(u.debug+="IDR "),u.key=!0,u.frame=!0;break;case 6:r=!0,l&&u&&(u.debug+="SEI ");var h=new s["default"](T(e.data));h.readUByte();var f=0,v=0,p=!1,m=0;while(!p&&h.bytesAvailable>1){f=0;do{m=h.readUByte(),f+=m}while(255===m);v=0;do{m=h.readUByte(),v+=m}while(255===m);if(4===f&&0!==h.bytesAvailable){p=!0;var S=h.readUByte();if(181===S){var b=h.readUShort();if(49===b){var L=h.readUInt();if(1195456820===L){var A=h.readUByte();if(3===A){for(var D=h.readUByte(),k=h.readUByte(),R=31&D,I=[D,k],_=0;_<R;_++)I.push(h.readUByte()),I.push(h.readUByte()),I.push(h.readUByte());E(i._txtTrack.samples,{type:3,pts:t.pts,bytes:I})}}}}}else if(5===f&&0!==h.bytesAvailable){if(p=!0,v>16){for(var C=[],O=0;O<16;O++)C.push(h.readUByte().toString(16)),3!==O&&5!==O&&7!==O&&9!==O||C.push("-");for(var w=v-16,x=new Uint8Array(w),P=0;P<w;P++)x[P]=h.readUByte();E(i._txtTrack.samples,{pts:t.pts,payloadType:f,uuid:C.join(""),userData:Object(a["utf8ArrayToStr"])(x),userDataBytes:x})}}else if(v<h.bytesAvailable)for(var F=0;F<v;F++)h.readUByte()}break;case 7:if(r=!0,c=!0,l&&u&&(u.debug+="SPS "),!n.sps){var M=new s["default"](e.data),N=M.readSPS();n.width=N.width,n.height=N.height,n.pixelRatio=N.pixelRatio,n.sps=[e.data],n.duration=i._duration;for(var B=e.data.subarray(1,4),U="avc1.",G=0;G<3;G++){var j=B[G].toString(16);j.length<2&&(j="0"+j),U+=j}n.codec=U}break;case 8:r=!0,l&&u&&(u.debug+="PPS "),n.pps||(n.pps=[e.data]);break;case 9:r=!1,n.audFound=!0,u&&y(u,n),u=i.avcSample=g(!1,t.pts,t.dts,l?"AUD ":"");break;case 12:r=!1;break;default:r=!1,u&&(u.debug+="unknown NAL "+e.type+" ");break}if(u&&r){var K=u.units;K.push(e)}})),e&&u&&(y(u,n),this.avcSample=null)},e.getLastNalUnit=function(){var t,e,r=this.avcSample;if(!r||0===r.units.length){var i=this._avcTrack.samples;r=i[i.length-1]}if(null!==(t=r)&&void 0!==t&&t.units){var n=r.units;e=n[n.length-1]}return e},e.parseAVCNALu=function(t){var e,r,i,n=t.byteLength,s=this._avcTrack,a=s.naluState||0,o=a,l=[],u=0,c=-1,d=0;-1===a&&(c=0,d=31&t[0],a=0,u=1);while(u<n)if(e=t[u++],a)if(1!==a)if(e)if(1===e){if(c>=0){var h={data:t.subarray(c,u-a-1),type:d};l.push(h)}else{var f=this.getLastNalUnit();if(f&&(o&&u<=4-o&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-o)),r=u-a-1,r>0)){var g=new Uint8Array(f.data.byteLength+r);g.set(f.data,0),g.set(t.subarray(0,r),f.data.byteLength),f.data=g,f.state=0}}u<n?(i=31&t[u],c=u,d=i,a=0):a=-1}else a=0;else a=3;else a=e?0:2;else a=e?0:1;if(c>=0&&a>=0){var v={data:t.subarray(c,n),type:d,state:a};l.push(v)}if(0===l.length){var p=this.getLastNalUnit();if(p){var m=new Uint8Array(p.data.byteLength+t.byteLength);m.set(p.data,0),m.set(t,p.data.byteLength),p.data=m}}return s.naluState=a,l},e.parseAACPES=function(t){var e,r,n,s,a,o=0,u=this._audioTrack,h=this.aacOverFlow,f=t.data;if(h){this.aacOverFlow=null;var g=h.sample.unit.byteLength,v=Math.min(h.missing,g),p=g-v;h.sample.unit.set(f.subarray(0,v),p),u.samples.push(h.sample),o=h.missing}for(e=o,r=f.length;e<r-1;e++)if(i["isHeader"](f,e))break;if(e!==o&&(e<r-1?(n="AAC PES did not start with ADTS header,offset:"+e,s=!1):(n="no ADTS header found in AAC PES",s=!0),c["logger"].warn("parsing error:"+n),this.observer.emit(l["Events"].ERROR,l["Events"].ERROR,{type:d["ErrorTypes"].MEDIA_ERROR,details:d["ErrorDetails"].FRAG_PARSING_ERROR,fatal:s,reason:n}),s))return;if(i["initTrackConfig"](u,this.observer,f,e,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!h)return void c["logger"].warn("[tsdemuxer]: AAC PES unknown PTS");var m=i["getFrameDuration"](u.samplerate);a=h.sample.pts+m}var y=0;while(e<r){if(i["isHeader"](f,e)){if(e+5<r){var E=i["appendFrame"](u,f,e,a,y);if(E){if(!E.missing){e+=E.length,y++;continue}this.aacOverFlow=E}}break}e++}},e.parseMPEGPES=function(t){var e=t.data,r=e.length,i=0,s=0,a=t.pts;if(void 0!==a)while(s<r)if(n["isHeader"](e,s)){var o=n["appendFrame"](this._audioTrack,e,s,a,i);if(!o)break;s+=o.length,i++}else s++;else c["logger"].warn("[tsdemuxer]: MPEG PES unknown PTS")},e.parseID3PES=function(t){void 0!==t.pts?this._id3Track.samples.push(t):c["logger"].warn("[tsdemuxer]: ID3 PES unknown PTS")},t}();function g(t,e,r,i){return{key:t,frame:!1,pts:e,dts:r,units:[],debug:i,length:0}}function v(t,e){return(31&t[e+10])<<8|t[e+11]}function p(t,e,r,i){var n={audio:-1,avc:-1,id3:-1,isAAC:!0},s=(15&t[e+1])<<8|t[e+2],a=e+3+s-4,o=(15&t[e+10])<<8|t[e+11];e+=12+o;while(e<a){var l=(31&t[e+1])<<8|t[e+2];switch(t[e]){case 207:if(!i){c["logger"].log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=l);break;case 21:-1===n.id3&&(n.id3=l);break;case 219:if(!i){c["logger"].log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=l);break;case 3:case 4:r?-1===n.audio&&(n.audio=l,n.isAAC=!1):c["logger"].log("MPEG audio found, not supported in this browser");break;case 36:c["logger"].warn("Unsupported HEVC stream type found");break;default:break}e+=5+((15&t[e+3])<<8|t[e+4])}return n}function m(t){var e,r,i,n,s,a=0,o=t.data;if(!t||0===t.size)return null;while(o[0].length<19&&o.length>1){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}e=o[0];var u=(e[0]<<16)+(e[1]<<8)+e[2];if(1===u){if(r=(e[4]<<8)+e[5],r&&r>t.size-6)return null;var d=e[7];192&d&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&d?(s=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,n-s>54e5&&(c["logger"].warn(Math.round((n-s)/9e4)+"s delta between PTS and DTS, align them"),n=s)):s=n),i=e[8];var h=i+9;if(t.size<=h)return null;t.size-=h;for(var f=new Uint8Array(t.size),g=0,v=o.length;g<v;g++){e=o[g];var p=e.byteLength;if(h){if(h>p){h-=p;continue}e=e.subarray(h),p-=h,h=0}f.set(e,a),a+=p}return r&&(r-=i+3),{data:f,pts:n,dts:s,len:r}}return null}function y(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var r=e.samples,i=r.length;if(!i)return void e.dropped++;var n=r[i-1];t.pts=n.pts,t.dts=n.dts}e.samples.push(t)}t.debug.length&&c["logger"].log(t.pts+"/"+t.dts+":"+t.debug)}function E(t,e){var r=t.length;if(r>0){if(e.pts>=t[r-1].pts)t.push(e);else for(var i=r-1;i>=0;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)}function T(t){var e=t.byteLength,r=[],i=1;while(i<e-2)0===t[i]&&0===t[i+1]&&3===t[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return t;var n=e-r.length,s=new Uint8Array(n),a=0;for(i=0;i<n;a++,i++)a===r[0]&&(a++,r.shift()),s[i]=t[a];return s}f.minProbeByteLength=188,e["default"]=f},"./src/errors.ts":
/*!***********************!*\
  !*** ./src/errors.ts ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(t,e,r){"use strict";var i,n;r.r(e),r.d(e,"ErrorTypes",(function(){return i})),r.d(e,"ErrorDetails",(function(){return n})),function(t){t["NETWORK_ERROR"]="networkError",t["MEDIA_ERROR"]="mediaError",t["KEY_SYSTEM_ERROR"]="keySystemError",t["MUX_ERROR"]="muxError",t["OTHER_ERROR"]="otherError"}(i||(i={})),function(t){t["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys",t["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess",t["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession",t["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed",t["KEY_SYSTEM_NO_INIT_DATA"]="keySystemNoInitData",t["MANIFEST_LOAD_ERROR"]="manifestLoadError",t["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut",t["MANIFEST_PARSING_ERROR"]="manifestParsingError",t["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError",t["LEVEL_EMPTY_ERROR"]="levelEmptyError",t["LEVEL_LOAD_ERROR"]="levelLoadError",t["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut",t["LEVEL_SWITCH_ERROR"]="levelSwitchError",t["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError",t["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut",t["SUBTITLE_LOAD_ERROR"]="subtitleTrackLoadError",t["SUBTITLE_TRACK_LOAD_TIMEOUT"]="subtitleTrackLoadTimeOut",t["FRAG_LOAD_ERROR"]="fragLoadError",t["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut",t["FRAG_DECRYPT_ERROR"]="fragDecryptError",t["FRAG_PARSING_ERROR"]="fragParsingError",t["REMUX_ALLOC_ERROR"]="remuxAllocError",t["KEY_LOAD_ERROR"]="keyLoadError",t["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut",t["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError",t["BUFFER_INCOMPATIBLE_CODECS_ERROR"]="bufferIncompatibleCodecsError",t["BUFFER_APPEND_ERROR"]="bufferAppendError",t["BUFFER_APPENDING_ERROR"]="bufferAppendingError",t["BUFFER_STALLED_ERROR"]="bufferStalledError",t["BUFFER_FULL_ERROR"]="bufferFullError",t["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole",t["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall",t["INTERNAL_EXCEPTION"]="internalException",t["INTERNAL_ABORTED"]="aborted",t["UNKNOWN"]="unknown"}(n||(n={}))},"./src/events.ts":
/*!***********************!*\
  !*** ./src/events.ts ***!
  \***********************/
/*! exports provided: Events */function(t,e,r){"use strict";var i;r.r(e),r.d(e,"Events",(function(){return i})),function(t){t["MEDIA_ATTACHING"]="hlsMediaAttaching",t["MEDIA_ATTACHED"]="hlsMediaAttached",t["MEDIA_DETACHING"]="hlsMediaDetaching",t["MEDIA_DETACHED"]="hlsMediaDetached",t["BUFFER_RESET"]="hlsBufferReset",t["BUFFER_CODECS"]="hlsBufferCodecs",t["BUFFER_CREATED"]="hlsBufferCreated",t["BUFFER_APPENDING"]="hlsBufferAppending",t["BUFFER_APPENDED"]="hlsBufferAppended",t["BUFFER_EOS"]="hlsBufferEos",t["BUFFER_FLUSHING"]="hlsBufferFlushing",t["BUFFER_FLUSHED"]="hlsBufferFlushed",t["MANIFEST_LOADING"]="hlsManifestLoading",t["MANIFEST_LOADED"]="hlsManifestLoaded",t["MANIFEST_PARSED"]="hlsManifestParsed",t["LEVEL_SWITCHING"]="hlsLevelSwitching",t["LEVEL_SWITCHED"]="hlsLevelSwitched",t["LEVEL_LOADING"]="hlsLevelLoading",t["LEVEL_LOADED"]="hlsLevelLoaded",t["LEVEL_UPDATED"]="hlsLevelUpdated",t["LEVEL_PTS_UPDATED"]="hlsLevelPtsUpdated",t["LEVELS_UPDATED"]="hlsLevelsUpdated",t["AUDIO_TRACKS_UPDATED"]="hlsAudioTracksUpdated",t["AUDIO_TRACK_SWITCHING"]="hlsAudioTrackSwitching",t["AUDIO_TRACK_SWITCHED"]="hlsAudioTrackSwitched",t["AUDIO_TRACK_LOADING"]="hlsAudioTrackLoading",t["AUDIO_TRACK_LOADED"]="hlsAudioTrackLoaded",t["SUBTITLE_TRACKS_UPDATED"]="hlsSubtitleTracksUpdated",t["SUBTITLE_TRACKS_CLEARED"]="hlsSubtitleTracksCleared",t["SUBTITLE_TRACK_SWITCH"]="hlsSubtitleTrackSwitch",t["SUBTITLE_TRACK_LOADING"]="hlsSubtitleTrackLoading",t["SUBTITLE_TRACK_LOADED"]="hlsSubtitleTrackLoaded",t["SUBTITLE_FRAG_PROCESSED"]="hlsSubtitleFragProcessed",t["CUES_PARSED"]="hlsCuesParsed",t["NON_NATIVE_TEXT_TRACKS_FOUND"]="hlsNonNativeTextTracksFound",t["INIT_PTS_FOUND"]="hlsInitPtsFound",t["FRAG_LOADING"]="hlsFragLoading",t["FRAG_LOAD_EMERGENCY_ABORTED"]="hlsFragLoadEmergencyAborted",t["FRAG_LOADED"]="hlsFragLoaded",t["FRAG_DECRYPTED"]="hlsFragDecrypted",t["FRAG_PARSING_INIT_SEGMENT"]="hlsFragParsingInitSegment",t["FRAG_PARSING_USERDATA"]="hlsFragParsingUserdata",t["FRAG_PARSING_METADATA"]="hlsFragParsingMetadata",t["FRAG_PARSED"]="hlsFragParsed",t["FRAG_BUFFERED"]="hlsFragBuffered",t["FRAG_CHANGED"]="hlsFragChanged",t["FPS_DROP"]="hlsFpsDrop",t["FPS_DROP_LEVEL_CAPPING"]="hlsFpsDropLevelCapping",t["ERROR"]="hlsError",t["DESTROYING"]="hlsDestroying",t["KEY_LOADING"]="hlsKeyLoading",t["KEY_LOADED"]="hlsKeyLoaded",t["LIVE_BACK_BUFFER_REACHED"]="hlsLiveBackBufferReached",t["BACK_BUFFER_REACHED"]="hlsBackBufferReached"}(i||(i={}))},"./src/hls.ts":
/*!********************!*\
  !*** ./src/hls.ts ***!
  \********************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return E}));var i=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),n=r(/*! ./loader/playlist-loader */"./src/loader/playlist-loader.ts"),s=r(/*! ./loader/key-loader */"./src/loader/key-loader.ts"),a=r(/*! ./controller/id3-track-controller */"./src/controller/id3-track-controller.ts"),o=r(/*! ./controller/latency-controller */"./src/controller/latency-controller.ts"),l=r(/*! ./controller/level-controller */"./src/controller/level-controller.ts"),u=r(/*! ./controller/fragment-tracker */"./src/controller/fragment-tracker.ts"),c=r(/*! ./controller/stream-controller */"./src/controller/stream-controller.ts"),d=r(/*! ./is-supported */"./src/is-supported.ts"),h=r(/*! ./utils/logger */"./src/utils/logger.ts"),f=r(/*! ./config */"./src/config.ts"),g=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),v=r(/*! ./events */"./src/events.ts"),p=r(/*! ./errors */"./src/errors.ts");function m(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function y(t,e,r){return e&&m(t.prototype,e),r&&m(t,r),t}var E=function(){function t(e){void 0===e&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new g["EventEmitter"],this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=Object(f["mergeConfig"])(t.DefaultConfig,e);this.userConfig=e,Object(h["enableLogs"])(r.debug),this._autoLevelCapping=-1,r.progressive&&Object(f["enableStreamingMode"])(r);var i=r.abrController,d=r.bufferController,v=r.capLevelController,p=r.fpsController,m=this.abrController=new i(this),y=this.bufferController=new d(this),E=this.capLevelController=new v(this),T=new p(this),S=new n["default"](this),b=new s["default"](this),L=new a["default"](this),A=this.levelController=new l["default"](this),D=new u["FragmentTracker"](this),k=this.streamController=new c["default"](this,D);E.setStreamController(k),T.setStreamController(k);var R=[A,k];this.networkControllers=R;var I=[S,b,m,y,E,T,L,D];this.audioTrackController=this.createController(r.audioTrackController,null,R),this.createController(r.audioStreamController,D,R),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,R),this.createController(r.subtitleStreamController,D,R),this.createController(r.timelineController,null,I),this.emeController=this.createController(r.emeController,null,I),this.cmcdController=this.createController(r.cmcdController,null,I),this.latencyController=this.createController(o["default"],null,I),this.coreComponents=I}t.isSupported=function(){return Object(d["isSupported"])()};var e=t.prototype;return e.createController=function(t,e,r){if(t){var i=e?new t(this,e):new t(this);return r&&r.push(i),i}return null},e.on=function(t,e,r){void 0===r&&(r=this),this._emitter.on(t,e,r)},e.once=function(t,e,r){void 0===r&&(r=this),this._emitter.once(t,e,r)},e.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},e.off=function(t,e,r,i){void 0===r&&(r=this),this._emitter.off(t,e,r,i)},e.listeners=function(t){return this._emitter.listeners(t)},e.emit=function(t,e,r){return this._emitter.emit(t,e,r)},e.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(r){h["logger"].error("An internal error happened while handling event "+t+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(v["Events"].ERROR,{type:p["ErrorTypes"].OTHER_ERROR,details:p["ErrorDetails"].INTERNAL_EXCEPTION,fatal:!1,event:t,error:r})}return!1},e.listenerCount=function(t){return this._emitter.listenerCount(t)},e.destroy=function(){h["logger"].log("destroy"),this.trigger(v["Events"].DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0},e.attachMedia=function(t){h["logger"].log("attachMedia"),this._media=t,this.trigger(v["Events"].MEDIA_ATTACHING,{media:t})},e.detachMedia=function(){h["logger"].log("detachMedia"),this.trigger(v["Events"].MEDIA_DETACHING,void 0),this._media=null},e.loadSource=function(t){this.stopLoad();var e=this.media,r=this.url,n=this.url=i["buildAbsoluteURL"](self.location.href,t,{alwaysNormalize:!0});h["logger"].log("loadSource:"+n),e&&r&&r!==n&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(v["Events"].MANIFEST_LOADING,{url:t})},e.startLoad=function(t){void 0===t&&(t=-1),h["logger"].log("startLoad("+t+")"),this.networkControllers.forEach((function(e){e.startLoad(t)}))},e.stopLoad=function(){h["logger"].log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},e.swapAudioCodec=function(){h["logger"].log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.recoverMediaError=function(){h["logger"].log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},e.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},y(t,[{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){h["logger"].log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){h["logger"].log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){h["logger"].log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){h["logger"].log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){h["logger"].log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(h["logger"].log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,i=0;i<r;i++)if(t[i].maxBitrate>e)return i;return 0}},{key:"maxAutoLevel",get:function(){var t,e=this.levels,r=this.autoLevelCapping;return t=-1===r&&e&&e.length?e.length-1:r,t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.2"}},{key:"Events",get:function(){return v["Events"]}},{key:"ErrorTypes",get:function(){return p["ErrorTypes"]}},{key:"ErrorDetails",get:function(){return p["ErrorDetails"]}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:f["hlsDefaultConfig"]},set:function(e){t.defaultConfig=e}}]),t}();E.defaultConfig=void 0},"./src/is-supported.ts":
/*!*****************************!*\
  !*** ./src/is-supported.ts ***!
  \*****************************/
/*! exports provided: isSupported, changeTypeSupported */function(t,e,r){"use strict";r.r(e),r.d(e,"isSupported",(function(){return s})),r.d(e,"changeTypeSupported",(function(){return a}));var i=r(/*! ./utils/mediasource-helper */"./src/utils/mediasource-helper.ts");function n(){return self.SourceBuffer||self.WebKitSourceBuffer}function s(){var t=Object(i["getMediaSource"])();if(!t)return!1;var e=n(),r=t&&"function"===typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"===typeof e.prototype.appendBuffer&&"function"===typeof e.prototype.remove;return!!r&&!!s}function a(){var t,e=n();return"function"===typeof(null===e||void 0===e||null===(t=e.prototype)||void 0===t?void 0:t.changeType)}},"./src/loader/fragment-loader.ts":
/*!***************************************!*\
  !*** ./src/loader/fragment-loader.ts ***!
  \***************************************/
/*! exports provided: default, LoadError */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return f})),r.d(e,"LoadError",(function(){return v}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../errors */"./src/errors.ts");function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}function a(t){var e="function"===typeof Map?new Map:void 0;return a=function(t){if(null===t||!u(t))return t;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return o(t,arguments,d(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),c(r,t)},a(t)}function o(t,e,r){return o=l()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);var n=Function.bind.apply(t,i),s=new n;return r&&c(s,r.prototype),s},o.apply(null,arguments)}function l(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function u(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}var h=Math.pow(2,17),f=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,e){var r=this,i=t.url;if(!i)return Promise.reject(new v({type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var s=this.config,a=s.fLoader,o=s.loader;return new Promise((function(i,l){r.loader&&r.loader.destroy();var u=r.loader=t.loader=a?new a(s):new o(s),c=g(t),d={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:h};t.stats=u.stats,u.load(c,d,{onSuccess:function(e,n,s,a){r.resetLoader(t,u),i({frag:t,part:null,payload:e.data,networkDetails:a})},onError:function(e,i,s){r.resetLoader(t,u),l(new v({type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].FRAG_LOAD_ERROR,fatal:!1,frag:t,response:e,networkDetails:s}))},onAbort:function(e,i,s){r.resetLoader(t,u),l(new v({type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:s}))},onTimeout:function(e,i,s){r.resetLoader(t,u),l(new v({type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:s}))},onProgress:function(r,i,n,s){e&&e({frag:t,part:null,payload:n,networkDetails:s})}})}))},e.loadPart=function(t,e,r){var i=this;this.abort();var s=this.config,a=s.fLoader,o=s.loader;return new Promise((function(l,u){i.loader&&i.loader.destroy();var c=i.loader=t.loader=a?new a(s):new o(s),d=g(t,e),f={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:h};e.stats=c.stats,c.load(d,f,{onSuccess:function(n,s,a,o){i.resetLoader(t,c),i.updateStatsFromPart(t,e);var u={frag:t,part:e,payload:n.data,networkDetails:o};r(u),l(u)},onError:function(r,s,a){i.resetLoader(t,c),u(new v({type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:r,networkDetails:a}))},onAbort:function(r,s,a){t.stats.aborted=e.stats.aborted,i.resetLoader(t,c),u(new v({type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].INTERNAL_ABORTED,fatal:!1,frag:t,part:e,networkDetails:a}))},onTimeout:function(r,s,a){i.resetLoader(t,c),u(new v({type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,networkDetails:a}))}})}))},e.updateStatsFromPart=function(t,e){var r=t.stats,i=e.stats,n=i.total;if(r.loaded+=i.loaded,n){var s=Math.round(t.duration/e.duration),a=Math.min(Math.round(r.loaded/n),s),o=s-a,l=o*Math.round(r.loaded/a);r.total=r.loaded+l}else r.total=Math.max(r.loaded,r.total);var u=r.loading,c=i.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end},e.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},t}();function g(t,e){void 0===e&&(e=null);var r=e||t,n={frag:t,part:e,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},s=r.byteRangeStartOffset,a=r.byteRangeEndOffset;return Object(i["isFiniteNumber"])(s)&&Object(i["isFiniteNumber"])(a)&&(n.rangeStart=s,n.rangeEnd=a),n}var v=function(t){function e(e){for(var r,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];return r=t.call.apply(t,[this].concat(n))||this,r.data=void 0,r.data=e,r}return s(e,t),e}(a(Error))},"./src/loader/fragment.ts":
/*!********************************!*\
  !*** ./src/loader/fragment.ts ***!
  \********************************/
/*! exports provided: ElementaryStreamTypes, BaseSegment, Fragment, Part */function(t,e,r){"use strict";r.r(e),r.d(e,"ElementaryStreamTypes",(function(){return i})),r.d(e,"BaseSegment",(function(){return f})),r.d(e,"Fragment",(function(){return g})),r.d(e,"Part",(function(){return v}));var i,n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),s=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ./level-key */"./src/loader/level-key.ts"),l=r(/*! ./load-stats */"./src/loader/load-stats.ts");function u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function d(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),t}(function(t){t["AUDIO"]="audio",t["VIDEO"]="video",t["AUDIOVIDEO"]="audiovideo"})(i||(i={}));var f=function(){function t(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(e={},e[i.AUDIO]=null,e[i.VIDEO]=null,e[i.AUDIOVIDEO]=null,e),this.baseurl=t}var e=t.prototype;return e.setByteRange=function(t,e){var r=t.split("@",2),i=[];1===r.length?i[0]=e?e.byteRangeEndOffset:0:i[0]=parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i},h(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(s["buildAbsoluteURL"])(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),g=function(t){function e(e,r){var i;return i=t.call(this,r)||this,i._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkey=void 0,i.type=void 0,i.loader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.appendedPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new l["LoadStats"],i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.type=e,i}u(e,t);var r=e.prototype;return r.createInitializationVector=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e},r.setDecryptDataFromLevelKey=function(t,e){var r=t;return"AES-128"===(null===t||void 0===t?void 0:t.method)&&t.uri&&!t.iv&&(r=o["LevelKey"].fromURI(t.uri),r.method=t.method,r.iv=this.createInitializationVector(e),r.keyFormat="identity"),r},r.setElementaryStreamInfo=function(t,e,r,i,n,s){void 0===s&&(s=!1);var a=this.elementaryStreams,o=a[t];o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):a[t]={startPTS:e,endPTS:r,startDTS:i,endDTS:n,partial:s}},r.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[i.AUDIO]=null,t[i.VIDEO]=null,t[i.AUDIOVIDEO]=null},h(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!==typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&a["logger"].warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(n["isFiniteNumber"])(this.programDateTime))return null;var t=Object(n["isFiniteNumber"])(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;return!(null===(t=this.decryptdata)||void 0===t||!t.keyFormat||!this.decryptdata.uri)}}]),e}(f),v=function(t){function e(e,r,i,n,s){var a;a=t.call(this,i)||this,a.fragOffset=0,a.duration=0,a.gap=!1,a.independent=!1,a.relurl=void 0,a.fragment=void 0,a.index=void 0,a.stats=new l["LoadStats"],a.duration=e.decimalFloatingPoint("DURATION"),a.gap=e.bool("GAP"),a.independent=e.bool("INDEPENDENT"),a.relurl=e.enumeratedString("URI"),a.fragment=r,a.index=n;var o=e.enumeratedString("BYTERANGE");return o&&a.setByteRange(o,s),s&&(a.fragOffset=s.fragOffset+s.duration),a}return u(e,t),h(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(f)},"./src/loader/key-loader.ts":
/*!**********************************!*\
  !*** ./src/loader/key-loader.ts ***!
  \**********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return a}));var i=r(/*! ../events */"./src/events.ts"),n=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=function(){function t(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){this.hls.on(i["Events"].KEY_LOADING,this.onKeyLoading,this)},e._unregisterListeners=function(){this.hls.off(i["Events"].KEY_LOADING,this.onKeyLoading)},e.destroy=function(){for(var t in this._unregisterListeners(),this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={}},e.onKeyLoading=function(t,e){var r=e.frag,n=r.type,a=this.loaders[n];if(r.decryptdata){var o=r.decryptdata.uri;if(o!==this.decrypturl||null===this.decryptkey){var l=this.hls.config;if(a&&(s["logger"].warn("abort previous key loader for type:"+n),a.abort()),!o)return void s["logger"].warn("key uri is falsy");var u=l.loader,c=r.loader=this.loaders[n]=new u(l);this.decrypturl=o,this.decryptkey=null;var d={url:o,frag:r,responseType:"arraybuffer"},h={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(d,h,f)}else this.decryptkey&&(r.decryptdata.key=this.decryptkey,this.hls.trigger(i["Events"].KEY_LOADED,{frag:r}))}else s["logger"].warn("Missing decryption data on fragment in onKeyLoading")},e.loadsuccess=function(t,e,r){var n=r.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(t.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(i["Events"].KEY_LOADED,{frag:n})):s["logger"].error("after key load, decryptdata unset")},e.loaderror=function(t,e){var r=e.frag,s=r.loader;s&&s.abort(),delete this.loaders[r.type],this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].KEY_LOAD_ERROR,fatal:!1,frag:r,response:t})},e.loadtimeout=function(t,e){var r=e.frag,s=r.loader;s&&s.abort(),delete this.loaders[r.type],this.hls.trigger(i["Events"].ERROR,{type:n["ErrorTypes"].NETWORK_ERROR,details:n["ErrorDetails"].KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},t}()},"./src/loader/level-details.ts":
/*!*************************************!*\
  !*** ./src/loader/level-details.ts ***!
  \*************************************/
/*! exports provided: LevelDetails */function(t,e,r){"use strict";r.r(e),r.d(e,"LevelDetails",(function(){return o}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts");function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var a=10,o=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=t}var e=t.prototype;return e.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,r=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!r||!!e,this.advanced=this.endSN>t.endSN||e>0||0===e&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},s(t,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(i["isFiniteNumber"])(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||a}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;if(t>0){var e=this.driftEnd-this.driftStart;return 1e3*e/t}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),t}()},"./src/loader/level-key.ts":
/*!*********************************!*\
  !*** ./src/loader/level-key.ts ***!
  \*********************************/
/*! exports provided: LevelKey */function(t,e,r){"use strict";r.r(e),r.d(e,"LevelKey",(function(){return a}));var i=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var a=function(){function t(t,e){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=e?Object(i["buildAbsoluteURL"])(t,e,{alwaysNormalize:!0}):t}return t.fromURL=function(e,r){return new t(e,r)},t.fromURI=function(e){return new t(e)},s(t,[{key:"uri",get:function(){return this._uri}}]),t}()},"./src/loader/load-stats.ts":
/*!**********************************!*\
  !*** ./src/loader/load-stats.ts ***!
  \**********************************/
/*! exports provided: LoadStats */function(t,e,r){"use strict";r.r(e),r.d(e,"LoadStats",(function(){return i}));var i=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":
/*!***********************************!*\
  !*** ./src/loader/m3u8-parser.ts ***!
  \***********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return m}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),s=r(/*! ./fragment */"./src/loader/fragment.ts"),a=r(/*! ./level-details */"./src/loader/level-details.ts"),o=r(/*! ./level-key */"./src/loader/level-key.ts"),l=r(/*! ../utils/attr-list */"./src/utils/attr-list.ts"),u=r(/*! ../utils/logger */"./src/utils/logger.ts"),c=r(/*! ../utils/codecs */"./src/utils/codecs.ts"),d=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,h=/#EXT-X-MEDIA:(.*)/g,f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),g=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),v=/\.(mp4|m4s|m4v|m4a)$/i;function p(t){var e,r;return v.test(null!=(e=null===(r=n["parseURL"](t))||void 0===r?void 0:r.path)?e:"")}var m=function(){function t(){}return t.findGroup=function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(i.id===e)return i}},t.convertAVC1ToAVCOTI=function(t){var e=t.split(".");if(e.length>2){var r=e.shift()+".";return r+=parseInt(e.shift()).toString(16),r+=("000"+parseInt(e.shift()).toString(16)).substr(-4),r}return t},t.resolve=function(t,e){return n["buildAbsoluteURL"](e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,r){var i,n=[],s={},a=!1;d.lastIndex=0;while(null!=(i=d.exec(e)))if(i[1]){var o=new l["AttrList"](i[1]),u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:t.resolve(i[2],r)},c=o.decimalResolution("RESOLUTION");c&&(u.width=c.width,u.height=c.height),y((o.CODECS||"").split(/[ ,]+/).filter((function(t){return t})),u),u.videoCodec&&-1!==u.videoCodec.indexOf("avc1")&&(u.videoCodec=t.convertAVC1ToAVCOTI(u.videoCodec)),n.push(u)}else if(i[3]){var h=new l["AttrList"](i[3]);h["DATA-ID"]&&(a=!0,s[h["DATA-ID"]]=h)}return{levels:n,sessionData:a?s:null}},t.parseMasterPlaylistMedia=function(e,r,i,n){var s;void 0===n&&(n=[]);var a=[],o=0;h.lastIndex=0;while(null!==(s=h.exec(e))){var u=new l["AttrList"](s[1]);if(u.TYPE===i){var c={attrs:u,bitrate:0,id:o++,groupId:u["GROUP-ID"],instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:i,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?t.resolve(u.URI,r):""};if(n.length){var d=t.findGroup(n,c.groupId)||n[0];E(c,d,"audioCodec"),E(c,d,"textCodec")}a.push(c)}}return a},t.parseLevelPlaylist=function(t,e,r,n,c){var d,h,v,m=new a["LevelDetails"](e),y=m.fragments,E=null,b=0,L=0,A=0,D=0,k=null,R=new s["Fragment"](n,e),I=-1,_=!1;f.lastIndex=0,m.m3u8=t;while(null!==(d=f.exec(t))){_&&(_=!1,R=new s["Fragment"](n,e),R.start=A,R.sn=b,R.cc=D,R.level=r,E&&(R.initSegment=E,R.rawProgramDateTime=E.rawProgramDateTime));var C=d[1];if(C){R.duration=parseFloat(C);var O=(" "+d[2]).slice(1);R.title=O||null,R.tagList.push(O?["INF",C,O]:["INF",C])}else if(d[3])Object(i["isFiniteNumber"])(R.duration)&&(R.start=A,v&&(R.levelkey=v),R.sn=b,R.level=r,R.cc=D,R.urlId=c,y.push(R),R.relurl=(" "+d[3]).slice(1),S(R,k),k=R,A+=R.duration,b++,L=0,_=!0);else if(d[4]){var w=(" "+d[4]).slice(1);k?R.setByteRange(w,k):R.setByteRange(w)}else if(d[5])R.rawProgramDateTime=(" "+d[5]).slice(1),R.tagList.push(["PROGRAM-DATE-TIME",R.rawProgramDateTime]),-1===I&&(I=y.length);else{if(d=d[0].match(g),!d){u["logger"].warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<d.length;h++)if("undefined"!==typeof d[h])break;var x=(" "+d[h]).slice(1),P=(" "+d[h+1]).slice(1),F=d[h+2]?(" "+d[h+2]).slice(1):"";switch(x){case"PLAYLIST-TYPE":m.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":b=m.startSN=parseInt(P);break;case"SKIP":var M=new l["AttrList"](P),N=M.decimalInteger("SKIPPED-SEGMENTS");if(Object(i["isFiniteNumber"])(N)){m.skippedSegments=N;for(var B=N;B--;)y.unshift(null);b+=N}var U=M.enumeratedString("RECENTLY-REMOVED-DATERANGES");U&&(m.recentlyRemovedDateranges=U.split("\t"));break;case"TARGETDURATION":m.targetduration=parseFloat(P);break;case"VERSION":m.version=parseInt(P);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"#":(P||F)&&R.tagList.push(F?[P,F]:[P]);break;case"DIS":D++;case"GAP":R.tagList.push([x]);break;case"BITRATE":R.tagList.push([x,P]);break;case"DISCONTINUITY-SEQ":D=parseInt(P);break;case"KEY":var G,j=new l["AttrList"](P),K=j.enumeratedString("METHOD"),H=j.URI,V=j.hexadecimalInteger("IV"),W=j.enumeratedString("KEYFORMATVERSIONS"),Y=j.enumeratedString("KEYID"),q=null!=(G=j.enumeratedString("KEYFORMAT"))?G:"identity",X=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(X.indexOf(q)>-1){u["logger"].warn("Keyformat "+q+" is not supported from the manifest");continue}if("identity"!==q)continue;K&&(v=o["LevelKey"].fromURL(e,H),H&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(K)>=0&&(v.method=K,v.keyFormat=q,Y&&(v.keyID=Y),W&&(v.keyFormatVersions=W),v.iv=V));break;case"START":var z=new l["AttrList"](P),Q=z.decimalFloatingPoint("TIME-OFFSET");Object(i["isFiniteNumber"])(Q)&&(m.startTimeOffset=Q);break;case"MAP":var $=new l["AttrList"](P);R.relurl=$.URI,$.BYTERANGE&&R.setByteRange($.BYTERANGE),R.level=r,R.sn="initSegment",v&&(R.levelkey=v),R.initSegment=null,E=R,_=!0;break;case"SERVER-CONTROL":var J=new l["AttrList"](P);m.canBlockReload=J.bool("CAN-BLOCK-RELOAD"),m.canSkipUntil=J.optionalFloat("CAN-SKIP-UNTIL",0),m.canSkipDateRanges=m.canSkipUntil>0&&J.bool("CAN-SKIP-DATERANGES"),m.partHoldBack=J.optionalFloat("PART-HOLD-BACK",0),m.holdBack=J.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Z=new l["AttrList"](P);m.partTarget=Z.decimalFloatingPoint("PART-TARGET");break;case"PART":var tt=m.partList;tt||(tt=m.partList=[]);var et=L>0?tt[tt.length-1]:void 0,rt=L++,it=new s["Part"](new l["AttrList"](P),R,e,rt,et);tt.push(it),R.duration+=it.duration;break;case"PRELOAD-HINT":var nt=new l["AttrList"](P);m.preloadHint=nt;break;case"RENDITION-REPORT":var st=new l["AttrList"](P);m.renditionReports=m.renditionReports||[],m.renditionReports.push(st);break;default:u["logger"].warn("line parsed but not handled: "+d);break}}}k&&!k.relurl?(y.pop(),A-=k.duration,m.partList&&(m.fragmentHint=k)):m.partList&&(S(R,k),R.cc=D,m.fragmentHint=R);var at=y.length,ot=y[0],lt=y[at-1];if(A+=m.skippedSegments*m.targetduration,A>0&&at&&lt){m.averagetargetduration=A/at;var ut=lt.sn;m.endSN="initSegment"!==ut?ut:0,ot&&(m.startCC=ot.cc,ot.initSegment||m.fragments.every((function(t){return t.relurl&&p(t.relurl)}))&&(u["logger"].warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),R=new s["Fragment"](n,e),R.relurl=lt.relurl,R.level=r,R.sn="initSegment",ot.initSegment=R,m.needSidxRanges=!0))}else m.endSN=0,m.startCC=0;return m.fragmentHint&&(A+=m.fragmentHint.duration),m.totalduration=A,m.endCC=D,I>0&&T(y,I),m},t}();function y(t,e){["video","audio","text"].forEach((function(r){var i=t.filter((function(t){return Object(c["isCodecType"])(t,r)}));if(i.length){var n=i.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));e[r+"Codec"]=n.length>0?n[0]:i[0],t=t.filter((function(t){return-1===i.indexOf(t)}))}})),e.unknownCodecs=t}function E(t,e,r){var i=e[r];i&&(t[r]=i)}function T(t,e){for(var r=t[e],i=e;i--;){var n=t[i];if(!n)return;n.programDateTime=r.programDateTime-1e3*n.duration,r=n}}function S(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!==e&&void 0!==e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(i["isFiniteNumber"])(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":
/*!***************************************!*\
  !*** ./src/loader/playlist-loader.ts ***!
  \***************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../events */"./src/events.ts"),s=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),l=r(/*! ./m3u8-parser */"./src/loader/m3u8-parser.ts"),u=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../utils/attr-list */"./src/utils/attr-list.ts");function d(t){var e=t.type;switch(e){case u["PlaylistContextType"].AUDIO_TRACK:return u["PlaylistLevelType"].AUDIO;case u["PlaylistContextType"].SUBTITLE_TRACK:return u["PlaylistLevelType"].SUBTITLE;default:return u["PlaylistLevelType"].MAIN}}function h(t,e){var r=t.url;return void 0!==r&&0!==r.indexOf("data:")||(r=e.url),r}var f=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(n["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.on(n["Events"].LEVEL_LOADING,this.onLevelLoading,this),t.on(n["Events"].AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(n["Events"].SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.unregisterListeners=function(){var t=this.hls;t.off(n["Events"].MANIFEST_LOADING,this.onManifestLoading,this),t.off(n["Events"].LEVEL_LOADING,this.onLevelLoading,this),t.off(n["Events"].AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(n["Events"].SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.createInternalLoader=function(t){var e=this.hls.config,r=e.pLoader,i=e.loader,n=r||i,s=new n(e);return t.loader=s,this.loaders[t.type]=s,s},e.getInternalLoader=function(t){return this.loaders[t.type]},e.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},e.onManifestLoading=function(t,e){var r=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:u["PlaylistContextType"].MANIFEST,url:r,deliveryDirectives:null})},e.onLevelLoading=function(t,e){var r=e.id,i=e.level,n=e.url,s=e.deliveryDirectives;this.load({id:r,groupId:null,level:i,responseType:"text",type:u["PlaylistContextType"].LEVEL,url:n,deliveryDirectives:s})},e.onAudioTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,s=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:u["PlaylistContextType"].AUDIO_TRACK,url:n,deliveryDirectives:s})},e.onSubtitleTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,s=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:u["PlaylistContextType"].SUBTITLE_TRACK,url:n,deliveryDirectives:s})},e.load=function(t){var e,r,i,n,s,o,l=this.hls.config,c=this.getInternalLoader(t);if(c){var d=c.context;if(d&&d.url===t.url)return void a["logger"].trace("[playlist-loader]: playlist request ongoing");a["logger"].log("[playlist-loader]: aborting previous loader for type: "+t.type),c.abort()}switch(t.type){case u["PlaylistContextType"].MANIFEST:r=l.manifestLoadingMaxRetry,i=l.manifestLoadingTimeOut,n=l.manifestLoadingRetryDelay,s=l.manifestLoadingMaxRetryTimeout;break;case u["PlaylistContextType"].LEVEL:case u["PlaylistContextType"].AUDIO_TRACK:case u["PlaylistContextType"].SUBTITLE_TRACK:r=0,i=l.levelLoadingTimeOut;break;default:r=l.levelLoadingMaxRetry,i=l.levelLoadingTimeOut,n=l.levelLoadingRetryDelay,s=l.levelLoadingMaxRetryTimeout;break}if((c=this.createInternalLoader(t),null!==(e=t.deliveryDirectives)&&void 0!==e&&e.part)&&(t.type===u["PlaylistContextType"].LEVEL&&null!==t.level?o=this.hls.levels[t.level].details:t.type===u["PlaylistContextType"].AUDIO_TRACK&&null!==t.id?o=this.hls.audioTracks[t.id].details:t.type===u["PlaylistContextType"].SUBTITLE_TRACK&&null!==t.id&&(o=this.hls.subtitleTracks[t.id].details),o)){var h=o.partTarget,f=o.targetduration;h&&f&&(i=Math.min(1e3*Math.max(3*h,.8*f),i))}var g={timeout:i,maxRetry:r,retryDelay:n,maxRetryDelay:s,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(t,g,v)},e.loadsuccess=function(t,e,r,i){if(void 0===i&&(i=null),r.isSidxRequest)return this.handleSidxRequest(t,r),void this.handlePlaylistLoaded(t,e,r,i);this.resetInternalLoader(r.type);var n=t.data;0===n.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,e,r,i):this.handleMasterPlaylist(t,e,r,i)):this.handleManifestParsingError(t,r,"no EXTM3U delimiter",i)},e.loaderror=function(t,e,r){void 0===r&&(r=null),this.handleNetworkError(e,r,!1,t)},e.loadtimeout=function(t,e,r){void 0===r&&(r=null),this.handleNetworkError(e,r,!0)},e.handleMasterPlaylist=function(t,e,r,i){var s=this.hls,o=t.data,u=h(t,r),d=l["default"].parseMasterPlaylist(o,u),f=d.levels,g=d.sessionData;if(f.length){var v=f.map((function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}})),p=f.map((function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}})),m=l["default"].parseMasterPlaylistMedia(o,u,"AUDIO",v),y=l["default"].parseMasterPlaylistMedia(o,u,"SUBTITLES",p),E=l["default"].parseMasterPlaylistMedia(o,u,"CLOSED-CAPTIONS");if(m.length){var T=m.some((function(t){return!t.url}));T||!f[0].audioCodec||f[0].attrs.AUDIO||(a["logger"].log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new c["AttrList"]({}),bitrate:0,url:""}))}s.trigger(n["Events"].MANIFEST_LOADED,{levels:f,audioTracks:m,subtitles:y,captions:E,url:u,stats:e,networkDetails:i,sessionData:g})}else this.handleManifestParsingError(t,r,"no level found in manifest",i)},e.handleTrackOrLevelPlaylist=function(t,e,r,a){var o=this.hls,f=r.id,g=r.level,v=r.type,p=h(t,r),m=Object(i["isFiniteNumber"])(f)?f:0,y=Object(i["isFiniteNumber"])(g)?g:m,E=d(r),T=l["default"].parseLevelPlaylist(t.data,p,y,E,m);if(T.fragments.length){if(v===u["PlaylistContextType"].MANIFEST){var S={attrs:new c["AttrList"]({}),bitrate:0,details:T,name:"",url:p};o.trigger(n["Events"].MANIFEST_LOADED,{levels:[S],audioTracks:[],url:p,stats:e,networkDetails:a,sessionData:null})}if(e.parsing.end=performance.now(),T.needSidxRanges){var b,L=null===(b=T.fragments[0].initSegment)||void 0===b?void 0:b.url;this.load({url:L,isSidxRequest:!0,type:v,level:g,levelDetails:T,id:f,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else r.levelDetails=T,this.handlePlaylistLoaded(t,e,r,a)}else o.trigger(n["Events"].ERROR,{type:s["ErrorTypes"].NETWORK_ERROR,details:s["ErrorDetails"].LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:"number"===typeof r.level?r.level:void 0})},e.handleSidxRequest=function(t,e){var r=Object(o["parseSegmentIndex"])(new Uint8Array(t.data));if(r){var i=r.references,n=e.levelDetails;i.forEach((function(t,e){var i=t.info,s=n.fragments[e];0===s.byteRange.length&&s.setByteRange(String(1+i.end-i.start)+"@"+String(i.start)),s.initSegment&&s.initSegment.setByteRange(String(r.moovEndOffset)+"@0")}))}},e.handleManifestParsingError=function(t,e,r,i){this.hls.trigger(n["Events"].ERROR,{type:s["ErrorTypes"].NETWORK_ERROR,details:s["ErrorDetails"].MANIFEST_PARSING_ERROR,fatal:e.type===u["PlaylistContextType"].MANIFEST,url:t.url,reason:r,response:t,context:e,networkDetails:i})},e.handleNetworkError=function(t,e,r,i){void 0===r&&(r=!1),a["logger"].warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var o=s["ErrorDetails"].UNKNOWN,l=!1,c=this.getInternalLoader(t);switch(t.type){case u["PlaylistContextType"].MANIFEST:o=r?s["ErrorDetails"].MANIFEST_LOAD_TIMEOUT:s["ErrorDetails"].MANIFEST_LOAD_ERROR,l=!0;break;case u["PlaylistContextType"].LEVEL:o=r?s["ErrorDetails"].LEVEL_LOAD_TIMEOUT:s["ErrorDetails"].LEVEL_LOAD_ERROR,l=!1;break;case u["PlaylistContextType"].AUDIO_TRACK:o=r?s["ErrorDetails"].AUDIO_TRACK_LOAD_TIMEOUT:s["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR,l=!1;break;case u["PlaylistContextType"].SUBTITLE_TRACK:o=r?s["ErrorDetails"].SUBTITLE_TRACK_LOAD_TIMEOUT:s["ErrorDetails"].SUBTITLE_LOAD_ERROR,l=!1;break}c&&this.resetInternalLoader(t.type);var d={type:s["ErrorTypes"].NETWORK_ERROR,details:o,fatal:l,url:t.url,loader:c,context:t,networkDetails:e};i&&(d.response=i),this.hls.trigger(n["Events"].ERROR,d)},e.handlePlaylistLoaded=function(t,e,r,i){var s=r.type,a=r.level,o=r.id,l=r.groupId,c=r.loader,d=r.levelDetails,h=r.deliveryDirectives;if(null!==d&&void 0!==d&&d.targetduration){if(c)switch(d.live&&(c.getCacheAge&&(d.ageHeader=c.getCacheAge()||0),c.getCacheAge&&!isNaN(d.ageHeader)||(d.ageHeader=0)),s){case u["PlaylistContextType"].MANIFEST:case u["PlaylistContextType"].LEVEL:this.hls.trigger(n["Events"].LEVEL_LOADED,{details:d,level:a||0,id:o||0,stats:e,networkDetails:i,deliveryDirectives:h});break;case u["PlaylistContextType"].AUDIO_TRACK:this.hls.trigger(n["Events"].AUDIO_TRACK_LOADED,{details:d,id:o||0,groupId:l||"",stats:e,networkDetails:i,deliveryDirectives:h});break;case u["PlaylistContextType"].SUBTITLE_TRACK:this.hls.trigger(n["Events"].SUBTITLE_TRACK_LOADED,{details:d,id:o||0,groupId:l||"",stats:e,networkDetails:i,deliveryDirectives:h});break}}else this.handleManifestParsingError(t,r,"invalid target duration",i)},t}();e["default"]=f},"./src/polyfills/number.ts":
/*!*********************************!*\
  !*** ./src/polyfills/number.ts ***!
  \*********************************/
/*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */function(t,e,r){"use strict";r.r(e),r.d(e,"isFiniteNumber",(function(){return i})),r.d(e,"MAX_SAFE_INTEGER",(function(){return n}));var i=Number.isFinite||function(t){return"number"===typeof t&&isFinite(t)},n=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":
/*!*********************************!*\
  !*** ./src/remux/aac-helper.ts ***!
  \*********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=function(){function t(){}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},t}();e["default"]=i},"./src/remux/mp4-generator.ts":
/*!************************************!*\
  !*** ./src/remux/mp4-generator.ts ***!
  \************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=Math.pow(2,32)-1,n=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:r,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=s,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,a,l,a,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,n))},t.box=function(t){for(var e=8,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var s=i.length,a=s;while(s--)e+=i[s].byteLength;var o=new Uint8Array(e);for(o[0]=e>>24&255,o[1]=e>>16&255,o[2]=e>>8&255,o[3]=255&e,o.set(t,4),s=0,e=8;s<a;s++)o.set(i[s],e),e+=i[s].byteLength;return o},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,r){r*=e;var n=Math.floor(r/(i+1)),s=Math.floor(r%(i+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,r,i){return t.box(t.types.moof,t.mfhd(e),t.traf(i,r))},t.moov=function(e){var r=e.length,i=[];while(r--)i[r]=t.trak(e[r]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(t.mvex(e)))},t.mvex=function(e){var r=e.length,i=[];while(r--)i[r]=t.trex(e[r]);return t.box.apply(null,[t.types.mvex].concat(i))},t.mvhd=function(e,r){r*=e;var n=Math.floor(r/(i+1)),s=Math.floor(r%(i+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,a)},t.sdtp=function(e){var r,i,n=e.samples||[],s=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,s[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return t.box(t.types.sdtp,s)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var r,i,n,s=[],a=[];for(r=0;r<e.sps.length;r++)i=e.sps[r],n=i.byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(i));for(r=0;r<e.pps.length;r++)i=e.pps[r],n=i.byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(i));var o=t.box(t.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(a))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var r=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var r=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var r=e.id,n=e.duration*e.timescale,s=e.width,a=e.height,o=Math.floor(n/(i+1)),l=Math.floor(n%(i+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,a>>8&255,255&a,0,0]))},t.traf=function(e,r){var n=t.sdtp(e),s=e.id,a=Math.floor(r/(i+1)),o=Math.floor(r%(i+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(e,n.length+16+20+8+16+8+8),n)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var r=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,r){var i,n,s,a,o,l,u=e.samples||[],c=u.length,d=12+16*c,h=new Uint8Array(d);for(r+=8+d,h.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<c;i++)n=u[i],s=n.duration,a=n.size,o=n.flags,l=n.cts,h.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return t.box(t.types.trun,h)},t.initSegment=function(e){t.types||t.init();var r=t.moov(e),i=new Uint8Array(t.FTYP.byteLength+r.byteLength);return i.set(t.FTYP),i.set(r,t.FTYP.byteLength),i},t}();n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,e["default"]=n},"./src/remux/mp4-remuxer.ts":
/*!**********************************!*\
  !*** ./src/remux/mp4-remuxer.ts ***!
  \**********************************/
/*! exports provided: default, normalizePts */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return y})),r.d(e,"normalizePts",(function(){return E}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ./aac-helper */"./src/remux/aac-helper.ts"),s=r(/*! ./mp4-generator */"./src/remux/mp4-generator.ts"),a=r(/*! ../events */"./src/events.ts"),o=r(/*! ../errors */"./src/errors.ts"),l=r(/*! ../utils/logger */"./src/utils/logger.ts"),u=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../utils/timescale-conversion */"./src/utils/timescale-conversion.ts");function d(){return d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},d.apply(this,arguments)}var h=1e4,f=1024,g=1152,v=null,p=null,m=!1,y=function(){function t(t,e,r,i){if(void 0===i&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=r,this.ISGenerated=!1,null===v){var n=navigator.userAgent||"",s=n.match(/Chrome\/(\d+)/i);v=s?parseInt(s[1]):0}if(null===p){var a=navigator.userAgent.match(/Safari\/(\d+)/i);p=a?parseInt(a[1]):0}m=!!v&&v<75||!!p&&p<600}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){l["logger"].log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},e.resetNextTimestamp=function(){l["logger"].log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){l["logger"].log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},e.getVideoStartPts=function(t){var e=!1,r=t.reduce((function(t,r){var i=r.pts-t;return i<-4294967296?(e=!0,E(t,r.pts)):i>0?t:r.pts}),t[0].pts);return e&&l["logger"].debug("PTS rollover detected"),r},e.remux=function(t,e,r,i,n,s,a,o){var c,d,h,f,g,v,p=n,m=n,y=t.pid>-1,S=e.pid>-1,b=e.samples.length,L=t.samples.length>0,A=b>1,D=(!y||L)&&(!S||A)||this.ISGenerated||a;if(D){this.ISGenerated||(h=this.generateIS(t,e,n));var k=this.isVideoContiguous,R=-1;if(A&&(R=T(e.samples),!k&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,R>0){l["logger"].warn("[mp4-remuxer]: Dropped "+R+" out of "+b+" video samples due to a missing keyframe");var I=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(R),e.dropped+=R,m+=(e.samples[0].pts-I)/(e.timescale||9e4)}else-1===R&&(l["logger"].warn("[mp4-remuxer]: No keyframe found out of "+b+" video samples"),v=!1);if(this.ISGenerated){if(L&&A){var _=this.getVideoStartPts(e.samples),C=E(t.samples[0].pts,_)-_,O=C/e.inputTimeScale;p+=Math.max(0,O),m+=Math.max(0,-O)}if(L){if(t.samplerate||(l["logger"].warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(t,e,n)),d=this.remuxAudio(t,p,this.isAudioContiguous,s,S||A||o===u["PlaylistLevelType"].AUDIO?m:void 0),A){var w=d?d.endPTS-d.startPTS:0;e.inputTimeScale||(l["logger"].warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(t,e,n)),c=this.remuxVideo(e,m,k,w)}}else A&&(c=this.remuxVideo(e,m,k,0));c&&(c.firstKeyFrame=R,c.independent=-1!==R)}}return this.ISGenerated&&(r.samples.length&&(g=this.remuxID3(r,n)),i.samples.length&&(f=this.remuxText(i,n))),{audio:d,video:c,initSegment:h,independent:v,text:f,id3:g}},e.generateIS=function(t,e,r){var n,a,o,l=t.samples,u=e.samples,c=this.typeSupported,d={},h=!Object(i["isFiniteNumber"])(this._initPTS),f="audio/mp4";if(h&&(n=a=1/0),t.config&&l.length&&(t.timescale=t.samplerate,t.isAAC||(c.mpeg?(f="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3")),d.audio={id:"audio",container:f,codec:t.codec,initSegment:!t.isAAC&&c.mpeg?new Uint8Array(0):s["default"].initSegment([t]),metadata:{channelCount:t.channelCount}},h&&(o=t.inputTimeScale,n=a=l[0].pts-Math.round(o*r))),e.sps&&e.pps&&u.length&&(e.timescale=e.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:s["default"].initSegment([e]),metadata:{width:e.width,height:e.height}},h)){o=e.inputTimeScale;var g=this.getVideoStartPts(u),v=Math.round(o*r);a=Math.min(a,E(u[0].dts,g)-v),n=Math.min(n,g-v)}if(Object.keys(d).length)return this.ISGenerated=!0,h&&(this._initPTS=n,this._initDTS=a),{tracks:d,initPTS:n,timescale:o}},e.remuxVideo=function(t,e,r,i){var n,u,h,f=t.inputTimeScale,g=t.samples,p=[],y=g.length,T=this._initPTS,b=this.nextAvcDts,L=8,A=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY,k=0,R=!1;if(!r||null===b){var I=e*f,_=g[0].pts-E(g[0].dts,g[0].pts);b=I-_}for(var C=0;C<y;C++){var O=g[C];if(O.pts=E(O.pts-T,b),O.dts=E(O.dts-T,b),O.dts>O.pts){var w=18e3;k=Math.max(Math.min(k,O.pts-O.dts),-1*w)}O.dts<g[C>0?C-1:C].dts&&(R=!0)}R&&g.sort((function(t,e){var r=t.dts-e.dts,i=t.pts-e.pts;return r||i})),u=g[0].dts,h=g[g.length-1].dts;var x=Math.round((h-u)/(y-1));if(k<0){if(k<-2*x){l["logger"].warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(c["toMsFromMpegTsClock"])(-x,!0)+" ms");for(var P=k,F=0;F<y;F++)g[F].dts=P=Math.max(P,g[F].pts-x),g[F].pts=Math.max(P,g[F].pts)}else{l["logger"].warn("PTS < DTS detected in video samples, shifting DTS by "+Object(c["toMsFromMpegTsClock"])(k,!0)+" ms to overcome this issue");for(var M=0;M<y;M++)g[M].dts=g[M].dts+k}u=g[0].dts}if(r){var N=u-b,B=N>x,U=N<-1;if(B||U){B?l["logger"].warn("AVC: "+Object(c["toMsFromMpegTsClock"])(N,!0)+" ms ("+N+"dts) hole between fragments detected, filling it"):l["logger"].warn("AVC: "+Object(c["toMsFromMpegTsClock"])(-N,!0)+" ms ("+N+"dts) overlapping between fragments detected"),u=b;var G=g[0].pts-N;g[0].dts=u,g[0].pts=G,l["logger"].log("Video: First PTS/DTS adjusted: "+Object(c["toMsFromMpegTsClock"])(G,!0)+"/"+Object(c["toMsFromMpegTsClock"])(u,!0)+", delta: "+Object(c["toMsFromMpegTsClock"])(N,!0)+" ms")}}m&&(u=Math.max(0,u));for(var j=0,K=0,H=0;H<y;H++){for(var V=g[H],W=V.units,Y=W.length,q=0,X=0;X<Y;X++)q+=W[X].data.length;K+=q,j+=Y,V.length=q,V.dts=Math.max(V.dts,u),V.pts=Math.max(V.pts,V.dts,0),A=Math.min(V.pts,A),D=Math.max(V.pts,D)}h=g[y-1].dts;var z,Q=K+4*j+8;try{z=new Uint8Array(Q)}catch(pt){return void this.observer.emit(a["Events"].ERROR,a["Events"].ERROR,{type:o["ErrorTypes"].MUX_ERROR,details:o["ErrorDetails"].REMUX_ALLOC_ERROR,fatal:!1,bytes:Q,reason:"fail allocating video mdat "+Q})}var $=new DataView(z.buffer);$.setUint32(0,Q),z.set(s["default"].types.mdat,4);for(var J=0;J<y;J++){for(var Z=g[J],tt=Z.units,et=0,rt=0,it=tt.length;rt<it;rt++){var nt=tt[rt],st=nt.data,at=nt.data.byteLength;$.setUint32(L,at),L+=4,z.set(st,L),L+=at,et+=4+at}if(J<y-1)n=g[J+1].dts-Z.dts;else{var ot=this.config,lt=Z.dts-g[J>0?J-1:J].dts;if(ot.stretchShortVideoTrack&&null!==this.nextAudioPts){var ut=Math.floor(ot.maxBufferHole*f),ct=(i?A+i*f:this.nextAudioPts)-Z.pts;ct>ut?(n=ct-lt,n<0&&(n=lt),l["logger"].log("[mp4-remuxer]: It is approximately "+ct/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=lt}else n=lt}var dt=Math.round(Z.pts-Z.dts);p.push(new S(Z.key,n,et,dt))}if(p.length&&v&&v<70){var ht=p[0].flags;ht.dependsOn=2,ht.isNonSync=0}console.assert(void 0!==n,"mp4SampleDuration must be computed"),this.nextAvcDts=b=h+n,this.isVideoContiguous=!0;var ft=s["default"].moof(t.sequenceNumber++,u,d({},t,{samples:p})),gt="video",vt={data1:ft,data2:z,startPTS:A/f,endPTS:(D+n)/f,startDTS:u/f,endDTS:b/f,type:gt,hasAudio:!1,hasVideo:!0,nb:p.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(z.length,"MDAT length must not be zero"),vt},e.remuxAudio=function(t,e,r,i,u){var c=t.inputTimeScale,v=t.samplerate?t.samplerate:c,p=c/v,m=t.isAAC?f:g,y=m*p,T=this._initPTS,b=!t.isAAC&&this.typeSupported.mpeg,L=[],A=t.samples,D=b?0:8,k=this.nextAudioPts||-1,R=e*c;if(this.isAudioContiguous=r=r||A.length&&k>0&&(i&&Math.abs(R-k)<9e3||Math.abs(E(A[0].pts-T,R)-k)<20*y),A.forEach((function(t){t.pts=E(t.pts-T,R)})),!r||k<0){if(A=A.filter((function(t){return t.pts>=0})),!A.length)return;k=0===u?0:i?Math.max(0,R):A[0].pts}if(t.isAAC)for(var I=void 0!==u,_=this.config.maxAudioFramesDrift,C=0,O=k;C<A.length;C++){var w=A[C],x=w.pts,P=x-O,F=Math.abs(1e3*P/c);if(P<=-_*y&&I)0===C&&(l["logger"].warn("Audio frame @ "+(x/c).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*P/c)+" ms."),this.nextAudioPts=k=O=x);else if(P>=_*y&&F<h&&I){var M=Math.round(P/y);O=x-M*y,O<0&&(M--,O+=y),0===C&&(this.nextAudioPts=k=O),l["logger"].warn("[mp4-remuxer]: Injecting "+M+" audio frame @ "+(O/c).toFixed(3)+"s due to "+Math.round(1e3*P/c)+" ms gap.");for(var N=0;N<M;N++){var B=Math.max(O,0),U=n["default"].getSilentFrame(t.manifestCodec||t.codec,t.channelCount);U||(l["logger"].log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),U=w.unit.subarray()),A.splice(C,0,{unit:U,pts:B}),O+=y,C++}}w.pts=O,O+=y}var G,j=null,K=null,H=0,V=A.length;while(V--)H+=A[V].unit.byteLength;for(var W=0,Y=A.length;W<Y;W++){var q=A[W],X=q.unit,z=q.pts;if(null!==K){var Q=L[W-1];Q.duration=Math.round((z-K)/p)}else{if(r&&t.isAAC&&(z=k),j=z,!(H>0))return;H+=D;try{G=new Uint8Array(H)}catch(at){return void this.observer.emit(a["Events"].ERROR,a["Events"].ERROR,{type:o["ErrorTypes"].MUX_ERROR,details:o["ErrorDetails"].REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating audio mdat "+H})}if(!b){var $=new DataView(G.buffer);$.setUint32(0,H),G.set(s["default"].types.mdat,4)}}G.set(X,D);var J=X.byteLength;D+=J,L.push(new S(!0,m,J,0)),K=z}var Z=L.length;if(Z){var tt=L[L.length-1];this.nextAudioPts=k=K+p*tt.duration;var et=b?new Uint8Array(0):s["default"].moof(t.sequenceNumber++,j/p,d({},t,{samples:L}));t.samples=[];var rt=j/c,it=k/c,nt="audio",st={data1:et,data2:G,startPTS:rt,endPTS:it,startDTS:rt,endDTS:it,type:nt,hasAudio:!0,hasVideo:!1,nb:Z};return this.isAudioContiguous=!0,console.assert(G.length,"MDAT length must not be zero"),st}},e.remuxEmptyAudio=function(t,e,r,i){var s=t.inputTimeScale,a=t.samplerate?t.samplerate:s,o=s/a,u=this.nextAudioPts,c=(null!==u?u:i.startDTS*s)+this._initDTS,d=i.endDTS*s+this._initDTS,h=o*f,g=Math.ceil((d-c)/h),v=n["default"].getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(l["logger"].warn("[mp4-remuxer]: remux empty Audio"),v){for(var p=[],m=0;m<g;m++){var y=c+m*h;p.push({unit:v,pts:y,dts:y})}return t.samples=p,this.remuxAudio(t,e,r,!1)}l["logger"].trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e.remuxID3=function(t,e){var r=t.samples.length;if(r){for(var i=t.inputTimeScale,n=this._initPTS,s=this._initDTS,a=0;a<r;a++){var o=t.samples[a];o.pts=E(o.pts-n,e*i)/i,o.dts=E(o.dts-s,e*i)/i}var l=t.samples;return t.samples=[],{samples:l}}},e.remuxText=function(t,e){var r=t.samples.length;if(r){for(var i=t.inputTimeScale,n=this._initPTS,s=0;s<r;s++){var a=t.samples[s];a.pts=E(a.pts-n,e*i)/i}t.samples.sort((function(t,e){return t.pts-e.pts}));var o=t.samples;return t.samples=[],{samples:o}}},t}();function E(t,e){var r;if(null===e)return t;r=e<t?-8589934592:8589934592;while(Math.abs(t-e)>4294967296)t+=r;return t}function T(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}var S=function(t,e,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=r,this.cts=i,this.flags=new b(t)},b=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":
/*!******************************************!*\
  !*** ./src/remux/passthrough-remuxer.ts ***!
  \******************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),s=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this.initPTS=t,this.lastEndDTS=null},e.resetNextTimestamp=function(){this.lastEndDTS=null},e.resetInitSegment=function(t,e,r){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment(t),this.emitInitSegment=!0},e.generateInitSegment=function(t){var e=this.audioCodec,r=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Object(n["parseInitSegment"])(t);e||(e=u(i.audio,s["ElementaryStreamTypes"].AUDIO)),r||(r=u(i.video,s["ElementaryStreamTypes"].VIDEO));var o={};i.audio&&i.video?o.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:t,id:"main"}:i.audio?o.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:i.video?o.video={container:"video/mp4",codec:r,initSegment:t,id:"main"}:a["logger"].warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o},e.remux=function(t,e,r,s,o){var u=this.initPTS,c=this.lastEndDTS,d={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};Object(i["isFiniteNumber"])(c)||(c=this.lastEndDTS=o||0);var h=e.samples;if(!h||!h.length)return d;var f={initPTS:void 0,timescale:1},g=this.initData;if(g&&g.length||(this.generateInitSegment(h),g=this.initData),!g||!g.length)return a["logger"].warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1),Object(i["isFiniteNumber"])(u)||(this.initPTS=f.initPTS=u=l(g,h,c));var v=Object(n["getDuration"])(h,g),p=c,m=v+p;Object(n["offsetStartDTS"])(g,h,u),v>0?this.lastEndDTS=m:(a["logger"].warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!g.audio,E=!!g.video,T="";y&&(T+="audio"),E&&(T+="video");var S={data1:h,startPTS:p,startDTS:p,endPTS:m,endDTS:m,type:T,hasAudio:y,hasVideo:E,nb:1,dropped:0};return d.audio="audio"===S.type?S:void 0,d.video="audio"!==S.type?S:void 0,d.text=s,d.id3=r,d.initSegment=f,d},t}(),l=function(t,e,r){return Object(n["getStartDTS"])(t,e)-r};function u(t,e){var r=null===t||void 0===t?void 0:t.codec;return r&&r.length>4?r:"hvc1"===r?"hvc1.1.c.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||e===s["ElementaryStreamTypes"].VIDEO?"avc1.42e01e":"mp4a.40.5"}e["default"]=o},"./src/task-loop.ts":
/*!**************************!*\
  !*** ./src/task-loop.ts ***!
  \**************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return i}));var i=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},t}()},"./src/types/cmcd.ts":
/*!***************************!*\
  !*** ./src/types/cmcd.ts ***!
  \***************************/
/*! exports provided: CMCDVersion, CMCDObjectType, CMCDStreamingFormat, CMCDStreamType */function(t,e,r){"use strict";r.r(e),r.d(e,"CMCDVersion",(function(){return a})),r.d(e,"CMCDObjectType",(function(){return i})),r.d(e,"CMCDStreamingFormat",(function(){return n})),r.d(e,"CMCDStreamType",(function(){return s}));var i,n,s,a=1;(function(t){t["MANIFEST"]="m",t["AUDIO"]="a",t["VIDEO"]="v",t["MUXED"]="av",t["INIT"]="i",t["CAPTION"]="c",t["TIMED_TEXT"]="tt",t["KEY"]="k",t["OTHER"]="o"})(i||(i={})),function(t){t["DASH"]="d",t["HLS"]="h",t["SMOOTH"]="s",t["OTHER"]="o"}(n||(n={})),function(t){t["VOD"]="v",t["LIVE"]="l"}(s||(s={}))},"./src/types/level.ts":
/*!****************************!*\
  !*** ./src/types/level.ts ***!
  \****************************/
/*! exports provided: HlsSkip, getSkipValue, HlsUrlParameters, Level */function(t,e,r){"use strict";function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}var s;function a(t,e){var r=t.canSkipUntil,i=t.canSkipDateRanges,n=t.endSN,a=void 0!==e?e-n:0;return r&&a<r?i?s.v2:s.Yes:s.No}r.r(e),r.d(e,"HlsSkip",(function(){return s})),r.d(e,"getSkipValue",(function(){return a})),r.d(e,"HlsUrlParameters",(function(){return o})),r.d(e,"Level",(function(){return l})),function(t){t["No"]="",t["Yes"]="YES",t["v2"]="v2"}(s||(s={}));var o=function(){function t(t,e,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=r}var e=t.prototype;return e.addDirectives=function(t){var e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.toString()},t}(),l=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(t){return t})).join(",").replace(/\.[^.,]+/g,"")}return n(t,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var e=t%this.url.length;this._urlId!==e&&(this.details=void 0,this._urlId=e)}}]),t}()},"./src/types/loader.ts":
/*!*****************************!*\
  !*** ./src/types/loader.ts ***!
  \*****************************/
/*! exports provided: PlaylistContextType, PlaylistLevelType */function(t,e,r){"use strict";var i,n;r.r(e),r.d(e,"PlaylistContextType",(function(){return i})),r.d(e,"PlaylistLevelType",(function(){return n})),function(t){t["MANIFEST"]="manifest",t["LEVEL"]="level",t["AUDIO_TRACK"]="audioTrack",t["SUBTITLE_TRACK"]="subtitleTrack"}(i||(i={})),function(t){t["MAIN"]="main",t["AUDIO"]="audio",t["SUBTITLE"]="subtitle"}(n||(n={}))},"./src/types/transmuxer.ts":
/*!*********************************!*\
  !*** ./src/types/transmuxer.ts ***!
  \*********************************/
/*! exports provided: ChunkMetadata */function(t,e,r){"use strict";r.r(e),r.d(e,"ChunkMetadata",(function(){return i}));var i=function(t,e,r,i,s,a){void 0===i&&(i=0),void 0===s&&(s=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=n(),this.buffering={audio:n(),video:n(),audiovideo:n()},this.level=t,this.sn=e,this.id=r,this.size=i,this.part=s,this.partial=a};function n(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":
/*!********************************!*\
  !*** ./src/utils/attr-list.ts ***!
  \********************************/
/*! exports provided: AttrList */function(t,e,r){"use strict";r.r(e),r.d(e,"AttrList",(function(){return s}));var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function t(e){for(var r in"string"===typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(r)&&(this[r]=e[r])}var e=t.prototype;return e.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},e.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.optionalFloat=function(t,e){var r=this[t];return r?parseFloat(r):e},e.enumeratedString=function(t){return this[t]},e.bool=function(t){return"YES"===this[t]},e.decimalResolution=function(t){var e=i.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,r={},i='"';n.lastIndex=0;while(null!==(e=n.exec(t))){var s=e[2];0===s.indexOf(i)&&s.lastIndexOf(i)===s.length-1&&(s=s.slice(1,-1)),r[e[1]]=s}return r},t}()},"./src/utils/binary-search.ts":
/*!************************************!*\
  !*** ./src/utils/binary-search.ts ***!
  \************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i={search:function(t,e){var r=0,i=t.length-1,n=null,s=null;while(r<=i){n=(r+i)/2|0,s=t[n];var a=e(s);if(a>0)r=n+1;else{if(!(a<0))return s;i=n-1}}return null}};e["default"]=i},"./src/utils/buffer-helper.ts":
/*!************************************!*\
  !*** ./src/utils/buffer-helper.ts ***!
  \************************************/
/*! exports provided: BufferHelper */function(t,e,r){"use strict";r.r(e),r.d(e,"BufferHelper",(function(){return s}));var i=r(/*! ./logger */"./src/utils/logger.ts"),n={length:0,start:function(){return 0},end:function(){return 0}},s=function(){function t(){}return t.isBuffered=function(e,r){try{if(e)for(var i=t.getBuffered(e),n=0;n<i.length;n++)if(r>=i.start(n)&&r<=i.end(n))return!0}catch(s){}return!1},t.bufferInfo=function(e,r,i){try{if(e){var n,s=t.getBuffered(e),a=[];for(n=0;n<s.length;n++)a.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(a,r,i)}}catch(o){}return{len:0,start:r,end:r,nextStart:void 0}},t.bufferedInfo=function(t,e,r){e=Math.max(0,e),t.sort((function(t,e){var r=t.start-e.start;return r||e.end-t.end}));var i=[];if(r)for(var n=0;n<t.length;n++){var s=i.length;if(s){var a=i[s-1].end;t[n].start-a<r?t[n].end>a&&(i[s-1].end=t[n].end):i.push(t[n])}else i.push(t[n])}else i=t;for(var o,l=0,u=e,c=e,d=0;d<i.length;d++){var h=i[d].start,f=i[d].end;if(e+r>=h&&e<f)u=h,c=f,l=c-e;else if(e+r<h){o=h;break}}return{len:l,start:u||0,end:c||0,nextStart:o}},t.getBuffered=function(t){try{return t.buffered}catch(e){return i["logger"].log("failed to get media.buffered",e),n}},t}()},"./src/utils/cea-608-parser.ts":
/*!*************************************!*\
  !*** ./src/utils/cea-608-parser.ts ***!
  \*************************************/
/*! exports provided: Row, CaptionScreen, default */function(t,e,r){"use strict";r.r(e),r.d(e,"Row",(function(){return y})),r.d(e,"CaptionScreen",(function(){return E}));var i,n=r(/*! ../utils/logger */"./src/utils/logger.ts"),s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},a=function(t){var e=t;return s.hasOwnProperty(t)&&(e=s[t]),String.fromCharCode(e)},o=15,l=100,u={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},f=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(t){t[t["ERROR"]=0]="ERROR",t[t["TEXT"]=1]="TEXT",t[t["WARNING"]=2]="WARNING",t[t["INFO"]=2]="INFO",t[t["DEBUG"]=3]="DEBUG",t[t["DATA"]=3]="DATA"})(i||(i={}));var g=function(){function t(){this.time=null,this.verboseLevel=i.ERROR}var e=t.prototype;return e.log=function(t,e){this.verboseLevel>=t&&n["logger"].log(this.time+" ["+t+"] "+e)},t}(),v=function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e},p=function(){function t(t,e,r,i,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=r||!1,this.background=i||"black",this.flash=n||!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),m=function(){function t(t,e,r,i,n,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new p(e,r,i,n,s)}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),y=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<l;e++)this.chars.push(new m);this.logger=t,this.pos=0,this.currPenState=new p}var e=t.prototype;return e.equals=function(t){for(var e=!0,r=0;r<l;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<l;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<l;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(i.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(this.logger.log(i.DEBUG,"Too large cursor position "+this.pos),this.pos=l)},e.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){t>=144&&this.backSpace();var e=a(t);this.pos>=l?this.logger.log(i.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){var e;for(e=t;e<l;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,r=0;r<l;r++){var i=this.chars[r].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t);var e=this.chars[this.pos];e.setPenState(this.currPenState)},t}(),E=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<o;e++)this.rows.push(new y(t));this.logger=t,this.currRow=o-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var e=t.prototype;return e.reset=function(){for(var t=0;t<o;t++)this.rows[t].clear();this.currRow=o-1},e.equals=function(t){for(var e=!0,r=0;r<o;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<o;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<o;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){var t=this.rows[this.currRow];t.backSpace()},e.clearToEndOfRow=function(){var t=this.rows[this.currRow];t.clearToEndOfRow()},e.insertChar=function(t){var e=this.rows[this.currRow];e.insertChar(t)},e.setPen=function(t){var e=this.rows[this.currRow];e.setPenStyles(t)},e.moveCursor=function(t){var e=this.rows[this.currRow];e.moveCursor(t)},e.setCursor=function(t){this.logger.log(i.INFO,"setCursor: "+t);var e=this.rows[this.currRow];e.setCursor(t)},e.setPAC=function(t){this.logger.log(i.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<o;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var a=s.rows[n].cueStartTime,l=this.logger.time;if(a&&null!==l&&a<l)for(var u=0;u<this.nrRollUpRows;u++)this.rows[e-this.nrRollUpRows+u+1].copy(s.rows[n+u])}}this.currRow=e;var c=this.rows[this.currRow];if(null!==t.indent){var d=t.indent,h=Math.max(d-1,0);c.setCursor(t.indent),t.color=c.chars[h].penState.foreground}var f={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(f)},e.setBkgData=function(t){this.logger.log(i.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(i.TEXT,this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(i.INFO,"Rolling up")}else this.logger.log(i.DEBUG,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e=[],r="",i=-1,n=0;n<o;n++){var s=this.rows[n].getTextString();s&&(i=n+1,t?e.push("Row "+i+": '"+s+"'"):e.push(s.trim()))}return e.length>0&&(r=t?"["+e.join(" | ")+"]":e.join("\n")),r},e.getTextAndFormat=function(){return this.rows},t}(),T=function(){function t(t,e,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new E(r),this.nonDisplayedMemory=new E(r),this.lastOutputScreen=new E(r),this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(i.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(i.INFO,r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(i.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(i.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(i.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(i.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(i.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(i.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(i.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(i.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(i.INFO,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(i.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(i.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(i.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){if(this.logger.log(i.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(i.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(i.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{var r=Math.floor(t/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=n[r]}this.logger.log(i.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),S=function(){function t(t,e,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new g;this.channels=[null,new T(t,e,i),new T(t+1,r,i)],this.cmdHistory=A(),this.logger=i}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var r,n,s,a=!1;this.logger.time=t;for(var o=0;o<e.length;o+=2)if(n=127&e[o],s=127&e[o+1],0!==n||0!==s){if(this.logger.log(i.DATA,"["+v([e[o],e[o+1]])+"] -> ("+v([n,s])+")"),r=this.parseCmd(n,s),r||(r=this.parseMidrow(n,s)),r||(r=this.parsePAC(n,s)),r||(r=this.parseBackgroundAttributes(n,s)),!r&&(a=this.parseChars(n,s),a)){var l=this.currentChannel;if(l&&l>0){var u=this.channels[l];u.insertChars(a)}else this.logger.log(i.WARNING,"No channel found yet. TEXT-MODE?")}r||a||this.logger.log(i.WARNING,"Couldn't parse cleaned data "+v([n,s])+" orig: "+v([e[o],e[o+1]]))}},e.parseCmd=function(t,e){var r=this.cmdHistory,n=(20===t||28===t||21===t||29===t)&&e>=32&&e<=47,s=(23===t||31===t)&&e>=33&&e<=35;if(!n&&!s)return!1;if(L(t,e,r))return b(null,null,r),this.logger.log(i.DEBUG,"Repeated command ("+v([t,e])+") is dropped"),!0;var a=20===t||21===t||23===t?1:2,o=this.channels[a];return 20===t||21===t||28===t||29===t?32===e?o.ccRCL():33===e?o.ccBS():34===e?o.ccAOF():35===e?o.ccAON():36===e?o.ccDER():37===e?o.ccRU(2):38===e?o.ccRU(3):39===e?o.ccRU(4):40===e?o.ccFON():41===e?o.ccRDC():42===e?o.ccTR():43===e?o.ccRTD():44===e?o.ccEDM():45===e?o.ccCR():46===e?o.ccENM():47===e&&o.ccEOC():o.ccTO(e-32),b(t,e,r),this.currentChannel=a,!0},e.parseMidrow=function(t,e){var r=0;if((17===t||25===t)&&e>=32&&e<=47){if(r=17===t?1:2,r!==this.currentChannel)return this.logger.log(i.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[r];return!!n&&(n.ccMIDROW(e),this.logger.log(i.DEBUG,"MIDROW ("+v([t,e])+")"),!0)}return!1},e.parsePAC=function(t,e){var r,i=this.cmdHistory,n=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,s=(16===t||24===t)&&e>=64&&e<=95;if(!n&&!s)return!1;if(L(t,e,i))return b(null,null,i),!0;var a=t<=23?1:2;r=e>=64&&e<=95?1===a?u[t]:d[t]:1===a?c[t]:h[t];var o=this.channels[a];return!!o&&(o.setPAC(this.interpretPAC(r,e)),b(t,e,i),this.currentChannel=a,!0)},e.interpretPAC=function(t,e){var r,i={color:null,italics:!1,indent:null,underline:!1,row:t};return r=e>95?e-96:e-64,i.underline=1===(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},e.parseChars=function(t,e){var r,n,s=null,o=null;(t>=25?(r=2,o=t-8):(r=1,o=t),o>=17&&o<=19)?(n=17===o?e+80:18===o?e+112:e+144,this.logger.log(i.INFO,"Special char '"+a(n)+"' in channel "+r),s=[n]):t>=32&&t<=127&&(s=0===e?[t]:[t,e]);if(s){var l=v(s);this.logger.log(i.DEBUG,"Char codes =  "+l.join(",")),b(t,e,this.cmdHistory)}return s},e.parseBackgroundAttributes=function(t,e){var r,i=(16===t||24===t)&&e>=32&&e<=47,n=(23===t||31===t)&&e>=45&&e<=47;if(!i&&!n)return!1;var s={};16===t||24===t?(r=Math.floor((e-32)/2),s.background=f[r],e%2===1&&(s.background=s.background+"_semi")):45===e?s.background="transparent":(s.foreground="black",47===e&&(s.underline=!0));var a=t<=23?1:2,o=this.channels[a];return o.setBkgData(s),b(t,e,this.cmdHistory),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory=A()},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var r=this.channels[e];r&&r.cueSplitAtTime(t)}},t}();function b(t,e,r){r.a=t,r.b=e}function L(t,e,r){return r.a===t&&r.b===e}function A(){return{a:null,b:null}}e["default"]=S},"./src/utils/codecs.ts":
/*!*****************************!*\
  !*** ./src/utils/codecs.ts ***!
  \*****************************/
/*! exports provided: isCodecType, isCodecSupportedInMp4 */function(t,e,r){"use strict";r.r(e),r.d(e,"isCodecType",(function(){return n})),r.d(e,"isCodecSupportedInMp4",(function(){return s}));var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function n(t,e){var r=i[e];return!!r&&!0===r[t.slice(0,4)]}function s(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}},"./src/utils/cues.ts":
/*!***************************!*\
  !*** ./src/utils/cues.ts ***!
  \***************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ./vttparser */"./src/utils/vttparser.ts"),n=r(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts"),s=r(/*! ./texttrack-utils */"./src/utils/texttrack-utils.ts"),a=/\s/,o={newCue:function(t,e,r,o){for(var l,u,c,d,h,f=[],g=self.VTTCue||self.TextTrackCue,v=0;v<o.rows.length;v++)if(l=o.rows[v],c=!0,d=0,h="",!l.isEmpty()){for(var p=0;p<l.chars.length;p++)a.test(l.chars[p].uchar)&&c?d++:(h+=l.chars[p].uchar,c=!1);l.cueStartTime=e,e===r&&(r+=1e-4),d>=16?d--:d++;var m=Object(i["fixLineBreaks"])(h.trim()),y=Object(n["generateCueId"])(e,r,m);t&&t.cues&&t.cues.getCueById(y)||(u=new g(e,r,m),u.id=y,u.line=v+1,u.align="left",u.position=10+Math.min(80,10*Math.floor(8*d/32)),f.push(u))}return t&&f.length&&(f.sort((function(t,e){return"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line})),f.forEach((function(e){return Object(s["addCueToTrack"])(t,e)}))),f}};e["default"]=o},"./src/utils/discontinuities.ts":
/*!**************************************!*\
  !*** ./src/utils/discontinuities.ts ***!
  \**************************************/
/*! exports provided: findFirstFragWithCC, shouldAlignOnDiscontinuities, findDiscontinuousReferenceFrag, adjustSlidingStart, alignStream, alignPDT, alignFragmentByPDTDelta, alignMediaPlaylistByPDT */function(t,e,r){"use strict";r.r(e),r.d(e,"findFirstFragWithCC",(function(){return a})),r.d(e,"shouldAlignOnDiscontinuities",(function(){return o})),r.d(e,"findDiscontinuousReferenceFrag",(function(){return l})),r.d(e,"adjustSlidingStart",(function(){return c})),r.d(e,"alignStream",(function(){return d})),r.d(e,"alignPDT",(function(){return f})),r.d(e,"alignFragmentByPDTDelta",(function(){return g})),r.d(e,"alignMediaPlaylistByPDT",(function(){return v}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ./logger */"./src/utils/logger.ts"),s=r(/*! ../controller/level-helper */"./src/controller/level-helper.ts");function a(t,e){for(var r=null,i=0,n=t.length;i<n;i++){var s=t[i];if(s&&s.cc===e){r=s;break}}return r}function o(t,e,r){return!(!e.details||!(r.endCC>r.startCC||t&&t.cc<r.startCC))}function l(t,e){var r=t.fragments,i=e.fragments;if(i.length&&r.length){var s=a(r,i[0].cc);if(s&&(!s||s.startPTS))return s;n["logger"].log("No frag in previous level to align on")}else n["logger"].log("No fragments to align")}function u(t,e){if(t){var r=t.start+e;t.start=t.startPTS=r,t.endPTS=r+t.duration}}function c(t,e){for(var r=e.fragments,i=0,n=r.length;i<n;i++)u(r[i],t);e.fragmentHint&&u(e.fragmentHint,t),e.alignedSliding=!0}function d(t,e,r){e&&(h(t,r,e),!r.alignedSliding&&e.details&&f(r,e.details),r.alignedSliding||!e.details||r.skippedSegments||Object(s["adjustSliding"])(e.details,r))}function h(t,e,r){if(o(t,r,e)){var s=l(r.details,e);s&&Object(i["isFiniteNumber"])(s.start)&&(n["logger"].log("Adjusting PTS using last level due to CC increase within current level "+e.url),c(s.start,e))}}function f(t,e){if(e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime){var r=e.fragments[0].programDateTime,s=t.fragments[0].programDateTime,a=(s-r)/1e3+e.fragments[0].start;a&&Object(i["isFiniteNumber"])(a)&&(n["logger"].log("Adjusting PTS using programDateTime delta "+(s-r)+"ms, sliding:"+a.toFixed(3)+" "+t.url+" "),c(a,t))}}function g(t,e){var r=t.programDateTime;if(r){var i=(r-e)/1e3;t.start=t.startPTS=i,t.endPTS=i+t.duration}}function v(t,e){if(e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime){var r=e.fragments[0].programDateTime,i=e.fragments[0].start,n=r-1e3*i;t.fragments.forEach((function(t){g(t,n)})),t.fragmentHint&&g(t.fragmentHint,n),t.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":
/*!***********************************************!*\
  !*** ./src/utils/ewma-bandwidth-estimator.ts ***!
  \***********************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../utils/ewma */"./src/utils/ewma.ts"),n=function(){function t(t,e,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new i["default"](t),this.fast_=new i["default"](e)}var e=t.prototype;return e.update=function(t,e){var r=this.slow_,n=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new i["default"](t,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new i["default"](e,n.getEstimate(),n.getTotalWeight()))},e.sample=function(t,e){t=Math.max(t,this.minDelayMs_);var r=8*e,i=t/1e3,n=r/i;this.fast_.sample(i,n),this.slow_.sample(i,n)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},t}();e["default"]=n},"./src/utils/ewma.ts":
/*!***************************!*\
  !*** ./src/utils/ewma.ts ***!
  \***************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=function(){function t(t,e,r){void 0===e&&(e=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=r}var e=t.prototype;return e.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}();e["default"]=i},"./src/utils/fetch-loader.ts":
/*!***********************************!*\
  !*** ./src/utils/fetch-loader.ts ***!
  \***********************************/
/*! exports provided: fetchSupported, default */function(t,e,r){"use strict";r.r(e),r.d(e,"fetchSupported",(function(){return g}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),s=r(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts");function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,d(t,e)}function o(t){var e="function"===typeof Map?new Map:void 0;return o=function(t){if(null===t||!c(t))return t;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return l(t,arguments,h(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d(r,t)},o(t)}function l(t,e,r){return l=u()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);var n=Function.bind.apply(t,i),s=new n;return r&&d(s,r.prototype),s},l.apply(null,arguments)}function u(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function c(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function d(t,e){return d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},d(t,e)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function f(){return f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},f.apply(this,arguments)}function g(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}var v=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||m,this.controller=new self.AbortController,this.stats=new n["LoadStats"]}var e=t.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(t,e,r){var n=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var a=p(t,this.controller.signal),o=r.onProgress,l="arraybuffer"===t.responseType,u=l?"byteLength":"length";this.context=t,this.config=e,this.callbacks=r,this.request=this.fetchSetup(t,a),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){n.abortInternal(),r.onTimeout(s,t,n.response)}),e.timeout),self.fetch(this.request).then((function(r){if(n.response=n.loader=r,!r.ok){var a=r.status,u=r.statusText;throw new y(u||"fetch, bad network response",a,r)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(r.headers.get("Content-Length")||"0"),o&&Object(i["isFiniteNumber"])(e.highWaterMark)?n.loadProgressively(r,s,t,e.highWaterMark,o):l?r.arrayBuffer():r.text()})).then((function(a){var l=n.response;self.clearTimeout(n.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=a[u];var c={url:l.url,data:a};o&&!Object(i["isFiniteNumber"])(e.highWaterMark)&&o(s,t,a,l),r.onSuccess(c,s,t,l)})).catch((function(e){if(self.clearTimeout(n.requestTimeout),!s.aborted){var i=e.code||0;r.onError({code:i,text:e.message},t,e.details)}}))},e.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},e.loadProgressively=function(t,e,r,i,n){void 0===i&&(i=0);var a=new s["default"],o=t.body.getReader(),l=function s(){return o.read().then((function(o){if(o.done)return a.dataLength&&n(e,r,a.flush(),t),Promise.resolve(new ArrayBuffer(0));var l=o.value,u=l.length;return e.loaded+=u,u<i||a.dataLength?(a.push(l),a.dataLength>=i&&n(e,r,a.flush(),t)):n(e,r,l,t),s()})).catch((function(){return Promise.reject()}))};return l()},t}();function p(t,e){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(f({},t.headers))};return t.rangeEnd&&r.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),r}function m(t,e){return new self.Request(t.url,e)}var y=function(t){function e(e,r,i){var n;return n=t.call(this,e)||this,n.code=void 0,n.details=void 0,n.code=r,n.details=i,n}return a(e,t),e}(o(Error));e["default"]=v},"./src/utils/imsc1-ttml-parser.ts":
/*!****************************************!*\
  !*** ./src/utils/imsc1-ttml-parser.ts ***!
  \****************************************/
/*! exports provided: IMSC1_CODEC, parseIMSC1 */function(t,e,r){"use strict";r.r(e),r.d(e,"IMSC1_CODEC",(function(){return c})),r.d(e,"parseIMSC1",(function(){return g}));var i=r(/*! ./mp4-tools */"./src/utils/mp4-tools.ts"),n=r(/*! ./vttparser */"./src/utils/vttparser.ts"),s=r(/*! ./vttcue */"./src/utils/vttcue.ts"),a=r(/*! ../demux/id3 */"./src/demux/id3.ts"),o=r(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts"),l=r(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts");function u(){return u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},u.apply(this,arguments)}var c="stpp.ttml.im1t",d=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,f={left:"start",center:"center",right:"end",start:"start",end:"end"};function g(t,e,r,n,s){var l=Object(i["findBox"])(new Uint8Array(t),["mdat"]);if(0!==l.length){var u=l[0],c=Object(a["utf8ArrayToStr"])(new Uint8Array(t,u.start,u.end-u.start)),d=Object(o["toTimescaleFromScale"])(e,1,r);try{n(v(c,d))}catch(h){s(h)}}else s(new Error("Could not parse IMSC1 mdat"))}function v(t,e){var r=new DOMParser,i=r.parseFromString(t,"text/xml"),n=i.getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(a).reduce((function(t,e){return t[e]=n.getAttribute("ttp:"+e)||a[e],t}),{}),c="preserve"!==n.getAttribute("xml:space"),d=m(p(n,"styling","style")),h=m(p(n,"layout","region")),g=p(n,"body","[begin]");return[].map.call(g,(function(t){var r=y(t,c);if(!r||!t.hasAttribute("begin"))return null;var i=b(t.getAttribute("begin"),o),n=b(t.getAttribute("dur"),o),a=b(t.getAttribute("end"),o);if(null===i)throw S(t);if(null===a){if(null===n)throw S(t);a=i+n}var g=new s["default"](i-e,a-e,r);g.id=Object(l["generateCueId"])(g.startTime,g.endTime,g.text);var v=h[t.getAttribute("region")],p=d[t.getAttribute("style")];g.position=10,g.size=80;var m=E(v,p),T=m.textAlign;if(T){var L=f[T];L&&(g.lineAlign=L),g.align=T}return u(g,m),g})).filter((function(t){return null!==t}))}function p(t,e,r){var i=t.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function m(t){return t.reduce((function(t,e){var r=e.getAttribute("xml:id");return r&&(t[r]=e),t}),{})}function y(t,e){return[].slice.call(t.childNodes).reduce((function(t,r,i){var n;return"br"===r.nodeName&&i?t+"\n":null!==(n=r.childNodes)&&void 0!==n&&n.length?y(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent}),"")}function E(t,e){var r="http://www.w3.org/ns/ttml#styling",i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return i.reduce((function(i,n){var s=T(e,r,n)||T(t,r,n);return s&&(i[n]=s),i}),{})}function T(t,e,r){return t.hasAttributeNS(e,r)?t.getAttributeNS(e,r):null}function S(t){return new Error("Could not parse ttml timestamp "+t)}function b(t,e){if(!t)return null;var r=Object(n["parseTimeStamp"])(t);return null===r&&(d.test(t)?r=L(t,e):h.test(t)&&(r=A(t,e))),r}function L(t,e){var r=d.exec(t),i=(0|r[4])+(0|r[5])/e.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/e.frameRate}function A(t,e){var r=h.exec(t),i=Number(r[1]),n=r[2];switch(n){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}},"./src/utils/logger.ts":
/*!*****************************!*\
  !*** ./src/utils/logger.ts ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(t,e,r){"use strict";r.r(e),r.d(e,"enableLogs",(function(){return l})),r.d(e,"logger",(function(){return u}));var i=function(){},n={trace:i,debug:i,log:i,warn:i,info:i,error:i},s=n;function a(t){var e=self.console[t];return e?e.bind(self.console,"["+t+"] >"):i}function o(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];r.forEach((function(e){s[e]=t[e]?t[e].bind(t):a(e)}))}function l(t){if(self.console&&!0===t||"object"===typeof t){o(t,"debug","log","info","warn","error");try{s.log()}catch(e){s=n}}else s=n}var u=s},"./src/utils/mediakeys-helper.ts":
/*!***************************************!*\
  !*** ./src/utils/mediakeys-helper.ts ***!
  \***************************************/
/*! exports provided: KeySystems, requestMediaKeySystemAccess */function(t,e,r){"use strict";var i;r.r(e),r.d(e,"KeySystems",(function(){return i})),r.d(e,"requestMediaKeySystemAccess",(function(){return n})),function(t){t["WIDEVINE"]="com.widevine.alpha",t["PLAYREADY"]="com.microsoft.playready"}(i||(i={}));var n=function(){return"undefined"!==typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":
/*!*****************************************!*\
  !*** ./src/utils/mediasource-helper.ts ***!
  \*****************************************/
/*! exports provided: getMediaSource */function(t,e,r){"use strict";function i(){return self.MediaSource||self.WebKitMediaSource}r.r(e),r.d(e,"getMediaSource",(function(){return i}))},"./src/utils/mp4-tools.ts":
/*!********************************!*\
  !*** ./src/utils/mp4-tools.ts ***!
  \********************************/
/*! exports provided: bin2str, readUint16, readUint32, writeUint32, findBox, parseSegmentIndex, parseInitSegment, getStartDTS, getDuration, computeRawDurationFromSamples, offsetStartDTS, segmentValidRange, appendUint8Array */function(t,e,r){"use strict";r.r(e),r.d(e,"bin2str",(function(){return o})),r.d(e,"readUint16",(function(){return l})),r.d(e,"readUint32",(function(){return u})),r.d(e,"writeUint32",(function(){return c})),r.d(e,"findBox",(function(){return d})),r.d(e,"parseSegmentIndex",(function(){return h})),r.d(e,"parseInitSegment",(function(){return f})),r.d(e,"getStartDTS",(function(){return g})),r.d(e,"getDuration",(function(){return v})),r.d(e,"computeRawDurationFromSamples",(function(){return p})),r.d(e,"offsetStartDTS",(function(){return m})),r.d(e,"segmentValidRange",(function(){return y})),r.d(e,"appendUint8Array",(function(){return E}));var i=r(/*! ./typed-array */"./src/utils/typed-array.ts"),n=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),s=Math.pow(2,32)-1,a=[].push;function o(t){return String.fromCharCode.apply(null,t)}function l(t,e){"data"in t&&(e+=t.start,t=t.data);var r=t[e]<<8|t[e+1];return r<0?65536+r:r}function u(t,e){"data"in t&&(e+=t.start,t=t.data);var r=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return r<0?4294967296+r:r}function c(t,e,r){"data"in t&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r}function d(t,e){var r,i,n,s=[];if(!e.length)return s;"data"in t?(r=t.data,i=t.start,n=t.end):(r=t,i=0,n=r.byteLength);for(var l=i;l<n;){var c=u(r,l),h=o(r.subarray(l+4,l+8)),f=c>1?l+c:n;if(h===e[0])if(1===e.length)s.push({data:r,start:l+8,end:f});else{var g=d({data:r,start:l+8,end:f},e.slice(1));g.length&&a.apply(s,g)}l=f}return s}function h(t){var e=d(t,["moov"]),r=e[0],i=r?r.end:null,n=d(t,["sidx"]);if(!n||!n[0])return null;var s=[],a=n[0],o=a.data[0],c=0===o?8:16,h=u(a,c);c+=4;var f=0,g=0;c+=0===o?8:16,c+=2;var v=a.end+g,p=l(a,c);c+=2;for(var m=0;m<p;m++){var y=c,E=u(a,y);y+=4;var T=2147483647&E,S=(2147483648&E)>>>31;if(1===S)return console.warn("SIDX has hierarchical references (not supported)"),null;var b=u(a,y);y+=4,s.push({referenceSize:T,subsegmentDuration:b,info:{duration:b/h,start:v,end:v+T-1}}),v+=T,y+=4,c=y}return{earliestPresentationTime:f,timescale:h,version:o,referencesCount:p,references:s,moovEndOffset:i}}function f(t){for(var e=[],r=d(t,["moov","trak"]),i=0;i<r.length;i++){var s=r[i],a=d(s,["tkhd"])[0];if(a){var l=a.data[a.start],c=0===l?12:20,h=u(a,c),f=d(s,["mdia","mdhd"])[0];if(f){l=f.data[f.start],c=0===l?12:20;var g=u(f,c),v=d(s,["mdia","hdlr"])[0];if(v){var p=o(v.data.subarray(v.start+8,v.start+12)),m={soun:n["ElementaryStreamTypes"].AUDIO,vide:n["ElementaryStreamTypes"].VIDEO}[p];if(m){var y=d(s,["mdia","minf","stbl","stsd"])[0],E=void 0;y&&(E=o(y.data.subarray(y.start+12,y.start+16))),e[h]={timescale:g,type:m},e[m]={timescale:g,id:h,codec:E}}}}}}var T=d(t,["moov","mvex","trex"]);return T.forEach((function(t){var r=u(t,4),i=e[r];i&&(i.default={duration:u(t,12),flags:u(t,20)})})),e}function g(t,e){return d(e,["moof","traf"]).reduce((function(e,r){var i=d(r,["tfdt"])[0],n=i.data[i.start],s=d(r,["tfhd"]).reduce((function(e,r){var s=u(r,4),a=t[s];if(a){var o=u(i,4);1===n&&(o*=Math.pow(2,32),o+=u(i,8));var l=a.timescale||9e4,c=o/l;if(isFinite(c)&&(null===e||c<e))return c}return e}),null);return null!==s&&isFinite(s)&&(null===e||s<e)?s:e}),null)||0}function v(t,e){for(var r=0,i=0,s=0,a=d(t,["moof","traf"]),o=0;o<a.length;o++){var l=a[o],c=d(l,["tfhd"])[0],f=u(c,4),g=e[f];if(g){var v=g.default,m=u(c,0)|(null===v||void 0===v?void 0:v.flags),y=null===v||void 0===v?void 0:v.duration;8&m&&(y=u(c,2&m?12:8));for(var E=g.timescale||9e4,T=d(l,["trun"]),S=0;S<T.length;S++){if(y){var b=u(T[S],4);r=y*b}else r=p(T[S]);g.type===n["ElementaryStreamTypes"].VIDEO?i+=r/E:g.type===n["ElementaryStreamTypes"].AUDIO&&(s+=r/E)}}}if(0===i&&0===s){var L=h(t);if(null!==L&&void 0!==L&&L.references)return L.references.reduce((function(t,e){return t+e.info.duration||0}),0)}return i||s}function p(t){var e=u(t,0),r=8;1&e&&(r+=4),4&e&&(r+=4);for(var i=0,n=u(t,4),s=0;s<n;s++){if(256&e){var a=u(t,r);i+=a,r+=4}512&e&&(r+=4),1024&e&&(r+=4),2048&e&&(r+=4)}return i}function m(t,e,r){d(e,["moof","traf"]).forEach((function(e){d(e,["tfhd"]).forEach((function(i){var n=u(i,4),a=t[n];if(a){var o=a.timescale||9e4;d(e,["tfdt"]).forEach((function(t){var e=t.data[t.start],i=u(t,4);if(0===e)c(t,4,i-r*o);else{i*=Math.pow(2,32),i+=u(t,8),i-=r*o,i=Math.max(i,0);var n=Math.floor(i/(s+1)),a=Math.floor(i%(s+1));c(t,4,n),c(t,8,a)}}))}}))}))}function y(t){var e={valid:null,remainder:null},r=d(t,["moof"]);if(!r)return e;if(r.length<2)return e.remainder=t,e;var n=r[r.length-1];return e.valid=Object(i["sliceUint8"])(t,0,n.start-8),e.remainder=Object(i["sliceUint8"])(t,n.start-8),e}function E(t,e){var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}},"./src/utils/output-filter.ts":
/*!************************************!*\
  !*** ./src/utils/output-filter.ts ***!
  \************************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return i}));var i=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[]},t}()},"./src/utils/texttrack-utils.ts":
/*!**************************************!*\
  !*** ./src/utils/texttrack-utils.ts ***!
  \**************************************/
/*! exports provided: sendAddTrackEvent, addCueToTrack, clearCurrentCues, removeCuesInRange, getCuesInRange */function(t,e,r){"use strict";r.r(e),r.d(e,"sendAddTrackEvent",(function(){return n})),r.d(e,"addCueToTrack",(function(){return s})),r.d(e,"clearCurrentCues",(function(){return a})),r.d(e,"removeCuesInRange",(function(){return o})),r.d(e,"getCuesInRange",(function(){return u}));var i=r(/*! ./logger */"./src/utils/logger.ts");function n(t,e){var r;try{r=new Event("addtrack")}catch(i){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)}function s(t,e){var r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(s){i["logger"].debug("[texttrack-utils]: "+s);var n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,t.addCue(n)}"disabled"===r&&(t.mode=r)}function a(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var r=t.cues.length;r--;)t.removeCue(t.cues[r]);"disabled"===e&&(t.mode=e)}function o(t,e,r){var i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues&&t.cues.length>0)for(var n=u(t.cues,e,r),s=0;s<n.length;s++)t.removeCue(n[s]);"disabled"===i&&(t.mode=i)}function l(t,e){if(e<t[0].startTime)return 0;var r=t.length-1;if(e>t[r].endTime)return-1;var i=0,n=r;while(i<=n){var s=Math.floor((n+i)/2);if(e<t[s].startTime)n=s-1;else{if(!(e>t[s].startTime&&i<r))return s;i=s+1}}return t[i].startTime-e<e-t[n].startTime?i:n}function u(t,e,r){var i=[],n=l(t,e);if(n>-1)for(var s=n,a=t.length;s<a;s++){var o=t[s];if(o.startTime>=e&&o.endTime<=r)i.push(o);else if(o.startTime>r)return i}return i}},"./src/utils/time-ranges.ts":
/*!**********************************!*\
  !*** ./src/utils/time-ranges.ts ***!
  \**********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i={toString:function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}};e["default"]=i},"./src/utils/timescale-conversion.ts":
/*!*******************************************!*\
  !*** ./src/utils/timescale-conversion.ts ***!
  \*******************************************/
/*! exports provided: toTimescaleFromBase, toTimescaleFromScale, toMsFromMpegTsClock, toMpegTsClockFromTimescale */function(t,e,r){"use strict";r.r(e),r.d(e,"toTimescaleFromBase",(function(){return n})),r.d(e,"toTimescaleFromScale",(function(){return s})),r.d(e,"toMsFromMpegTsClock",(function(){return a})),r.d(e,"toMpegTsClockFromTimescale",(function(){return o}));var i=9e4;function n(t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var n=t*e*r;return i?Math.round(n):n}function s(t,e,r,i){return void 0===r&&(r=1),void 0===i&&(i=!1),n(t,e,1/r,i)}function a(t,e){return void 0===e&&(e=!1),n(t,1e3,1/i,e)}function o(t,e){return void 0===e&&(e=1),n(t,i,1/e)}},"./src/utils/typed-array.ts":
/*!**********************************!*\
  !*** ./src/utils/typed-array.ts ***!
  \**********************************/
/*! exports provided: sliceUint8 */function(t,e,r){"use strict";function i(t,e,r){return Uint8Array.prototype.slice?t.slice(e,r):new Uint8Array(Array.prototype.slice.call(t,e,r))}r.r(e),r.d(e,"sliceUint8",(function(){return i}))},"./src/utils/vttcue.ts":
/*!*****************************!*\
  !*** ./src/utils/vttcue.ts ***!
  \*****************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e),e["default"]=function(){if("undefined"!==typeof self&&self.VTTCue)return self.VTTCue;var t=["","lr","rl"],e=["start","middle","end","left","right"];function r(t,e){if("string"!==typeof e)return!1;if(!Array.isArray(t))return!1;var r=e.toLowerCase();return!!~t.indexOf(r)&&r}function i(e){return r(t,e)}function n(t){return r(e,t)}function s(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)t[a]=s[a]}return t}function a(t,e,r){var a=this,o={enumerable:!0};a.hasBeenReset=!1;var l="",u=!1,c=t,d=e,h=r,f=null,g="",v=!0,p="auto",m="start",y=50,E="middle",T=50,S="middle";Object.defineProperty(a,"id",s({},o,{get:function(){return l},set:function(t){l=""+t}})),Object.defineProperty(a,"pauseOnExit",s({},o,{get:function(){return u},set:function(t){u=!!t}})),Object.defineProperty(a,"startTime",s({},o,{get:function(){return c},set:function(t){if("number"!==typeof t)throw new TypeError("Start time must be set to a number.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",s({},o,{get:function(){return d},set:function(t){if("number"!==typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",s({},o,{get:function(){return h},set:function(t){h=""+t,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",s({},o,{get:function(){return f},set:function(t){f=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",s({},o,{get:function(){return g},set:function(t){var e=i(t);if(!1===e)throw new SyntaxError("An invalid or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",s({},o,{get:function(){return v},set:function(t){v=!!t,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",s({},o,{get:function(){return p},set:function(t){if("number"!==typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",s({},o,{get:function(){return m},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",s({},o,{get:function(){return y},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",s({},o,{get:function(){return E},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",s({},o,{get:function(){return T},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");T=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",s({},o,{get:function(){return S},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");S=e,this.hasBeenReset=!0}})),a.displayState=void 0}return a.prototype.getCueAsHTML=function(){var t=self.WebVTT;return t.convertCueToDOMTree(self,this.text)},a}()},"./src/utils/vttparser.ts":
/*!********************************!*\
  !*** ./src/utils/vttparser.ts ***!
  \********************************/
/*! exports provided: parseTimeStamp, fixLineBreaks, VTTParser */function(t,e,r){"use strict";r.r(e),r.d(e,"parseTimeStamp",(function(){return s})),r.d(e,"fixLineBreaks",(function(){return d})),r.d(e,"VTTParser",(function(){return h}));var i=r(/*! ./vttcue */"./src/utils/vttcue.ts"),n=function(){function t(){}var e=t.prototype;return e.decode=function(t,e){if(!t)return"";if("string"!==typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function s(t){function e(t,e,r,i){return 3600*(0|t)+60*(0|e)+(0|r)+parseFloat(i||0)}var r=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?e(r[2],r[3],0,r[4]):e(r[1],r[2],r[3],r[4]):null}var a=function(){function t(){this.values=Object.create(null)}var e=t.prototype;return e.set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},e.get=function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},e.has=function(t){return t in this.values},e.alt=function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},e.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},e.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var r=parseFloat(e);if(r>=0&&r<=100)return this.set(t,r),!0}return!1},t}();function o(t,e,r,i){var n=i?t.split(i):[t];for(var s in n)if("string"===typeof n[s]){var a=n[s].split(r);if(2===a.length){var o=a[0],l=a[1];e(o,l)}}}var l=new i["default"](0,0,""),u="middle"===l.align?"middle":"center";function c(t,e,r){var i=t;function n(){var e=s(t);if(null===e)throw new Error("Malformed timestamp: "+i);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function c(t,e){var i=new a;o(t,(function(t,e){var n;switch(t){case"region":for(var s=r.length-1;s>=0;s--)if(r[s].id===e){i.set(t,r[s].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":n=e.split(","),i.integer(t,n[0]),i.percent(t,n[0])&&i.set("snapToLines",!1),i.alt(t,n[0],["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",u,"end"]);break;case"position":n=e.split(","),i.percent(t,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",u,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start",u,"end","left","right"]);break}}),/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");var n=i.get("line","auto");"auto"===n&&-1===l.line&&(n=-1),e.line=n,e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100),e.align=i.get("align",u);var s=i.get("position","auto");"auto"===s&&50===l.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}function d(){t=t.replace(/^\s+/,"")}if(d(),e.startTime=n(),d(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);t=t.substr(3),d(),e.endTime=n(),d(),c(t,e)}function d(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var h=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new n,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var e=t.prototype;return e.parse=function(t){var e=this;function r(){var t=e.buffer,r=0;t=d(t);while(r<t.length&&"\r"!==t[r]&&"\n"!==t[r])++r;var i=t.substr(0,r);return"\r"===t[r]&&++r,"\n"===t[r]&&++r,e.buffer=t.substr(r),i}function n(t){o(t,(function(t,e){}),/:/)}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var s="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;s=r();var a=s.match(/^()?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}var l=!1;while(e.buffer){if(!/\r\n|\n/.test(e.buffer))return this;switch(l?l=!1:s=r(),e.state){case"HEADER":/:/.test(s)?n(s):s||(e.state="ID");continue;case"NOTE":s||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){e.state="NOTE";break}if(!s)continue;if(e.cue=new i["default"](0,0,""),e.state="CUE",-1===s.indexOf("--\x3e")){e.cue.id=s;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{c(s,e.cue,e.regionList)}catch(h){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var u=-1!==s.indexOf("--\x3e");if(!s||u&&(l=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=s;continue;case"BADCUE":s||(e.state="ID")}}}catch(h){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},e.flush=function(){var t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},t}()},"./src/utils/webvtt-parser.ts":
/*!************************************!*\
  !*** ./src/utils/webvtt-parser.ts ***!
  \************************************/
/*! exports provided: generateCueId, parseWebVTT */function(t,e,r){"use strict";r.r(e),r.d(e,"generateCueId",(function(){return h})),r.d(e,"parseWebVTT",(function(){return g}));var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! ./vttparser */"./src/utils/vttparser.ts"),s=r(/*! ../demux/id3 */"./src/demux/id3.ts"),a=r(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts"),o=r(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),l=/\r\n|\n\r|\n|\r/g,u=function(t,e,r){return void 0===r&&(r=0),t.substr(r,e.length)===e},c=function(t){var e=parseInt(t.substr(-3)),r=parseInt(t.substr(-6,2)),n=parseInt(t.substr(-9,2)),s=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;if(!Object(i["isFiniteNumber"])(e)||!Object(i["isFiniteNumber"])(r)||!Object(i["isFiniteNumber"])(n)||!Object(i["isFiniteNumber"])(s))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*r,e+=6e4*n,e+=36e5*s,e},d=function(t){var e=5381,r=t.length;while(r)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()};function h(t,e,r){return d(t.toString())+d(e.toString())+d(r)}var f=function(t,e,r){var i=t[e],n=t[i.prevCC];if(!n||!n.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);while(null!==(s=n)&&void 0!==s&&s.new){var s;t.ccOffset+=i.start-n.start,i.new=!1,i=n,n=t[i.prevCC]}t.presentationOffset=r};function g(t,e,r,i,d,g,v,p){var m,y=new n["VTTParser"],E=Object(s["utf8ArrayToStr"])(new Uint8Array(t)).trim().replace(l,"\n").split("\n"),T=[],S=Object(a["toMpegTsClockFromTimescale"])(e,r),b="00:00.000",L=0,A=0,D=!0,k=!1;y.oncue=function(t){var e=i[d],r=i.ccOffset,n=(L-S)/9e4;if(null!==e&&void 0!==e&&e.new&&(void 0!==A?r=i.ccOffset=e.start:f(i,d,n)),n&&(r=n-i.presentationOffset),k){var s=t.endTime-t.startTime,a=Object(o["normalizePts"])(9e4*(t.startTime+r-A),9e4*g)/9e4;t.startTime=a,t.endTime=a+s}var l=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(l)),t.id||(t.id=h(t.startTime,t.endTime,l)),t.endTime>0&&T.push(t)},y.onparsingerror=function(t){m=t},y.onflush=function(){m?p(m):v(T)},E.forEach((function(t){if(D){if(u(t,"X-TIMESTAMP-MAP=")){D=!1,k=!0,t.substr(16).split(",").forEach((function(t){u(t,"LOCAL:")?b=t.substr(6):u(t,"MPEGTS:")&&(L=parseInt(t.substr(7)))}));try{A=c(b)/1e3}catch(e){k=!1,m=e}return}""===t&&(D=!1)}y.parse(t+"\n")})),y.flush()}},"./src/utils/xhr-loader.ts":
/*!*********************************!*\
  !*** ./src/utils/xhr-loader.ts ***!
  \*********************************/
/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var i=r(/*! ../utils/logger */"./src/utils/logger.ts"),n=r(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),s=/^age:\s*[\d.]+\s*$/m,a=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new n["LoadStats"],this.retryDelay=0}var e=t.prototype;return e.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},e.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},e.load=function(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.retryDelay=e.retryDelay,this.loadInternal()},e.loadInternal=function(){var t=this.config,e=this.context;if(t){var r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(r,e.url)}catch(o){r.open("GET",e.url,!0),n(r,e.url)}r.readyState||r.open("GET",e.url,!0);var s=this.context.headers;if(s)for(var a in s)r.setRequestHeader(a,s[a])}catch(o){return void this.callbacks.onError({code:r.status,text:o.message},e,r)}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),r.send()}},e.readystatechange=function(){var t=this.context,e=this.loader,r=this.stats;if(t&&e){var n=e.readyState,s=this.config;if(!r.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start)),4===n){e.onreadystatechange=null,e.onprogress=null;var a=e.status;if(a>=200&&a<300){var o,l;if(r.loading.end=Math.max(self.performance.now(),r.loading.first),"arraybuffer"===t.responseType?(o=e.response,l=o.byteLength):(o=e.responseText,l=o.length),r.loaded=r.total=l,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(r,t,o,e),!this.callbacks)return;var c={url:e.responseURL,data:o};this.callbacks.onSuccess(c,r,t,e)}else r.retry>=s.maxRetry||a>=400&&a<499?(i["logger"].error(a+" while loading "+t.url),this.callbacks.onError({code:a,text:e.statusText},t,e)):(i["logger"].warn(a+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),r.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},e.loadtimeout=function(){i["logger"].warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},e.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},e.getCacheAge=function(){var t=null;if(this.loader&&s.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},t}();e["default"]=a}})["default"]}))}}]);||||||| .r0
=======
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["hls"],{"0aa2":function(e,t,r){"undefined"!==typeof window&&function(t,r){e.exports=r()}(0,(function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,r){"use strict";var i=Object.prototype.hasOwnProperty,a="~";function n(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,n){if("function"!==typeof r)throw new TypeError("The listener must be a function");var o=new s(r,i||e,n),l=a?a+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(a=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=a?a+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,n=r.length,s=new Array(n);i<n;i++)s[i]=r[i].fn;return s},u.prototype.listenerCount=function(e){var t=a?a+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,n,s){var o=a?a+e:e;if(!this._events[o])return!1;var l,u,d=this._events[o],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,n),!0;case 6:return d.fn.call(d.context,t,r,i,n,s),!0}for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];d.fn.apply(d.context,l)}else{var h,f=d.length;for(u=0;u<f;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),c){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,r);break;case 4:d[u].fn.call(d[u].context,t,r,i);break;default:if(!l)for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];d[u].fn.apply(d[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var n=a?a+e:e;if(!this._events[n])return this;if(!t)return l(this,n),this;var s=this._events[n];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||l(this,n);else{for(var o=0,u=[],d=s.length;o<d;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[n]=1===u.length?u[0]:u:l(this,n)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=a?a+e:e,this._events[t]&&l(this,t)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=a,u.EventEmitter=u,e.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,r){(function(t){var r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),t=t.trim(),!t){if(!r.alwaysNormalize)return e;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");return a.path=s.normalizePath(a.path),s.buildURLFromParts(a)}var n=s.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return r.alwaysNormalize?(n.path=s.normalizePath(n.path),s.buildURLFromParts(n)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(u.netLoc=o.netLoc,"/"!==n.path[0]))if(n.path){var d=o.path,c=d.substring(0,d.lastIndexOf("/")+1)+n.path;u.path=s.normalizePath(c)}else u.path=o.path,n.params||(u.params=o.params,n.query||(u.query=o.query));return null===u.path&&(u.path=r.alwaysNormalize?s.normalizePath(n.path):n.path),s.buildURLFromParts(u)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){e=e.split("").reverse().join("").replace(a,"");while(e.length!==(e=e.replace(n,"")).length);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s})()},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}var a="[\\.|\\-|\\+|\\w|/|@]+",n="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+a+").*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e){return!isNaN(1*e)}function l(e,t,i){var l={};l[i]=[];var u=t.toString(),d=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return l;var c,h=d[1],f=new RegExp("(\\\\n|\\W)"+s(h)+n,"g");while(c=f.exec(u))"dll-reference"!==c[3]&&l[i].push(c[3]);f=new RegExp("\\("+s(h)+'\\("(dll-reference\\s('+a+'))"\\)\\)'+n,"g");while(c=f.exec(u))e[c[2]]||(l[i].push(c[1]),e[c[2]]=r(c[1]).m),l[c[2]]=l[c[2]]||[],l[c[2]].push(c[4]);for(var g=Object.keys(l),p=0;p<g.length;p++)for(var v=0;v<l[g[p]].length;v++)o(l[g[p]][v])&&(l[g[p]][v]=1*l[g[p]][v]);return l}function u(e){var t=Object.keys(e);return t.reduce((function(t,r){return t||e[r].length>0}),!1)}function d(e,t){var r={main:[t]},i={main:[]},a={main:{}};while(u(r))for(var n=Object.keys(r),s=0;s<n.length;s++){var o=n[s],d=r[o],c=d.pop();if(a[o]=a[o]||{},!a[o][c]&&e[o][c]){a[o][c]=!0,i[o]=i[o]||[],i[o].push(c);for(var h=l(e,e[o][c],o),f=Object.keys(h),g=0;g<f.length;g++)r[f[g]]=r[f[g]]||[],r[f[g]]=r[f[g]].concat(h[f[g]])}}return i}e.exports=function(e,t){t=t||{};var a={main:r.m},n=t.all?{main:Object.keys(a.main)}:d(a,e),s="";Object.keys(n).filter((function(e){return"main"!==e})).forEach((function(e){var t=0;while(n[e][t])t++;n[e].push(t),a[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n[e].map((function(t){return JSON.stringify(t)+": "+a[e][t].toString()})).join(",")+"});\n"})),s=s+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map((function(e){return JSON.stringify(e)+": "+a.main[e].toString()})).join(",")+"}))(self);";var o=new window.Blob([s],{type:"text/javascript"});if(t.bare)return o;var l=window.URL||window.webkitURL||window.mozURL||window.msURL,u=l.createObjectURL(o),c=new window.Worker(u);return c.objectURL=u,c}},"./src/crypt/decrypter.js":
/*!********************************************!*\
  !*** ./src/crypt/decrypter.js + 3 modules ***!
  \********************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(e,t,r){"use strict";r.r(t);var i=function(){function e(e,t){this.subtle=e,this.aesIV=t}var t=e.prototype;return t.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),a=function(){function e(e,t){this.subtle=e,this.key=t}var t=e.prototype;return t.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),n=a;function s(e){var t=e.byteLength,r=t&&new DataView(e).getUint8(t-1);return r?e.slice(0,t-r):e}var o=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},t.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],a=r[1],n=r[2],s=r[3],o=this.invSubMix,l=o[0],u=o[1],d=o[2],c=o[3],h=new Uint32Array(256),f=0,g=0,p=0;for(p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=g^g<<1^g<<2^g<<3^g<<4;v=v>>>8^255&v^99,e[f]=v,t[v]=f;var m=h[f],y=h[m],E=h[y],T=257*h[v]^16843008*v;i[f]=T<<24|T>>>8,a[f]=T<<16|T>>>16,n[f]=T<<8|T>>>24,s[f]=T,T=16843009*E^65537*y^257*m^16843008*f,l[v]=T<<24|T>>>8,u[v]=T<<16|T>>>16,d[v]=T<<8|T>>>24,c[v]=T,f?(f=m^h[h[h[E^m]]],g^=h[h[g]]):f=g=1}},t.expandKey=function(e){var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;while(i<t.length&&r)r=t[i]===this.key[i],i++;if(!r){this.key=t;var a=this.keySize=t.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);var n,s,o,l,u=this.ksRows=4*(a+6+1),d=this.keySchedule=new Uint32Array(u),c=this.invKeySchedule=new Uint32Array(u),h=this.sBox,f=this.rcon,g=this.invSubMix,p=g[0],v=g[1],m=g[2],y=g[3];for(n=0;n<u;n++)n<a?o=d[n]=t[n]:(l=o,n%a===0?(l=l<<8|l>>>24,l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=f[n/a|0]<<24):a>6&&n%a===4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),d[n]=o=(d[n-a]^l)>>>0);for(s=0;s<u;s++)n=u-s,l=3&s?d[n]:d[n-4],c[s]=s<4||n<=4?l:p[h[l>>>24]]^v[h[l>>>16&255]]^m[h[l>>>8&255]]^y[h[255&l]],c[s]=c[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,r,i){var a,n,o,l,u,d,c,h,f,g,p,v,m,y,E=this.keySize+6,T=this.invKeySchedule,S=this.invSBox,b=this.invSubMix,_=b[0],A=b[1],R=b[2],D=b[3],L=this.uint8ArrayToUint32Array_(r),w=L[0],k=L[1],I=L[2],O=L[3],C=new Int32Array(e),P=new Int32Array(C.length),x=this.networkToHostOrderSwap;while(t<C.length){for(f=x(C[t]),g=x(C[t+1]),p=x(C[t+2]),v=x(C[t+3]),u=f^T[0],d=v^T[1],c=p^T[2],h=g^T[3],m=4,y=1;y<E;y++)a=_[u>>>24]^A[d>>16&255]^R[c>>8&255]^D[255&h]^T[m],n=_[d>>>24]^A[c>>16&255]^R[h>>8&255]^D[255&u]^T[m+1],o=_[c>>>24]^A[h>>16&255]^R[u>>8&255]^D[255&d]^T[m+2],l=_[h>>>24]^A[u>>16&255]^R[d>>8&255]^D[255&c]^T[m+3],u=a,d=n,c=o,h=l,m+=4;a=S[u>>>24]<<24^S[d>>16&255]<<16^S[c>>8&255]<<8^S[255&h]^T[m],n=S[d>>>24]<<24^S[c>>16&255]<<16^S[h>>8&255]<<8^S[255&u]^T[m+1],o=S[c>>>24]<<24^S[h>>16&255]<<16^S[u>>8&255]<<8^S[255&d]^T[m+2],l=S[h>>>24]<<24^S[u>>16&255]<<16^S[d>>8&255]<<8^S[255&c]^T[m+3],m+=3,P[t]=x(a^w),P[t+1]=x(l^k),P[t+2]=x(o^I),P[t+3]=x(n^O),w=f,k=g,I=p,O=v,t+=4}return i?s(P.buffer):P.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),l=o,u=r("./src/errors.ts"),d=r("./src/utils/logger.js"),c=r("./src/events.js"),h=r("./src/utils/get-self-scope.js"),f=Object(h["getSelfScope"])(),g=function(){function e(e,t,r){var i=void 0===r?{}:r,a=i.removePKCS7Padding,n=void 0===a||a;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=n,n)try{var s=f.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(o){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,r,a){var s=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(d["logger"].log("JS AES decrypt"),this.logEnabled=!1);var o=this.decryptor;o||(this.decryptor=o=new l),o.expandKey(t),a(o.decrypt(e,0,r,this.removePKCS7Padding))}else{this.logEnabled&&(d["logger"].log("WebCrypto AES decrypt"),this.logEnabled=!1);var u=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new n(u,t)),this.fastAesKey.expandKey().then((function(n){var o=new i(u,r);o.decrypt(e,n).catch((function(i){s.onWebCryptoError(i,e,t,r,a)})).then((function(e){a(e)}))})).catch((function(i){s.onWebCryptoError(i,e,t,r,a)}))}},t.onWebCryptoError=function(e,t,r,i,a){this.config.enableSoftwareAES?(d["logger"].log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,i,a)):(d["logger"].error("decrypting error : "+e.message),this.observer.trigger(c["default"].ERROR,{type:u["ErrorTypes"].MEDIA_ERROR,details:u["ErrorDetails"].FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t["default"]=g},"./src/demux/demuxer-inline.js":
/*!**************************************************!*\
  !*** ./src/demux/demuxer-inline.js + 12 modules ***!
  \**************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number-isFinite.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(e,t,r){"use strict";r.r(t);var i=r("./src/events.js"),a=r("./src/errors.ts"),n=r("./src/crypt/decrypter.js"),s=r("./src/polyfills/number-isFinite.js"),o=r("./src/utils/logger.js"),l=r("./src/utils/get-self-scope.js");function u(e,t,r,n){var s,l,u,d,c,h=navigator.userAgent.toLowerCase(),f=n,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(s=1+((192&t[r+2])>>>6),l=(60&t[r+2])>>>2,!(l>g.length-1))return d=(1&t[r+2])<<2,d|=(192&t[r+3])>>>6,o["logger"].log("manifest codec:"+n+",ADTS data:type:"+s+",sampleingIndex:"+l+"["+g[l]+"Hz],channelConfig:"+d),/firefox/i.test(h)?l>=6?(s=5,c=new Array(4),u=l-3):(s=2,c=new Array(2),u=l):-1!==h.indexOf("android")?(s=2,c=new Array(2),u=l):(s=5,c=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&l>=6?u=l-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(l>=6&&1===d||/vivaldi/i.test(h))||!n&&1===d)&&(s=2,c=new Array(2)),u=l)),c[0]=s<<3,c[0]|=(14&l)>>1,c[1]|=(1&l)<<7,c[1]|=d<<3,5===s&&(c[1]|=(14&u)>>1,c[2]=(1&u)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:g[l],channelCount:d,codec:"mp4a.40."+s,manifestCodec:f};e.trigger(i["default"].ERROR,{type:a["ErrorTypes"].MEDIA_ERROR,details:a["ErrorDetails"].FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l})}function d(e,t){return 255===e[t]&&240===(246&e[t+1])}function c(e,t){return 1&e[t+1]?7:9}function h(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function f(e,t){return!!(t+1<e.length&&d(e,t))}function g(e,t){if(f(e,t)){var r=c(e,t),i=r;t+5<e.length&&(i=h(e,t));var a=t+i;if(a===e.length||a+1<e.length&&d(e,a))return!0}return!1}function p(e,t,r,i,a){if(!e.samplerate){var n=u(t,r,i,a);e.config=n.config,e.samplerate=n.samplerate,e.channelCount=n.channelCount,e.codec=n.codec,e.manifestCodec=n.manifestCodec,o["logger"].log("parsed codec:"+e.codec+",rate:"+n.samplerate+",nb channel:"+n.channelCount)}}function v(e){return 9216e4/e}function m(e,t,r,i,a){var n,s,o,l=e.length;if(n=c(e,t),s=h(e,t),s-=n,s>0&&t+n+s<=l)return o=r+i*a,{headerLength:n,frameLength:s,stamp:o}}function y(e,t,r,i,a){var n=v(e.samplerate),s=m(t,r,i,a,n);if(s){var o=s.stamp,l=s.headerLength,u=s.frameLength,d={unit:t.subarray(r+l,r+l+u),pts:o,dts:o};return e.samples.push(d),{sample:d,length:u+l}}}var E=r("./src/demux/id3.js"),T=function(){function e(e,t,r){this.observer=e,this.config=r,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,r,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:i,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=E["default"].getID3Data(e,0)||[],r=t.length,i=e.length;r<i;r++)if(g(e,r))return o["logger"].log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,r,i){var a=this._audioTrack,n=E["default"].getID3Data(e,0)||[],l=E["default"].getTimeStamp(n),u=Object(s["isFiniteNumber"])(l)?90*l:9e4*t,d=0,c=u,h=e.length,g=n.length,v=[{pts:c,dts:c,data:n}];while(g<h-1)if(f(e,g)&&g+5<h){p(a,this.observer,e,g,a.manifestCodec);var m=y(a,e,g,u,d);if(!m){o["logger"].log("Unable to parse AAC frame");break}g+=m.length,c=m.sample.pts,d++}else E["default"].isHeader(e,g)?(n=E["default"].getID3Data(e,g),v.push({pts:c,dts:c,data:n}),g+=n.length):g++;this.remuxer.remux(a,{samples:[]},{samples:v,inputTimeScale:9e4},{samples:[]},t,r,i)},t.destroy=function(){},e}(),S=T,b=r("./src/demux/mp4demuxer.js"),_={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,i,a){if(!(r+24>t.length)){var n=this.parseHeader(t,r);if(n&&r+n.frameLength<=t.length){var s=9e4*n.samplesPerFrame/n.sampleRate,o=i+a*s,l={unit:t.subarray(r,r+n.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=n.channelCount,e.samplerate=n.sampleRate,e.samples.push(l),{sample:l,length:n.frameLength}}}},parseHeader:function(e,t){var r=e[t+1]>>3&3,i=e[t+1]>>1&3,a=e[t+2]>>4&15,n=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==r&&0!==a&&15!==a&&3!==n){var o=3===r?3-i:3===i?3:4,l=1e3*_.BitratesMap[14*o+a-1],u=3===r?0:2===r?1:2,d=_.SamplingRateMap[3*u+n],c=e[t+3]>>6===3?1:2,h=_.SamplesCoefficients[r][i],f=_.BytesInSlot[i],g=8*h*f,p=parseInt(h*l/d+s,10)*f;return{sampleRate:d,channelCount:c,frameLength:p,samplesPerFrame:g}}},isHeaderPattern:function(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var r=4,i=this.parseHeader(e,t),a=r;i&&i.frameLength&&(a=i.frameLength);var n=t+a;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}},A=_,R=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");i.set(e.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&o["logger"].error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){var t,r,i=8,a=8;for(t=0;t<e;t++)0!==a&&(r=this.readEG(),a=(i+r+256)%256),i=0===a?i:a},t.readSPS=function(){var e,t,r,i,a,n,s,o=0,l=0,u=0,d=0,c=this.readUByte.bind(this),h=this.readBits.bind(this),f=this.readUEG.bind(this),g=this.readBoolean.bind(this),p=this.skipBits.bind(this),v=this.skipEG.bind(this),m=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(c(),e=c(),h(5),p(3),c(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var E=f();if(3===E&&p(1),m(),m(),p(1),g())for(n=3!==E?8:12,s=0;s<n;s++)g()&&y(s<6?16:64)}m();var T=f();if(0===T)f();else if(1===T)for(p(1),v(),v(),t=f(),s=0;s<t;s++)v();m(),p(1),r=f(),i=f(),a=h(1),0===a&&p(1),p(1),g()&&(o=f(),l=f(),u=f(),d=f());var S=[1,1];if(g()&&g()){var b=c();switch(b){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil(16*(r+1)-2*o-2*l),height:(2-a)*(i+1)*16-(a?2:4)*(u+d),pixelRatio:S}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),D=R,L=function(){function e(e,t,r,i){this.decryptdata=r,this.discardEPB=i,this.decrypter=new n["default"](e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(e,t,r,i){var a=e[t].unit,n=a.subarray(16,a.length-a.length%16),s=n.buffer.slice(n.byteOffset,n.byteOffset+n.length),o=this;this.decryptBuffer(s,(function(n){n=new Uint8Array(n),a.set(n,16),i||o.decryptAacSamples(e,t+1,r)}))},t.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,i),!i)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,a=32;a<=e.length-16;a+=160,i+=16)r.set(e.subarray(a,a+16),i);return r},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var r=0,i=32;i<=e.length-16;i+=160,r+=16)e.set(t.subarray(r,r+16),i);return e},t.decryptAvcSample=function(e,t,r,i,a,n){var s=this.discardEPB(a.data),o=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(o.buffer,(function(o){a.data=l.getAvcDecryptedUnit(s,o),n||l.decryptAvcSamples(e,t,r+1,i)}))},t.decryptAvcSamples=function(e,t,r,i){for(;;t++,r=0){if(t>=e.length)return void i();for(var a=e[t].units;;r++){if(r>=a.length)break;var n=a[r];if(!(n.length<=48||1!==n.type&&5!==n.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,i,n,s),!s)return}}}},e}(),w=L,k={video:1,audio:2,id3:3,text:4},I=function(){function e(e,t,r,i){this.observer=e,this.config=r,this.typeSupported=i,this.remuxer=t,this.sampleAes=null}var t=e.prototype;return t.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new w(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var r=e._syncOffset(t);return!(r<0)&&(r&&o["logger"].warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),!0)},e._syncOffset=function(e){var t=Math.min(1e3,e.length-564),r=0;while(r<t){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:k[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},t.resetInitSegment=function(t,r,i,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",a),this._audioTrack=e.createTrack("audio",a),this._id3Track=e.createTrack("id3",a),this._txtTrack=e.createTrack("text",a),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=i,this._duration=a},t.resetTimeStamp=function(){},t.append=function(t,r,n,s){var l,u,d,c,h,f,g=t.length,p=!1;this.contiguous=n;var v=this.pmtParsed,m=this._avcTrack,y=this._audioTrack,E=this._id3Track,T=m.pid,S=y.pid,b=E.pid,_=this._pmtId,A=m.pesData,R=y.pesData,D=E.pesData,L=this._parsePAT,w=this._parsePMT,k=this._parsePES,I=this._parseAVCPES.bind(this),O=this._parseAACPES.bind(this),C=this._parseMPEGPES.bind(this),P=this._parseID3PES.bind(this),x=e._syncOffset(t);for(g-=(g+x)%188,l=x;l<g;l+=188)if(71===t[l]){if(u=!!(64&t[l+1]),d=((31&t[l+1])<<8)+t[l+2],c=(48&t[l+3])>>4,c>1){if(h=l+5+t[l+4],h===l+188)continue}else h=l+4;switch(d){case T:u&&(A&&(f=k(A))&&I(f,!1),A={data:[],size:0}),A&&(A.data.push(t.subarray(h,l+188)),A.size+=l+188-h);break;case S:u&&(R&&(f=k(R))&&(y.isAAC?O(f):C(f)),R={data:[],size:0}),R&&(R.data.push(t.subarray(h,l+188)),R.size+=l+188-h);break;case b:u&&(D&&(f=k(D))&&P(f),D={data:[],size:0}),D&&(D.data.push(t.subarray(h,l+188)),D.size+=l+188-h);break;case 0:u&&(h+=t[h]+1),_=this._pmtId=L(t,h);break;case _:u&&(h+=t[h]+1);var F=w(t,h,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);T=F.avc,T>0&&(m.pid=T),S=F.audio,S>0&&(y.pid=S,y.isAAC=F.isAAC),b=F.id3,b>0&&(E.pid=b),p&&!v&&(o["logger"].log("reparse from beginning"),p=!1,l=x-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0;break}}else this.observer.trigger(i["default"].ERROR,{type:a["ErrorTypes"].MEDIA_ERROR,details:a["ErrorDetails"].FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});A&&(f=k(A))?(I(f,!0),m.pesData=null):m.pesData=A,R&&(f=k(R))?(y.isAAC?O(f):C(f),y.pesData=null):(R&&R.size&&o["logger"].log("last AAC PES packet truncated,might overlap between fragments"),y.pesData=R),D&&(f=k(D))?(P(f),E.pesData=null):E.pesData=D,null==this.sampleAes?this.remuxer.remux(y,m,E,this._txtTrack,r,n,s):this.decryptAndRemux(y,m,E,this._txtTrack,r,n,s)},t.decryptAndRemux=function(e,t,r,i,a,n,s){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,(function(){o.decryptAndRemuxAvc(e,t,r,i,a,n,s)}))}else this.decryptAndRemuxAvc(e,t,r,i,a,n,s)},t.decryptAndRemuxAvc=function(e,t,r,i,a,n,s){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,(function(){o.remuxer.remux(e,t,r,i,a,n,s)}))}else this.remuxer.remux(e,t,r,i,a,n,s)},t.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._parsePMT=function(e,t,r,i){var a,n,s,l,u={audio:-1,avc:-1,id3:-1,isAAC:!0};a=(15&e[t+1])<<8|e[t+2],n=t+3+a-4,s=(15&e[t+10])<<8|e[t+11],t+=12+s;while(t<n){switch(l=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!i){o["logger"].log("unknown stream type:"+e[t]);break}case 15:-1===u.audio&&(u.audio=l);break;case 21:-1===u.id3&&(u.id3=l);break;case 219:if(!i){o["logger"].log("unknown stream type:"+e[t]);break}case 27:-1===u.avc&&(u.avc=l);break;case 3:case 4:r?-1===u.audio&&(u.audio=l,u.isAAC=!1):o["logger"].log("MPEG audio found, not supported in this browser for now");break;case 36:o["logger"].warn("HEVC stream type found, not supported for now");break;default:o["logger"].log("unknown stream type:"+e[t]);break}t+=5+((15&e[t+3])<<8|e[t+4])}return u},t._parsePES=function(e){var t,r,i,a,n,s,l,u,d,c=0,h=e.data;if(!e||0===e.size)return null;while(h[0].length<19&&h.length>1){var f=new Uint8Array(h[0].length+h[1].length);f.set(h[0]),f.set(h[1],h[0].length),h[0]=f,h.splice(1,1)}if(t=h[0],i=(t[0]<<16)+(t[1]<<8)+t[2],1===i){if(a=(t[4]<<8)+t[5],a&&a>e.size-6)return null;if(r=t[7],192&r&&(l=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,l>4294967295&&(l-=8589934592),64&r?(u=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,u>4294967295&&(u-=8589934592),l-u>54e5&&(o["logger"].warn(Math.round((l-u)/9e4)+"s delta between PTS and DTS, align them"),l=u)):u=l),n=t[8],d=n+9,e.size<=d)return null;e.size-=d,s=new Uint8Array(e.size);for(var g=0,p=h.length;g<p;g++){t=h[g];var v=t.byteLength;if(d){if(d>v){d-=v;continue}t=t.subarray(d),v-=d,d=0}s.set(t,c),c+=v}return a&&(a-=n+3),{data:s,pts:l,dts:u,len:a}}return null},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var r=t.samples,i=r.length;if(isNaN(e.pts)){if(!i)return void t.dropped++;var a=r[i-1];e.pts=a.pts,e.dts=a.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(i||this.contiguous)?(e.id=i,r.push(e)):t.dropped++}e.debug.length&&o["logger"].log(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){var r,i,a,n=this,s=this._avcTrack,o=this._parseAVCNALu(e.data),l=!1,u=this.avcSample,d=!1,c=this.pushAccesUnit.bind(this),h=function(e,t,r,i){return{key:e,pts:t,dts:r,units:[],debug:i}};e.data=null,u&&o.length&&!s.audFound&&(c(u,s),u=this.avcSample=h(!1,e.pts,e.dts,"")),o.forEach((function(t){switch(t.type){case 1:i=!0,u||(u=n.avcSample=h(!0,e.pts,e.dts,"")),l&&(u.debug+="NDR "),u.frame=!0;var o=t.data;if(d&&o.length>4){var f=new D(o).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(u.key=!0)}break;case 5:i=!0,u||(u=n.avcSample=h(!0,e.pts,e.dts,"")),l&&(u.debug+="IDR "),u.key=!0,u.frame=!0;break;case 6:i=!0,l&&u&&(u.debug+="SEI "),r=new D(n.discardEPB(t.data)),r.readUByte();var g=0,p=0,v=!1,m=0;while(!v&&r.bytesAvailable>1){g=0;do{m=r.readUByte(),g+=m}while(255===m);p=0;do{m=r.readUByte(),p+=m}while(255===m);if(4===g&&0!==r.bytesAvailable){v=!0;var y=r.readUByte();if(181===y){var T=r.readUShort();if(49===T){var S=r.readUInt();if(1195456820===S){var b=r.readUByte();if(3===b){var _=r.readUByte(),A=r.readUByte(),R=31&_,L=[_,A];for(a=0;a<R;a++)L.push(r.readUByte()),L.push(r.readUByte()),L.push(r.readUByte());n._insertSampleInOrder(n._txtTrack.samples,{type:3,pts:e.pts,bytes:L})}}}}}else if(5===g&&0!==r.bytesAvailable){if(v=!0,p>16){var w=[];for(a=0;a<16;a++)w.push(r.readUByte().toString(16)),3!==a&&5!==a&&7!==a&&9!==a||w.push("-");var k=p-16,I=new Uint8Array(k);for(a=0;a<k;a++)I[a]=r.readUByte();n._insertSampleInOrder(n._txtTrack.samples,{pts:e.pts,payloadType:g,uuid:w.join(""),userDataBytes:I,userData:Object(E["utf8ArrayToStr"])(I.buffer)})}}else if(p<r.bytesAvailable)for(a=0;a<p;a++)r.readUByte()}break;case 7:if(i=!0,d=!0,l&&u&&(u.debug+="SPS "),!s.sps){r=new D(t.data);var O=r.readSPS();s.width=O.width,s.height=O.height,s.pixelRatio=O.pixelRatio,s.sps=[t.data],s.duration=n._duration;var C=t.data.subarray(1,4),P="avc1.";for(a=0;a<3;a++){var x=C[a].toString(16);x.length<2&&(x="0"+x),P+=x}s.codec=P}break;case 8:i=!0,l&&u&&(u.debug+="PPS "),s.pps||(s.pps=[t.data]);break;case 9:i=!1,s.audFound=!0,u&&c(u,s),u=n.avcSample=h(!1,e.pts,e.dts,l?"AUD ":"");break;case 12:i=!1;break;default:i=!1,u&&(u.debug+="unknown NAL "+t.type+" ");break}if(u&&i){var F=u.units;F.push(t)}})),t&&u&&(c(u,s),this.avcSample=null)},t._insertSampleInOrder=function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var i=r-1;i>=0;i--)if(t.pts<e[i].pts){e.splice(i,0,t);break}}else e.push(t)},t._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var r=this._avcTrack,i=r.samples;t=i[i.length-1]}if(t){var a=t.units;e=a[a.length-1]}return e},t._parseAVCNALu=function(e){var t,r,i,a,n,s=0,o=e.byteLength,l=this._avcTrack,u=l.naluState||0,d=u,c=[],h=-1;-1===u&&(h=0,n=31&e[0],u=0,s=1);while(s<o)if(t=e[s++],u)if(1!==u)if(t)if(1===t){if(h>=0)i={data:e.subarray(h,s-u-1),type:n},c.push(i);else{var f=this._getLastNalUnit();if(f&&(d&&s<=4-d&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-d)),r=s-u-1,r>0)){var g=new Uint8Array(f.data.byteLength+r);g.set(f.data,0),g.set(e.subarray(0,r),f.data.byteLength),f.data=g}}s<o?(a=31&e[s],h=s,n=a,u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(h>=0&&u>=0&&(i={data:e.subarray(h,o),type:n,state:u},c.push(i)),0===c.length){var p=this._getLastNalUnit();if(p){var v=new Uint8Array(p.data.byteLength+e.byteLength);v.set(p.data,0),v.set(e,p.data.byteLength),p.data=v}}return l.naluState=u,c},t.discardEPB=function(e){var t,r,i=e.byteLength,a=[],n=1;while(n<i-2)0===e[n]&&0===e[n+1]&&3===e[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return e;t=i-a.length,r=new Uint8Array(t);var s=0;for(n=0;n<t;s++,n++)s===a[0]&&(s++,a.shift()),r[n]=e[s];return r},t._parseAACPES=function(e){var t,r,n,s,l,u,d,c=this._audioTrack,h=e.data,g=e.pts,m=0,E=this.aacOverFlow,T=this.aacLastPTS;if(E){var S=new Uint8Array(E.byteLength+h.byteLength);S.set(E,0),S.set(h,E.byteLength),h=S}for(n=m,l=h.length;n<l-1;n++)if(f(h,n))break;if(n&&(n<l-1?(u="AAC PES did not start with ADTS header,offset:"+n,d=!1):(u="no ADTS header found in AAC PES",d=!0),o["logger"].warn("parsing error:"+u),this.observer.trigger(i["default"].ERROR,{type:a["ErrorTypes"].MEDIA_ERROR,details:a["ErrorDetails"].FRAG_PARSING_ERROR,fatal:d,reason:u}),d))return;if(p(c,this.observer,h,n,this.audioCodec),r=0,t=v(c.samplerate),E&&T){var b=T+t;Math.abs(b-g)>1&&(o["logger"].log("AAC: align PTS for overlapping frames by "+Math.round((b-g)/90)),g=b)}while(n<l){if(f(h,n)){if(n+5<l){var _=y(c,h,n,g,r);if(_){n+=_.length,s=_.sample.pts,r++;continue}}break}n++}E=n<l?h.subarray(n,l):null,this.aacOverFlow=E,this.aacLastPTS=s},t._parseMPEGPES=function(e){var t=e.data,r=t.length,i=0,a=0,n=e.pts;while(a<r)if(A.isHeader(t,a)){var s=A.appendFrame(this._audioTrack,t,a,n,i);if(!s)break;a+=s.length,i++}else a++},t._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),O=I,C=function(){function e(e,t,r){this.observer=e,this.config=r,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,r,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:i,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,r,i=E["default"].getID3Data(e,0);if(i&&void 0!==E["default"].getTimeStamp(i))for(t=i.length,r=Math.min(e.length-1,t+100);t<r;t++)if(A.probe(e,t))return o["logger"].log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,r,i){var a=E["default"].getID3Data(e,0),n=E["default"].getTimeStamp(a),s=n?90*n:9e4*t,o=a.length,l=e.length,u=0,d=0,c=this._audioTrack,h=[{pts:s,dts:s,data:a}];while(o<l)if(A.isHeader(e,o)){var f=A.appendFrame(c,e,o,s,u);if(!f)break;o+=f.length,d=f.sample.pts,u++}else E["default"].isHeader(e,o)?(a=E["default"].getID3Data(e,o),h.push({pts:d,dts:d,data:a}),o+=a.length):o++;this.remuxer.remux(c,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},t,r,i)},t.destroy=function(){},e}(),P=C,x=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}return null},e}(),F=x,M=Math.pow(2,32)-1,N=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=n,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,a))},e.box=function(e){var t,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;while(a--)i+=r[a].byteLength;for(t=new Uint8Array(i),t[0]=i>>24&255,t[1]=i>>16&255,t[2]=i>>8&255,t[3]=255&i,t.set(e,4),a=0,i=8;a<n;a++)t.set(r[a],i),i+=r[a].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,r){r*=t;var i=Math.floor(r/(M+1)),a=Math.floor(r%(M+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))},e.moov=function(t){var r=t.length,i=[];while(r--)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))},e.mvex=function(t){var r=t.length,i=[];while(r--)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))},e.mvhd=function(t,r){r*=t;var i=Math.floor(r/(M+1)),a=Math.floor(r%(M+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,n)},e.sdtp=function(t){var r,i,a=t.samples||[],n=new Uint8Array(4+a.length);for(i=0;i<a.length;i++)r=a[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,n)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var r,i,a,n=[],s=[];for(r=0;r<t.sps.length;r++)i=t.sps[r],a=i.byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)i=t.pps[r],a=i.byteLength,s.push(a>>>8&255),s.push(255&a),s=s.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,d=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,c>>24,c>>16&255,c>>8&255,255&c])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var r=t.id,i=t.duration*t.timescale,a=t.width,n=t.height,s=Math.floor(i/(M+1)),o=Math.floor(i%(M+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,n>>8&255,255&n,0,0]))},e.traf=function(t,r){var i=e.sdtp(t),a=t.id,n=Math.floor(r/(M+1)),s=Math.floor(r%(M+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,i.length+16+20+8+16+8+8),i)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,r){var i,a,n,s,o,l,u=t.samples||[],d=u.length,c=12+16*d,h=new Uint8Array(c);for(r+=8+c,h.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<d;i++)a=u[i],n=a.duration,s=a.size,o=a.flags,l=a.cts,h.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var r,i=e.moov(t);return r=new Uint8Array(e.FTYP.byteLength+i.byteLength),r.set(e.FTYP),r.set(i,e.FTYP.byteLength),r},e}(),U=N,B=9e4;function G(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var a=e*t*r;return i?Math.round(a):a}function K(e,t){return void 0===t&&(t=!1),G(e,1e3,1/B,t)}function j(e,t){return void 0===t&&(t=1),G(e,B,1/t)}var H,V=j(10),W=j(.2),Y=function(){function e(e,t,r,i){this.observer=e,this.config=t,this.typeSupported=r;var a=navigator.userAgent;this.isSafari=i&&i.indexOf("Apple")>-1&&a&&!a.match("CriOS"),this.ISGenerated=!1}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.remux=function(e,t,r,a,n,s,l){if(this.ISGenerated||this.generateIS(e,t,n),this.ISGenerated){var u=e.samples.length,d=t.samples.length,c=n,h=n;if(u&&d){var f=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;c+=Math.max(0,f),h+=Math.max(0,-f)}if(u){e.timescale||(o["logger"].warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,n));var g,p=this.remuxAudio(e,c,s,l);if(d)p&&(g=p.endPTS-p.startPTS),t.timescale||(o["logger"].warn("regenerate InitSegment as video detected"),this.generateIS(e,t,n)),this.remuxVideo(t,h,s,g,l)}else if(d){var v=this.remuxVideo(t,h,s,0,l);v&&e.codec&&this.remuxEmptyAudio(e,c,s,v)}}r.samples.length&&this.remuxID3(r,n),a.samples.length&&this.remuxText(a,n),this.observer.trigger(i["default"].FRAG_PARSED)},t.generateIS=function(e,t,r){var n,s,l=this.observer,u=e.samples,d=t.samples,c=this.typeSupported,h="audio/mp4",f={},g={tracks:f},p=void 0===this._initPTS;if(p&&(n=s=1/0),e.config&&u.length&&(e.timescale=e.samplerate,o["logger"].log("audio sampling rate : "+e.samplerate),e.isAAC||(c.mpeg?(h="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3")),f.audio={container:h,codec:e.codec,initSegment:!e.isAAC&&c.mpeg?new Uint8Array:U.initSegment([e]),metadata:{channelCount:e.channelCount}},p&&(n=s=u[0].pts-e.inputTimeScale*r)),t.sps&&t.pps&&d.length){var v=t.inputTimeScale;t.timescale=v,f.video={container:"video/mp4",codec:t.codec,initSegment:U.initSegment([t]),metadata:{width:t.width,height:t.height}},p&&(n=Math.min(n,d[0].pts-v*r),s=Math.min(s,d[0].dts-v*r),this.observer.trigger(i["default"].INIT_PTS_FOUND,{initPTS:n}))}Object.keys(f).length?(l.trigger(i["default"].FRAG_PARSING_INIT_SEGMENT,g),this.ISGenerated=!0,p&&(this._initPTS=n,this._initDTS=s)):l.trigger(i["default"].ERROR,{type:a["ErrorTypes"].MEDIA_ERROR,details:a["ErrorDetails"].FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,r,n,s){var l,u,d,c,h,f,g,p=8,v=e.timescale,m=e.samples,y=[],E=m.length,T=this._PTSNormalize,S=this._initPTS,b=this.nextAvcDts,_=this.isSafari;if(0!==E){_&&(r|=m.length&&b&&(s&&Math.abs(t-b/v)<.1||Math.abs(m[0].pts-b-S)<v/5)),r||(b=t*v),m.forEach((function(e){e.pts=T(e.pts-S,b),e.dts=T(e.dts-S,b)})),m.sort((function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i||e.id-t.id}));var A=m.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-1*W)}),0);if(A<0){o["logger"].warn("PTS < DTS detected in video samples, shifting DTS by "+K(A,!0)+" ms to overcome this issue");for(var R=0;R<m.length;R++)m[R].dts+=A}var D=m[0];h=Math.max(D.dts,0),c=Math.max(D.pts,0);var L=h-b;r&&L&&(L>1?o["logger"].log("AVC: "+K(L,!0)+" ms hole between fragments detected,filling it"):L<-1&&o["logger"].log("AVC: "+K(-L,!0)+" ms overlapping between fragments detected"),h=b,m[0].dts=h,c=Math.max(c-L,b),m[0].pts=c,o["logger"].log("Video: PTS/DTS adjusted: "+K(c,!0)+"/"+K(h,!0)+", delta: "+K(L,!0)+" ms")),D=m[m.length-1],g=Math.max(D.dts,0),f=Math.max(D.pts,0,g),_&&(l=Math.round((g-h)/(m.length-1)));for(var w=0,k=0,I=0;I<E;I++){for(var O=m[I],C=O.units,P=C.length,x=0,F=0;F<P;F++)x+=C[F].data.length;k+=x,w+=P,O.length=x,O.dts=_?h+I*l:Math.max(O.dts,h),O.pts=Math.max(O.pts,O.dts)}var M=k+4*w+8;try{u=new Uint8Array(M)}catch(ne){return void this.observer.trigger(i["default"].ERROR,{type:a["ErrorTypes"].MUX_ERROR,details:a["ErrorDetails"].REMUX_ALLOC_ERROR,fatal:!1,bytes:M,reason:"fail allocating video mdat "+M})}var N=new DataView(u.buffer);N.setUint32(0,M),u.set(U.types.mdat,4);for(var B=0;B<E;B++){for(var G=m[B],j=G.units,H=0,V=void 0,Y=0,q=j.length;Y<q;Y++){var z=j[Y],X=z.data,Q=z.data.byteLength;N.setUint32(p,Q),p+=4,u.set(X,p),p+=Q,H+=4+Q}if(_)V=Math.max(0,l*Math.round((G.pts-G.dts)/l));else{if(B<E-1)l=m[B+1].dts-G.dts;else{var J=this.config,$=G.dts-m[B>0?B-1:B].dts;if(J.stretchShortVideoTrack){var Z=J.maxBufferHole,ee=Math.floor(Z*v),te=(n?c+n*v:this.nextAudioPts)-G.pts;te>ee?(l=te-$,l<0&&(l=$),o["logger"].log("It is approximately "+K(te,!1)+" ms to the next segment; using duration "+K(l,!1)+" ms for the last video frame.")):l=$}else l=$}V=Math.round(G.pts-G.dts)}y.push({size:H,duration:l,cts:V,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:G.key?2:1,isNonSync:G.key?0:1}})}this.nextAvcDts=g+l;var re=e.dropped;if(e.nbNalu=0,e.dropped=0,y.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ie=y[0].flags;ie.dependsOn=2,ie.isNonSync=0}e.samples=y,d=U.moof(e.sequenceNumber++,h,e),e.samples=[];var ae={data1:d,data2:u,startPTS:c/v,endPTS:(f+l)/v,startDTS:h/v,endDTS:this.nextAvcDts/v,type:"video",hasAudio:!1,hasVideo:!0,nb:y.length,dropped:re};return this.observer.trigger(i["default"].FRAG_PARSING_DATA,ae),ae}},t.remuxAudio=function(e,t,r,n){var s,l,u,d,c,h,f=e.inputTimeScale,g=e.timescale,p=f/g,v=e.isAAC?1024:1152,m=v*p,y=this._PTSNormalize,E=this._initPTS,T=!e.isAAC&&this.typeSupported.mpeg,S=T?0:8,b=e.samples,_=[],A=this.nextAudioPts;if(r|=b.length&&A&&(n&&Math.abs(t-A/f)<.1||Math.abs(b[0].pts-A-E)<20*m),b.forEach((function(e){e.pts=e.dts=y(e.pts-E,t*f)})),b=b.filter((function(e){return e.pts>=0})),0!==b.length){if(r||(A=n?t*f:b[0].pts),e.isAAC)for(var R=this.config.maxAudioFramesDrift,D=0,L=A;D<b.length;){var w,k=b[D],I=k.pts;if(w=I-L,w<=-R*m)o["logger"].warn("Dropping 1 audio frame @ "+K(L,!0)+" ms due to "+K(w,!0)+" ms overlap."),b.splice(D,1);else if(w>=R*m&&w<V&&L){var O=Math.round(w/m);o["logger"].warn("Injecting "+O+" audio frames @ "+K(L,!0)+" ms due to "+K(L,!0)+" ms gap.");for(var C=0;C<O;C++){var P=Math.max(L,0);l=F.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),l||(o["logger"].log("Unable to get silent frame for given audio codec; duplicating last frame instead."),l=k.unit.subarray()),b.splice(D,0,{unit:l,pts:P,dts:P}),L+=m,D++}k.pts=k.dts=L,L+=m,D++}else Math.abs(w),k.pts=k.dts=L,L+=m,D++}var x=b.length,M=0;while(x--)M+=b[x].unit.byteLength;for(var N=0,B=b.length;N<B;N++){var G=b[N],j=G.unit,H=G.pts;if(void 0!==h)s.duration=Math.round((H-h)/p);else{var W=H-A,Y=0;if(r&&e.isAAC&&W){if(W>0&&W<V)Y=Math.round((H-A)/m),o["logger"].log(K(W,!0)+" ms hole between AAC samples detected,filling it"),Y>0&&(l=F.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),l||(l=j.subarray()),M+=Y*l.length);else if(W<-12){o["logger"].log("drop overlapping AAC sample, expected/parsed/delta: "+K(A,!0)+" ms / "+K(H,!0)+" ms / "+K(-W,!0)+" ms"),M-=j.byteLength;continue}H=A}if(c=H,!(M>0))return;M+=S;try{u=new Uint8Array(M)}catch(ee){return void this.observer.trigger(i["default"].ERROR,{type:a["ErrorTypes"].MUX_ERROR,details:a["ErrorDetails"].REMUX_ALLOC_ERROR,fatal:!1,bytes:M,reason:"fail allocating audio mdat "+M})}if(!T){var q=new DataView(u.buffer);q.setUint32(0,M),u.set(U.types.mdat,4)}for(var z=0;z<Y;z++)l=F.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),l||(o["logger"].log("Unable to get silent frame for given audio codec; duplicating this frame instead."),l=j.subarray()),u.set(l,S),S+=l.byteLength,s={size:l.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},_.push(s)}u.set(j,S);var X=j.byteLength;S+=X,s={size:X,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},_.push(s),h=H}var Q=0;if(x=_.length,x>=2&&(Q=_[x-2].duration,s.duration=Q),x){this.nextAudioPts=A=h+p*Q,e.samples=_,d=T?new Uint8Array:U.moof(e.sequenceNumber++,c/p,e),e.samples=[];var J=c/f,$=A/f,Z={data1:d,data2:u,startPTS:J,endPTS:$,startDTS:J,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:x};return this.observer.trigger(i["default"].FRAG_PARSING_DATA,Z),Z}return null}},t.remuxEmptyAudio=function(e,t,r,i){var a=e.inputTimeScale,n=e.samplerate?e.samplerate:a,s=a/n,l=this.nextAudioPts,u=(void 0!==l?l:i.startDTS*a)+this._initDTS,d=i.endDTS*a+this._initDTS,c=1024,h=s*c,f=Math.ceil((d-u)/h),g=F.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(o["logger"].warn("remux empty Audio"),g){for(var p=[],v=0;v<f;v++){var m=u+v*h;p.push({unit:g,pts:m,dts:m})}e.samples=p,this.remuxAudio(e,t,r)}else o["logger"].trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e){var t,r=e.samples.length,a=e.inputTimeScale,n=this._initPTS,s=this._initDTS;if(r){for(var o=0;o<r;o++)t=e.samples[o],t.pts=(t.pts-n)/a,t.dts=(t.dts-s)/a;this.observer.trigger(i["default"].FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},t.remuxText=function(e){e.samples.sort((function(e,t){return e.pts-t.pts}));var t,r=e.samples.length,a=e.inputTimeScale,n=this._initPTS;if(r){for(var s=0;s<r;s++)t=e.samples[s],t.pts=(t.pts-n)/a;this.observer.trigger(i["default"].FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},t._PTSNormalize=function(e,t){var r;if(void 0===t)return e;r=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=r;return e},e}(),q=Y,z=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,r,a,n,s,o,l){var u=this.observer,d="";e&&(d+="audio"),t&&(d+="video"),u.trigger(i["default"].FRAG_PARSING_DATA,{data1:l,startPTS:n,startDTS:n,type:d,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),u.trigger(i["default"].FRAG_PARSED)},e}(),X=z,Q=Object(l["getSelfScope"])();try{H=Q.performance.now.bind(Q.performance)}catch($){o["logger"].debug("Unable to use Performance API on this environment"),H=Q.Date.now}var J=function(){function e(e,t,r,i){this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,t,r,a,s,o,l,u,d,c,h,f){var g=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var p=this.decrypter;null==p&&(p=this.decrypter=new n["default"](this.observer,this.config));var v=H();p.decrypt(e,t.key.buffer,t.iv.buffer,(function(e){var n=H();g.observer.trigger(i["default"].FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:n}}),g.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),a,s,o,l,u,d,c,h,f)}))}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),a,s,o,l,u,d,c,h,f)},t.pushDecrypted=function(e,t,r,n,s,o,l,u,d,c,h,f){var g=this.demuxer;if(!g||(l||u)&&!this.probe(e)){for(var p=this.observer,v=this.typeSupported,m=this.config,y=[{demux:O,remux:q},{demux:b["default"],remux:X},{demux:S,remux:q},{demux:P,remux:q}],E=0,T=y.length;E<T;E++){var _=y[E],A=_.demux.probe;if(A(e)){var R=this.remuxer=new _.remux(p,m,v,this.vendor);g=new _.demux(p,R,m,v),this.probe=A;break}}if(!g)return void p.trigger(i["default"].ERROR,{type:a["ErrorTypes"].MEDIA_ERROR,details:a["ErrorDetails"].FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=g}var D=this.remuxer;(l||u)&&(g.resetInitSegment(r,n,s,c),D.resetInitSegment()),l&&(g.resetTimeStamp(f),D.resetTimeStamp(f)),"function"===typeof g.setDecryptData&&g.setDecryptData(t),g.append(e,o,d,h)},e}();t["default"]=J},"./src/demux/demuxer-worker.js":
/*!*************************************!*\
  !*** ./src/demux/demuxer-worker.js ***!
  \*************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/demux/demuxer.js (referenced with require.resolve) */function(e,t,r){"use strict";r.r(t);var i=r(/*! ../demux/demuxer-inline */"./src/demux/demuxer-inline.js"),a=r(/*! ../events */"./src/events.js"),n=r(/*! ../utils/logger */"./src/utils/logger.js"),s=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),o=function(e){var t=new s["EventEmitter"];t.trigger=function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.emit.apply(t,[e,e].concat(i))},t.off=function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.removeListener.apply(t,[e].concat(i))};var r=function(t,r){e.postMessage({event:t,data:r})};e.addEventListener("message",(function(a){var s=a.data;switch(s.cmd){case"init":var o=JSON.parse(s.config);e.demuxer=new i["default"](t,s.typeSupported,o,s.vendor),Object(n["enableLogs"])(o.debug),r("init",null);break;case"demux":e.demuxer.push(s.data,s.decryptdata,s.initSegment,s.audioCodec,s.videoCodec,s.timeOffset,s.discontinuity,s.trackSwitch,s.contiguous,s.duration,s.accurateTimeOffset,s.defaultInitPTS);break;default:break}})),t.on(a["default"].FRAG_DECRYPTED,r),t.on(a["default"].FRAG_PARSING_INIT_SEGMENT,r),t.on(a["default"].FRAG_PARSED,r),t.on(a["default"].ERROR,r),t.on(a["default"].FRAG_PARSING_METADATA,r),t.on(a["default"].FRAG_PARSING_USERDATA,r),t.on(a["default"].INIT_PTS_FOUND,r),t.on(a["default"].FRAG_PARSING_DATA,(function(t,r){var i=[],a={event:t,data:r};r.data1&&(a.data1=r.data1.buffer,i.push(r.data1.buffer),delete r.data1),r.data2&&(a.data2=r.data2.buffer,i.push(r.data2.buffer),delete r.data2),e.postMessage(a,i)}))};t["default"]=o},"./src/demux/id3.js":
/*!**************************!*\
  !*** ./src/demux/id3.js ***!
  \**************************/
/*! exports provided: default, utf8ArrayToStr */function(e,t,r){"use strict";r.r(t),r.d(t,"utf8ArrayToStr",(function(){return o}));var i,a=r(/*! ../utils/get-self-scope */"./src/utils/get-self-scope.js"),n=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,r){var i=r,a=0;while(e.isHeader(t,r)){a+=10;var n=e._readSize(t,r+6);a+=n,e.isFooter(t,r+10)&&(a+=10),r+=a}if(a>0)return t.subarray(i,i+a)},e._readSize=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3],r},e.getTimeStamp=function(t){for(var r=e.getID3Frames(t),i=0;i<r.length;i++){var a=r[i];if(e.isTimeStampFrame(a))return e._readTimeStamp(a)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var r=String.fromCharCode(t[0],t[1],t[2],t[3]),i=e._readSize(t,4),a=10;return{type:r,size:i,data:t.subarray(a,a+i)}},e.getID3Frames=function(t){var r=0,i=[];while(e.isHeader(t,r)){var a=e._readSize(t,r+6);r+=10;var n=r+a;while(r+8<n){var s=e._getFrameData(t.subarray(r)),o=e._decodeFrame(s);o&&i.push(o),r+=s.size+10}e.isFooter(t,r)&&(r+=10)}return i},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var r=e._utf8ArrayToStr(t.data,!0),i=new Uint8Array(t.data.subarray(r.length+1));return{key:t.type,info:r,data:i.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var r=1,i=e._utf8ArrayToStr(t.data.subarray(r),!0);r+=i.length+1;var a=e._utf8ArrayToStr(t.data.subarray(r));return{key:t.type,info:i,data:a}}var n=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:n}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var r=1,i=e._utf8ArrayToStr(t.data.subarray(r));r+=i.length+1;var a=e._utf8ArrayToStr(t.data.subarray(r));return{key:t.type,info:i,data:a}}var n=e._utf8ArrayToStr(t.data);return{key:t.type,data:n}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var r=s();if(r){var i=r.decode(e);if(t){var a=i.indexOf("\0");return-1!==a?i.substring(0,a):i}return i.replace(/\0/g,"")}var n,o,l,u=e.length,d="",c=0;while(c<u){if(n=e[c++],0===n&&t)return d;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(n);break;case 12:case 13:o=e[c++],d+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=e[c++],l=e[c++],d+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&l)<<0);break;default:}}return d},e}();function s(){var e=Object(a["getSelfScope"])();return i||"undefined"===typeof e.TextDecoder||(i=new e.TextDecoder("utf-8")),i}var o=n._utf8ArrayToStr;t["default"]=n},"./src/demux/mp4demuxer.js":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.js ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var i=r(/*! ../utils/logger */"./src/utils/logger.js"),a=r(/*! ../events */"./src/events.js"),n=Math.pow(2,32)-1,s=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function(e){this.initPTS=e},t.resetInitSegment=function(t,r,i,n){if(t&&t.byteLength){var s=this.initData=e.parseInitSegment(t);null==r&&(r="mp4a.40.5"),null==i&&(i="avc1.42e01e");var o={};s.audio&&s.video?o.audiovideo={container:"video/mp4",codec:r+","+i,initSegment:n?t:null}:(s.audio&&(o.audio={container:"audio/mp4",codec:r,initSegment:n?t:null}),s.video&&(o.video={container:"video/mp4",codec:i,initSegment:n?t:null})),this.observer.trigger(a["default"].FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else r&&(this.audioCodec=r),i&&(this.videoCodec=i)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<8|e[t+1];return r<0?65536+r:r},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r},e.writeUint32=function(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},e.findBox=function(t,r){var i,a,n,s,o,l,u,d=[];if(t.data?(l=t.start,s=t.end,t=t.data):(l=0,s=t.byteLength),!r.length)return null;for(i=l;i<s;)a=e.readUint32(t,i),n=e.bin2str(t.subarray(i+4,i+8)),u=a>1?i+a:s,n===r[0]&&(1===r.length?d.push({data:t,start:i+8,end:u}):(o=e.findBox({data:t,start:i+8,end:u},r.slice(1)),o.length&&(d=d.concat(o)))),i=u;return d},e.parseSegmentIndex=function(t){var r,i=e.findBox(t,["moov"])[0],a=i?i.end:null,n=0,s=e.findBox(t,["sidx"]);if(!s||!s[0])return null;r=[],s=s[0];var o=s.data[0];n=0===o?8:16;var l=e.readUint32(s,n);n+=4;var u=0,d=0;n+=0===o?8:16,n+=2;var c=s.end+d,h=e.readUint16(s,n);n+=2;for(var f=0;f<h;f++){var g=n,p=e.readUint32(s,g);g+=4;var v=2147483647&p,m=(2147483648&p)>>>31;if(1===m)return void console.warn("SIDX has hierarchical references (not supported)");var y=e.readUint32(s,g);g+=4,r.push({referenceSize:v,subsegmentDuration:y,info:{duration:y/l,start:c,end:c+v-1}}),c+=v,g+=4,n=g}return{earliestPresentationTime:u,timescale:l,version:o,referencesCount:h,references:r,moovEndOffset:a}},e.parseInitSegment=function(t){var r=[],a=e.findBox(t,["moov","trak"]);return a.forEach((function(t){var a=e.findBox(t,["tkhd"])[0];if(a){var n=a.data[a.start],s=0===n?12:20,o=e.readUint32(a,s),l=e.findBox(t,["mdia","mdhd"])[0];if(l){n=l.data[l.start],s=0===n?12:20;var u=e.readUint32(l,s),d=e.findBox(t,["mdia","hdlr"])[0];if(d){var c=e.bin2str(d.data.subarray(d.start+8,d.start+12)),h={soun:"audio",vide:"video"}[c];if(h){var f=e.findBox(t,["mdia","minf","stbl","stsd"]);if(f.length){f=f[0];var g=e.bin2str(f.data.subarray(f.start+12,f.start+16));i["logger"].log("MP4Demuxer:"+h+":"+g+" found")}r[o]={timescale:u,type:h},r[h]={timescale:u,id:o}}}}}})),r},e.getStartDTS=function(t,r){var i,a,n;return i=e.findBox(r,["moof","traf"]),a=[].concat.apply([],i.map((function(r){return e.findBox(r,["tfhd"]).map((function(i){var a,n,s;return a=e.readUint32(i,4),n=t[a].timescale||9e4,s=e.findBox(r,["tfdt"]).map((function(t){var r,i;return r=t.data[t.start],i=e.readUint32(t,4),1===r&&(i*=Math.pow(2,32),i+=e.readUint32(t,8)),i}))[0],s/n}))}))),n=Math.min.apply(null,a),isFinite(n)?n:0},e.offsetStartDTS=function(t,r,i){e.findBox(r,["moof","traf"]).map((function(r){return e.findBox(r,["tfhd"]).map((function(a){var s=e.readUint32(a,4),o=t[s].timescale||9e4;e.findBox(r,["tfdt"]).map((function(t){var r=t.data[t.start],a=e.readUint32(t,4);if(0===r)e.writeUint32(t,4,a-i*o);else{a*=Math.pow(2,32),a+=e.readUint32(t,8),a-=i*o,a=Math.max(a,0);var s=Math.floor(a/(n+1)),l=Math.floor(a%(n+1));e.writeUint32(t,4,s),e.writeUint32(t,8,l)}}))}))}))},t.append=function(t,r,i,n){var s=this.initData;s||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),s=this.initData);var o,l=this.initPTS;if(void 0===l){var u=e.getStartDTS(s,t);this.initPTS=l=u-r,this.observer.trigger(a["default"].INIT_PTS_FOUND,{initPTS:l})}e.offsetStartDTS(s,t,l),o=e.getStartDTS(s,t),this.remuxer.remux(s.audio,s.video,null,null,o,i,n,t)},t.destroy=function(){},e}();t["default"]=s},"./src/errors.ts":
/*!***********************!*\
  !*** ./src/errors.ts ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(e,t,r){"use strict";var i,a;r.r(t),r.d(t,"ErrorTypes",(function(){return i})),r.d(t,"ErrorDetails",(function(){return a})),function(e){e["NETWORK_ERROR"]="networkError",e["MEDIA_ERROR"]="mediaError",e["KEY_SYSTEM_ERROR"]="keySystemError",e["MUX_ERROR"]="muxError",e["OTHER_ERROR"]="otherError"}(i||(i={})),function(e){e["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys",e["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess",e["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession",e["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed",e["KEY_SYSTEM_NO_INIT_DATA"]="keySystemNoInitData",e["MANIFEST_LOAD_ERROR"]="manifestLoadError",e["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut",e["MANIFEST_PARSING_ERROR"]="manifestParsingError",e["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError",e["LEVEL_LOAD_ERROR"]="levelLoadError",e["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut",e["LEVEL_SWITCH_ERROR"]="levelSwitchError",e["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError",e["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut",e["FRAG_LOAD_ERROR"]="fragLoadError",e["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut",e["FRAG_DECRYPT_ERROR"]="fragDecryptError",e["FRAG_PARSING_ERROR"]="fragParsingError",e["REMUX_ALLOC_ERROR"]="remuxAllocError",e["KEY_LOAD_ERROR"]="keyLoadError",e["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut",e["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError",e["BUFFER_APPEND_ERROR"]="bufferAppendError",e["BUFFER_APPENDING_ERROR"]="bufferAppendingError",e["BUFFER_STALLED_ERROR"]="bufferStalledError",e["BUFFER_FULL_ERROR"]="bufferFullError",e["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole",e["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall",e["INTERNAL_EXCEPTION"]="internalException"}(a||(a={}))},"./src/events.js":
/*!***********************!*\
  !*** ./src/events.js ***!
  \***********************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var i={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"};t["default"]=i},"./src/hls.ts":
/*!*********************************!*\
  !*** ./src/hls.ts + 50 modules ***!
  \*********************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/demuxer-inline.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number-isFinite.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/eventemitter3/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/url-toolkit/src/url-toolkit.js (<- Module is not an ECMAScript module) */function(e,t,r){"use strict";r.r(t);var i={};r.r(i),r.d(i,"newCue",(function(){return gr}));var a,n,s=r("./node_modules/url-toolkit/src/url-toolkit.js"),o=r("./src/errors.ts"),l=r("./src/polyfills/number-isFinite.js"),u=r("./src/events.js"),d=r("./src/utils/logger.js"),c={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"===typeof this.handledEvents&&this.handledEvents.length&&"function"===typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){if(c[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)}),this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){this.hls.off(e,this.onEvent)}),this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(e,t){var r=function(e,t){var r="on"+e.replace("hls","");if("function"!==typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)};try{r.call(this,e,t).call()}catch(i){d["logger"].error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].OTHER_ERROR,details:o["ErrorDetails"].INTERNAL_EXCEPTION,fatal:!1,event:e,err:i})}},e}(),f=h;(function(e){e["MANIFEST"]="manifest",e["LEVEL"]="level",e["AUDIO_TRACK"]="audioTrack",e["SUBTITLE_TRACK"]="subtitleTrack"})(a||(a={})),function(e){e["MAIN"]="main",e["AUDIO"]="audio",e["SUBTITLE"]="subtitle"}(n||(n={}));var g=r("./src/demux/mp4demuxer.js");function p(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),e}var m,y=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}return v(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(s["buildAbsoluteURL"])(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();function E(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function T(e,t,r){return t&&E(e.prototype,t),r&&E(e,r),e}(function(e){e["AUDIO"]="audio",e["VIDEO"]="video"})(m||(m={}));var S=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=(e={},e[m.AUDIO]=!1,e[m.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t=e.prototype;return t.setByteRange=function(e,t){var r=e.split("@",2),i=[];1===r.length?i[0]=t?t.byteRangeEndOffset:0:i[0]=parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i},t.addElementaryStream=function(e){this._elementaryStreams[e]=!0},t.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},t.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},t.setDecryptDataFromLevelKey=function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&(r=new y(e.baseuri,e.reluri),r.method=e.method,r.iv=this.createInitializationVector(t)),r},T(e,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(s["buildAbsoluteURL"])(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!==typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&d["logger"].warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(l["isFiniteNumber"])(this.programDateTime))return null;var e=Object(l["isFiniteNumber"])(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}]),e}();function b(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _(e,t,r){return t&&b(e.prototype,t),r&&b(e,r),e}var A=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}return _(e,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(l["isFiniteNumber"])(this.fragments[0].programDateTime))}}]),e}(),R=/^(\d+)x(\d+)$/,D=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function e(t){for(var r in"string"===typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){var t=R.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,r={};D.lastIndex=0;while(null!==(t=D.exec(e))){var i=t[2],a='"';0===i.indexOf(a)&&i.lastIndexOf(a)===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r},e}(),w=L,k={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function I(e,t){var r=k[t];return!!r&&!0===r[e.slice(0,4)]}function O(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var C=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,P=/#EXT-X-MEDIA:(.*)/g,x=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),F=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,M=/\.(mp4|m4s|m4v|m4a)$/i,N=function(){function e(){}return e.findGroup=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(i.id===t)return i}},e.convertAVC1ToAVCOTI=function(e){var t,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return s["buildAbsoluteURL"](t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,r){var i,a=[];function n(e,t){["video","audio"].forEach((function(r){var i=e.filter((function(e){return I(e,r)}));if(i.length){var a=i.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[r+"Codec"]=a.length>0?a[0]:i[0],e=e.filter((function(e){return-1===i.indexOf(e)}))}})),t.unknownCodecs=e}C.lastIndex=0;while(null!=(i=C.exec(t))){var s={},o=s.attrs=new w(i[1]);s.url=e.resolve(i[2],r);var l=o.decimalResolution("RESOLUTION");l&&(s.width=l.width,s.height=l.height),s.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),s.name=o.NAME,n([].concat((o.CODECS||"").split(/[ ,]+/)),s),s.videoCodec&&-1!==s.videoCodec.indexOf("avc1")&&(s.videoCodec=e.convertAVC1ToAVCOTI(s.videoCodec)),a.push(s)}return a},e.parseMasterPlaylistMedia=function(t,r,i,a){var n;void 0===a&&(a=[]);var s=[],o=0;P.lastIndex=0;while(null!==(n=P.exec(t))){var l=new w(n[1]);if(l.TYPE===i){var u={id:o++,groupId:l["GROUP-ID"],name:l.NAME||l.LANGUAGE,type:i,default:"YES"===l.DEFAULT,autoselect:"YES"===l.AUTOSELECT,forced:"YES"===l.FORCED,lang:l.LANGUAGE};if(l.URI&&(u.url=e.resolve(l.URI,r)),a.length){var d=e.findGroup(a,u.groupId);u.audioCodec=d?d.codec:a[0].codec}s.push(u)}}return s},e.parseLevelPlaylist=function(e,t,r,i,a){var n,s,o,u=0,c=0,h=new A(t),f=0,g=null,p=new S,v=null;x.lastIndex=0;while(null!==(n=x.exec(e))){var m=n[1];if(m){p.duration=parseFloat(m);var E=(" "+n[2]).slice(1);p.title=E||null,p.tagList.push(E?["INF",m,E]:["INF",m])}else if(n[3]){if(Object(l["isFiniteNumber"])(p.duration)){var T=u++;p.type=i,p.start=c,o&&(p.levelkey=o),p.sn=T,p.level=r,p.cc=f,p.urlId=a,p.baseurl=t,p.relurl=(" "+n[3]).slice(1),B(p,g),h.fragments.push(p),g=p,c+=p.duration,p=new S}}else if(n[4]){var b=(" "+n[4]).slice(1);g?p.setByteRange(b,g):p.setByteRange(b)}else if(n[5])p.rawProgramDateTime=(" "+n[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),null===v&&(v=h.fragments.length);else{if(n=n[0].match(F),!n){d["logger"].warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<n.length;s++)if("undefined"!==typeof n[s])break;var _=(" "+n[s+1]).slice(1),R=(" "+n[s+2]).slice(1);switch(n[s]){case"#":p.tagList.push(R?[_,R]:[_]);break;case"PLAYLIST-TYPE":h.type=_.toUpperCase();break;case"MEDIA-SEQUENCE":u=h.startSN=parseInt(_);break;case"TARGETDURATION":h.targetduration=parseFloat(_);break;case"VERSION":h.version=parseInt(_);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":f++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":f=parseInt(_);break;case"KEY":var D=_,L=new w(D),k=L.enumeratedString("METHOD"),I=L.URI,O=L.hexadecimalInteger("IV");k&&(o=new y(t,I),I&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(k)>=0&&(o.method=k,o.key=null,o.iv=O));break;case"START":var C=new w(_),P=C.decimalFloatingPoint("TIME-OFFSET");Object(l["isFiniteNumber"])(P)&&(h.startTimeOffset=P);break;case"MAP":var N=new w(_);p.relurl=N.URI,N.BYTERANGE&&p.setByteRange(N.BYTERANGE),p.baseurl=t,p.level=r,p.type=i,p.sn="initSegment",h.initSegment=p,p=new S,p.rawProgramDateTime=h.initSegment.rawProgramDateTime;break;default:d["logger"].warn("line parsed but not handled: "+n);break}}}return p=g,p&&!p.relurl&&(h.fragments.pop(),c-=p.duration),h.totalduration=c,h.averagetargetduration=c/h.fragments.length,h.endSN=u-1,h.startCC=h.fragments[0]?h.fragments[0].cc:0,h.endCC=f,!h.initSegment&&h.fragments.length&&h.fragments.every((function(e){return M.test(e.relurl)}))&&(d["logger"].warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),p=new S,p.relurl=h.fragments[0].relurl,p.baseurl=t,p.level=r,p.type=i,p.sn="initSegment",h.initSegment=p,h.needSidxRanges=!0),v&&U(h.fragments,v),h},e}();function U(e,t){for(var r=e[t],i=t-1;i>=0;i--){var a=e[i];a.programDateTime=r.programDateTime-1e3*a.duration,r=a}}function B(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(l["isFiniteNumber"])(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function G(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var K=window,j=K.performance,H=function(e){function t(t){var r;return r=e.call(this,t,u["default"].MANIFEST_LOADING,u["default"].LEVEL_LOADING,u["default"].AUDIO_TRACK_LOADING,u["default"].SUBTITLE_TRACK_LOADING)||this,r.loaders={},r}G(t,e),t.canHaveQualityLevels=function(e){return e!==a.AUDIO_TRACK&&e!==a.SUBTITLE_TRACK},t.mapContextToLevelType=function(e){var t=e.type;switch(t){case a.AUDIO_TRACK:return n.AUDIO;case a.SUBTITLE_TRACK:return n.SUBTITLE;default:return n.MAIN}},t.getResponseUrl=function(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r};var r=t.prototype;return r.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,a=r||i,n=new a(t);return e.loader=n,this.loaders[e.type]=n,n},r.getInternalLoader=function(e){return this.loaders[e.type]},r.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},r.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},r.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},r.onManifestLoading=function(e){this.load({url:e.url,type:a.MANIFEST,level:0,id:null,responseType:"text"})},r.onLevelLoading=function(e){this.load({url:e.url,type:a.LEVEL,level:e.level,id:e.id,responseType:"text"})},r.onAudioTrackLoading=function(e){this.load({url:e.url,type:a.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},r.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:a.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},r.load=function(e){var t=this.hls.config;d["logger"].debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var r,i,n,s,o=this.getInternalLoader(e);if(o){var l=o.context;if(l&&l.url===e.url)return d["logger"].trace("playlist request ongoing"),!1;d["logger"].warn("aborting previous loader for type: "+e.type),o.abort()}switch(e.type){case a.MANIFEST:r=t.manifestLoadingMaxRetry,i=t.manifestLoadingTimeOut,n=t.manifestLoadingRetryDelay,s=t.manifestLoadingMaxRetryTimeout;break;case a.LEVEL:r=0,s=0,n=0,i=t.levelLoadingTimeOut;break;default:r=t.levelLoadingMaxRetry,i=t.levelLoadingTimeOut,n=t.levelLoadingRetryDelay,s=t.levelLoadingMaxRetryTimeout;break}o=this.createInternalLoader(e);var u={timeout:i,maxRetry:r,retryDelay:n,maxRetryDelay:s},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return d["logger"].debug("Calling internal loader delegate for URL: "+e.url),o.load(e,u,c),!0},r.loadsuccess=function(e,t,r,i){if(void 0===i&&(i=null),r.isSidxRequest)return this._handleSidxRequest(e,r),void this._handlePlaylistLoaded(e,t,r,i);if(this.resetInternalLoader(r.type),"string"!==typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var a=e.data;t.tload=j.now(),0===a.indexOf("#EXTM3U")?a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,r,i):this._handleMasterPlaylist(e,t,r,i):this._handleManifestParsingError(e,r,"no EXTM3U delimiter",i)},r.loaderror=function(e,t,r){void 0===r&&(r=null),this._handleNetworkError(t,r,!1,e)},r.loadtimeout=function(e,t,r){void 0===r&&(r=null),this._handleNetworkError(t,r,!0)},r._handleMasterPlaylist=function(e,r,i,a){var n=this.hls,s=e.data,o=t.getResponseUrl(e,i),l=N.parseMasterPlaylist(s,o);if(l.length){var c=l.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),h=N.parseMasterPlaylistMedia(s,o,"AUDIO",c),f=N.parseMasterPlaylistMedia(s,o,"SUBTITLES");if(h.length){var g=!1;h.forEach((function(e){e.url||(g=!0)})),!1===g&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(d["logger"].log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1}))}n.trigger(u["default"].MANIFEST_LOADED,{levels:l,audioTracks:h,subtitles:f,url:o,stats:r,networkDetails:a})}else this._handleManifestParsingError(e,i,"no level found in manifest",a)},r._handleTrackOrLevelPlaylist=function(e,r,i,n){var s=this.hls,o=i.id,d=i.level,c=i.type,h=t.getResponseUrl(e,i),f=Object(l["isFiniteNumber"])(o)?o:0,g=Object(l["isFiniteNumber"])(d)?d:f,p=t.mapContextToLevelType(i),v=N.parseLevelPlaylist(e.data,h,g,p,f);if(v.tload=r.tload,c===a.MANIFEST){var m={url:h,details:v};s.trigger(u["default"].MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:r,networkDetails:n})}if(r.tparsed=j.now(),v.needSidxRanges){var y=v.initSegment.url;this.load({url:y,isSidxRequest:!0,type:c,level:d,levelDetails:v,id:o,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else i.levelDetails=v,this._handlePlaylistLoaded(e,r,i,n)},r._handleSidxRequest=function(e,t){if("string"===typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var r=g["default"].parseSegmentIndex(new Uint8Array(e.data));if(r){var i=r.references,a=t.levelDetails;i.forEach((function(e,t){var r=e.info;if(a){var i=a.fragments[t];0===i.byteRange.length&&i.setByteRange(String(1+r.end-r.start)+"@"+String(r.start))}})),a&&a.initSegment.setByteRange(String(r.moovEndOffset)+"@0")}},r._handleManifestParsingError=function(e,t,r,i){this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].NETWORK_ERROR,details:o["ErrorDetails"].MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:r,networkDetails:i})},r._handleNetworkError=function(e,t,r,i){var n,s;void 0===r&&(r=!1),void 0===i&&(i=null),d["logger"].info("A network error occured while loading a "+e.type+"-type playlist");var l=this.getInternalLoader(e);switch(e.type){case a.MANIFEST:n=r?o["ErrorDetails"].MANIFEST_LOAD_TIMEOUT:o["ErrorDetails"].MANIFEST_LOAD_ERROR,s=!0;break;case a.LEVEL:n=r?o["ErrorDetails"].LEVEL_LOAD_TIMEOUT:o["ErrorDetails"].LEVEL_LOAD_ERROR,s=!1;break;case a.AUDIO_TRACK:n=r?o["ErrorDetails"].AUDIO_TRACK_LOAD_TIMEOUT:o["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR,s=!1;break;default:s=!1}l&&(l.abort(),this.resetInternalLoader(e.type));var c={type:o["ErrorTypes"].NETWORK_ERROR,details:n,fatal:s,url:e.url,loader:l,context:e,networkDetails:t};i&&(c.response=i),this.hls.trigger(u["default"].ERROR,c)},r._handlePlaylistLoaded=function(e,r,i,n){var s=i.type,o=i.level,l=i.id,d=i.levelDetails;if(d&&d.targetduration){var c=t.canHaveQualityLevels(i.type);if(c)this.hls.trigger(u["default"].LEVEL_LOADED,{details:d,level:o||0,id:l||0,stats:r,networkDetails:n});else switch(s){case a.AUDIO_TRACK:this.hls.trigger(u["default"].AUDIO_TRACK_LOADED,{details:d,id:l,stats:r,networkDetails:n});break;case a.SUBTITLE_TRACK:this.hls.trigger(u["default"].SUBTITLE_TRACK_LOADED,{details:d,id:l,stats:r,networkDetails:n});break}}else this._handleManifestParsingError(e,i,"invalid target duration",n)},t}(f),V=H;function W(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Y=function(e){function t(t){var r;return r=e.call(this,t,u["default"].FRAG_LOADING)||this,r.loaders={},r}W(t,e);var r=t.prototype;return r.destroy=function(){var t=this.loaders;for(var r in t){var i=t[r];i&&i.destroy()}this.loaders={},e.prototype.destroy.call(this)},r.onFragLoading=function(e){var t=e.frag,r=t.type,i=this.loaders,a=this.hls.config,n=a.fLoader,s=a.loader;t.loaded=0;var o,u,c,h=i[r];h&&(d["logger"].warn("abort previous fragment loader for type: "+r),h.abort()),h=i[r]=t.loader=a.fLoader?new n(a):new s(a),o={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var f=t.byteRangeStartOffset,g=t.byteRangeEndOffset;Object(l["isFiniteNumber"])(f)&&Object(l["isFiniteNumber"])(g)&&(o.rangeStart=f,o.rangeEnd=g),u={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},h.load(o,u,c)},r.loadsuccess=function(e,t,r,i){void 0===i&&(i=null);var a=e.data,n=r.frag;n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(u["default"].FRAG_LOADED,{payload:a,frag:n,stats:t,networkDetails:i})},r.loaderror=function(e,t,r){void 0===r&&(r=null);var i=t.frag,a=i.loader;a&&a.abort(),this.loaders[i.type]=void 0,this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].NETWORK_ERROR,details:o["ErrorDetails"].FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:r})},r.loadtimeout=function(e,t,r){void 0===r&&(r=null);var i=t.frag,a=i.loader;a&&a.abort(),this.loaders[i.type]=void 0,this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].NETWORK_ERROR,details:o["ErrorDetails"].FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:r})},r.loadprogress=function(e,t,r,i){void 0===i&&(i=null);var a=t.frag;a.loaded=e.loaded,this.hls.trigger(u["default"].FRAG_LOAD_PROGRESS,{frag:a,stats:e,networkDetails:i})},t}(f),q=Y;function z(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var X=function(e){function t(t){var r;return r=e.call(this,t,u["default"].KEY_LOADING)||this,r.loaders={},r.decryptkey=null,r.decrypturl=null,r}z(t,e);var r=t.prototype;return r.destroy=function(){for(var t in this.loaders){var r=this.loaders[t];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},r.onKeyLoading=function(e){var t=e.frag,r=t.type,i=this.loaders[r];if(t.decryptdata){var a=t.decryptdata.uri;if(a!==this.decrypturl||null===this.decryptkey){var n=this.hls.config;if(i&&(d["logger"].warn("abort previous key loader for type:"+r),i.abort()),!a)return void d["logger"].warn("key uri is falsy");t.loader=this.loaders[r]=new n.loader(n),this.decrypturl=a,this.decryptkey=null;var s={url:a,frag:t,responseType:"arraybuffer"},o={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(s,o,l)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(u["default"].KEY_LOADED,{frag:t}))}else d["logger"].warn("Missing decryption data on fragment in onKeyLoading")},r.loadsuccess=function(e,t,r){var i=r.frag;i.decryptdata?(this.decryptkey=i.decryptdata.key=new Uint8Array(e.data),i.loader=void 0,delete this.loaders[i.type],this.hls.trigger(u["default"].KEY_LOADED,{frag:i})):d["logger"].error("after key load, decryptdata unset")},r.loaderror=function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),delete this.loaders[r.type],this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].NETWORK_ERROR,details:o["ErrorDetails"].KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},r.loadtimeout=function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),delete this.loaders[r.type],this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].NETWORK_ERROR,details:o["ErrorDetails"].KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},t}(f),Q=X;function J(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var $={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Z=function(e){function t(t){var r;return r=e.call(this,t,u["default"].BUFFER_APPENDED,u["default"].FRAG_BUFFERED,u["default"].FRAG_LOADED)||this,r.bufferPadding=.2,r.fragments=Object.create(null),r.timeRanges=Object.create(null),r.config=t.config,r}J(t,e);var r=t.prototype;return r.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,f.prototype.destroy.call(this),e.prototype.destroy.call(this)},r.getBufferedFrag=function(e,t){var r=this.fragments,i=Object.keys(r).filter((function(i){var a=r[i];if(a.body.type!==t)return!1;if(!a.buffered)return!1;var n=a.body;return n.startPTS<=e&&e<=n.endPTS}));if(0===i.length)return null;var a=i.pop();return r[a].body},r.detectEvictedFragments=function(e,t){var r,i,a=this;Object.keys(this.fragments).forEach((function(n){var s=a.fragments[n];if(!0===s.buffered){var o=s.range[e];if(o){r=o.time;for(var l=0;l<r.length;l++)if(i=r[l],!1===a.isTimeBuffered(i.startPTS,i.endPTS,t)){a.removeFragment(s.body);break}}}}))},r.detectPartialFragments=function(e){var t=this,r=this.getFragmentKey(e),i=this.fragments[r];i&&(i.buffered=!0,Object.keys(this.timeRanges).forEach((function(r){if(e.hasElementaryStream(r)){var a=t.timeRanges[r];i.range[r]=t.getBufferedTimes(e.startPTS,e.endPTS,a)}})))},r.getBufferedTimes=function(e,t,r){for(var i,a,n=[],s=!1,o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,a=r.end(o)+this.bufferPadding,e>=i&&t<=a){n.push({startPTS:Math.max(e,r.start(o)),endPTS:Math.min(t,r.end(o))});break}if(e<a&&t>i)n.push({startPTS:Math.max(e,r.start(o)),endPTS:Math.min(t,r.end(o))}),s=!0;else if(t<=i)break}return{time:n,partial:s}},r.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},r.getPartialFragment=function(e){var t,r,i,a=this,n=null,s=0;return Object.keys(this.fragments).forEach((function(o){var l=a.fragments[o];a.isPartial(l)&&(r=l.body.startPTS-a.bufferPadding,i=l.body.endPTS+a.bufferPadding,e>=r&&e<=i&&(t=Math.min(e-r,i-e),s<=t&&(n=l.body,s=t)))})),n},r.getState=function(e){var t=this.getFragmentKey(e),r=this.fragments[t],i=$.NOT_LOADED;return void 0!==r&&(i=r.buffered?!0===this.isPartial(r)?$.PARTIAL:$.OK:$.APPENDING),i},r.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},r.isTimeBuffered=function(e,t,r){for(var i,a,n=0;n<r.length;n++){if(i=r.start(n)-this.bufferPadding,a=r.end(n)+this.bufferPadding,e>=i&&t<=a)return!0;if(t<=i)return!1}return!1},r.onFragLoaded=function(e){var t=e.frag;Object(l["isFiniteNumber"])(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},r.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(e){var r=t.timeRanges[e];t.detectEvictedFragments(e,r)}))},r.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},r.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},r.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},r.removeAllFragments=function(){this.fragments=Object.create(null)},t}(f),ee={search:function(e,t){var r=0,i=e.length-1,a=null,n=null;while(r<=i){a=(r+i)/2|0,n=e[a];var s=t(n);if(s>0)r=a+1;else{if(!(s<0))return n;i=a-1}}return null}},te=ee,re=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var r=e.buffered,i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0}catch(a){}return!1},e.bufferInfo=function(e,t,r){try{if(e){var i,a=e.buffered,n=[];for(i=0;i<a.length;i++)n.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(n,t,r)}}catch(s){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,r){e.sort((function(e,t){var r=e.start-t.start;return r||t.end-e.end}));var i=[];if(r)for(var a=0;a<e.length;a++){var n=i.length;if(n){var s=i[n-1].end;e[a].start-s<r?e[a].end>s&&(i[n-1].end=e[a].end):i.push(e[a])}else i.push(e[a])}else i=e;for(var o,l=0,u=t,d=t,c=0;c<i.length;c++){var h=i[c].start,f=i[c].end;if(t+r>=h&&t<f)u=h,d=f,l=d-t;else if(t+r<h){o=h;break}}return{len:l,start:u,end:d,nextStart:o}},e}(),ie=r("./node_modules/eventemitter3/index.js"),ae=r("./node_modules/webworkify-webpack/index.js"),ne=r("./src/demux/demuxer-inline.js");function se(){return window.MediaSource||window.WebKitMediaSource}var oe=r("./src/utils/get-self-scope.js");function le(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var ue=function(e){function t(){return e.apply(this,arguments)||this}le(t,e);var r=t.prototype;return r.trigger=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];this.emit.apply(this,[e,e].concat(r))},t}(ie["EventEmitter"]),de=Object(oe["getSelfScope"])(),ce=se()||{isTypeSupported:function(){return!1}},he=function(){function e(e,t){var r=this;this.hls=e,this.id=t;var i=this.observer=new ue,a=e.config,n=function(t,i){i=i||{},i.frag=r.frag,i.id=r.id,e.trigger(t,i)};i.on(u["default"].FRAG_DECRYPTED,n),i.on(u["default"].FRAG_PARSING_INIT_SEGMENT,n),i.on(u["default"].FRAG_PARSING_DATA,n),i.on(u["default"].FRAG_PARSED,n),i.on(u["default"].ERROR,n),i.on(u["default"].FRAG_PARSING_METADATA,n),i.on(u["default"].FRAG_PARSING_USERDATA,n),i.on(u["default"].INIT_PTS_FOUND,n);var s={mp4:ce.isTypeSupported("video/mp4"),mpeg:ce.isTypeSupported("audio/mpeg"),mp3:ce.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(a.enableWorker&&"undefined"!==typeof Worker){var c;d["logger"].log("demuxing in webworker");try{c=this.w=ae(/*! ../demux/demuxer-worker.js */"./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),c.addEventListener("message",this.onwmsg),c.onerror=function(t){e.trigger(u["default"].ERROR,{type:o["ErrorTypes"].OTHER_ERROR,details:o["ErrorDetails"].INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},c.postMessage({cmd:"init",typeSupported:s,vendor:l,id:t,config:JSON.stringify(a)})}catch(h){d["logger"].warn("Error in worker:",h),d["logger"].error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),c&&de.URL.revokeObjectURL(c.objectURL),this.demuxer=new ne["default"](i,s,a,l),this.w=void 0}}else this.demuxer=new ne["default"](i,s,a,l)}var t=e.prototype;return t.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)},t.push=function(e,t,r,i,a,n,s,o){var u=this.w,c=Object(l["isFiniteNumber"])(a.startPTS)?a.startPTS:a.start,h=a.decryptdata,f=this.frag,g=!(f&&a.cc===f.cc),p=!(f&&a.level===f.level),v=f&&a.sn===f.sn+1,m=!p&&v;if(g&&d["logger"].log(this.id+":discontinuity detected"),p&&d["logger"].log(this.id+":switch detected"),this.frag=a,u)u.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:t,audioCodec:r,videoCodec:i,timeOffset:c,discontinuity:g,trackSwitch:p,contiguous:m,duration:n,accurateTimeOffset:s,defaultInitPTS:o},e instanceof ArrayBuffer?[e]:[]);else{var y=this.demuxer;y&&y.push(e,h,t,r,i,c,g,p,m,n,s,o)}},t.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":de.URL.revokeObjectURL(this.w.objectURL);break;case u["default"].FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data);break}},e}(),fe=he;function ge(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r);break}}function pe(e,t,r){var i=e[t],a=e[r],n=a.startPTS;Object(l["isFiniteNumber"])(n)?r>t?(i.duration=n-i.start,i.duration<0&&d["logger"].warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-n,a.duration<0&&d["logger"].warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):a.start=r>t?i.start+i.duration:Math.max(i.start-a.duration,0)}function ve(e,t,r,i,a,n){var s=r;if(Object(l["isFiniteNumber"])(t.startPTS)){var o=Math.abs(t.startPTS-r);Object(l["isFiniteNumber"])(t.deltaPTS)?t.deltaPTS=Math.max(o,t.deltaPTS):t.deltaPTS=o,s=Math.max(r,t.startPTS),r=Math.min(r,t.startPTS),i=Math.max(i,t.endPTS),a=Math.min(a,t.startDTS),n=Math.max(n,t.endDTS)}var u=r-t.start;t.start=t.startPTS=r,t.maxStartPTS=s,t.endPTS=i,t.startDTS=a,t.endDTS=n,t.duration=i-r;var d,c,h,f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;for(d=f-e.startSN,c=e.fragments,c[d]=t,h=d;h>0;h--)pe(c,h,h-1);for(h=d;h<c.length-1;h++)pe(c,h,h+1);return e.PTSKnown=!0,u}function me(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var r,i=0;if(Ee(e,t,(function(e,a){i=e.cc-a.cc,Object(l["isFiniteNumber"])(e.startPTS)&&(a.start=a.startPTS=e.startPTS,a.endPTS=e.endPTS,a.duration=e.duration,a.backtracked=e.backtracked,a.dropped=e.dropped,r=a),t.PTSKnown=!0})),t.PTSKnown){if(i){d["logger"].log("discontinuity sliding from playlist, take drift into account");for(var a=t.fragments,n=0;n<a.length;n++)a[n].cc+=i}r?ve(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Te(e,t),t.PTSKnown=e.PTSKnown}}function ye(e,t,r){void 0===r&&(r=0);var i=-1;Ee(e,t,(function(e,t,r){t.start=e.start,i=r}));var a=t.fragments;if(i<0)a.forEach((function(e){e.start+=r}));else for(var n=i+1;n<a.length;n++)a[n].start=a[n-1].start+a[n-1].duration}function Ee(e,t,r){if(e&&t)for(var i=Math.max(e.startSN,t.startSN)-t.startSN,a=Math.min(e.endSN,t.endSN)-t.startSN,n=t.startSN-e.startSN,s=i;s<=a;s++){var o=e.fragments[n+s],l=t.fragments[s];if(!o||!l)break;r(o,l,s)}}function Te(e,t){var r=t.startSN-e.startSN,i=e.fragments,a=t.fragments;if(!(r<0||r>i.length))for(var n=0;n<a.length;n++)a[n].start+=i[r].start}function Se(e,t,r){var i=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),a=i/2;return e&&t.endSN===e.endSN&&(i=a),r&&(i=Math.max(a,i-(window.performance.now()-r))),Math.round(i)}var be={toString:function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="["+e.start(i).toFixed(3)+","+e.end(i).toFixed(3)+"]";return t}},_e=be;function Ae(e,t){for(var r=null,i=0;i<e.length;i+=1){var a=e[i];if(a&&a.cc===t){r=a;break}}return r}function Re(e,t){return te.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}function De(e,t,r){var i=!1;return t&&t.details&&r&&(r.endCC>r.startCC||e&&e.cc<r.startCC)&&(i=!0),i}function Le(e,t){var r=e.fragments,i=t.fragments;if(i.length&&r.length){var a=Ae(r,i[0].cc);if(a&&(!a||a.startPTS))return a;d["logger"].log("No frag in previous level to align on")}else d["logger"].log("No fragments to align")}function we(e,t){t.fragments.forEach((function(t){if(t){var r=t.start+e;t.start=t.startPTS=r,t.endPTS=r+t.duration}})),t.PTSKnown=!0}function ke(e,t,r){Ie(e,r,t),!r.PTSKnown&&t&&Oe(r,t.details)}function Ie(e,t,r){if(De(e,r,t)){var i=Le(r.details,t);i&&(d["logger"].log("Adjusting PTS using last level due to CC increase within current level"),we(i.start,t))}}function Oe(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var r=t.fragments[0].programDateTime,i=e.fragments[0].programDateTime,a=(i-r)/1e3+t.fragments[0].start;Object(l["isFiniteNumber"])(a)&&(d["logger"].log("adjusting PTS using programDateTime delta, sliding:"+a.toFixed(3)),we(a,e))}}function Ce(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!Object(l["isFiniteNumber"])(t))return null;var i=e[0].programDateTime;if(t<(i||0))return null;var a=e[e.length-1].endProgramDateTime;if(t>=(a||0))return null;r=r||0;for(var n=0;n<e.length;++n){var s=e[n];if(Fe(t,r,s))return s}return null}function Pe(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var a=e?t[e.sn-t[0].sn+1]:null;return a&&!xe(r,i,a)?a:te.search(t,xe.bind(null,r,i))}function xe(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0);var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function Fe(e,t,r){var i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0)),a=r.endProgramDateTime||0;return a-i>e}var Me=250,Ne=2,Ue=.1,Be=.05,Ge=function(){function e(e,t,r,i){this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function(e){var t=this.config,r=this.media,i=this.stalled,a=r.currentTime,n=r.seeking,s=this.seeking&&!n,o=!this.seeking&&n;if(this.seeking=n,a===e){if((o||s)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&r.buffered.length){var l=re.bufferInfo(r,a,0),u=l.len>0,c=l.nextStart||0;if(u||c){if(n){var h=l.len>Ne,f=!c||c-a>Ne;if(h||f)return;this.moved=!1}if(!this.moved&&this.stalled){var g=Math.max(c,l.start||0)-a;if(g>0&&g<=Ne)return void this._trySkipBufferHole(null)}var p=self.performance.now();if(null!==i){var v=p-i;!n&&v>=Me&&this._reportStall(l.len);var m=re.bufferInfo(r,a,t.maxBufferHole);this._tryFixBufferStall(m,v)}else this.stalled=p}}}else if(this.moved=!0,null!==i){if(this.stallReported){var y=self.performance.now()-i;d["logger"].warn("playback not stuck anymore @"+a+", after "+Math.round(y)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,a=this.media,n=a.currentTime,s=i.getPartialFragment(n);if(s){var o=this._trySkipBufferHole(s);if(o)return}e.len>r.maxBufferHole&&t>1e3*r.highBufferWatchdogPeriod&&(d["logger"].warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,r=this.media,i=this.stallReported;i||(this.stallReported=!0,d["logger"].warn("Playback stalling at @"+r.currentTime+" due to low buffer"),t.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:o["ErrorDetails"].BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,r=this.hls,i=this.media,a=i.currentTime,n=0,s=0;s<i.buffered.length;s++){var l=i.buffered.start(s);if(a+t.maxBufferHole>=n&&a<l){var c=Math.max(l+Be,i.currentTime+Ue);return d["logger"].warn("skipping hole, adjusting currentTime from "+a+" to "+c),this.moved=!0,this.stalled=null,i.currentTime=c,e&&r.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:o["ErrorDetails"].BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+a+" to "+c,frag:e}),c}n=i.buffered.end(s)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=r.currentTime,a=(this.nudgeRetry||0)+1;if(this.nudgeRetry=a,a<e.nudgeMaxRetry){var n=i+a*e.nudgeOffset;d["logger"].warn("Nudging 'currentTime' from "+i+" to "+n),r.currentTime=n,t.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:o["ErrorDetails"].BUFFER_NUDGE_ON_STALL,fatal:!1})}else d["logger"].error("Playhead still not moving while enough data buffered @"+i+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:o["ErrorDetails"].BUFFER_STALLED_ERROR,fatal:!0})},e}();function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var He=function(e){function t(t){for(var r,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return r=e.call.apply(e,[this,t].concat(a))||this,r._boundTick=void 0,r._tickTimer=null,r._tickInterval=null,r._tickCallCount=0,r._boundTick=r.tick.bind(Ke(r)),r}je(t,e);var r=t.prototype;return r.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},r.hasInterval=function(){return!!this._tickInterval},r.hasNextTick=function(){return!!this._tickTimer},r.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},r.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},r.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},r.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},r.doTick=function(){},t}(f);function Ve(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var We={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Ye=function(e){function t(){return e.apply(this,arguments)||this}Ve(t,e);var r=t.prototype;return r.doTick=function(){},r.startLoad=function(){},r.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=We.STOPPED},r._streamEnded=function(e,t){var r=this.fragCurrent,i=this.fragmentTracker;if(!t.live&&r&&!r.backtracked&&r.sn===t.endSN&&!e.nextStart){var a=i.getState(r);return a===$.PARTIAL||a===$.OK}return!1},r.onMediaSeeking=function(){var e=this.config,t=this.media,r=this.mediaBuffer,i=this.state,a=t?t.currentTime:null,n=re.bufferInfo(r||t,a,this.config.maxBufferHole);if(Object(l["isFiniteNumber"])(a)&&d["logger"].log("media seeking to "+a.toFixed(3)),i===We.FRAG_LOADING){var s=this.fragCurrent;if(0===n.len&&s){var o=e.maxFragLookUpTolerance,u=s.start-o,c=s.start+s.duration+o;a<u||a>c?(s.loader&&(d["logger"].log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=We.IDLE):d["logger"].log("seeking outside of buffer but within currently loaded fragment range")}}else i===We.ENDED&&(0===n.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=We.IDLE);t&&(this.lastCurrentTime=a),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=a),this.tick()},r.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function(){this.state=We.STOPPED,this.fragmentTracker=null},r.computeLivePosition=function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)},t}(He);function qe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ze(e,t,r){return t&&qe(e.prototype,t),r&&qe(e,r),e}function Xe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Qe=100,Je=function(e){function t(t,r){var i;return i=e.call(this,t,u["default"].MEDIA_ATTACHED,u["default"].MEDIA_DETACHING,u["default"].MANIFEST_LOADING,u["default"].MANIFEST_PARSED,u["default"].LEVEL_LOADED,u["default"].KEY_LOADED,u["default"].FRAG_LOADED,u["default"].FRAG_LOAD_EMERGENCY_ABORTED,u["default"].FRAG_PARSING_INIT_SEGMENT,u["default"].FRAG_PARSING_DATA,u["default"].FRAG_PARSED,u["default"].ERROR,u["default"].AUDIO_TRACK_SWITCHING,u["default"].AUDIO_TRACK_SWITCHED,u["default"].BUFFER_CREATED,u["default"].BUFFER_APPENDED,u["default"].BUFFER_FLUSHED)||this,i.fragmentTracker=r,i.config=t.config,i.audioCodecSwap=!1,i._state=We.STOPPED,i.stallReported=!1,i.gapController=null,i.altAudio=!1,i}Xe(t,e);var r=t.prototype;return r.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(Qe),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(i=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&-1===e&&(d["logger"].log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=We.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=We.STOPPED},r.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case We.BUFFER_FLUSHING:this.fragLoadError=0;break;case We.IDLE:this._doTickIdle();break;case We.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=We.IDLE);break;case We.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),r=this.retryDate;(!r||t>=r||this.media&&this.media.seeking)&&(d["logger"].log("mediaController: retryDate reached, switch back to IDLE state"),this.state=We.IDLE);break;case We.ERROR:case We.STOPPED:case We.FRAG_LOADING:case We.PARSING:case We.PARSED:case We.ENDED:break;default:break}this._checkBuffer(),this._checkFragmentChanged()},r._doTickIdle=function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&t.startFragPrefetch)){var i;i=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var a=e.nextLoadLevel,n=this.levels[a];if(n){var s,o=n.bitrate;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=re.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,t.maxBufferHole),c=l.len;if(!(c>=s)){d["logger"].trace("buffer length of "+c.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=a;var h=n.details;if(!h||h.live&&this.levelLastLoaded!==a)this.state=We.WAITING_LEVEL;else{if(this._streamEnded(l,h)){var f={};return this.altAudio&&(f.type="video"),this.hls.trigger(u["default"].BUFFER_EOS,f),void(this.state=We.ENDED)}this._fetchPayloadOrEos(i,l,h)}}}}},r._fetchPayloadOrEos=function(e,t,r){var i=this.fragPrevious,a=this.level,n=r.fragments,s=n.length;if(0!==s){var o,l=n[0].start,u=n[s-1].start+n[s-1].duration,c=t.end;if(r.initSegment&&!r.initSegment.data)o=r.initSegment;else if(r.live){var h=this.config.initialLiveManifestSize;if(s<h)return void d["logger"].warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+h);if(o=this._ensureFragmentAtLivePoint(r,c,l,u,i,n,s),null===o)return}else c<l&&(o=n[0]);o||(o=this._findFragment(l,i,s,n,c,u,r)),o&&(o.encrypted?(d["logger"].log("Loading key for "+o.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+a),this._loadKey(o)):(d["logger"].log("Loading "+o.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+a+", currentTime:"+e.toFixed(3)+",bufferEnd:"+c.toFixed(3)),this._loadFragment(o)))}},r._ensureFragmentAtLivePoint=function(e,t,r,i,a,n,s){var o,l=this.hls.config,u=this.media,c=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-l.maxFragLookUpTolerance,i-c)){var h=this.liveSyncPosition=this.computeLivePosition(r,e);t=h,u&&!u.paused&&u.readyState&&u.duration>h&&h>u.currentTime&&(d["logger"].log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),u.currentTime=h),this.nextLoadPosition=h}if(e.PTSKnown&&t>i&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(a)if(e.hasProgramDateTime)d["logger"].log("live playlist, switching playlist, load frag with same PDT: "+a.programDateTime),o=Ce(n,a.endProgramDateTime,l.maxFragLookUpTolerance);else{var f=a.sn+1;if(f>=e.startSN&&f<=e.endSN){var g=n[f-e.startSN];a.cc===g.cc&&(o=g,d["logger"].log("live playlist, switching playlist, load frag with next SN: "+o.sn))}o||(o=te.search(n,(function(e){return a.cc-e.cc})),o&&d["logger"].log("live playlist, switching playlist, load frag with same CC: "+o.sn))}o||(o=n[Math.min(s-1,Math.round(s/2))],d["logger"].log("live playlist, switching playlist, unknown, load middle frag : "+o.sn))}return o},r._findFragment=function(e,t,r,i,a,n,s){var o,l=this.hls.config;if(a<n){var u=a>n-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance;o=Pe(t,i,a,u)}else o=i[r-1];if(o){var c=o.sn-s.startSN,h=t&&o.level===t.level,f=i[c-1],g=i[c+1];if(t&&o.sn===t.sn)if(h&&!o.backtracked)if(o.sn<s.endSN){var p=t.deltaPTS;p&&p>l.maxBufferHole&&t.dropped&&c?(o=f,d["logger"].warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(o=g,d["logger"].log("Re-loading fragment with SN: "+o.sn))}else o=null;else o.backtracked&&(g&&g.backtracked?(d["logger"].warn("Already backtracked from fragment "+g.sn+", will not backtrack to fragment "+o.sn+". Loading fragment "+g.sn),o=g):(d["logger"].warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),o.dropped=0,f?(o=f,o.backtracked=!0):c&&(o=null)))}return o},r._loadKey=function(e){this.state=We.KEY_LOADING,this.hls.trigger(u["default"].KEY_LOADING,{frag:e})},r._loadFragment=function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,"initSegment"!==e.sn&&(this.startFragRequested=!0),Object(l["isFiniteNumber"])(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===$.NOT_LOADED||t===$.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(u["default"].FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new fe(this.hls,"main")),this.state=We.FRAG_LOADING):t===$.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},r.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,n.MAIN)},r.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},r._checkFragmentChanged=function(){var e,t,r=this.media;if(r&&r.readyState&&!1===r.seeking&&(t=r.currentTime,t>this.lastCurrentTime&&(this.lastCurrentTime=t),re.isBuffered(r,t)?e=this.getBufferedFrag(t):re.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var i=e;if(i!==this.fragPlaying){this.hls.trigger(u["default"].FRAG_CHANGED,{frag:i});var a=i.level;this.fragPlaying&&this.fragPlaying.level===a||this.hls.trigger(u["default"].LEVEL_SWITCHED,{level:a}),this.fragPlaying=i}}},r.immediateLevelSwitch=function(){if(d["logger"].log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e,t=this.media;t?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,re.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},r.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,r,i;if(r=this.getBufferedFrag(e.currentTime),r&&r.startPTS>1&&this.flushMainBuffer(0,r.startPTS-1),e.paused)t=0;else{var a=this.hls.nextLoadLevel,n=this.levels[a],s=this.fragLastKbps;t=s&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*s)+1:0}if(i=this.getBufferedFrag(e.currentTime+t),i&&(i=this.followingBufferedFrag(i),i)){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.maxStartPTS,Number.POSITIVE_INFINITY)}}},r.flushMainBuffer=function(e,t){this.state=We.BUFFER_FLUSHING;var r={startOffset:e,endOffset:t};this.altAudio&&(r.type="video"),this.hls.trigger(u["default"].BUFFER_FLUSHING,r)},r.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition),this.gapController=new Ge(r,t,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(d["logger"].log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach((function(e){e.details&&e.details.fragments.forEach((function(e){e.backtracked=void 0}))})),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},r.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(l["isFiniteNumber"])(t)&&d["logger"].log("media seeked to "+t.toFixed(3)),this.tick()},r.onManifestLoading=function(){d["logger"].log("trigger BUFFER_RESET"),this.hls.trigger(u["default"].BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},r.onManifestParsed=function(e){var t,r=!1,i=!1;e.levels.forEach((function(e){t=e.audioCodec,t&&(-1!==t.indexOf("mp4a.40.2")&&(r=!0),-1!==t.indexOf("mp4a.40.5")&&(i=!0))})),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&d["logger"].log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var a=this.config;(a.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(a.startPosition)},r.onLevelLoaded=function(e){var t=e.details,r=e.level,i=this.levels[this.levelLastLoaded],a=this.levels[r],n=t.totalduration,s=0;if(d["logger"].log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+n),t.live){var o=a.details;o&&t.fragments.length>0?(me(o,t),s=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,o),t.PTSKnown&&Object(l["isFiniteNumber"])(s)?d["logger"].log("live playlist sliding:"+s.toFixed(3)):(d["logger"].log("live playlist - outdated PTS, unknown sliding"),ke(this.fragPrevious,i,t))):(d["logger"].log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,ke(this.fragPrevious,i,t))}else t.PTSKnown=!1;if(a.details=t,this.levelLastLoaded=r,this.hls.trigger(u["default"].LEVEL_UPDATED,{details:t,level:r}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var c=t.startTimeOffset;Object(l["isFiniteNumber"])(c)?(c<0&&(d["logger"].log("negative start time offset "+c+", count from end of last fragment"),c=s+n+c),d["logger"].log("start time offset found in playlist, adjust startPosition to "+c),this.startPosition=c):t.live?(this.startPosition=this.computeLivePosition(s,t),d["logger"].log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===We.WAITING_LEVEL&&(this.state=We.IDLE),this.tick()},r.onKeyLoaded=function(){this.state===We.KEY_LOADING&&(this.state=We.IDLE,this.tick())},r.onFragLoaded=function(e){var t=this.fragCurrent,r=this.hls,i=this.levels,a=this.media,n=e.frag;if(this.state===We.FRAG_LOADING&&t&&"main"===n.type&&n.level===t.level&&n.sn===t.sn){var s=e.stats,o=i[t.level],l=o.details;if(this.bitrateTest=!1,this.stats=s,d["logger"].log("Loaded "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level),n.bitrateTest&&r.nextLoadLevel)this.state=We.IDLE,this.startFragRequested=!1,s.tparsed=s.tbuffered=window.performance.now(),r.trigger(u["default"].FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else if("initSegment"===n.sn)this.state=We.IDLE,s.tparsed=s.tbuffered=window.performance.now(),l.initSegment.data=e.payload,r.trigger(u["default"].FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else{d["logger"].log("Parsing "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level+", cc "+t.cc),this.state=We.PARSING,this.pendingBuffering=!0,this.appended=!1,n.bitrateTest&&(n.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:n}));var c=!(a&&a.seeking)&&(l.PTSKnown||!l.live),h=l.initSegment?l.initSegment.data:[],f=this._getAudioCodec(o),g=this.demuxer=this.demuxer||new fe(this.hls,"main");g.push(e.payload,h,f,o.videoCodec,t,l.totalduration,c)}}this.fragLoadError=0},r.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===We.PARSING){var i,a,n=e.tracks;if(n.audio&&this.altAudio&&delete n.audio,a=n.audio,a){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(d["logger"].log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===o.indexOf("firefox")&&(s="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==a.container&&(s="mp4a.40.2",d["logger"].log("Android: force audio codec to "+s)),a.levelCodec=s,a.id=e.id}for(i in a=n.video,a&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=e.id),this.hls.trigger(u["default"].BUFFER_CODECS,n),n){a=n[i],d["logger"].log("main track:"+i+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var l=a.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u["default"].BUFFER_APPENDING,{type:i,data:l,parent:"main",content:"initSegment"}))}this.tick()}},r.onFragParsingData=function(e){var t=this,r=this.fragCurrent,i=e.frag;if(r&&"main"===e.id&&i.sn===r.sn&&i.level===r.level&&("audio"!==e.type||!this.altAudio)&&this.state===We.PARSING){var a=this.levels[this.level],n=r;if(Object(l["isFiniteNumber"])(e.endPTS)||(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),!0===e.hasAudio&&n.addElementaryStream(m.AUDIO),!0===e.hasVideo&&n.addElementaryStream(m.VIDEO),d["logger"].log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(n.dropped=e.dropped,n.dropped)if(n.backtracked)d["logger"].warn("Already backtracked on this fragment, appending with the gap",n.sn);else{var s=a.details;if(!s||n.sn!==s.startSN)return d["logger"].warn("missing video frame(s), backtracking fragment",n.sn),this.fragmentTracker.removeFragment(n),n.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=We.IDLE,this.fragPrevious=n,void this.tick();d["logger"].warn("missing video frame(s) on first frag, appending with gap",n.sn)}else n.backtracked=!1;var o=ve(a.details,n,e.startPTS,e.endPTS,e.startDTS,e.endDTS),c=this.hls;c.trigger(u["default"].LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:o,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach((function(r){r&&r.length&&t.state===We.PARSING&&(t.appended=!0,t.pendingBuffering=!0,c.trigger(u["default"].BUFFER_APPENDING,{type:e.type,data:r,parent:"main",content:"data"}))})),this.tick()}},r.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===We.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=We.PARSED,this._checkAppendedParsed())},r.onAudioTrackSwitching=function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){d["logger"].log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(d["logger"].log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=We.IDLE}var a=this.hls;a.trigger(u["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(u["default"].AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}},r.onAudioTrackSwitched=function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(d["logger"].log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()},r.onBufferCreated=function(e){var t,r,i=e.tracks,a=!1;for(var n in i){var s=i[n];"main"===s.id?(r=n,t=s,"video"===n&&(this.videoBuffer=i[n].buffer)):a=!0}a&&t?(d["logger"].log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},r.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==We.PARSING&&t!==We.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},r._checkAppendedParsed=function(){if(this.state===We.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;d["logger"].log("main buffered : "+_e.toString(t.buffered)),this.fragPrevious=e;var r=this.stats;r.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*r.total/(r.tbuffered-r.tfirst)),this.hls.trigger(u["default"].FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.state=We.IDLE}this.tick()}},r.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r=!!this.media&&re.isBuffered(this.media,this.media.currentTime)&&re.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case o["ErrorDetails"].FRAG_LOAD_ERROR:case o["ErrorDetails"].FRAG_LOAD_TIMEOUT:case o["ErrorDetails"].KEY_LOAD_ERROR:case o["ErrorDetails"].KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var i=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);d["logger"].warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=window.performance.now()+i,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=We.FRAG_LOADING_WAITING_RETRY}else d["logger"].error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=We.ERROR;break;case o["ErrorDetails"].LEVEL_LOAD_ERROR:case o["ErrorDetails"].LEVEL_LOAD_TIMEOUT:this.state!==We.ERROR&&(e.fatal?(this.state=We.ERROR,d["logger"].warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==We.WAITING_LEVEL||(this.state=We.IDLE));break;case o["ErrorDetails"].BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==We.PARSING&&this.state!==We.PARSED||(r?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=We.IDLE):(d["logger"].warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break;default:break}}},r._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,d["logger"].warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},r._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=this.mediaBuffer?this.mediaBuffer:e,r=t.buffered;!this.loadedmetadata&&r.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,r)}},r.onFragLoadEmergencyAborted=function(){this.state=We.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},r.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(m.VIDEO,e.buffered),this.state=We.IDLE,this.fragPrevious=null},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r._seekToStartPos=function(){var e=this.media,t=e.currentTime,r=e.seeking?t:this.startPosition;t!==r&&r>=0&&(d["logger"].log("target start position not buffered, seek to buffered.start(0) "+r+" from current time "+t+" "),e.currentTime=r)},r._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(d["logger"].log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},ze(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,d["logger"].log("main stream-controller: "+t+"->"+e),this.hls.trigger(u["default"].STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(Ye),$e=Je;function Ze(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function et(e,t,r){return t&&Ze(e.prototype,t),r&&Ze(e,r),e}function tt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var rt,it=window,at=(it.performance,function(e){function t(t){var r;return r=e.call(this,t,u["default"].MANIFEST_LOADED,u["default"].LEVEL_LOADED,u["default"].AUDIO_TRACK_SWITCHED,u["default"].FRAG_LOADED,u["default"].ERROR)||this,r.canload=!1,r.currentLevelIndex=null,r.manualLevelIndex=-1,r.timer=null,rt=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),r}tt(t,e);var r=t.prototype;return r.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},r.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},r.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach((function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)})),null!==this.timer&&this.loadLevel()},r.stopLoad=function(){this.canload=!1},r.onManifestLoaded=function(e){var t,r=[],i=[],a={},n=null,s=!1,l=!1;if(e.levels.forEach((function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,s=s||!!e.videoCodec,l=l||!!e.audioCodec,rt&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),n=a[e.bitrate],n?n.url.push(e.url):(e.url=[e.url],e.urlId=0,a[e.bitrate]=e,r.push(e)),t&&(t.AUDIO&&(l=!0,ge(n||e,"audio",t.AUDIO)),t.SUBTITLES&&ge(n||e,"text",t.SUBTITLES))})),s&&l&&(r=r.filter((function(e){var t=e.videoCodec;return!!t}))),r=r.filter((function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||O(t,"audio"))&&(!r||O(r,"video"))})),e.audioTracks&&(i=e.audioTracks.filter((function(e){return!e.audioCodec||O(e.audioCodec,"audio")})),i.forEach((function(e,t){e.id=t}))),r.length>0){t=r[0].bitrate,r.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=r;for(var c=0;c<r.length;c++)if(r[c].bitrate===t){this._firstLevel=c,d["logger"].log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(u["default"].MANIFEST_PARSED,{levels:r,audioTracks:i,firstLevel:this._firstLevel,stats:e.stats,audio:l,video:s,altAudio:i.some((function(e){return!!e.url}))})}else this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:o["ErrorDetails"].MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},r.setLevelInternal=function(e){var t=this._levels,r=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){d["logger"].log("switching to level "+e),this.currentLevelIndex=e;var i=t[e];i.level=e,r.trigger(u["default"].LEVEL_SWITCHING,i)}var a=t[e],n=a.details;if(!n||n.live){var s=a.urlId;r.trigger(u["default"].LEVEL_LOADING,{url:a.url[s],level:e,id:s})}}else r.trigger(u["default"].ERROR,{type:o["ErrorTypes"].OTHER_ERROR,details:o["ErrorDetails"].LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},r.onError=function(e){if(e.fatal)e.type===o["ErrorTypes"].NETWORK_ERROR&&this.clearTimer();else{var t,r=!1,i=!1;switch(e.details){case o["ErrorDetails"].FRAG_LOAD_ERROR:case o["ErrorDetails"].FRAG_LOAD_TIMEOUT:case o["ErrorDetails"].KEY_LOAD_ERROR:case o["ErrorDetails"].KEY_LOAD_TIMEOUT:t=e.frag.level,i=!0;break;case o["ErrorDetails"].LEVEL_LOAD_ERROR:case o["ErrorDetails"].LEVEL_LOAD_TIMEOUT:t=e.context.level,r=!0;break;case o["ErrorDetails"].REMUX_ALLOC_ERROR:t=e.level,r=!0;break}void 0!==t&&this.recoverLevel(e,t,r,i)}},r.recoverLevel=function(e,t,r,i){var a,n,s,o=this,l=this.hls.config,u=e.details,c=this._levels[t];if(c.loadError++,c.fragmentError=i,r){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return d["logger"].error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);n=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return o.loadLevel()}),n),e.levelRetry=!0,this.levelRetryCount++,d["logger"].warn("level controller, "+u+", retry in "+n+" ms, current retry count is "+this.levelRetryCount)}(r||i)&&(a=c.url.length,a>1&&c.loadError<a?(c.urlId=(c.urlId+1)%a,c.details=void 0,d["logger"].warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+c.urlId)):-1===this.manualLevelIndex?(s=0===t?this._levels.length-1:t-1,d["logger"].warn("level controller, "+u+": switch to "+s),this.hls.nextAutoLevel=this.currentLevelIndex=s):i&&(d["logger"].warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},r.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var r=this._levels[t.level];void 0!==r&&(r.fragmentError=!1,r.loadError=0,this.levelRetryCount=0)}},r.onLevelLoaded=function(e){var t=this,r=e.level,i=e.details;if(r===this.currentLevelIndex){var a=this._levels[r];if(a.fragmentError||(a.loadError=0,this.levelRetryCount=0),i.live){var n=Se(a.details,i,e.stats.trequest);d["logger"].log("live playlist, reload in "+Math.round(n)+" ms"),this.timer=setTimeout((function(){return t.loadLevel()}),n)}else this.clearTimer()}},r.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var i=-1,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===t){i=a;break}i!==r.urlId&&(r.urlId=i,this.startLoad())}},r.loadLevel=function(){if(d["logger"].debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"===typeof e&&e.url.length>0){var t=this.currentLevelIndex,r=e.urlId,i=e.url[r];d["logger"].log("Attempt loading level index "+t+" with URL-id "+r),this.hls.trigger(u["default"].LEVEL_LOADING,{url:i,level:t,id:r})}}},et(t,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(f)),nt=r("./src/demux/id3.js");function st(e,t){var r;try{r=new Event("addtrack")}catch(i){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function ot(e){if(e&&e.cues)while(e.cues.length>0)e.removeCue(e.cues[0])}function lt(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];var r=0,i=e.length-1;while(r<=i){var a=Math.floor((i+r)/2);if(t<e[a].endTime)i=a-1;else{if(!(t>e[a].endTime))return e[a];r=a+1}}return e[r].endTime-t<t-e[i].endTime?e[r]:e[i]}function ut(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var dt=function(e){function t(t){var r;return r=e.call(this,t,u["default"].MEDIA_ATTACHED,u["default"].MEDIA_DETACHING,u["default"].FRAG_PARSING_METADATA,u["default"].LIVE_BACK_BUFFER_REACHED)||this,r.id3Track=void 0,r.media=void 0,r}ut(t,e);var r=t.prototype;return r.destroy=function(){f.prototype.destroy.call(this)},r.onMediaAttached=function(e){this.media=e.media,this.media},r.onMediaDetaching=function(){ot(this.id3Track),this.id3Track=void 0,this.media=void 0},r.getID3Track=function(e){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return st(r,this.media),r}return this.media.addTextTrack("metadata","id3")},r.onFragParsingMetadata=function(e){var t=e.frag,r=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,a=0;a<r.length;a++){var n=nt["default"].getID3Frames(r[a].data);if(n){var s=r[a].pts,o=a<r.length-1?r[a+1].pts:t.endPTS;s===o?o+=1e-4:s>o&&(d["logger"].warn("detected an id3 sample with endTime < startTime, adjusting endTime to (startTime + 0.25)"),o=s+.25);for(var l=0;l<n.length;l++){var u=n[l];if(!nt["default"].isTimeStampFrame(u)){var c=new i(s,o,"");c.value=u,this.id3Track.addCue(c)}}}}},r.onLiveBackBufferReached=function(e){var t=e.bufferEnd,r=this.id3Track;if(r&&r.cues&&r.cues.length){var i=lt(r.cues,t);if(i)while(r.cues[0]!==i)r.removeCue(r.cues[0])}},t}(f),ct=dt;function ht(){var e=se();if(!e)return!1;var t=self.SourceBuffer||self.WebKitSourceBuffer,r=e&&"function"===typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove;return!!r&&!!i}var ft=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),gt=ft,pt=function(){function e(e,t,r,i){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new gt(t),this.fast_=new gt(r)}var t=e.prototype;return t.sample=function(e,t){e=Math.max(e,this.minDelayMs_);var r=8*t,i=e/1e3,a=r/i;this.fast_.sample(i,a),this.slow_.sample(i,a)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}(),vt=pt;function mt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function yt(e,t,r){return t&&mt(e.prototype,t),r&&mt(e,r),e}function Et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var St=window,bt=St.performance,_t=function(e){function t(t){var r;return r=e.call(this,t,u["default"].FRAG_LOADING,u["default"].FRAG_LOADED,u["default"].FRAG_BUFFERED,u["default"].ERROR)||this,r.lastLoadedFragLevel=0,r._nextAutoLevel=-1,r.hls=t,r.timer=null,r._bwEstimator=null,r.onCheck=r._abandonRulesCheck.bind(Et(r)),r}Tt(t,e);var r=t.prototype;return r.destroy=function(){this.clearTimer(),f.prototype.destroy.call(this)},r.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var r,i,a=this.hls,n=a.config,s=t.level,o=a.levels[s].details.live;o?(r=n.abrEwmaFastLive,i=n.abrEwmaSlowLive):(r=n.abrEwmaFastVoD,i=n.abrEwmaSlowVoD),this._bwEstimator=new vt(a,i,r,n.abrEwmaDefaultEstimate)}},r._abandonRulesCheck=function(){var e=this.hls,t=e.media,r=this.fragCurrent;if(r){var i=r.loader,a=e.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return d["logger"].warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var n=i.stats;if(t&&n&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var s=bt.now()-n.trequest,o=Math.abs(t.playbackRate);if(s>500*r.duration/o){var l=e.levels,c=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/s),h=l[r.level],f=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,g=n.total?n.total:Math.max(n.loaded,Math.round(r.duration*f/8)),p=t.currentTime,v=(g-n.loaded)/c,m=(re.bufferInfo(t,p,e.config.maxBufferHole).end-p)/o;if(m<2*r.duration/o&&v>m){var y,E;for(E=r.level-1;E>a;E--){var T=l[E].realBitrate?Math.max(l[E].realBitrate,l[E].bitrate):l[E].bitrate,S=r.duration*T/(6.4*c);if(S<m)break}y<v&&(d["logger"].warn("loading too slow, abort fragment loading and switch to level "+E+":fragLoadedDelay["+E+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+y.toFixed(1)+"<"+v.toFixed(1)+":"+m.toFixed(1)),e.nextLoadLevel=E,this._bwEstimator.sample(s,n.loaded),i.abort(),this.clearTimer(),e.trigger(u["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n}))}}}}},r.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&Object(l["isFiniteNumber"])(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[t.level],i=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,a=(r.loaded?r.loaded.duration:0)+e.frag.duration;r.loaded={bytes:i,duration:a},r.realBitrate=Math.round(8*i/a)}if(e.frag.bitrateTest){var n=e.stats;n.tparsed=n.tbuffered=n.tload,this.onFragBuffered(e)}}},r.onFragBuffered=function(e){var t=e.stats,r=e.frag;if(!0!==t.aborted&&"main"===r.type&&Object(l["isFiniteNumber"])(r.sn)&&(!r.bitrateTest||t.tload===t.tbuffered)){var i=t.tparsed-t.trequest;d["logger"].log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(i,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},r.onError=function(e){switch(e.details){case o["ErrorDetails"].FRAG_LOAD_ERROR:case o["ErrorDetails"].FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},r.clearTimer=function(){clearInterval(this.timer),this.timer=null},r._findBestLevel=function(e,t,r,i,a,n,s,o,l){for(var u=a;u>=i;u--){var c=l[u];if(c){var h=c.details,f=h?h.totalduration/h.fragments.length:t,g=!!h&&h.live,p=void 0;p=u<=e?s*r:o*r;var v=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,m=v*f/p;if(d["logger"].trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+v+"/"+f+"/"+n+"/"+m),p>v&&(!m||g&&!this.bitrateTestDelay||m<n))return u}}return-1},yt(t,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(-1!==e&&(!t||!t.canEstimate()))return e;var r=this._nextABRAutoLevel;return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.levels,i=e.config,a=e.minAutoLevel,n=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,h=(re.bufferInfo(n,l,i.maxBufferHole).end-l)/u,f=this._findBestLevel(s,o,c,a,t,h,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(f>=0)return f;d["logger"].trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,v=i.abrBandWidthUpFactor;if(0===h){var m=this.bitrateTestDelay;if(m){var y=o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay;g=y-m,d["logger"].trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),p=v=1}}return f=this._findBestLevel(s,o,c,a,t,h+g,p,v,r),Math.max(f,0)}}]),t}(f),At=_t;function Rt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Dt=se(),Lt=function(e){function t(t){var r;return r=e.call(this,t,u["default"].MEDIA_ATTACHING,u["default"].MEDIA_DETACHING,u["default"].MANIFEST_PARSED,u["default"].BUFFER_RESET,u["default"].BUFFER_APPENDING,u["default"].BUFFER_CODECS,u["default"].BUFFER_EOS,u["default"].BUFFER_FLUSHING,u["default"].LEVEL_PTS_UPDATED,u["default"].LEVEL_UPDATED)||this,r._msDuration=null,r._levelDuration=null,r._levelTargetDuration=10,r._live=null,r._objectUrl=null,r._needsFlush=!1,r._needsEos=!1,r.config=void 0,r.audioTimestampOffset=void 0,r.bufferCodecEventsExpected=0,r._bufferCodecEventsTotal=0,r.media=null,r.mediaSource=null,r.segments=[],r.parent=void 0,r.appending=!1,r.appended=0,r.appendError=0,r.flushBufferCounter=0,r.tracks={},r.pendingTracks={},r.sourceBuffer={},r.flushRange=[],r._onMediaSourceOpen=function(){d["logger"].log("media source opened"),r.hls.trigger(u["default"].MEDIA_ATTACHED,{media:r.media});var e=r.mediaSource;e&&e.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},r._onMediaSourceClose=function(){d["logger"].log("media source closed")},r._onMediaSourceEnded=function(){d["logger"].log("media source ended")},r._onSBUpdateEnd=function(){if(r.audioTimestampOffset&&r.sourceBuffer.audio){var e=r.sourceBuffer.audio;d["logger"].warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+r.audioTimestampOffset),e.timestampOffset=r.audioTimestampOffset,delete r.audioTimestampOffset}r._needsFlush&&r.doFlush(),r._needsEos&&r.checkEos(),r.appending=!1;var t=r.parent,i=r.segments.reduce((function(e,r){return r.parent===t?e+1:e}),0),a={},n=r.sourceBuffer;for(var s in n){var o=n[s];if(!o)throw Error("handling source buffer update end error: source buffer for "+s+" uninitilized and unable to update buffered TimeRanges.");a[s]=o.buffered}r.hls.trigger(u["default"].BUFFER_APPENDED,{parent:t,pending:i,timeRanges:a}),r._needsFlush||r.doAppending(),r.updateMediaElementDuration(),0===i&&r.flushLiveBackBuffer()},r._onSBUpdateError=function(e){d["logger"].error("sourceBuffer error:",e),r.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:o["ErrorDetails"].BUFFER_APPENDING_ERROR,fatal:!1})},r.config=t.config,r}Rt(t,e);var r=t.prototype;return r.destroy=function(){f.prototype.destroy.call(this)},r.onLevelPtsUpdated=function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){var i=this.sourceBuffer.audio;if(!i)throw Error("Level PTS Updated and source buffer for audio uninitalized");var a=Math.abs(i.timestampOffset-e.start);if(a>.1){var n=i.updating;try{i.abort()}catch(s){d["logger"].warn("can not abort audio buffer: "+s)}n?this.audioTimestampOffset=e.start:(d["logger"].warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+e.start),i.timestampOffset=e.start)}}},r.onManifestParsed=function(e){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e.altAudio?2:1,d["logger"].log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},r.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&Dt){var r=this.mediaSource=new Dt;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(r),this._objectUrl=t.src}},r.onMediaDetaching=function(){d["logger"].log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(t){d["logger"].warn("onMediaDetaching:"+t.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):d["logger"].warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(u["default"].MEDIA_DETACHED)},r.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,r=Object.keys(t).length;(r&&!e||2===r)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},r.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{r&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this._onSBUpdateEnd),r.removeEventListener("error",this._onSBUpdateError))}catch(i){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},r.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach((function(r){t.pendingTracks[r]=e[r]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},r.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var i in e)if(!t[i]){var a=e[i];if(!a)throw Error("source buffer exists for track "+i+", however track does not");var n=a.levelCodec||a.codec,s=a.container+";codecs="+n;d["logger"].log("creating sourceBuffer("+s+")");try{var l=t[i]=r.addSourceBuffer(s);l.addEventListener("updateend",this._onSBUpdateEnd),l.addEventListener("error",this._onSBUpdateError),this.tracks[i]={buffer:l,codec:n,id:a.id,container:a.container,levelCodec:a.levelCodec}}catch(c){d["logger"].error("error while trying to add sourceBuffer:"+c.message),this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:o["ErrorDetails"].BUFFER_ADD_CODEC_ERROR,fatal:!1,err:c,mimeType:s})}}this.hls.trigger(u["default"].BUFFER_CREATED,{tracks:this.tracks})},r.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},r.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var r=this.sourceBuffer[t];r&&!r.ended&&(r.ended=!0,d["logger"].log(t+" sourceBuffer now EOS"))}this.checkEos()},r.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){var i=e[r];if(i){if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}}d["logger"].log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(a){d["logger"].warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},r.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},r.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))if(this.media)for(var t=this.media.currentTime,r=this.sourceBuffer,i=Object.keys(r),a=t-Math.max(e,this._levelTargetDuration),n=i.length-1;n>=0;n--){var s=i[n],o=r[s];if(o){var l=o.buffered;l.length>0&&a>l.start(0)&&this.removeBufferRange(s,o,0,a)&&this.hls.trigger(u["default"].LIVE_BACK_BUFFER_REACHED,{bufferEnd:a})}}else d["logger"].error("flushLiveBackBuffer called without attaching media")}},r.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},r.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer){var i=this.sourceBuffer[r];if(i&&!0===i.updating)return}e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(d["logger"].log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(l["isFiniteNumber"])(e))&&(d["logger"].log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},r.doFlush=function(){while(this.flushRange.length){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var i in r){var a=r[i];a&&(t+=a.buffered.length)}}catch(n){d["logger"].error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u["default"].BUFFER_FLUSHED)}},r.doAppending=function(){var e=this.config,t=this.hls,r=this.segments,i=this.sourceBuffer;if(Object.keys(i).length){if(!this.media||this.media.error)return this.segments=[],void d["logger"].error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var a=r.shift();if(a)try{var n=i[a.type];if(!n)return void this._onSBUpdateEnd();if(n.updating)return void r.unshift(a);n.ended=!1,this.parent=a.parent,n.appendBuffer(a.data),this.appendError=0,this.appended++,this.appending=!0}catch(l){d["logger"].error("error while trying to append buffer:"+l.message),r.unshift(a);var s={type:o["ErrorTypes"].MEDIA_ERROR,parent:a.parent,details:"",fatal:!1};22===l.code?(this.segments=[],s.details=o["ErrorDetails"].BUFFER_FULL_ERROR):(this.appendError++,s.details=o["ErrorDetails"].BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(d["logger"].log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],s.fatal=!0)),t.trigger(u["default"].ERROR,s)}}}},r.flushBuffer=function(e,t,r){var i=this.sourceBuffer;if(!Object.keys(i).length)return!0;var a="null";if(this.media&&(a=this.media.currentTime.toFixed(3)),d["logger"].log("flushBuffer,pos/start/end: "+a+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return d["logger"].warn("abort flushing too many retries"),!0;var n=i[r];if(n){if(n.ended=!1,n.updating)return d["logger"].warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(r,n,e,t))return this.flushBufferCounter++,!1}return d["logger"].log("buffer flushed"),!0},r.removeBufferRange=function(e,t,r,i){try{for(var a=0;a<t.buffered.length;a++){var n=t.buffered.start(a),s=t.buffered.end(a),o=Math.max(n,r),l=Math.min(s,i);if(Math.min(l,s)-o>.5){var u="null";return this.media&&(u=this.media.currentTime.toString()),d["logger"].log("sb remove "+e+" ["+o+","+l+"], of ["+n+","+s+"], pos:"+u),t.remove(o,l),!0}}}catch(c){d["logger"].warn("removeBufferRange failed",c)}return!1},t}(f),wt=Lt;function kt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function It(e,t,r){return t&&kt(e.prototype,t),r&&kt(e,r),e}function Ot(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Ct=function(e){function t(t){var r;return r=e.call(this,t,u["default"].FPS_DROP_LEVEL_CAPPING,u["default"].MEDIA_ATTACHING,u["default"].MANIFEST_PARSED,u["default"].BUFFER_CODECS,u["default"].MEDIA_DETACHING)||this,r.autoLevelCapping=Number.POSITIVE_INFINITY,r.firstLevel=null,r.levels=[],r.media=null,r.restrictedLevels=[],r.timer=null,r}Ot(t,e);var r=t.prototype;return r.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.stopCapping())},r.onFpsDropLevelCapping=function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},r.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},r.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},r.onBufferCodecs=function(e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},r.onLevelsUpdated=function(e){this.levels=e.levels},r.onMediaDetaching=function(){this.stopCapping()},r.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},r.getMaxLevel=function(e){var r=this;if(!this.levels)return-1;var i=this.levels.filter((function(i,a){return t.isLevelAllowed(a,r.restrictedLevels)&&a<=e}));return t.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},r.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},r.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},t.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,r){if(!e||e&&!e.length)return-1;for(var i=function(e,t){return!t||(e.width!==t.width||e.height!==t.height)},a=e.length-1,n=0;n<e.length;n+=1){var s=e[n];if((s.width>=t||s.height>=r)&&i(s,e[n+1])){a=n;break}}return a},It(t,[{key:"mediaWidth",get:function(){var e,r=this.media;return r&&(e=r.width||r.clientWidth||r.offsetWidth,e*=t.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e,r=this.media;return r&&(e=r.height||r.clientHeight||r.offsetHeight,e*=t.contentScaleFactor),e}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(t){}return e}}]),t}(f),Pt=Ct;function xt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Ft=window,Mt=Ft.performance,Nt=function(e){function t(t){return e.call(this,t,u["default"].MEDIA_ATTACHING)||this}xt(t,e);var r=t.prototype;return r.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},r.onMediaAttaching=function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var r=this.video=e.media instanceof window.HTMLVideoElement?e.media:null;"function"===typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},r.checkFPS=function(e,t,r){var i=Mt.now();if(t){if(this.lastTime){var a=i-this.lastTime,n=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*n/a,l=this.hls;if(l.trigger(u["default"].FPS_DROP,{currentDropped:n,currentDecoded:s,totalDroppedFrames:r}),o>0&&n>l.config.fpsDroppedMonitoringThreshold*s){var c=l.currentLevel;d["logger"].warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=c)&&(c-=1,l.trigger(u["default"].FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,l.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},r.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},t}(f),Ut=Nt,Bt=window,Gt=Bt.performance,Kt=Bt.XMLHttpRequest,jt=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:Gt.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e,t=this.context;e=this.loader=new Kt;var r=this.stats;r.tfirst=0,r.loaded=0;var i=this.xhrSetup;try{if(i)try{i(e,t.url)}catch(a){e.open("GET",t.url,!0),i(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(a){return void this.callbacks.onError({code:e.status,text:a.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},t.readystatechange=function(e){var t=e.currentTarget,r=t.readyState,i=this.stats,a=this.context,n=this.config;if(!i.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(Gt.now(),i.trequest)),4===r){var s=t.status;if(s>=200&&s<300){var o,l;i.tload=Math.max(i.tfirst,Gt.now()),"arraybuffer"===a.responseType?(o=t.response,l=o.byteLength):(o=t.responseText,l=o.length),i.loaded=i.total=l;var u={url:t.responseURL,data:o};this.callbacks.onSuccess(u,i,a,t)}else i.retry>=n.maxRetry||s>=400&&s<499?(d["logger"].error(s+" while loading "+a.url),this.callbacks.onError({code:s,text:t.statusText},a,t)):(d["logger"].warn(s+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,n.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),n.timeout)},t.loadtimeout=function(){d["logger"].warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,r=this.stats;r.loaded=e.loaded,e.lengthComputable&&(r.total=e.total);var i=this.callbacks.onProgress;i&&i(r,this.context,null,t)},e}(),Ht=jt;function Vt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Wt(e,t,r){return t&&Vt(e.prototype,t),r&&Vt(e,r),e}function Yt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var qt=function(e){function t(t){var r;return r=e.call(this,t,u["default"].MANIFEST_LOADING,u["default"].MANIFEST_PARSED,u["default"].AUDIO_TRACK_LOADED,u["default"].AUDIO_TRACK_SWITCHED,u["default"].LEVEL_LOADED,u["default"].ERROR)||this,r._trackId=-1,r._selectDefaultTrack=!0,r.tracks=[],r.trackIdBlacklist=Object.create(null),r.audioGroupId=null,r}Yt(t,e);var r=t.prototype;return r.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},r.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(u["default"].AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},r.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)d["logger"].warn("Invalid audio track id:",e.id);else{if(d["logger"].log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},r.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},r.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},r.onError=function(e){e.type===o["ErrorTypes"].NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===o["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR&&(d["logger"].warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},r._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)d["logger"].debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)d["logger"].warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];d["logger"].log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var r=t.url,i=t.type,a=t.id;this.hls.trigger(u["default"].AUDIO_TRACK_SWITCHING,{id:a,type:i,url:r}),this._loadTrackDetailsIfNeeded(t)}},r.doTick=function(){this._updateTrack(this._trackId)},r._selectAudioGroup=function(e){var t=this.hls.levels[e];if(t&&t.audioGroupIds){var r=t.audioGroupIds[t.urlId];this.audioGroupId!==r&&(this.audioGroupId=r,this._selectInitialAudioTrack())}},r._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var r=this.tracks[this._trackId],i=null;if(r&&(i=r.name),this._selectDefaultTrack){var a=t.filter((function(e){return e.default}));a.length?t=a:d["logger"].warn("No default audio tracks defined")}var n=!1,s=function(){t.forEach((function(t){n||e.audioGroupId&&t.groupId!==e.audioGroupId||i&&i!==t.name||(e._setAudioTrack(t.id),n=!0)}))};s(),n||(i=null,s()),n||(d["logger"].error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:o["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},r._needsTrackLoading=function(e){var t=e.details,r=e.url;return!(t&&!t.live)&&!!r},r._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,r=e.id;d["logger"].log("loading audio-track playlist for id: "+r),this.hls.trigger(u["default"].AUDIO_TRACK_LOADING,{url:t,id:r})}},r._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,d["logger"].log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},r._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],r=t.name,i=t.language,a=t.groupId;d["logger"].warn("Loading failed on audio track id: "+e+", group-id: "+a+', name/language: "'+r+'" / "'+i+'"');for(var n=e,s=0;s<this.tracks.length;s++)if(!this.trackIdBlacklist[s]){var o=this.tracks[s];if(o.name===r){n=s;break}}n!==e?(d["logger"].log("Attempting audio-track fallback id:",n,"group-id:",this.tracks[n].groupId),this._setAudioTrack(n)):d["logger"].warn('No fallback audio-track found for name/language: "'+r+'" / "'+i+'"')},Wt(t,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),t}(He),zt=qt;function Xt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Qt(e,t,r){return t&&Xt(e.prototype,t),r&&Xt(e,r),e}function Jt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var $t=window,Zt=$t.performance,er=100,tr=function(e){function t(t,r){var i;return i=e.call(this,t,u["default"].MEDIA_ATTACHED,u["default"].MEDIA_DETACHING,u["default"].AUDIO_TRACKS_UPDATED,u["default"].AUDIO_TRACK_SWITCHING,u["default"].AUDIO_TRACK_LOADED,u["default"].KEY_LOADED,u["default"].FRAG_LOADED,u["default"].FRAG_PARSING_INIT_SEGMENT,u["default"].FRAG_PARSING_DATA,u["default"].FRAG_PARSED,u["default"].ERROR,u["default"].BUFFER_RESET,u["default"].BUFFER_CREATED,u["default"].BUFFER_APPENDED,u["default"].BUFFER_FLUSHED,u["default"].INIT_PTS_FOUND)||this,i.fragmentTracker=r,i.config=t.config,i.audioCodecSwap=!1,i._state=We.STOPPED,i.initPTS=[],i.waitingFragment=null,i.videoTrackCC=null,i}Jt(t,e);var r=t.prototype;return r.onInitPtsFound=function(e){var t=e.id,r=e.frag.cc,i=e.initPTS;"main"===t&&(this.initPTS[r]=i,this.videoTrackCC=r,d["logger"].log("InitPTS for cc: "+r+" found from video track: "+i),this.state===We.WAITING_INIT_PTS&&this.tick())},r.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(er),this.fragLoadError=0,t>0&&-1===e?(d["logger"].log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=We.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=We.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=We.STOPPED},r.doTick=function(){var e,t,r,i=this.hls,a=i.config;switch(this.state){case We.ERROR:case We.PAUSED:case We.BUFFER_FLUSHING:break;case We.STARTING:this.state=We.WAITING_TRACK,this.loadedmetadata=!1;break;case We.IDLE:var n=this.tracks;if(!n)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(e=this.nextLoadPosition,void 0===e)break;var s=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,c=re.bufferInfo(s,e,a.maxBufferHole),h=re.bufferInfo(o,e,a.maxBufferHole),f=c.len,g=c.end,p=this.fragPrevious,v=Math.min(a.maxBufferLength,a.maxMaxBufferLength),m=Math.max(v,h.len),y=this.audioSwitch,E=this.trackId;if((f<m||y)&&E<n.length){if(r=n[E].details,"undefined"===typeof r){this.state=We.WAITING_TRACK;break}if(!y&&this._streamEnded(c,r))return this.hls.trigger(u["default"].BUFFER_EOS,{type:"audio"}),void(this.state=We.ENDED);var T,S=r.fragments,b=S.length,_=S[0].start,A=S[b-1].start+S[b-1].duration;if(y)if(r.live&&!r.PTSKnown)d["logger"].log("switching audiotrack, live stream, unknown PTS,load first fragment"),g=0;else if(g=e,r.PTSKnown&&e<_){if(!(c.end>_||c.nextStart))return;d["logger"].log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=_+.05}if(r.initSegment&&!r.initSegment.data)T=r.initSegment;else if(g<=_){if(T=S[0],null!==this.videoTrackCC&&T.cc!==this.videoTrackCC&&(T=Re(S,this.videoTrackCC)),r.live&&T.loadIdx&&T.loadIdx===this.fragLoadIdx){var R=c.nextStart?c.nextStart:_;return d["logger"].log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(R+.05)),void(this.media.currentTime=R+.05)}}else{var D,L=a.maxFragLookUpTolerance,w=p?S[p.sn-S[0].sn+1]:void 0,k=function(e){var t=Math.min(L,e.duration);return e.start+e.duration-t<=g?1:e.start-t>g&&e.start?-1:0};g<A?(g>A-L&&(L=0),D=w&&!k(w)?w:te.search(S,k)):D=S[b-1],D&&(T=D,_=D.start,p&&T.level===p.level&&T.sn===p.sn&&(T.sn<r.endSN?(T=S[T.sn+1-r.startSN],d["logger"].log("SN just loaded, load next one: "+T.sn)):T=null))}T&&(T.encrypted?(d["logger"].log("Loading key for "+T.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+E),this.state=We.KEY_LOADING,i.trigger(u["default"].KEY_LOADING,{frag:T})):(d["logger"].log("Loading "+T.sn+", cc: "+T.cc+" of ["+r.startSN+" ,"+r.endSN+"],track "+E+", currentTime:"+e+",bufferEnd:"+g.toFixed(3)),this.fragCurrent=T,(y||this.fragmentTracker.getState(T)===$.NOT_LOADED)&&("initSegment"!==T.sn&&(this.startFragRequested=!0),Object(l["isFiniteNumber"])(T.sn)&&(this.nextLoadPosition=T.start+T.duration),i.trigger(u["default"].FRAG_LOADING,{frag:T}),this.state=We.FRAG_LOADING)))}break;case We.WAITING_TRACK:t=this.tracks[this.trackId],t&&t.details&&(this.state=We.IDLE);break;case We.FRAG_LOADING_WAITING_RETRY:var I=Zt.now(),O=this.retryDate;s=this.media;var C=s&&s.seeking;(!O||I>=O||C)&&(d["logger"].log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=We.IDLE);break;case We.WAITING_INIT_PTS:var P=this.videoTrackCC;if(void 0===this.initPTS[P])break;var x=this.waitingFragment;if(x){var F=x.frag.cc;P!==F?(t=this.tracks[this.trackId],t.details&&t.details.live&&(d["logger"].warn("Waiting fragment CC ("+F+") does not match video track CC ("+P+")"),this.waitingFragment=null,this.state=We.IDLE)):(this.state=We.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=We.IDLE;break;case We.STOPPED:case We.FRAG_LOADING:case We.PARSING:case We.PARSED:case We.ENDED:break;default:break}},r.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)},r.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(d["logger"].log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},r.onAudioTracksUpdated=function(e){d["logger"].log("audio tracks updated"),this.tracks=e.audioTracks},r.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=We.PAUSED,this.waitingFragment=null,t?this.setInterval(er):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=We.IDLE),this.tick()},r.onAudioTrackLoaded=function(e){var t=e.details,r=e.id,i=this.tracks[r],a=t.totalduration,n=0;if(d["logger"].log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live){var s=i.details;s&&t.fragments.length>0?(me(s,t),n=t.fragments[0].start,t.PTSKnown?d["logger"].log("live audio playlist sliding:"+n.toFixed(3)):d["logger"].log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,d["logger"].log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(i.details=t,!this.startFragRequested){if(-1===this.startPosition){var o=t.startTimeOffset;Object(l["isFiniteNumber"])(o)?(d["logger"].log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o):t.live?(this.startPosition=this.computeLivePosition(n,t),d["logger"].log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===We.WAITING_TRACK&&(this.state=We.IDLE),this.tick()},r.onKeyLoaded=function(){this.state===We.KEY_LOADING&&(this.state=We.IDLE,this.tick())},r.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag;if(this.state===We.FRAG_LOADING&&t&&"audio"===r.type&&r.level===t.level&&r.sn===t.sn){var i=this.tracks[this.trackId],a=i.details,n=a.totalduration,s=t.level,o=t.sn,l=t.cc,c=this.config.defaultAudioCodec||i.audioCodec||"mp4a.40.2",h=this.stats=e.stats;if("initSegment"===o)this.state=We.IDLE,h.tparsed=h.tbuffered=Zt.now(),a.initSegment.data=e.payload,this.hls.trigger(u["default"].FRAG_BUFFERED,{stats:h,frag:t,id:"audio"}),this.tick();else{this.state=We.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new fe(this.hls,"audio"));var f=this.initPTS[l],g=a.initSegment?a.initSegment.data:[];if(a.initSegment||void 0!==f){this.pendingBuffering=!0,d["logger"].log("Demuxing "+o+" of ["+a.startSN+" ,"+a.endSN+"],track "+s);var p=!1;this.demuxer.push(e.payload,g,c,null,t,n,p,f)}else d["logger"].log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+o+" of ["+a.startSN+" ,"+a.endSN+"],track "+s),this.waitingFragment=e,this.state=We.WAITING_INIT_PTS}}this.fragLoadError=0},r.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===We.PARSING){var i,a=e.tracks;if(a.video&&delete a.video,i=a.audio,i){i.levelCodec=i.codec,i.id=e.id,this.hls.trigger(u["default"].BUFFER_CODECS,a),d["logger"].log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var n=i.initSegment;if(n){var s={type:"audio",data:n,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u["default"].BUFFER_APPENDING,s))}this.tick()}}},r.onFragParsingData=function(e){var t=this,r=this.fragCurrent,i=e.frag;if(r&&"audio"===e.id&&"audio"===e.type&&i.sn===r.sn&&i.level===r.level&&this.state===We.PARSING){var a=this.trackId,n=this.tracks[a],s=this.hls;Object(l["isFiniteNumber"])(e.endPTS)||(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),r.addElementaryStream(m.AUDIO),d["logger"].log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),ve(n.details,r,e.startPTS,e.endPTS);var c=this.audioSwitch,h=this.media,f=!1;if(c)if(h&&h.readyState){var g=h.currentTime;d["logger"].log("switching audio track : currentTime:"+g),g>=e.startPTS&&(d["logger"].log("switching audio track : flushing all audio"),this.state=We.BUFFER_FLUSHING,s.trigger(u["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),f=!0,this.audioSwitch=!1,s.trigger(u["default"].AUDIO_TRACK_SWITCHED,{id:a}))}else this.audioSwitch=!1,s.trigger(u["default"].AUDIO_TRACK_SWITCHED,{id:a});var p=this.pendingData;if(!p)return d["logger"].warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void s.trigger(u["default"].ERROR,{type:o["ErrorTypes"].MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach((function(t){t&&t.length&&p.push({type:e.type,data:t,parent:"audio",content:"data"})})),!f&&p.length&&(p.forEach((function(e){t.state===We.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(u["default"].BUFFER_APPENDING,e))})),this.pendingData=[],this.appended=!0)),this.tick()}},r.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===We.PARSING&&(this.stats.tparsed=Zt.now(),this.state=We.PARSED,this._checkAppendedParsed())},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},r.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==We.PARSING&&t!==We.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},r._checkAppendedParsed=function(){if(this.state===We.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e,t.tbuffered=Zt.now(),r.trigger(u["default"].FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;i&&d["logger"].log("audio buffered : "+_e.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(u["default"].AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=We.IDLE}this.tick()}},r.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case o["ErrorDetails"].FRAG_LOAD_ERROR:case o["ErrorDetails"].FRAG_LOAD_TIMEOUT:var r=e.frag;if(r&&"audio"!==r.type)break;if(!e.fatal){var i=this.fragLoadError;i?i++:i=1;var a=this.config;if(i<=a.fragLoadingMaxRetry){this.fragLoadError=i;var n=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);d["logger"].warn("AudioStreamController: frag loading failed, retry in "+n+" ms"),this.retryDate=Zt.now()+n,this.state=We.FRAG_LOADING_WAITING_RETRY}else d["logger"].error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=We.ERROR}break;case o["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR:case o["ErrorDetails"].AUDIO_TRACK_LOAD_TIMEOUT:case o["ErrorDetails"].KEY_LOAD_ERROR:case o["ErrorDetails"].KEY_LOAD_TIMEOUT:this.state!==We.ERROR&&(this.state=e.fatal?We.ERROR:We.IDLE,d["logger"].warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case o["ErrorDetails"].BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===We.PARSING||this.state===We.PARSED)){var s=this.mediaBuffer,l=this.media.currentTime,c=s&&re.isBuffered(s,l)&&re.isBuffered(s,l+.5);if(c){var h=this.config;h.maxMaxBufferLength>=h.maxBufferLength&&(h.maxMaxBufferLength/=2,d["logger"].warn("AudioStreamController: reduce max buffer length to "+h.maxMaxBufferLength+"s")),this.state=We.IDLE}else d["logger"].warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=We.BUFFER_FLUSHING,this.hls.trigger(u["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}break;default:break}},r.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(d["logger"].log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach((function(t){e.hls.trigger(u["default"].BUFFER_APPENDING,t)})),this.appended=!0,this.pendingData=[],this.state=We.PARSED):(this.state=We.IDLE,this.fragPrevious=null,this.tick())},Qt(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,d["logger"].log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(Ye),rr=tr,ir=function(){if("undefined"!==typeof window&&window.VTTCue)return window.VTTCue;var e="auto",t={"":!0,lr:!0,rl:!0},r={start:!0,middle:!0,end:!0,left:!0,right:!0};function i(e){if("string"!==typeof e)return!1;var r=t[e.toLowerCase()];return!!r&&e.toLowerCase()}function a(e){if("string"!==typeof e)return!1;var t=r[e.toLowerCase()];return!!t&&e.toLowerCase()}function n(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]=r[i]}return e}function s(t,r,s){var o=this,l={enumerable:!0};o.hasBeenReset=!1;var u="",d=!1,c=t,h=r,f=s,g=null,p="",v=!0,m="auto",y="start",E=50,T="middle",S=50,b="middle";Object.defineProperty(o,"id",n({},l,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",n({},l,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",n({},l,{get:function(){return c},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},l,{get:function(){return h},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},l,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},l,{get:function(){return p},set:function(e){var t=i(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},l,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},l,{get:function(){return m},set:function(t){if("number"!==typeof t&&t!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},l,{get:function(){return y},set:function(e){var t=a(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},l,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},l,{get:function(){return T},set:function(e){var t=a(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},l,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},l,{get:function(){return b},set:function(e){var t=a(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){var e=window.WebVTT;return e.convertCueToDOMTree(window,this.text)},s}(),ar=function(){return{decode:function(e){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function nr(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new ar,this.regionList=[]}function sr(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+(0|i)/1e3}var r=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return r?r[3]?t(r[1],r[2],r[3].replace(":",""),r[4]):r[1]>59?t(r[1],r[2],0,r[4]):t(0,r[1],r[2],r[4]):null}function or(){this.values=Object.create(null)}function lr(e,t,r,i){var a=i?e.split(i):[e];for(var n in a)if("string"===typeof a[n]){var s=a[n].split(r);if(2===s.length){var o=s[0],l=s[1];t(o,l)}}}or.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t),t>=0&&t<=100))&&(this.set(e,t),!0)}};var ur=new ir(0,0,0),dr="middle"===ur.align?"middle":"center";function cr(e,t,r){var i=e;function a(){var t=sr(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(e,t){var i=new or;lr(e,(function(e,t){switch(e){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===t){i.set(e,r[a].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var n=t.split(","),s=n[0];i.integer(e,s),i.percent(e,s)&&i.set("snapToLines",!1),i.alt(e,s,["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",dr,"end"]);break;case"position":n=t.split(","),i.percent(e,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",dr,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",dr,"end","left","right"]);break}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");var a=i.get("line","auto");"auto"===a&&-1===ur.line&&(a=-1),t.line=a,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",dr);var n=i.get("position","auto");"auto"===n&&50===ur.position&&(n="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=n}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=a(),s(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),s(),t.endTime=a(),s(),n(e,t)}function hr(e){return e.replace(/<br(?: \/)?>/gi,"\n")}nr.prototype={parse:function(e){var t=this;function r(){var e=t.buffer,r=0;e=hr(e);while(r<e.length&&"\r"!==e[r]&&"\n"!==e[r])++r;var i=e.substr(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.substr(r),i}function i(e){lr(e,(function(e,t){switch(e){case"Region":break}}),/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var a;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;a=r();var n=a.match(/^()?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}var s=!1;while(t.buffer){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:a=r(),t.state){case"HEADER":/:/.test(a)?i(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;if(t.cue=new ir(0,0,""),t.state="CUE",-1===a.indexOf("--\x3e")){t.cue.id=a;continue}case"CUE":try{cr(a,t.cue,t.regionList)}catch(l){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==a.indexOf("--\x3e");if(!a||o&&(s=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=a;continue;case"BADCUE":a||(t.state="ID");continue}}}catch(l){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return e.onflush&&e.onflush(),this}};var fr=nr;function gr(e,t,r,i){for(var a,n,s,o,l,u=window.VTTCue||TextTrackCue,d=0;d<i.rows.length;d++)if(a=i.rows[d],s=!0,o=0,l="",!a.isEmpty()){for(var c=0;c<a.chars.length;c++)a.chars[c].uchar.match(/\s/)&&s?o++:(l+=a.chars[c].uchar,s=!1);a.cueStartTime=t,t===r&&(r+=1e-4),n=new u(t,r,hr(l.trim())),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?n.line=d+1:n.line=d>7?d-2:d+1,n.align="left",n.position=Math.max(0,Math.min(100,o/32*100)),e.addCue(n)}}var pr,vr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},mr=function(e){var t=e;return vr.hasOwnProperty(e)&&(t=vr[e]),String.fromCharCode(t)},yr=15,Er=100,Tr={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Sr={17:2,18:4,21:6,22:8,23:10,19:13,20:15},br={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},_r={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ar=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(e){e[e["ERROR"]=0]="ERROR",e[e["TEXT"]=1]="TEXT",e[e["WARNING"]=2]="WARNING",e[e["INFO"]=2]="INFO",e[e["DEBUG"]=3]="DEBUG",e[e["DATA"]=3]="DATA"})(pr||(pr={}));var Rr={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e];this.verboseLevel}},Dr=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},Lr=function(){function e(e,t,r,i,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=a||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),wr=function(){function e(e,t,r,i,a,n){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Lr(t,r,i,a,n)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),kr=function(){function e(){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.chars=[];for(var e=0;e<Er;e++)this.chars.push(new wr);this.pos=0,this.currPenState=new Lr}var t=e.prototype;return t.equals=function(e){for(var t=!0,r=0;r<Er;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<Er;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<Er;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(Rr.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>Er&&(Rr.log("ERROR","Too large cursor position "+this.pos),this.pos=Er)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=mr(e);this.pos>=Er?Rr.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<Er;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,r=0;r<Er;r++){var i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)},e}(),Ir=function(){function e(){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.rows=[];for(var e=0;e<yr;e++)this.rows.push(new kr);this.currRow=yr-1,this.nrRollUpRows=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<yr;e++)this.rows[e].clear();this.currRow=yr-1},t.equals=function(e){for(var t=!0,r=0;r<yr;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<yr;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<yr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()},t.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},t.insertChar=function(e){var t=this.rows[this.currRow];t.insertChar(e)},t.setPen=function(e){var t=this.rows[this.currRow];t.setPenStyles(e)},t.moveCursor=function(e){var t=this.rows[this.currRow];t.moveCursor(e)},t.setCursor=function(e){Rr.log("INFO","setCursor: "+e);var t=this.rows[this.currRow];t.setCursor(e)},t.setPAC=function(e){Rr.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<yr;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var n=a.rows[i].cueStartTime;if(n&&Rr.time&&n<Rr.time)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(a.rows[i+s])}}this.currRow=t;var o=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,u=Math.max(l-1,0);o.setCursor(e.indent),e.color=o.chars[u].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)},t.setBkgData=function(e){Rr.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){Rr.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),Rr.log("INFO","Rolling up")}else Rr.log("DEBUG","roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],r="",i=-1,a=0;a<yr;a++){var n=this.rows[a].getTextString();n&&(i=a+1,e?t.push("Row "+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},t.getTextAndFormat=function(){return this.rows},e}(),Or=function(){function e(e,t){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.lastCueEndTime=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ir,this.nonDisplayedMemory=new Ir,this.lastOutputScreen=new Ir,this.currRollUpRow=this.displayedMemory.rows[yr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[yr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,Rr.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";Rr.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(Rr.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){Rr.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){Rr.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){Rr.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){Rr.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){Rr.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){Rr.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){Rr.log("INFO","TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){Rr.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){Rr.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){Rr.log("INFO","CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){Rr.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(Rr.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,Rr.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){Rr.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}Rr.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=Rr.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),Cr=function(){function e(e,t,r){this.field=void 0,this.outputs=void 0,this.channels=void 0,this.currChNr=void 0,this.lastCmdA=void 0,this.lastCmdB=void 0,this.lastTime=void 0,this.dataCounters=void 0,this.field=e||1,this.outputs=[t,r],this.channels=[new Or(1,t),new Or(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var r,i,a,n=!1;this.lastTime=e,Rr.setTime(e);for(var s=0;s<t.length;s+=2)if(i=127&t[s],a=127&t[s+1],0!==i||0!==a){if(Rr.log("DATA","["+Dr([t[s],t[s+1]])+"] -> ("+Dr([i,a])+")"),r=this.parseCmd(i,a),r||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(n=this.parseChars(i,a),n))if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(n)}else Rr.log("WARNING","No channel found yet. TEXT-MODE?");r?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,Rr.log("WARNING","Couldn't parse cleaned data "+Dr([i,a])+" orig: "+Dr([t[s],t[s+1]])))}else this.dataCounters.padding+=2},t.parseCmd=function(e,t){var r=null,i=(20===e||28===e)&&t>=32&&t<=47,a=(23===e||31===e)&&t>=33&&t<=35;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,Rr.log("DEBUG","Repeated command ("+Dr([e,t])+") is dropped"),!0;r=20===e||23===e?1:2;var n=this.channels[r-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},t.parseMidrow=function(e,t){var r=null;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currChNr)return Rr.log("ERROR","Mismatch channel in midrow parsing"),!1;var i=this.channels[r-1];return i.ccMIDROW(t),Rr.log("DEBUG","MIDROW ("+Dr([e,t])+")"),!0}return!1},t.parsePAC=function(e,t){var r=null,i=null,a=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,n=(16===e||24===e)&&t>=64&&t<=95;if(!a&&!n)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=e<=23?1:2,i=t>=64&&t<=95?1===r?Tr[e]:br[e]:1===r?Sr[e]:_r[e];var s=this.interpretPAC(i,t),o=this.channels[r-1];return o.setPAC(s),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},t.interpretPAC=function(e,t){var r=t,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1===(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},t.parseChars=function(e,t){var r=null,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),a>=17&&a<=19){var n=t;n=17===a?t+80:18===a?t+112:t+144,Rr.log("INFO","Special char '"+mr(n)+"' in channel "+r),i=[n]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);if(i){var s=Dr(i);Rr.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return i},t.parseBackgroundAttributes=function(e,t){var r,i,a,n,s=(16===e||24===e)&&t>=32&&t<=47,o=(23===e||31===e)&&t>=45&&t<=47;return!(!s&&!o)&&(r={},16===e||24===e?(i=Math.floor((t-32)/2),r.background=Ar[i],t%2===1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),a=e<24?1:2,n=this.channels[a-1],n.setBkgData(r),this.lastCmdA=null,this.lastCmdB=null,!0)},t.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}(),Pr=Cr,xr=function(){function e(e,t){this.timelineController=void 0,this.trackName=void 0,this.startTime=void 0,this.endTime=void 0,this.screen=void 0,this.timelineController=e,this.trackName=t,this.startTime=null,this.endTime=null,this.screen=null}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},t.newCue=function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},e}(),Fr=function(e,t,r){return e.substr(r||0,t.length)===t},Mr=function(e){var t=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),i=parseInt(e.substr(-9,2)),a=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!Object(l["isFiniteNumber"])(t)||!Object(l["isFiniteNumber"])(r)||!Object(l["isFiniteNumber"])(i)||!Object(l["isFiniteNumber"])(a))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*r,t+=6e4*i,t+=36e5*a,t},Nr=function(e){var t=5381,r=e.length;while(r)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()},Ur=function(e,t,r){var i=e[t],a=e[i.prevCC];if(!a||!a.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);while(a&&a.new)e.ccOffset+=i.start-a.start,i.new=!1,i=a,a=e[i.prevCC];e.presentationOffset=r},Br={parse:function(e,t,r,i,a,n){var s,o=/\r\n|\n\r|\n|\r/g,l=Object(nt["utf8ArrayToStr"])(new Uint8Array(e)).trim().replace(o,"\n").split("\n"),u="00:00.000",d=0,c=0,h=0,f=[],g=!0,p=!1,v=new fr;v.oncue=function(e){var t=r[i],a=r.ccOffset;t&&t.new&&(void 0!==c?a=r.ccOffset=t.start:Ur(r,i,h)),h&&(a=h-r.presentationOffset),p&&(e.startTime+=a-c,e.endTime+=a-c),e.id=Nr(e.startTime.toString())+Nr(e.endTime.toString())+Nr(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&f.push(e)},v.onparsingerror=function(e){s=e},v.onflush=function(){s&&n?n(s):a(f)},l.forEach((function(e){if(g){if(Fr(e,"X-TIMESTAMP-MAP=")){g=!1,p=!0,e.substr(16).split(",").forEach((function(e){Fr(e,"LOCAL:")?u=e.substr(6):Fr(e,"MPEGTS:")&&(d=parseInt(e.substr(7)))}));try{t+(9e4*r[i].start||0)<0&&(t+=8589934592),d-=t,c=Mr(u)/1e3,h=d/9e4}catch(a){p=!1,s=a}return}""===e&&(g=!1)}v.parse(e+"\n")})),v.flush()}},Gr=Br;function Kr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jr(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Hr=function(e){function t(t){var r;if(r=e.call(this,t,u["default"].MEDIA_ATTACHING,u["default"].MEDIA_DETACHING,u["default"].FRAG_PARSING_USERDATA,u["default"].FRAG_DECRYPTED,u["default"].MANIFEST_LOADING,u["default"].MANIFEST_LOADED,u["default"].FRAG_LOADED,u["default"].INIT_PTS_FOUND)||this,r.media=null,r.config=void 0,r.enabled=!0,r.Cues=void 0,r.textTracks=[],r.tracks=[],r.initPTS=[],r.unparsedVttFrags=[],r.cueRanges=[],r.captionsTracks={},r.captionsProperties=void 0,r.cea608Parser=void 0,r.lastSn=-1,r.prevCC=-1,r.vttCCs=null,r.hls=t,r.config=t.config,r.Cues=t.config.cueHandler,r.captionsProperties={textTrack1:{label:r.config.captionsTextTrack1Label,languageCode:r.config.captionsTextTrack1LanguageCode},textTrack2:{label:r.config.captionsTextTrack2Label,languageCode:r.config.captionsTextTrack2LanguageCode}},r.config.enableCEA708Captions){var i=new xr(Kr(r),"textTrack1"),a=new xr(Kr(r),"textTrack2");r.cea608Parser=new Pr(0,i,a)}return r}jr(t,e);var r=t.prototype;return r.addCues=function(e,t,r,i){for(var a=this.cueRanges,n=!1,s=a.length;s--;){var o=a[s],l=Wr(o[0],o[1],t,r);if(l>=0&&(o[0]=Math.min(o[0],t),o[1]=Math.max(o[1],r),n=!0,l/(r-t)>.5))return}n||a.push([t,r]),this.Cues.newCue(this.captionsTracks[e],t,r,i)},r.onInitPtsFound=function(e){var t=this,r=e.frag,i=e.id,a=e.initPTS,n=this.unparsedVttFrags;"main"===i&&(this.initPTS[r.cc]=a),n.length&&(this.unparsedVttFrags=[],n.forEach((function(e){t.onFragLoaded(e)})))},r.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e])return i}return null},r.createCaptionsTrack=function(e){var t=this.captionsProperties,r=this.captionsTracks,i=this.media,a=t[e],n=a.label,s=a.languageCode;if(!r[e]){var o=this.getExistingTrack(e);if(o)r[e]=o,ot(r[e]),st(r[e],i);else{var l=this.createTextTrack("captions",n,s);l&&(l[e]=!0,r[e]=l)}}},r.createTextTrack=function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)},r.destroy=function(){e.prototype.destroy.call(this)},r.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},r.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){ot(e[t]),delete e[t]}))},r.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},r._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)ot(t[r])}},r.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var r=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,i){var a;if(i<r.length){for(var n=null,s=0;s<r.length;s++)if(Vr(r[s],e)){n=r[s];break}n&&(a=n)}a||(a=t.createTextTrack("subtitles",e.name,e.lang)),e.default?a.mode=t.hls.subtitleDisplay?"showing":"hidden":a.mode="disabled",t.textTracks.push(a)}))}},r.onFragLoaded=function(e){var t=e.frag,r=e.payload,i=this.cea608Parser,a=this.initPTS,n=this.lastSn,s=this.unparsedVttFrags;if("main"===t.type){var o=t.sn;t.sn!==n+1&&i&&i.reset(),this.lastSn=o}else if("subtitle"===t.type)if(r.byteLength){if(!Object(l["isFiniteNumber"])(a[t.cc]))return s.push(e),void(a.length&&this.hls.trigger(u["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var d=t.decryptdata;null!=d&&null!=d.key&&"AES-128"===d.method||this._parseVTTs(t,r)}else this.hls.trigger(u["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},r._parseVTTs=function(e,t){var r=this.hls,i=this.prevCC,a=this.textTracks,n=this.vttCCs;n[e.cc]||(n[e.cc]={start:e.start,prevCC:i,new:!0},this.prevCC=e.cc),Gr.parse(t,this.initPTS[e.cc],n,e.cc,(function(t){var i=a[e.level];"disabled"!==i.mode?(t.forEach((function(e){if(!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(r){d["logger"].debug("Failed occurred on adding cues: "+r);var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}})),r.trigger(u["default"].SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})):r.trigger(u["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}),(function(t){d["logger"].log("Failed to parse VTT cue: "+t),r.trigger(u["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}))},r.onFragDecrypted=function(e){var t=e.frag,r=e.payload;if("subtitle"===t.type){if(!Object(l["isFiniteNumber"])(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(t,r)}},r.onFragParsingUserdata=function(e){if(this.enabled&&this.cea608Parser)for(var t=0;t<e.samples.length;t++){var r=e.samples[t].bytes;if(r){var i=this.extractCea608Data(r);this.cea608Parser.addData(e.samples[t].pts,i)}}},r.extractCea608Data=function(e){for(var t,r,i,a,n,s=31&e[0],o=2,l=[],u=0;u<s;u++)t=e[o++],r=127&e[o++],i=127&e[o++],a=0!==(4&t),n=3&t,0===r&&0===i||a&&0===n&&(l.push(r),l.push(i));return l},t}(f);function Vr(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function Wr(e,t,r,i){return Math.min(t,i)-Math.max(e,r)}var Yr=Hr;function qr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function zr(e,t,r){return t&&qr(e.prototype,t),r&&qr(e,r),e}function Xr(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Qr=function(e){function t(t){var r;return r=e.call(this,t,u["default"].MEDIA_ATTACHED,u["default"].MEDIA_DETACHING,u["default"].MANIFEST_LOADED,u["default"].SUBTITLE_TRACK_LOADED)||this,r.tracks=[],r.trackId=-1,r.media=null,r.stopped=!0,r.subtitleDisplay=!0,r.queuedDefaultTrack=null,r}Xr(t,e);var r=t.prototype;return r.destroy=function(){f.prototype.destroy.call(this)},r.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(l["isFiniteNumber"])(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){t.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},r.onMediaDetaching=function(){if(this.media){this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(l["isFiniteNumber"])(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack);var e=Jr(this.media.textTracks);e.forEach((function(e){ot(e)})),this.subtitleTrack=-1,this.media=null}},r.onManifestLoaded=function(e){var t=this,r=e.subtitles||[];this.tracks=r,this.hls.trigger(u["default"].SUBTITLE_TRACKS_UPDATED,{subtitleTracks:r}),r.forEach((function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)}))},r.onSubtitleTrackLoaded=function(e){var t=this,r=e.id,i=e.details,a=this.trackId,n=this.tracks,s=n[a];if(r>=n.length||r!==a||!s||this.stopped)this._clearReloadTimer();else if(d["logger"].log("subtitle track "+r+" loaded"),i.live){var o=Se(s.details,i,e.stats.trequest);d["logger"].log("Reloading live subtitle playlist in "+o+"ms"),this.timer=setTimeout((function(){t._loadCurrentTrack()}),o)}else this._clearReloadTimer()},r.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},r.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},r._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},r._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,r=this.hls,i=t[e];e<0||!i||i.details&&!i.details.live||(d["logger"].log("Loading subtitle track "+e),r.trigger(u["default"].SUBTITLE_TRACK_LOADING,{url:i.url,id:e}))},r._toggleTrackModes=function(e){var t=this.media,r=this.subtitleDisplay,i=this.trackId;if(t){var a=Jr(t.textTracks);if(-1===e)[].slice.call(a).forEach((function(e){e.mode="disabled"}));else{var n=a[i];n&&(n.mode="disabled")}var s=a[e];s&&(s.mode=r?"showing":"hidden")}},r._setSubtitleTrackInternal=function(e){var t=this.hls,r=this.tracks;!Object(l["isFiniteNumber"])(e)||e<-1||e>=r.length||(this.trackId=e,d["logger"].log("Switching to subtitle track "+e),t.trigger(u["default"].SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},r._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=Jr(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack=e}},zr(t,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}]),t}(f);function Jr(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];"subtitles"===i.kind&&i.label&&t.push(e[r])}return t}var $r=Qr,Zr=r("./src/crypt/decrypter.js");function ei(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ti(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var ri,ii=window,ai=ii.performance,ni=500,si=function(e){function t(t,r){var i;return i=e.call(this,t,u["default"].MEDIA_ATTACHED,u["default"].MEDIA_DETACHING,u["default"].ERROR,u["default"].KEY_LOADED,u["default"].FRAG_LOADED,u["default"].SUBTITLE_TRACKS_UPDATED,u["default"].SUBTITLE_TRACK_SWITCH,u["default"].SUBTITLE_TRACK_LOADED,u["default"].SUBTITLE_FRAG_PROCESSED,u["default"].LEVEL_UPDATED)||this,i.fragmentTracker=r,i.config=t.config,i.state=We.STOPPED,i.tracks=[],i.tracksBuffered=[],i.currentTrackId=-1,i.decrypter=new Zr["default"](t,t.config),i.lastAVStart=0,i._onMediaSeeking=i.onMediaSeeking.bind(ei(i)),i}ti(t,e);var r=t.prototype;return r.onSubtitleFragProcessed=function(e){var t=e.frag,r=e.success;if(this.fragPrevious=t,this.state=We.IDLE,r){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var a,n=t.start,s=0;s<i.length;s++)if(n>=i[s].start&&n<=i[s].end){a=i[s];break}var o=t.start+t.duration;a?a.end=o:(a={start:n,end:o},i.push(a))}}},r.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=We.IDLE},r.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]})),this.media=null,this.state=We.STOPPED)},r.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=We.IDLE)},r.onSubtitleTracksUpdated=function(e){var t=this;d["logger"].log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]}))},r.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(ni)}else this.clearInterval()},r.onSubtitleTrackLoaded=function(e){var t=e.id,r=e.details,i=this.currentTrackId,a=this.tracks,n=a[i];t>=a.length||t!==i||!n||(r.live&&ye(n.details,r,this.lastAVStart),n.details=r,this.setInterval(ni))},r.onKeyLoaded=function(){this.state===We.KEY_LOADING&&(this.state=We.IDLE)},r.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag.decryptdata,i=e.frag,a=this.hls;if(this.state===We.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&r&&r.key&&"AES-128"===r.method){var n=ai.now();this.decrypter.decrypt(e.payload,r.key.buffer,r.iv.buffer,(function(e){var t=ai.now();a.trigger(u["default"].FRAG_DECRYPTED,{frag:i,payload:e,stats:{tstart:n,tdecrypt:t}})}))}},r.onLevelUpdated=function(e){var t=e.details,r=t.fragments;this.lastAVStart=r.length?r[0].start:0},r.doTick=function(){if(this.media)switch(this.state){case We.IDLE:var e=this.config,t=this.currentTrackId,r=this.fragmentTracker,i=this.media,a=this.tracks;if(!a||!a[t]||!a[t].details)break;var n,s=e.maxBufferHole,o=e.maxFragLookUpTolerance,l=Math.min(e.maxBufferLength,e.maxMaxBufferLength),c=re.bufferedInfo(this._getBuffered(),i.currentTime,s),h=c.end,f=c.len,g=a[t].details,p=g.fragments,v=p.length,m=p[v-1].start+p[v-1].duration;if(f>l)return;var y=this.fragPrevious;h<m?(y&&g.hasProgramDateTime&&(n=Ce(p,y.endProgramDateTime,o)),n||(n=Pe(y,p,h,o))):n=p[v-1],n&&n.encrypted?(d["logger"].log("Loading key for "+n.sn),this.state=We.KEY_LOADING,this.hls.trigger(u["default"].KEY_LOADING,{frag:n})):n&&r.getState(n)===$.NOT_LOADED&&(this.fragCurrent=n,this.state=We.FRAG_LOADING,this.hls.trigger(u["default"].FRAG_LOADING,{frag:n}))}else this.state=We.IDLE},r.stopLoad=function(){this.lastAVStart=0,e.prototype.stopLoad.call(this)},r._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},r.onMediaSeeking=function(){this.fragPrevious=null},t}(Ye);(function(e){e["WIDEVINE"]="com.widevine.alpha",e["PLAYREADY"]="com.microsoft.playready"})(ri||(ri={}));var oi=function(){return"undefined"!==typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}();function li(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ui(e,t,r){return t&&li(e.prototype,t),r&&li(e,r),e}function di(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var ci=3,hi=function(e,t){var r={videoCapabilities:[]};return t.forEach((function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})})),[r]},fi=function(e,t,r){switch(e){case ri.WIDEVINE:return hi(t,r);default:throw new Error("Unknown key-system: "+e)}},gi=function(e){function t(t){var r;return r=e.call(this,t,u["default"].MEDIA_ATTACHED,u["default"].MEDIA_DETACHED,u["default"].MANIFEST_PARSED)||this,r._widevineLicenseUrl=void 0,r._licenseXhrSetup=void 0,r._emeEnabled=void 0,r._requestMediaKeySystemAccess=void 0,r._config=void 0,r._mediaKeysList=[],r._media=null,r._hasSetMediaKeys=!1,r._requestLicenseFailureCount=0,r._onMediaEncrypted=function(e){d["logger"].log('Media is encrypted using "'+e.initDataType+'" init data type'),r._attemptSetMediaKeys(),r._generateRequestWithPreferredKeySession(e.initDataType,e.initData)},r._config=t.config,r._widevineLicenseUrl=r._config.widevineLicenseUrl,r._licenseXhrSetup=r._config.licenseXhrSetup,r._emeEnabled=r._config.emeEnabled,r._requestMediaKeySystemAccess=r._config.requestMediaKeySystemAccessFunc,r}di(t,e);var r=t.prototype;return r.getLicenseServerUrl=function(e){switch(e){case ri.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},r._attemptKeySystemAccess=function(e,t,r){var i=this,a=fi(e,t,r);d["logger"].log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,a).then((function(t){i._onMediaKeySystemAccessObtained(e,t)})).catch((function(t){d["logger"].error('Failed to obtain key-system "'+e+'" access:',t)}))},r._onMediaKeySystemAccessObtained=function(e,t){var r=this;d["logger"].log('Access for key-system "'+e+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(i),t.createMediaKeys().then((function(t){i.mediaKeys=t,d["logger"].log('Media-keys created for key-system "'+e+'"'),r._onMediaKeysCreated()})).catch((function(e){d["logger"].error("Failed to create media-keys:",e)}))},r._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},r._onNewMediaKeySession=function(e){var t=this;d["logger"].log("New key-system session "+e.sessionId),e.addEventListener("message",(function(r){t._onKeySessionMessage(e,r.message)}),!1)},r._onKeySessionMessage=function(e,t){d["logger"].log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){d["logger"].log("Received license data (length: "+(t?t.byteLength:t)+"), updating key-session"),e.update(t)}))},r._attemptSetMediaKeys=function(){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return d["logger"].error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].KEY_SYSTEM_ERROR,details:o["ErrorDetails"].KEY_SYSTEM_NO_KEYS,fatal:!0});d["logger"].log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},r._generateRequestWithPreferredKeySession=function(e,t){var r=this,i=this._mediaKeysList[0];if(!i)return d["logger"].error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].KEY_SYSTEM_ERROR,details:o["ErrorDetails"].KEY_SYSTEM_NO_ACCESS,fatal:!0});if(i.mediaKeysSessionInitialized)d["logger"].warn("Key-Session already initialized but requested again");else{var a=i.mediaKeysSession;if(!a)return d["logger"].error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].KEY_SYSTEM_ERROR,details:o["ErrorDetails"].KEY_SYSTEM_NO_SESSION,fatal:!0});if(!t)return d["logger"].warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].KEY_SYSTEM_ERROR,details:o["ErrorDetails"].KEY_SYSTEM_NO_INIT_DATA,fatal:!0});d["logger"].log('Generating key-session request for "'+e+'" init data type'),i.mediaKeysSessionInitialized=!0,a.generateRequest(e,t).then((function(){d["logger"].debug("Key-session generation succeeded")})).catch((function(e){d["logger"].error("Error generating key-session request:",e),r.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].KEY_SYSTEM_ERROR,details:o["ErrorDetails"].KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},r._createLicenseXhr=function(e,t,r){var i=new XMLHttpRequest,a=this._licenseXhrSetup;try{if(a)try{a(i,e)}catch(n){i.open("POST",e,!0),a(i,e)}i.readyState||i.open("POST",e,!0)}catch(n){throw new Error("issue setting up KeySystem license XHR "+n)}return i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,e,t,r),i},r._onLicenseRequestReadyStageChange=function(e,t,r,i){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,d["logger"].log("License request succeeded"),"arraybuffer"!==e.responseType&&d["logger"].warn("xhr response type was not set to the expected arraybuffer for license request"),i(e.response);else{if(d["logger"].error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>ci)return void this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].KEY_SYSTEM_ERROR,details:o["ErrorDetails"].KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var a=ci-this._requestLicenseFailureCount+1;d["logger"].warn("Retrying license request, "+a+" attempts left"),this._requestLicense(r,i)}break}},r._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case ri.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},r._requestLicense=function(e,t){d["logger"].log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return d["logger"].error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].KEY_SYSTEM_ERROR,details:o["ErrorDetails"].KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var i=this.getLicenseServerUrl(r.mediaKeySystemDomain),a=this._createLicenseXhr(i,e,t);d["logger"].log("Sending license request to URL: "+i);var n=this._generateLicenseRequestChallenge(r,e);a.send(n)}catch(s){d["logger"].error("Failure requesting DRM license: "+s),this.hls.trigger(u["default"].ERROR,{type:o["ErrorTypes"].KEY_SYSTEM_ERROR,details:o["ErrorDetails"].KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},r.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},r.onMediaDetached=function(){this._media&&(this._media.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null)},r.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map((function(e){return e.audioCodec})),r=e.levels.map((function(e){return e.videoCodec}));this._attemptKeySystemAccess(ri.WIDEVINE,t,r)}},ui(t,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),t}(f),pi=gi;function vi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),i.forEach((function(t){mi(e,t,r[t])}))}return e}function mi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var yi=vi({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ht,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:At,bufferController:wt,capLevelController:Pt,fpsController:Ut,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:oi},Ei(),{subtitleStreamController:si,subtitleTrackController:$r,timelineController:Yr,audioStreamController:rr,audioTrackController:zt,emeController:pi});function Ei(){return{cueHandler:i,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es"}}function Ti(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),i.forEach((function(t){Si(e,t,r[t])}))}return e}function Si(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ai(e,t,r){return t&&_i(e.prototype,t),r&&_i(e,r),e}function Ri(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}r.d(t,"default",(function(){return Di}));var Di=function(e){function t(r){var i;void 0===r&&(r={}),i=e.call(this)||this,i.config=void 0,i._autoLevelCapping=void 0,i.abrController=void 0,i.capLevelController=void 0,i.levelController=void 0,i.streamController=void 0,i.networkControllers=void 0,i.audioTrackController=void 0,i.subtitleTrackController=void 0,i.emeController=void 0,i.coreComponents=void 0,i.media=null,i.url=null;var a=t.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");i.config=Ti({},a,r);var n=bi(i),s=n.config;if(void 0!==s.liveMaxLatencyDurationCount&&s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==s.liveMaxLatencyDuration&&(void 0===s.liveSyncDuration||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(d["enableLogs"])(s.debug),i._autoLevelCapping=-1;var o=i.abrController=new s.abrController(bi(i)),l=new s.bufferController(bi(i)),u=i.capLevelController=new s.capLevelController(bi(i)),c=new s.fpsController(bi(i)),h=new V(bi(i)),f=new q(bi(i)),g=new Q(bi(i)),p=new ct(bi(i)),v=i.levelController=new at(bi(i)),m=new Z(bi(i)),y=i.streamController=new $e(bi(i),m),E=[v,y],T=s.audioStreamController;T&&E.push(new T(bi(i),m)),i.networkControllers=E;var S=[h,f,g,o,l,u,c,p,m];if(T=s.audioTrackController,T){var b=new T(bi(i));i.audioTrackController=b,S.push(b)}if(T=s.subtitleTrackController,T){var _=new T(bi(i));i.subtitleTrackController=_,E.push(_)}if(T=s.emeController,T){var A=new T(bi(i));i.emeController=A,S.push(A)}return T=s.subtitleStreamController,T&&E.push(new T(bi(i),m)),T=s.timelineController,T&&S.push(new T(bi(i))),i.coreComponents=S,i}Ri(t,e),t.isSupported=function(){return ht()},Ai(t,null,[{key:"version",get:function(){return"0.13.2"}},{key:"Events",get:function(){return u["default"]}},{key:"ErrorTypes",get:function(){return o["ErrorTypes"]}},{key:"ErrorDetails",get:function(){return o["ErrorDetails"]}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:yi},set:function(e){t.defaultConfig=e}}]);var r=t.prototype;return r.destroy=function(){d["logger"].log("destroy"),this.trigger(u["default"].DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(e){e.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},r.attachMedia=function(e){d["logger"].log("attachMedia"),this.media=e,this.trigger(u["default"].MEDIA_ATTACHING,{media:e})},r.detachMedia=function(){d["logger"].log("detachMedia"),this.trigger(u["default"].MEDIA_DETACHING),this.media=null},r.loadSource=function(e){e=s["buildAbsoluteURL"](window.location.href,e,{alwaysNormalize:!0}),d["logger"].log("loadSource:"+e),this.url=e,this.trigger(u["default"].MANIFEST_LOADING,{url:e})},r.startLoad=function(e){void 0===e&&(e=-1),d["logger"].log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},r.stopLoad=function(){d["logger"].log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},r.swapAudioCodec=function(){d["logger"].log("swapAudioCodec"),this.streamController.swapAudioCodec()},r.recoverMediaError=function(){d["logger"].log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},Ai(t,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){d["logger"].log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){d["logger"].log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){d["logger"].log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){d["logger"].log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){d["logger"].log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){d["logger"].log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,r=e?e.length:0,i=0;i<r;i++){var a=e[i].realBitrate?Math.max(e[i].realBitrate,e[i].bitrate):e[i].bitrate;if(a>t)return i}return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping;return e=-1===r&&t&&t.length?t.length-1:r,e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),t}(ue);Di.defaultConfig=void 0},"./src/polyfills/number-isFinite.js":
/*!******************************************!*\
  !*** ./src/polyfills/number-isFinite.js ***!
  \******************************************/
/*! exports provided: isFiniteNumber */function(e,t,r){"use strict";r.r(t),r.d(t,"isFiniteNumber",(function(){return i}));var i=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)}},"./src/utils/get-self-scope.js":
/*!*************************************!*\
  !*** ./src/utils/get-self-scope.js ***!
  \*************************************/
/*! exports provided: getSelfScope */function(e,t,r){"use strict";function i(){return"undefined"===typeof window?self:window}r.r(t),r.d(t,"getSelfScope",(function(){return i}))},"./src/utils/logger.js":
/*!*****************************!*\
  !*** ./src/utils/logger.js ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(e,t,r){"use strict";r.r(t),r.d(t,"enableLogs",(function(){return c})),r.d(t,"logger",(function(){return h}));var i=r(/*! ./get-self-scope */"./src/utils/get-self-scope.js");function a(){}var n={trace:a,debug:a,log:a,warn:a,info:a,error:a},s=n;function o(e,t){return t="["+e+"] > "+t,t}var l=Object(i["getSelfScope"])();function u(e){var t=l.console[e];return t?function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];i[0]&&(i[0]=o(e,i[0])),t.apply(l.console,i)}:a}function d(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach((function(t){s[t]=e[t]?e[t].bind(e):u(t)}))}var c=function(e){if(l.console&&!0===e||"object"===typeof e){d(e,"debug","log","info","warn","error");try{s.log()}catch(t){s=n}}else s=n},h=s}})["default"]}))}}]);>>>>>>> .r82661
